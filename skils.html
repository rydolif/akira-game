<html lang="en" class=" desktop portrait">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="keywords" content="ментальная арифметика, платформа по ментальной арифметике, тренажеры по ментальной арифметике, портал по ментальной арифметике, домашние задания для ментальной арифметики, абакус, соробан, анзан, crm система, ментальная арифметика скачать, ментальная арифметика обучение, ментальная арифметика франшиза, абакус, Абакус-центр, AMAkids, Smartykids, UCMAS, PAMA, PAMAGLOBAL, abacus, mental arithmetic, online platform mental arithmetic">
    <meta name="description" content="mindskills.ru - это лучшая онлайн платформа по ментальной арифметике с красочными тренажерами с  настраиваемыми параметрами  для каждого ученика, с удобной и простой CRM системой учета посещений, оплат, с возможностью задавать домашние задания, с детальной статистикой выполнения заданий, а также онлайн баттлы, онлайн олимпиады, рейтинги и многое другое">
    <meta name="yandex-verification" content="b0b2abeb71178a3b">
    <meta name="google-site-verification" content="Oq6HwhQkLG9zKCfUXwetAn2-EIee9lmoTA6vk2LRT6U">
    <link rel="shortcut icon" href="/testos/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/testos/static/bootstrap4/bootstrap_sketchy.min.css">
    <link rel="stylesheet" href="/testos/static/AdminLTE/bower_components/font-awesome/css/font-awesome.min.css">
    <script src="/testos/static/AdminLTE/jquery.min.js"></script>
    <script src="/testos/static/bootstrap4/popper.min.js"></script>
    <script src="/testos/static/bootstrap4/bootstrap.min.js"></script>
    <script src="/testos/static/bootstrap4/sketchy_bootstrap.js"></script>
    <script src="/testos/static/js/bootstrap-slider.js"></script>
    <script src="/testos/static/js/device.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Neucha&amp;subset=cyrillic" rel="stylesheet">
    <link rel="stylesheet" href="/testos/css/main.css">
    <title>Флэш карты</title>
</head>

<body class="">
    <nav class="navbar navbar-expand-lg border-info navbar-light screen" style="height: 10vh; background-color: #e2f7df" id="navbar">
        <span class="d-none" id="csrf_check">
            <input type="hidden" name="csrfmiddlewaretoken" value="kjyf6OmwyyrSScgfKnA5kvvS8hU9t3wYVAKGbzq6fJg1a63v2BGcJMBdZX8ny1U7">
            <input type="hidden" id="check_url" value="/csrf_check">
        </span>
        <input type="hidden" id="is_auth_check" value="/is_auth_check">
        <input type="hidden" id="module_names" value="/games/api/module_names/">
        <input type="hidden" id="name_methodic" value="abakus">
        <input type="hidden" id="voice_methodic" value="classic">
        <a class="navbar-brand" tabindex="-1" href="&#10;        &#10;            /games/&#10;       "></a>
        <button tabindex="-1" class="navbar-toggler navbar-toggler-close" data-toggle="modal" data-target="#modal_change_bead_color">
            Цвет
        </button>
        <button tabindex="-1" class="navbar-toggler show_block" data-block_type="settings" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation" style="">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarColor03">
            <ul class="navbar-nav mr-auto">

                <li class="nav-item dropdown task-hidden">
                    <a tabindex="-1" href="#" class="dropdown-toggle btn btn-outline-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Режим </a>
                    <div class="dropdown-menu border-info btn-outline-info noclose">
                        <a class="dropdown-item" href="skils.html" onclick="change_mode('abakus')">Aбакуса</a>
                        <a class="dropdown-item" href="forsag.html" onclick="change_mode('abakus')">Числа</a>
                        <!-- <a class="dropdown-item" href="#" onclick="change_mode('abakus')">Режим абакуса</a>
                        <a class="dropdown-item" href="#" onclick="change_mode('flash_card')">Режим флэш-карт</a> -->
                    </div>
                </li>

                <li class="nav-item dropdown d-none  tablet-hidden mobile-hidden">
                    <a tabindex="-1" href="#" class="dropdown-toggle btn btn-outline-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Режим <span class="mode_display"></span> </a>
                    <div class="dropdown-menu border-warning btn-outline-warning noclose">
                        <a class="dropdown-item mode" data-mode_type="default" href="#"> <input type="hidden" value="off"> <span class="activity"><i class="fa fa-check"></i></span> <span class="title">Выкл. все режимы</span> </a>
                        <div class="dropdown-divider border-secondary"></div>
                        <a class="dropdown-item mode" data-mode_type="negative" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">Отрицательные числа</span></a>
                        <div class="dropdown-divider border-secondary"></div>
                        <a class="dropdown-item mode" data-mode_type="disorder" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">Разброс</span></a>
                        <a class="dropdown-item mode" data-mode_type="2_screens" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">2 Экрана</span></a>
                        <a class="dropdown-item mode" data-mode_type="3_screens" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">3 Экрана</span></a>
                        <div class="dropdown-divider border-secondary"></div>
                        <a class="dropdown-item mode" data-mode_type="decimal_1" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">Дробные числа (1 знак )</span></a>
                        <a class="dropdown-item mode" data-mode_type="decimal_2" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">Дробных числа (2 знака )</span></a>
                        <div class="dropdown-divider border-secondary"></div>
                        <a class="dropdown-item mode" data-mode_type="mode_50" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">Переход через 50</span></a>
                        <a class="dropdown-item mode" data-mode_type="mode_100" href="#"><input type="hidden" value="off"><span class="activity"></span> <span class="title">Переход через 100</span></a>
                    </div>
                </li>

                <li class="nav-item dropdown  tablet-hidden mobile-hidden ">
                    <a tabindex="-1" class="dropdown-toggle btn btn-outline-secondary" data-toggle="dropdown" href="#" id="themes">Players: <span class="screens_nmb_display">1</span></a>
                    <div class="dropdown-menu border-secondary text-center btn-outline-secondary2" aria-labelledby="themes">
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(1)" href="#" data-value="1">1</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(2)" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(3)" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(4)" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(5)" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(6)" href="#" data-value="6">6</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(7)" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(8)" href="#" data-value="8">8</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(9)" href="#" data-value="9">9</a>
                        <a class="dropdown-item navbar_screens_nmb" onclick="create_screens(10)" href="#" data-value="10">10</a>
                    </div>
                </li>

                <li class="nav-item dropdown tablet-hidden mobile-hidden">
                    <a tabindex="-1" href="#" class="btn btn-outline-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Скорость: <span class="interval_display">1</span> </a>
                    <div class="dropdown-menu border-danger text-center btn-outline-danger">
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 0.1, screen_pk: 'global'})" href="#" data-value="0.1">0.1 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 0.2, screen_pk: 'global'})" href="#" data-value="0.2">0.2 сек</a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 0.3, screen_pk: 'global'})" href="#" data-value="0.3">0.3 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 0.4, screen_pk: 'global'})" href="#" data-value="0.4">0.4 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 0.5, screen_pk: 'global'})" href="#" data-value="0.5">0.5 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 0.7, screen_pk: 'global'})" href="#" data-value="0.7">0.7 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 1, screen_pk: 'global'})" href="#" data-value="1">1 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 1.2, screen_pk: 'global'})" href="#" data-value="1.2">1.2 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 1.5, screen_pk: 'global'})" href="#" data-value="1.5">1.5 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 1.8, screen_pk: 'global'})" href="#" data-value="1.8">1.8 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 2, screen_pk: 'global'})" href="#" data-value="2">2 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 2.5, screen_pk: 'global'})" href="#" data-value="2.5">2.5 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 3, screen_pk: 'global'})" href="#" data-value="3">3 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 3.5, screen_pk: 'global'})" href="#" data-value="3.5">3.5 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 4, screen_pk: 'global'})" href="#" data-value="4">4 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 5, screen_pk: 'global'})" href="#" data-value="5">5 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 7, screen_pk: 'global'})" href="#" data-value="7">7 сек </a>
                        <a class="dropdown-item navbar_interval" onclick="edit_parameter({value_type: 'interval', value: 10, screen_pk: 'global'})" href="#" data-value="10">10 сек </a>
                    </div>
                </li>

                <li class="nav-item dropdown tablet-hidden mobile-hidden">
                    <a tabindex="-1" href="#" class="btn btn-outline-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cпицы: <span class="digits_nmb_display">4</span> </a>
                    <div class="dropdown-menu border-success text-center btn-outline-success">
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 1, screen_pk: 'global'})" href="#">1</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 2, screen_pk: 'global'})" href="#">2</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 3, screen_pk: 'global'})" href="#">3</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 4, screen_pk: 'global'})" href="#">4</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 5, screen_pk: 'global'})" href="#">5</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 6, screen_pk: 'global'})" href="#">6</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 7, screen_pk: 'global'})" href="#">7</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 8, screen_pk: 'global'})" href="#">8</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 9, screen_pk: 'global'})" href="#">9</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'digits_nmb', value: 10, screen_pk: 'global'})" href="#">10</a>
                    </div>
                </li>

                <li class="nav-item dropdown tablet-hidden mobile-hidden">
                    <a tabindex="-1" href="#" class="btn btn-outline-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Примеров: <span class="impulses_nmb_display">1</span> </a>
                    <div class="dropdown-menu border-info text-center btn-outline-info">
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 1, screen_pk: 'global'})" href="#">1</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 2, screen_pk: 'global'})" href="#">2</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 3, screen_pk: 'global'})" href="#">3</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 4, screen_pk: 'global'})" href="#">4</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 5, screen_pk: 'global'})" href="#">5</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 6, screen_pk: 'global'})" href="#">6</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 7, screen_pk: 'global'})" href="#">7</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 8, screen_pk: 'global'})" href="#">8</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 9, screen_pk: 'global'})" href="#">9</a>
                        <a class="dropdown-item" onclick="edit_parameter({value_type: 'impulses_nmb', value: 10, screen_pk: 'global'})" href="#">10</a>
                    </div>
                </li>

                <li class="nav-pause nav-item dropdown tablet-hidden mobile-hidden">
                    <div class="btn-group inc-dec-control">
                        <label class="btn btn-nrm btn-danger pr-0 change_value_to_default dropdown-toggle" data-value_type="interval" data-value="1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Паузы: </label>
                        <div class="dropdown-menu border-info text-center btn-outline-info">
                            <label class="btn btn-nrm btn-danger input_decrease btn--arrow">  < </label>
                            <label class="btn btn-nrm btn-danger p-0">
                            <input type="number" name="interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="1"  min="0.1" max="10" step="0.1" data-decimal="1">
                            </label>
                            <label class="btn btn-nrm btn-danger input_increase btn--arrow"> > </label>
                        </div>
                    </div>
                </li>

                <li class="nav-pause nav-item dropdown tablet-hidden mobile-hidden">
                    <a tabindex="-1" href="#" class="btn btn-outline-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Знаки: </a>
                    <div class="card-body text-center p-2">
                        <div class="dropdown-menu border-info text-center btn-outline-info">
                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btn btn-outline-secondary active">
                            <input type="radio" name="sign" autocomplete="off" checked="" value="positive"> Положительные
                            </label>
                            <label class="btn btn-outline-secondary">
                            <input type="radio" name="sign"  autocomplete="off" value="negative"> Отрицательные
                            </label>
                            </div>
                        </div>
                    </div>
                </li>

            </ul>

            <a href="mailto:budni-verstalshika@akira.education" class="header__mail">budni-verstalshika@akira.education</a>

        </div>
    </nav>
    <script>
        $(document).ready(function () {

            $(".btn_voice").on("click", function () {
                if (GLOBAL_STATE.voice) {
                    GLOBAL_STATE.voice = false;
                    $(this).removeClass("btn-warning").addClass("btn-outline-warning");

                }
                else {
                    GLOBAL_STATE.voice = true;
                    $(this).addClass("btn-warning").removeClass("btn-outline-warning");
                    
                }

            });
            if (device.mobile() || device.tablet()) {
                GLOBAL_STATE.voice = false
            }
        })
    </script>
    <div id="main_screen" class="row col-12 justify-content-center m-0 p-0 bg_0" data-type="class">
        <div class="row screen_row col-12 justify-content-center p-0 m-0" data-row_position="up" data-row_screens_nmb="1">
            <div class="screen bg_color_1 m-0 p-0  align-items-center container-fluid text-center  col-12" id="1" style="border: 1px dotted grey; height:90vh;">
                <div class="block block--close" data-type="mini-control">
                    <div class="btn-group mini-control h-lg">
                        <div class="btn-group inc-dec-control">
                            <label class="btn btn-nrm-lg btn-lg btn-success input_decrease mb-0"> &lt; </label>
                            <label class="btn btn-nrm-lg btn-lg btn-success p-0 input-group mb-0 bg-light-success">
                                <input tabindex="-1" type="number" name="digits_nmb" class="form-control input-nrm text-center no-border bg-light-success p-0 input_number" value="4" min="1" max="10" step="1" data-decimal="0">
                                <span class="bg-light-success pr-2 d-flex align-items-center"> ц </span>
                            </label>
                            <label class="btn btn-nrm-lg btn-lg btn-success mb-0 input_increase"> &gt; </label>
                        </div>
                        <a tabindex="-1" class="btn btn-nrm-lg input-nrm btn-lg btn-warning player_name_title d-flex align-items-center">
                            <span class="player_name_points6">
                                <input tabindex="-1" class="screen_title m-1 text-center" style="max-width: 70px; border: none; background: inherit;" value="Игрок 1">
                                (<span class="player_points">0</span>)</span>
                        </a>
                        <div class="btn-group inc-dec-control">
                            <label class="btn btn-nrm-lg btn-lg btn-danger mb-0 input_decrease"> &lt; </label>
                            <label class="btn btn-nrm-lg btn-lg btn-danger p-0 mb-0 input-group bg-light-danger">
                                <input tabindex="-1" type="number" name="interval" class="form-control input-nrm text-center p-0 no-border bg-light-danger input_number" value="1" min="0.1" max="5" step="0.1" data-decimal="1">
                                <span class="bg-light-danger pr-2  d-flex align-items-center"> c </span> </label>
                            <label class="btn btn-nrm-lg btn-lg mb-0 btn-danger input_increase"> &gt; </label>
                        </div>
                    </div>
                </div>
                <div class="block card-body col-12 row m-0 p-0 justify-content-center align-items-center" data-type="problem">
                    <div class="col d-none d-lg-block left_hero left_hero_0  mr-5" style="height: 80vh; "></div>
                    <div class="col p-0 m-0 block" data-type="problem_inner">
                        <div class="block col-12 row justify-content-center p-0 m-0" data-type="flash_card">
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div class="bead bead-number invisible" data-col="0" style="width: 1.720533728687917vw; height: 1.0323202372127502vw; font-size: 0.8602668643439585vw;">0</div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div class="bead bead-line bead-line-default" style="width: 1.720533728687917vw; height: 0.17205337286879172vw "></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="2" data-col="0" class="bead  bead-inactive bead-inactive-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="3" data-col="0" class="bead  bead-empty bead-empty-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div class="bead bead-line bead-line-default" style="width: 1.720533728687917vw; height: 0.17205337286879172vw "></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="5" data-col="0" class="bead  bead-empty bead-empty-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="6" data-col="0" class="bead  bead-inactive bead-inactive-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="7" data-col="0" class="bead  bead-inactive bead-inactive-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="8" data-col="0" class="bead  bead-inactive bead-inactive-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div data-row="9" data-col="0" class="bead  bead-inactive bead-inactive-default" style="width: 1.720533728687917vw; height: 0.6882134914751669vw"></div>
                            </div>
                            <div class="col-12 row justify-content-center p-0 m-0 ">
                                <div class="bead bead-line bead-line-default" style="width: 1.720533728687917vw; height: 0.17205337286879172vw "></div>
                            </div>
                        </div>
                        <div class="block col-12 row justify-content-center  p-0 m-0 d-none" data-type="answer_inputs"></div>
                        <div class="block col-12 row justify-content-center  p-0 m-0" data-type="answer_input">
                            <div class="progress timer_block invisible" style="width: 80%; height: 7px; padding: 0; border: none">
                                <div class="timer_bar progress-bar progress-bar-striped bg-danger progress-bar-animated color-black" style="width: 100%; ">
                                    <span style="position: absolute; left: 30%; font-weight: 100;"></span>
                                </div>
                            </div>
                            <div class="input-group mb-3 mt-5" style="width:30vw">
                                <div class="input-group-prepend">
                                    <span class="btn btn-success pr-3 pl-3 show_block" data-block_type="settings" style="font-size:5vh"><i class="fa fa-bars"></i></span>
                                </div>
                                <input type="number" inputmode="numeric" name="answer_input" data-number="1" class="form-control answer_input text-center" placeholder="Ответ" style="font-size:5vh">
                                <div class="input-group-append">
                                    <span class="btn btn-primary btn_start pr-3 pl-3" style="font-size:5vh"><i class="fa fa-play"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="block col-12 row justify-content-center  p-0 m-0">
            <form class="form-inline my-2 my-lg-0">
                <button type="button" tabindex="-1" class="btn my-2 my-sm-0" id="btn_global_refresh" onclick="global_refresh()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content="Обнулить/заново" data-original-title="" title="">
                    <img src="img/header--item1.png" alt="">
                </button>
                <div class="main_btn_group form-inline">
                    <button type="button" tabindex="-1" class="btn btn-secondary my-2 my-sm-0 d-none" id="btn_global_restart" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Заново" data-original-title="" title=""><i class="fa fa-refresh"></i></button>
                    <button type="button" tabindex="-1" class="btn btn-purple my-2 my-sm-0  d-none" id="btn_global_show_example" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Показать примеры" data-original-title="" title=""><i class="fa fa-eye"></i></button>
                    <button type="button" tabindex="-1" class="btn btn-success my-2 my-sm-0  d-none" id="btn_global_show_result" onclick="$('#modal_result').modal()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Результаты" data-original-title="" title=""><i class="fa fa-thumbs-up"></i></button>
                    <button type="button" tabindex="-1" class="btn btn-info my-2 my-sm-0  d-none" id="btn_global_check_answer" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Проверить" data-original-title="" title=""><i class="fa fa-question"></i></button>
                    <button type="button" tabindex="-1" class="btn btn-warning my-2 my-sm-0  d-none" id="btn_global_pause" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Пауза" data-original-title="" title=""><i class="fa fa-pause"></i></button>
                    <button type="button" tabindex="-1" class="btn my-2 my-sm-0" id="btn_global_start" onclick="global_start()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Старт" data-original-title="" title="">
                        <img src="img/header--item2.png" alt="">
                    </button>
                    <button type="button" tabindex="-1" class="btn btn-success my-2 my-sm-0  d-none" id="btn_global_next" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Следующий" data-original-title="" title=""><i class="fa fa-forward"></i></button>
                    <button type="button" tabindex="-1" class="btn btn-success my-2 my-sm-0  d-none" id="btn_global_continue" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Продолжить" data-original-title="" title=""><i class="fa fa-play"></i></button>
                </div>
                <button type="button" id="btn_global_stop" tabindex="-1" onclick="global_stop()" class="btn my-2 my-sm-0" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Стоп" data-original-title="" title=""><i class="fa fa-stop"></i></button>
                <div class="btn-group" role="group">
                    <button type="button" tabindex="-1" class="btn btn-warning my-2 my-sm-0" onclick="$('#modal_global_settings').modal()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Настройки" data-original-title="" title="">
                        <img src="img/header--item4.png" alt="">
                    </button>
                </div>
            </form>
            </div>
                    </div>
                    <div class="col d-none d-lg-block right_hero right_hero_0 ml-5 " style="height: 80vh; "></div>
                </div>
                <div class="block row col-12 d-none card-body  align-items-center" data-type="settings">
                    <div class="col left_hero left_hero_0 settings_hero" style="height: 80vh; "></div>
                    <div class="row justify-content-center col  p-0 m-0">
                        <form>
                            <div class="col-12 card-body text-center p-0">
                                <h4 class="neucha"><a class="btn btn-info color-white mr-3 show_block" data-block_type="problem"><i class="fa fa-arrow-left"></i></a>Настройки<a class="btn btn_start btn-success color-white ml-3"><i class="fa fa-play"></i></a></h4>
                                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="1"> 1</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="2"> 2</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="3"> 3</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="4"> 4</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="5"> 5</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="6"> 6</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="7"> 7</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="8"> 8</label>
                                    <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="9"> 9</label>
                                    <label class="btn_check_all_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="check_all_digits" checked="checked" value="on"><i class="fa fa-check"></i></label>
                                </div>
                            </div>
                            <div class="card-body text-center p-2">
                                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                    <label class="btn btn-outline-secondary active">
                                        <input type="radio" name="sign" autocomplete="off" checked="" value="off"> Положительные
                                    </label>
                                    <label class="btn btn-outline-secondary">
                                        <input type="radio" name="sign" autocomplete="off" value="off"> Отрицательные
                                    </label>
                                </div>
                            </div>
                            <div class="card-body text-center">
                                <h4 class="neucha">Количество игроков</h4>
                                <div class="btn-group">
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm-2 btn-secondary change_value_to_default" data-value_type="screens_nmb" data-value="1">Игроков: </label>
                                        <label class="btn btn-nrm-2 btn-secondary input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm-2 btn-secondary p-0">
                                            <input type="number" name="screens_nmb" class="form-control input-nrm-2 text-center border-secondary bg-light-secondary input_number" value="1" min="1" max="10" step="1" data-decimal="0">
                                        </label>
                                        <label class="btn btn-nrm-2 btn-secondary input_increase"> &gt; </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 card-body text-center p-0">
                                <div class="btn-group2">
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm btn-success pr-0 change_value_to_default" data-value_type="digits_nmb" data-value="1">Цифр: </label>
                                        <label class="btn btn-nrm btn-success input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm btn-success p-0">
                                            <input type="number" name="digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="1" min="1" max="10" step="1" data-decimal="0">
                                        </label>
                                        <label class="btn btn-nrm btn-success input_increase"> &gt; </label>
                                    </div>
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm btn-success pr-0 change_value_to_default" data-value_type="progress_digits_nmb" data-value="0">Про: </label>
                                        <label class="btn btn-nrm btn-success input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm btn-success p-0">
                                            <input type="number" name="progress_digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="0" min="0" max="10" step="1" data-decimal="0">
                                        </label>
                                        <label class="btn btn-nrm btn-success input_increase"> &gt; </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 card-body text-center p-0 ">
                                <div class="btn-group2">
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm btn-info pr-0 change_value_to_default" data-value_type="impulses_nmb" data-value="1">Импульсов: </label>
                                        <label class="btn btn-nrm btn-info input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm btn-info p-0">
                                            <input type="number" name="impulses_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="1" min="1" max="10" step="1" data-decimal="0">
                                        </label>
                                        <label class="btn btn-nrm btn-info input_increase"> &gt; </label>
                                    </div>
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm btn-info pr-0 change_value_to_default" data-value_type="progress_impulses_nmb" data-value="0">Про: </label>
                                        <label class="btn btn-nrm btn-info input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm btn-info p-0">
                                            <input type="number" name="progress_impulses_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="0" min="0" max="10" step="1" data-decimal="0">
                                        </label>
                                        <label class="btn btn-nrm btn-info input_increase"> &gt; </label>
                                    </div>
                                </div>
                            </div>
<!--                             <div class="col-12 card-body text-center p-0">
                                <div class="btn-group2">
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm btn-danger pr-0 change_value_to_default" data-value_type="interval" data-value="1">Интервал: </label>
                                        <label class="btn btn-nrm btn-danger input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm btn-danger p-0">
                                            <input type="number" name="interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="1" min="0.1" max="10" step="0.1" data-decimal="1">
                                        </label>
                                        <label class="btn btn-nrm btn-danger input_increase"> &gt; </label>
                                    </div>
                                    <div class="btn-group inc-dec-control">
                                        <label class="btn btn-nrm btn-danger pr-0 change_value_to_default" data-value_type="progress_interval" data-value="0">Про:</label>
                                        <label class="btn btn-nrm btn-danger input_decrease"> &lt; </label>
                                        <label class="btn btn-nrm btn-danger p-0">
                                            <input type="number" name="progress_interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="0" min="0" max="10" step="1" data-decimal="0">
                                        </label>
                                        <label class="btn btn-nrm btn-danger input_increase"> &gt; </label>
                                    </div>
                                </div>
                            </div> -->
                        </form>
                    </div>
                    <div class="col right_hero right_hero_0 settings_hero" style="height: 80vh; "></div>
                </div>
                <div data-type="main" class="block card-body col row align-items-center justify-content-center col-12 d-none">
                    <div class="col left_hero left_hero_0 " style="height: 80vh; "></div>
                    <div class="col btn-group-vertical btn_group_main">
                        <a href="#" class="btn_start btn btn-lg btn-nrm btn-success mb-3"><i class="fa fa-play"> </i> Старт</a>
                        <a href="#" class="btn_continue d-none btn btn-lg btn-nrm btn-success mb-3"><i class="fa fa-play"> </i> Продолжить</a>
                        <a href="#" class="btn_next d-none btn btn-lg btn-nrm btn-success mb-3"><i class="fa fa-forward"> </i> Следующий</a>
                        <a href="#" class="btn_stop d-none btn btn-lg btn-nrm btn-danger mb-3"><i class="fa fa-stop"> </i> Стоп</a>
                        <a href="#" class="btn_restart d-none btn btn-lg btn-nrm btn-secondary mb-3"><i class="fa fa-refresh"> </i> Заново</a>
                        <a href="#" class="btn_show_example show_block hidden btn btn-lg btn-nrm btn-purple mb-3" data-block_type="problem"><i class="fa fa-eye"> </i> Задание</a>
                        <a href="#" class="btn_show_settings show_block btn btn-lg btn-nrm btn-warning" data-block_type="settings"><i class="fa fa-wrench"> </i> Настроить</a>
                    </div>
                    <div class="col right_hero right_hero_0  " style="height: 80vh; "></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal screen" id="modal_global_settings" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg " role="document" style="max-width: 600px;">
            <div class="bg_8 modal-content" style=" position: absolute; height: 100%; width: 100%; z-index: 99"></div>
            <div class="modal-content border-primary " style="background-color: rgba(255,255,255, 1); z-index: 100">
                <div class="modal-header border-info ">
                    <h3 class="modal-title neucha"> <img src="img/option.png" alt="">Настройки</h3>
                    <button type="button" class="btn btn-nrm-2 btn-danger" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <form action="" id="form_settings_global">
                    <input type="hidden" class="examples_nmb-input" name="examples_nmb" value="0">
                    <div class="modal-body">
                        <div class="row homework   d-none ">
                            <div class="col-md-6">
                                <div class="card-body text-center">
                                    <h5 class="neucha">Правильность выполнения </h5>
                                    <div id="correctness_text">
                                        <span class="correct_nmb">0</span> из <span class="examples_done">0</span>
                                        (<span class="correct_percent">0</span>%)
                                    </div>
                                    <div class="progress progress-striped margin-bottom-0 active">
                                        <div class="correctness_bar progress-bar progress-bar-success"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card-body text-center">
                                    <h5 class="neucha">Прогресс выполнения </h5>
                                    <div id="progress_text">
                                        <span class="examples_done">0</span> из <span class="examples_nmb">0</span>
                                        (<span class="done_percent">0</span>%)
                                    </div>
                                    <div class="progress progress-striped active margin-bottom-0">
                                        <div class="progress_bar progress-bar progress-bar-primary"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body text-center mb-3">
                            <h4 class="neucha">Используемые цифры</h4>
                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="1"> 1</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="2"> 2</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="3"> 3</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="4"> 4</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="5"> 5</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="6"> 6</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="7"> 7</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="8"> 8</label>
                                <label class="btn_checked_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="checked_digits" checked="checked" value="9"> 9</label>
                                <label class="btn_check_all_digits btn btn-outline-secondary btn-nrm-2 active"><input type="checkbox" name="check_all_digits" checked="checked"><i class="fa fa-check"></i></label>
                            </div>
                        </div>
                        <div class="card-body text-center ">
                            <h4 class="neucha">Знак</h4>
                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                <label class="btn btn-outline-secondary active">
                                    <input type="radio" name="options" id="option1" autocomplete="off" checked="" value="positive"> Положительные
                                </label>
                                <label class="btn btn-outline-secondary">
                                    <input type="radio" name="options" id="option2" autocomplete="off" value="negative"> Отрицательные
                                </label>
                            </div>
                        </div>
                        <div class="card-body text-center">
                            <h4 class="neucha">Количество цифр</h4>
                            <div class="btn-group inc-dec-control">
                                <label class="btn btn-nrm-2 btn-success change_value_to_default" data-value_type="digits_nmb" data-value="1">Цифр: </label>
                                <label class="btn btn-nrm-2 btn-success input_decrease"> &lt; </label>
                                <label class="btn btn-nrm-2 btn-success p-0">
                                    <input type="number" name="digits_nmb" class="form-control input-nrm-2 text-center border-success bg-light-success input_number" value="1" min="1" max="10" step="1" data-decimal="0">
                                </label>
                                <label class="btn btn-nrm-2 btn-success input_increase"> &gt; </label>
                            </div>
                        </div>
                        <div class="card-body text-center">
                            <h4 class="neucha">Количество импульсов</h4>
                            <div class="btn-group inc-dec-control">
                                <label class="btn btn-nrm-2 btn-info change_value_to_default pr-0" data-value_type="impulses_nmb" data-value="1">Импульсов:</label>
                                <label class="btn btn-nrm-2 btn-info input_decrease"> &lt; </label>
                                <label class="btn btn-nrm-2 btn-info p-0">
                                    <input type="number" name="impulses_nmb" class="form-control input-nrm-2 text-center border-info bg-light-info input_number" value="1" min="1" max="10" step="1" data-decimal="0">
                                </label>
                                <label class="btn btn-nrm-2 btn-info input_increase"> &gt; </label>
                            </div>
                            <div class="btn-group inc-dec-control">
                                <label class="btn btn-nrm-2 btn-info pr-0 change_value_to_default" data-value_type="progress_impulses_nmb" data-value="0" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="" data-content="При включенном прогрессе, количество действий увеличится на 1, если
                                    <br>  Было правильно выполнено то количество примеров, указанное в прогрессе действий

                                    <br><br>  Количество действий уменьшится на 1, если
                                    <br>  Было НЕправильно выполнено то количество примеров, указанное в прогрессе действий
                                    <br><br> Если включен параллельно прогресс скорости, то увеличение/уменьшение количества действий будет чередоваться с увеличением/уменьшением скорости" data-original-title="Прогресс количества действий">Прогресс: </label>
                                <label class="btn btn-nrm-2 btn-info input_decrease"> &lt; </label>
                                <label class="btn btn-nrm-2 btn-info p-0">
                                    <input type="number" name="progress_impulses_nmb" class="form-control input-nrm-2 text-center border-info bg-light-info input_number" value="0" min="0" max="10" step="1" data-decimal="0">
                                </label>
                                <label class="btn btn-nrm-2 btn-info input_increase"> &gt; </label>
                            </div>
                        </div>
<!--                         <div class="card-body text-center">
                            <h4 class="neucha">Интервал</h4>
                            <div class="btn-group-2">
                                <div class="btn-group inc-dec-control">
                                    <label class="btn btn-nrm-2 btn-danger change_value_to_default" data-value_type="interval" data-value="1" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="" data-content="Интервал - это время, которое дается на выполнение одной элементарной операции:
                                        Показ флэш карт" data-original-title="Интервал">Интервал: </label>
                                    <label class="btn btn-nrm-2 btn-danger input_decrease"> &lt; </label>
                                    <label class="btn btn-nrm-2 btn-danger p-0">
                                        <input type="number" name="interval" class="form-control input-nrm-2 text-center border-danger bg-light-danger input_number" value="1" min="0.1" max="10" step="0.1" data-decimal="1">
                                    </label>
                                    <label class="btn btn-danger btn-nrm-2 input_increase"> &gt; </label>
                                </div>
                                <div class="btn-group inc-dec-control">
                                    <label class="btn btn-nrm-2 btn-danger pr-0 change_value_to_default" data-value_type="progress_interval" data-value="0" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="" data-content="При включенном прогрессе скорости, скорость увеличится на 0.1, если
                                        <br>  Было правильно выполнено то количество примеров, указанное в прогрессе скорости

                                        <br><br>  Скорость уменьшится, если
                                        <br>  Было НЕправильно выполнено то количество примеров, указанное в прогрессе скорости
                                        <br><br> Если включен параллельно прогресс действий, то увеличение/уменьшение скорости будет чередоваться с увеличением/уменьшением количества действий" data-original-title="Прогресс количества скорости">Про: </label>
                                    <label class="btn btn-nrm-2 btn-danger input_decrease"> &lt; </label>
                                    <label class="btn btn-nrm-2 btn-danger p-0">
                                        <input type="number" name="progress_interval" class="form-control input-nrm-2 text-center border-danger bg-light-danger input_number" value="0" min="0" max="5" step="1" data-decimal="0">
                                    </label>
                                    <label class="btn btn-nrm-2 btn-danger input_increase"> &gt; </label>
                                </div>
                            </div>
                        </div> -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary pull-right" id="modal_settings_confirm">Применить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="modal_result">
        <div class="modal-dialog modal-lg border-danger" role="document">
            <div class="bg_8 modal-content" style=" position: absolute; height: 100%; width: 100%; z-index: 99"></div>
            <div class="modal-content  border-warning" style="background-color: rgba(255,255,204,0.8); z-index: 100">
                <div class="modal-header border-warning">
                    <h5 class="modal-title neucha">Твои результаты</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <form action="" data-action="" method="get" class="form-horizontal" id="result_form">
                    <input type="hidden" id="correct_percent" name="correct_percent" value="0">
                    <input type="hidden" id="points" name="points" value="0">
                    <input type="hidden" id="status" name="status" value="1">
                    <input type="hidden" id="duration" name="duration" value="">
                    <input type="hidden" id="done_date" name="done_date" value="">
                    <div class="modal-body">
                        <div class="row homework">
                            <div class="col-md-6">
                                <div class="card-body text-center">
                                    <h5 class="neucha">Правильность выполнения </h5>
                                    <div id="correctness_text">
                                        <span class="correct_nmb">0</span> из <span class="examples_done">0</span>
                                        (<span class="correct_percent">0</span>%)
                                    </div>
                                    <div class="progress">
                                        <div class="correctness_bar progress-bar progress-bar-striped bg-info" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card-body text-center">
                                    <h5 class="neucha">Прогресс выполнения </h5>
                                    <div id="progress_text">
                                        <span class="examples_done">0</span> из <span class="examples_nmb_display">0</span>
                                        (<span class="done_percent">0</span>%)
                                    </div>
                                    <div class="progress">
                                        <div class="progress_bar progress-bar progress-bar-striped bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h4 class="neucha"> Поздравляем!!! Ты завершил задание</h4>
                        <h4 class="neucha d-none"> Ты набрал: <span class="points"></span> баллов</h4>
                        <h4 class="neucha text-success d-none plus_bonus_points_block"> Бонусные баллы за 100% правильность: <span class="plus_bonus_points"></span> баллов</h4>
                        <h4 class="neucha text-danger d-none minus_bonus_points_block"> Штрафные баллы за выполнение не в срок: <span class="minus_bonus_points"></span> баллов</h4>
                        <h4 class="neucha"> Итого за данное задание: <span class="summary_points"></span> баллов</h4>
                        <h4 class="neucha"> Итого выполнено: <span class="done_nmb"></span> примеров</h4>
                        <br>
                        <h4 class="neucha d-none"> За этот месяц ты на набрал: <span class="month_points"></span> баллов</h4>
                        <h4 class="neucha d-none"> Всего баллов за данный курс: <span class="cs_points"></span> баллов</h4>
                        <h4 class="neucha"> Время выполнения: <span class="duration"></span></h4>
                        <textarea readonly="" id="student_answer" cols="30" rows="10" class="form-control text-center border-info"></textarea>
                    </div>
                    <div class="modal-footer border-warning">
                        <button type="button" id="btn_save_results" class="btn btn-nrm-2 btn-uppercase-none btn-primary" onclick="send_result(force=true)">Отправить результаты</button>
                        <button type="submit" id="btn_next_tasks" class="btn btn-nrm-2 btn-uppercase-none btn-primary d-none">Перейти к новым заданиям</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="modal_alert">
        <div class="modal-dialog modal-lg border-danger" role="document">
            <div class="bg_8 modal-content" style=" position: absolute; height: 100%; width: 100%;"></div>
            <div class="modal-content  border-warning" style="background-color: rgba(255,255,204,0.8);">
                <div class="modal-header border-warning">
                    <h5 class="modal-title neucha">ВНИМАНИЕ!!!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body pb-0">
                    <h1 class="text-center" id="alert_message"></h1>
                </div>
                <div class="modal-footer border-warning">
                    <button type="button" class="btn btn-nrm-2 btn-success" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
                $("#modal_change_bead_color").modal()
            })
        </script>
    <div class="modal" id="modal_browser_alert2">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">ВНИМАНИЕ!!!!</h4>
                </div>
                <div class="modal-body">
                    <h4>Уважаемый пользователь! </h4>
                    <h5> Для корректной работы портала необходимо установить и работать на одном из следующих браузеров: </h5>
                    <br><br>
                    <p>
                        <a class="btn btn-lg btn-success" href="https://browser.yandex.ru/"><i class="fa fa-yahoo" aria-hidden="true"></i> Yandex Browser</a>
                        <a class="btn btn-lg btn-primary  pull-right" href="https://www.google.ru/chrome/browser/desktop/index.html"><i class="fa fa-google" aria-hidden="true"></i> Google Chrome</a>
                    </p>
                    <p>
                        <a class="btn btn-lg btn-primary" href="http://www.opera.com/ru"><i class="fa fa-opera" aria-hidden="true"></i> Opera Browser</a>
                        <a class="btn btn-lg btn-primary pull-right" href="https://www.mozilla.org/ru/firefox/"><i class="fa fa-firefox" aria-hidden="true"></i> Mozilla Browser</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        function getInternetExplorerVersion() {
                var rv = -1;
                if (navigator.appName == 'Microsoft Internet Explorer') {
                    var ua = navigator.userAgent;
                    var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
                    if (re.exec(ua) != null)
                        rv = parseFloat(RegExp.$1);
                }
                else if (navigator.appName == 'Netscape') {
                    var ua = navigator.userAgent;
                    var re = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
                    if (re.exec(ua) != null)
                        rv = parseFloat(RegExp.$1);
                }
                return rv;
            }
            $(document).ready(function () {

                if (getInternetExplorerVersion() !== -1) {
                    window.location = '/browser_error/'
                }
            })
        </script>
    <input type="hidden" id="trans_simple" value="Простое">
    <input type="hidden" id="trans_brother" value="Помощь брата">
    <input type="hidden" id="trans_friend" value="Помощь друга">
    <input type="hidden" id="trans_friend_brother" value="Помощь друга + брата">
    <input type="hidden" id="trans_combo" value="Комбинированный счет">
    <input type="hidden" id="trans_random" value="Произвольный счет">
    <input type="hidden" id="trans_player" value="Игрок">
    <input type="hidden" id="trans_simple_short" value="Просто">
    <input type="hidden" id="trans_brother_short" value="Брат">
    <input type="hidden" id="trans_friend_short" value="Друг">
    <input type="hidden" id="trans_combo_short" value="Комбо">
    <input type="hidden" id="trans_random_short" value="Рандом">
    <input type="hidden" id="trans_plus" value="Сложение">
    <input type="hidden" id="trans_just_plus" value="Только сложение">
    <input type="hidden" id="trans_minus" value="Вычитание">
    <input type="hidden" id="trans_just_minus" value="Только вычитание">
    <input type="hidden" id="trans_plus_minus" value="Слож-е/Выч-е">
    <input type="hidden" id="trans_decimal_off" value="Дробь">
    <input type="hidden" id="trans_decimal_1_digit" value="Дробь 1">
    <input type="hidden" id="trans_decimal_2_digit" value="Дробь 2">
    <input type="hidden" id="trans_sign_off" value="Знак">
    <input type="hidden" id="trans_sign_on" value="✓ Знак">
    <input type="hidden" id="trans_sign_training" value="Т Знак">
    <input type="hidden" id="trans_progress_off" value="Прогресс">
    <input type="hidden" id="trans_progress_on" value="Про:">
    <input type="hidden" id="trans_progress_action_1" value="Д1">
    <input type="hidden" id="trans_progress_action_2" value="Д2">
    <input type="hidden" id="trans_progress_speed_1" value="С1">
    <input type="hidden" id="trans_progress_speed_2" value="С2">
    <input type="hidden" id="trans_countdown_1" value="На старт!">
    <input type="hidden" id="trans_countdown_2" value="Внимание!">
    <input type="hidden" id="trans_countdown_3" value="Марш!">
    <input type="hidden" id="trans_false_answer" value="Ой-ой! Ошибочка - бывает. Попробуй еще">
    <input type="hidden" id="is_ready" value="0">
    <input type="hidden" id="url_incorrect" value="/testos/static/games_audio/kungdu_panda_2/incrorrect">
    <input type="hidden" id="url_correct" value="/testos/static/games_audio/kungdu_panda_2/correct">
    <input type="hidden" id="url_present" value="/testos/static/audio/audio_for_menar_games/present">
    <input type="hidden" id="url_sounds" value="/testos/static/audio/audio_for_menar_games/sounds">
    <input type="hidden" id="url_voice" value="/testos/static/games_audio/voice/russian/female">
    <script>
    /**
     * Created by User on 07.09.2017.
     */

    $.fn.serializeObject = function() {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function to_boolean(t) {
        if (t === "true" || t === "on" || t === true || t === 1)
            return true;
        else if (t === "false" || t === false || t === 0 || t === undefined || t === null)
            return false;
        else
            return undefined
    }

    function randomInteger(n) {
        var t = Math.floor(Math.random() * (n - 0.0001));
        if (t < 0) t = 0;
        return t;
    }

    function random_between(n, m) {
        var t = n + randomInteger(m - n);
        return t;
    }

    function power10(n) {
        var d = 1;
        for (var i = 1; i <= n; i++) {
            d *= 10;
        }
        return d;
    }

    // mutliply 2 arrays

    function multiply_arrays(arr1, arr2, is_int) {
        if (is_int === undefined) is_int = false;
        var multi = [],
            obj1 = {},
            obj2 = {};

        for (var i = 0; i < arr1.length; i++)
            obj1[arr1[i]] = !0;

        for (i = 0; i < arr2.length; i++)
            obj2[arr2[i]] = !0;

        if (is_int)
            for (var el in obj1) obj2[el] && multi.push(parseInt(el));
        else
            for (var el in obj1) obj2[el] && multi.push(el);
        return multi;
    }

    function sum_of_arrays(arr1, arr2, is_int) {
        if (is_int === undefined) is_int = false;
        var sum = [],
            obj1 = {},
            obj2 = {};

        for (var i = 0; i < arr1.length; i++)
            obj1[arr1[i]] = !0;

        for (i = 0; i < arr2.length; i++)
            obj2[arr2[i]] = !0;

        for (var el in obj1)
            obj2[el] = !0;

        if (is_int)
            for (el in obj2)
                sum.push(parseInt(el))
        else
            for (el in obj2)
                sum.push(el)

        return sum;
    }


    // included element a in array arr
    function include_el_to_array(a, arr) {
        if (arr.indexOf(a) === -1)
            arr.push(a);
        return arr
    }

    function get_array_with_el_included(a, arr) {
        var new_arr = arr.slice();
        if (new_arr.indexOf(a) === -1)
            new_arr.push(a);
        return new_arr
    }

    // exists element in array arr
    function exist_in_array(a, arr) {
        var index = arr.indexOf(a);
        return (index !== -1)
    }

    // exclude element a from array arr
    function exclude_el_from_array(a, arr) {
        var index = arr.indexOf(a);
        if (index !== -1)
            arr.splice(index, 1);
        return arr;
    }

    // get new array with excluded element
    function get_array_with_el_excluded(a, arr) {
        var new_arr = arr.slice();
        var index = new_arr.indexOf(a);
        if (index !== -1)
            new_arr.splice(index, 1);
        return new_arr;
    }

    function toggle_el_to_array(a, arr) {
        var index = arr.indexOf(a);
        if (index !== -1)
            arr.splice(index, 1);
        else
            arr.push(a);
        return arr;
    }

    function get_array_with_el_toggled(a, arr) {
        var new_arr = arr.slice();
        var index = new_arr.indexOf(a);
        if (index !== -1)
            new_arr.splice(index, 1);
        else
            new_arr.push(a);
        return new_arr;
    }

    // included element a in array arr if element not exists else exclude element a from array arr

    function get_array_of_digits_from_str(str, splitter) {
        if (typeof str === "string") {
            var str_array = str.split(splitter);
            if (str_array.length === 0 || str_array[0] === "")
                return [];
            var digits_array = [];
            for (var i in str_array) {
                digits_array.push(parseInt(str_array[i]))
            }
            return digits_array;
        } else if (typeof str === "object") {
            array = [];
            for (e in str) {
                array.push(parseInt(str[e]))
            }
            return array
        } else {
            return str
        }
    }


    //rounds till 1 digit after dot: 1.3333 => 1.3
    function get_number_float_rounded(n) {
        n = parseFloat(n);
        number = Math.round(n * 10) / 10;
        if (number % 10 === 0) number = parseInt(number);
        return Math.round(n * 10) / 10;
    }

    function get_number_float_rounded2(n) {
        n = parseFloat(n);
        number = Math.round(n * 100) / 100;
        if (number % 100 === 0) number = parseInt(number);
        return Math.round(n * 100) / 100;
    }

    function get_number_float_rounded_for_sound(n) {
        n = parseFloat(n);
        number = Math.round(n * 10) / 10;
        return number.toFixed(1);
    }

    function get_number_float_rounded_for_sound2(n) {
        n = parseFloat(n);
        number = Math.round(n * 100) / 100;
        return number.toFixed(2);
    }

    //gets reversed digits array from number 1234 => [4,3,2,1]
    function get_digits_array_from_nmb(number, digits_nmb) {
        var str_number = number.toString();
        if (digits_nmb === undefined)
            digits_nmb = 0;
        if (digits_nmb > 0) {
            if (str_number.length < digits_nmb) {
                for (var i = 1; i <= digits_nmb - str_number.length; i++)
                    str_number = "0" + str_number;
            }
        }
        return get_array_of_digits_from_str(str_number.split("").reverse().join(","), ",");
    }

    function getRefundMode(refund_mode) {
        console.log('refund_mode 1  ', refund_mode)
        if (refund_mode !== undefined) {
            if (typeof refund_mode === 'string') {
                refund_mode = refund_mode.replace(/'/g, '');
                refund_mode = refund_mode.replace(/\s/g, '');
                refund_mode = refund_mode.replace(/"/g, '');
                refund_mode = refund_mode.replace('[', '');
                refund_mode = refund_mode.replace(']', '');

                console.log('refund_mode 2 ', refund_mode)
                const arr = refund_mode.split(',');

                console.log('arr 2 ', arr)

                const refundModeArray = [];
                for (var el of arr) {
                    refundModeArray.push(el)
                }
                return refundModeArray
            } else {
                return refund_mode.slice()
            }
        } else {
            return ['off']
        }

    }

    function get_parameters_parsed(parameters) {


        if (parameters.accept_just_true_answers === undefined) {
            parameters.accept_just_true_answers = 'off'
        }

        if (parameters.show_results === undefined) {
            parameters.show_results = 'on'
        }

        if (parameters.voice_results === undefined) {
            parameters.voice_results = 'on'
        }

        if (parameters.voice_numbers === undefined) {
            parameters.voice_numbers = 'on'
        }

        if (parameters.show_numbers === undefined) {
            parameters.show_numbers = 'on'
        }

        if (parameters.save_progress === undefined) {
            parameters.save_progress = 'off'
        }


        if (parameters.timer !== undefined) {
            parameters.timer = get_number_float_rounded(parameters.timer);
        }

        if (parameters.timer_select !== undefined) {
            if (parameters.timer_select !== "task_timer" && parameters.timer_select !== "action_timer") {
                parameters.timer_select = "off";
            }
        }
        if (parameters.timer_select === undefined) {
            parameters.timer_select = "off"
        }


        if (parameters.decimal_1) {
            parameters.decimal_1 = parseInt(parameters.decimal_1);
        } else {
            parameters.decimal_1 = 0
        }

        if (parameters.modulo === undefined) {
            parameters.modulo = 'off'
        }
        if (parameters.base === undefined) {
            parameters.base = '100'
        }

        parameters.refund_mode = getRefundMode(parameters.refund_mode)

        // if (parameters.refund_mode === undefined) {
        //   parameters.refund_mode = ['off']
        //} else if (typeof parameters.refund_mode === 'string') {
        //     parameters.refund_mode = [parameters.refund_mode]
        // }
        if (parameters.base_direction === undefined) {
            parameters.base_direction = 'less'
        }

        if (parameters.multiply_mode === undefined) {
            parameters.multiply_mode = 'ordinary_mode'
        }

        if (parameters.rounding) {
            parameters.rounding = parseInt(parameters.rounding);
        } else {
            parameters.rounding = 2
        }

        if (parameters.decimal_2) {
            parameters.decimal_2 = parseInt(parameters.decimal_2);
        } else {
            parameters.decimal_2 = 0
        }


        if (parameters.impulses_nmb)
            parameters.impulses_nmb = parseInt(parameters.impulses_nmb);


        if (parameters.columns_nmb)
            parameters.columns_nmb = parseInt(parameters.columns_nmb);

        if (parameters.tables_nmb)
            parameters.tables_nmb = parseInt(parameters.tables_nmb);

        if (parameters.interval)
            parameters.interval = get_number_float_rounded(parameters.interval);

        if (parameters.checked_digits) {
            if (typeof parameters.checked_digits === "string") {
                parameters.checked_digits = parameters.checked_digits.replace('[', '');
                parameters.checked_digits = parameters.checked_digits.replace(']', '');
            }
            parameters.checked_digits = get_array_of_digits_from_str(parameters.checked_digits, ",")
        } else
            parameters.checked_digits = [];

        if (parameters.checked_digits_1) {
            if (typeof parameters.checked_digits_1 === "string") {
                parameters.checked_digits_1 = parameters.checked_digits_1.replace('[', '');
                parameters.checked_digits_1 = parameters.checked_digits_1.replace(']', '');
            }

            parameters.checked_digits_1 = get_array_of_digits_from_str(parameters.checked_digits_1, ",");
        } else
            parameters.checked_digits_1 = [];

        if (parameters.checked_digits_11) {
            if (typeof parameters.checked_digits_11 === "string") {
                parameters.checked_digits_11 = parameters.checked_digits_11.replace('[', '');
                parameters.checked_digits_11 = parameters.checked_digits_11.replace(']', '');
            }

            parameters.checked_digits_11 = get_array_of_digits_from_str(parameters.checked_digits_11, ",");
        } else
            parameters.checked_digits_11 = parameters.checked_digits_1;


        if (parameters.checked_digits_2) {
            if (typeof parameters.checked_digits_2 === "string") {
                parameters.checked_digits_2 = parameters.checked_digits_2.replace('[', '');
                parameters.checked_digits_2 = parameters.checked_digits_2.replace(']', '');
            }

            parameters.checked_digits_2 = get_array_of_digits_from_str(parameters.checked_digits_2, ",");
        } else
            parameters.checked_digits_2 = [];

        if (parameters.checked_digits_21) {
            if (typeof parameters.checked_digits_21 === "string") {
                parameters.checked_digits_21 = parameters.checked_digits_21.replace('[', '');
                parameters.checked_digits_21 = parameters.checked_digits_21.replace(']', '');
            }

            parameters.checked_digits_21 = get_array_of_digits_from_str(parameters.checked_digits_21, ",");
        } else
            parameters.checked_digits_21 = parameters.checked_digits_2;

        if (parameters.digits_nmb)
            parameters.digits_nmb = parseInt(parameters.digits_nmb);

        if (parameters.screens_nmb)
            parameters.screens_nmb = parseInt(parameters.screens_nmb);

        if (parameters.digits_nmb_1)
            parameters.digits_nmb_1 = parseInt(parameters.digits_nmb_1);

        if (parameters.digits_nmb_2)
            parameters.digits_nmb_2 = parseInt(parameters.digits_nmb_2);

        if (parameters.examples_nmb)
            parameters.examples_nmb = parseInt(parameters.examples_nmb);

        if (parameters.summands_nmb)
            parameters.summands_nmb = parseInt(parameters.summands_nmb);

        if (parameters.actions_nmb)
            parameters.actions_nmb = parseInt(parameters.actions_nmb);

        if (parameters.progress_actions_nmb)
            parameters.progress_actions_nmb = parseInt(parameters.progress_actions_nmb);

        if (parameters.progress_interval)
            parameters.progress_interval = parseInt(parameters.progress_interval);

        if (parameters.progress_digits_nmb)
            parameters.progress_digits_nmb = parseInt(parameters.progress_digits_nmb);

        if (parameters.progress_impulses_nmb !== undefined) {
            parameters.progress_impulses_nmb = parseInt(parameters.progress_impulses_nmb);
        }

        if (parameters.is_alternation) {
            if (parameters.is_alternation === "true") {
                parameters.is_alternation = "on"
            } else if (parameters.is_alternation === "false") {
                parameters.is_alternation = "off"
            }
        }
        if (parameters.is_brother_global) {
            if (parameters.is_brother_global === "true") {
                parameters.mode_50 = "on"
            } else if (parameters.is_brother_global === "false") {
                parameters.mode_50 = "off"
            }
        }

        if (parameters.is_friend_global) {
            if (parameters.is_friend_global === "true") {
                parameters.mode_100 = "on"
            } else if (parameters.is_friend_global === "false") {
                parameters.mode_100 = "off"
            }
        }


        if (!parameters.all_discharge) {
            parameters.all_discharge = "on"
        }


        if (parameters.is_progress && parameters.is_progress === "true") {
            parameters.progress_speed = 2;
            parameters.progress_action = 2
        }

        if (parameters.progress_speed) {
            parameters.progress_speed = parseInt(parameters.progress_speed);
        }

        if (parameters.progress_action) {
            parameters.progress_action = parseInt(parameters.progress_action);
        }

        if (!parameters.sign) {
            parameters.sign = "off"
        }

        if (!parameters.decimal) {
            parameters.decimal = "off"
        }

        return parameters;
    }


    function digit_to_input($form, digit, operation, nmb) {
        if (nmb === undefined) nmb = 0;

        switch (parseInt(nmb)) {
            case 0:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits-input").val(), ',');
                break;
            case 1:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits_1-input").val(), ',');
                break;
            case 2:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits_2-input").val(), ',');
                break;
        }
        switch (operation) {
            case "toggle":
                toggle_el_to_array(digit, checked_digits_array);
                break;
            case "include":
                include_el_to_array(digit, checked_digits_array);
                break;
            case "exclude":
                exclude_el_from_array(digit, checked_digits_array);
                break;
        }
        switch (parseInt(nmb)) {
            case 0:
                $form.find(".checked_digits-input").val(checked_digits_array);
                break;
            case 1:
                $form.find(".checked_digits_1-input").val(checked_digits_array);
                break;
            case 2:
                $form.find(".checked_digits_2-input").val(checked_digits_array);
                break;
        }

    }

    function show_checked_digits($form, module) {
        $checked_digits = $form.find(".checked_digits-input");
        switch (module) {
            case "simple":
                for (var i = 1; i <= 4; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 5; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("5,6,7,8,9");
                break;
            case "brother":
                for (var i = 5; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 1; i <= 4; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("1,2,3,4");
                break;
            case "friend":
                for (var i = 1; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("1,2,3,4,5,6,7,8,9");
                break;
            case "combo":
                for (var i = 1; i <= 5; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 6; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("6,7,8,9");
                break;
            case "random":
                $form.find(".checked_digits").addClass("hidden active");
                $form.find(".check_all_digits-input").addClass("hidden");
                $checked_digits.val("0,1,2,3,4,5,6,7,8,9");
                break;
        }
    }
    </script>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>
    $(document).ready(function() {
        if (!device.mobile() && !device.tablet() && !is_task_mode()) {
            $('[data-toggle="popover"]').popover()
        }
        if (is_task_mode()) {
            $.ajax({
                type: "get",
                url: $("#task_parameters_url").val(),
                success: function(data) {
                    if (!data.parameters.checked_digits) {
                        data.parameters.checked_digits = [1, 2, 3, 4, 5, 6, 7, 8, 9]
                    }
                    set_setting_bars(data, 1, true);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters = get_parameters_parsed(data.parameters);
                        GLOBAL_STATE[i].all_examples_nmb = GLOBAL_STATE[i].parameters.examples_nmb
                        set_setting_bars(GLOBAL_STATE[i], i)
                    }

                    set_setting_bars(GLOBAL_STATE[1], 'global');
                }
            })
        }
    });

    function get_parameters() {
        parameters = $("#modal_global_settings").find("form").serializeObject();
        return get_parameters_parsed(parameters)
    }
    </script>
    <script src="/testos/static/js/device.min.js"></script>
    <script>
    var current_audio = new Audio();
    var current_audio2 = new Audio();
    var true_key = true;

    function stop_sound() {
        current_audio.pause();
        current_audio2.pause()
    }

    function sound_click(sound_type) {
        if (device.mobile() || device.tablet() || sound_type === 'tik-tak') {
            current_audio.src = $("#url_sounds").val() + "/" + sound_type + ".mp3";
            current_audio.play()
        } else {
            if (true_key) {
                true_key = false;
                current_audio.src = $("#url_sounds").val() + "/" + sound_type + ".mp3";
                current_audio.play()
            } else {
                true_key = true;
                current_audio2.src = $("#url_sounds").val() + "/" + sound_type + ".mp3";
                current_audio2.play()
            }
        }
    }

    /**
     * Created by User on 07.09.2017.
     */

    function to_boolean(t) {
        if (t === "true" || t === "on" || t === true || t === 1)
            return true;
        else if (t === "false" || t === false || t === 0 || t === undefined || t === null)
            return false;
        else
            return undefined
    }

    function randomInteger(n) {
        var t = Math.floor(Math.random() * (n - 0.0001));
        if (t < 0) t = 0;
        return t;
    }

    function random_between(n, m) {
        var t = n + randomInteger(m - n);
        return t;
    }

    function power10(n) {
        var d = 1;
        for (var i = 1; i <= n; i++) {
            d *= 10;
        }
        return d;
    }

    // mutliply 2 arrays

    function multiply_arrays(arr1, arr2, is_int) {
        if (is_int === undefined) is_int = false;
        var multi = [],
            obj1 = {},
            obj2 = {};

        for (var i = 0; i < arr1.length; i++)
            obj1[arr1[i]] = !0;

        for (i = 0; i < arr2.length; i++)
            obj2[arr2[i]] = !0;

        if (is_int)
            for (var el in obj1) obj2[el] && multi.push(parseInt(el));
        else
            for (var el in obj1) obj2[el] && multi.push(el);
        return multi;
    }

    function sum_of_arrays(arr1, arr2, is_int) {
        if (is_int === undefined) is_int = false;
        var sum = [],
            obj1 = {},
            obj2 = {};

        for (var i = 0; i < arr1.length; i++)
            obj1[arr1[i]] = !0;

        for (i = 0; i < arr2.length; i++)
            obj2[arr2[i]] = !0;

        for (var el in obj1)
            obj2[el] = !0;

        if (is_int)
            for (el in obj2)
                sum.push(parseInt(el))
        else
            for (el in obj2)
                sum.push(el)

        return sum;
    }


    // included element a in array arr
    function include_el_to_array(a, arr) {
        if (arr.indexOf(a) === -1)
            arr.push(a);
        return arr
    }

    function get_array_with_el_included(a, arr) {
        var new_arr = arr.slice();
        if (new_arr.indexOf(a) === -1)
            new_arr.push(a);
        return new_arr
    }

    // exists element in array arr
    function exist_in_array(a, arr) {
        var index = arr.indexOf(a);
        return (index !== -1)
    }

    // exclude element a from array arr
    function exclude_el_from_array(a, arr) {
        var index = arr.indexOf(a);
        if (index !== -1)
            arr.splice(index, 1);
        return arr;
    }

    // get new array with excluded element
    function get_array_with_el_excluded(a, arr) {
        var new_arr = arr.slice();
        var index = new_arr.indexOf(a);
        if (index !== -1)
            new_arr.splice(index, 1);
        return new_arr;
    }

    function toggle_el_to_array(a, arr) {
        var index = arr.indexOf(a);
        if (index !== -1)
            arr.splice(index, 1);
        else
            arr.push(a);
        return arr;
    }

    function get_array_with_el_toggled(a, arr) {
        var new_arr = arr.slice();
        var index = new_arr.indexOf(a);
        if (index !== -1)
            new_arr.splice(index, 1);
        else
            new_arr.push(a);
        return new_arr;
    }

    // included element a in array arr if element not exists else exclude element a from array arr

    function get_array_of_digits_from_str(str, splitter) {
        if (typeof str === "string") {
            var str_array = str.split(splitter);
            if (str_array.length === 0 || str_array[0] === "")
                return [];
            var digits_array = [];
            for (var i in str_array) {
                digits_array.push(parseInt(str_array[i]))
            }
            return digits_array;
        } else if (typeof str === "object") {
            array = [];
            for (e in str) {
                array.push(parseInt(str[e]))
            }
            return array
        } else {
            return str
        }
    }


    //rounds till 1 digit after dot: 1.3333 => 1.3
    function get_number_float_rounded(n) {
        n = parseFloat(n);
        number = Math.round(n * 10) / 10;
        if (number % 10 === 0) number = parseInt(number);
        return Math.round(n * 10) / 10;
    }

    function get_number_float_rounded2(n) {
        n = parseFloat(n);
        number = Math.round(n * 100) / 100;
        if (number % 100 === 0) number = parseInt(number);
        return Math.round(n * 100) / 100;
    }

    function get_number_float_rounded_for_sound(n) {
        n = parseFloat(n);
        number = Math.round(n * 10) / 10;
        return number.toFixed(1);
    }

    function get_number_float_rounded_for_sound2(n) {
        n = parseFloat(n);
        number = Math.round(n * 100) / 100;
        return number.toFixed(2);
    }

    //gets reversed digits array from number 1234 => [4,3,2,1]
    function get_digits_array_from_nmb(number, digits_nmb) {
        var str_number = number.toString();
        var str_number_length = str_number.length;
        if (digits_nmb === undefined)
            digits_nmb = 0;
        if (digits_nmb > 0) {
            if (str_number_length < digits_nmb) {
                for (var i = 1; i <= digits_nmb - str_number_length; i++)
                    str_number = "0" + str_number;
            }
        }
        return get_array_of_digits_from_str(str_number.split("").reverse().join(","), ",");
    }

    function get_parameters_parsed2(parameters) {
        if (parameters.decimal_1 !== undefined)
            parameters.decimal_1 = parseInt(parameters.decimal_1);

        if (parameters.decimal_2 !== undefined)
            parameters.decimal_2 = parseInt(parameters.decimal_2);

        if (parameters.impulses_nmb !== undefined)
            parameters.impulses_nmb = parseInt(parameters.impulses_nmb);


        if (parameters.columns_nmb !== undefined)
            parameters.columns_nmb = parseInt(parameters.columns_nmb);

        if (parameters.tables_nmb !== undefined)
            parameters.tables_nmb = parseInt(parameters.tables_nmb);

        if (parameters.interval !== undefined)
            parameters.interval = get_number_float_rounded(parameters.interval);

        if (parameters.checked_digits !== undefined)
            parameters.checked_digits = get_array_of_digits_from_str(parameters.checked_digits, ",")

        else
            parameters.checked_digits = [];

        if (parameters.checked_digits_1 !== undefined)
            parameters.checked_digits_1 = get_array_of_digits_from_str(parameters.checked_digits_1, ",");
        else
            parameters.checked_digits_1 = [];


        if (parameters.checked_digits_2 !== undefined)
            parameters.checked_digits_2 = get_array_of_digits_from_str(parameters.checked_digits_2, ",");
        else
            parameters.checked_digits_2 = [];

        if (parameters.digits_nmb !== undefined)
            parameters.digits_nmb = parseInt(parameters.digits_nmb);

        if (parameters.screens_nmb !== undefined)
            parameters.screens_nmb = parseInt(parameters.screens_nmb);

        if (parameters.digits_nmb_1 !== undefined)
            parameters.digits_nmb_1 = parseInt(parameters.digits_nmb_1);

        if (parameters.digits_nmb_2 !== undefined)
            parameters.digits_nmb_2 = parseInt(parameters.digits_nmb_2);

        if (parameters.examples_nmb !== undefined)
            parameters.examples_nmb = parseInt(parameters.examples_nmb);

        if (parameters.summands_nmb !== undefined)
            parameters.summands_nmb = parseInt(parameters.summands_nmb);

        if (parameters.is_alternation !== undefined) {
            if (parameters.is_alternation === "true") {
                parameters.is_alternation = "on"
            } else if (parameters.is_alternation === "false") {
                parameters.is_alternation = "off"
            }
        }
        if (parameters.is_brother_global !== undefined) {
            if (parameters.is_brother_global === "true") {
                parameters.mode_50 = "on"
            } else if (parameters.is_brother_global === "false") {
                parameters.mode_50 = "off"
            }
        }

        if (parameters.is_friend_global !== undefined) {
            if (parameters.is_friend_global === "true") {
                parameters.mode_100 = "on"
            } else if (parameters.is_friend_global === "false") {
                parameters.mode_100 = "off"
            }
        }


        if (!parameters.all_discharge !== undefined) {
            parameters.all_discharge = "on"
        }


        if (parameters.is_progress !== undefined && parameters.is_progress === "true") {
            parameters.progress_interval = 2;
            parameters.progress_impulses_nmb = 2
        }

        if (parameters.progress_interval !== undefined) {
            parameters.progress_interval = parseInt(parameters.progress_interval);
        }


        if (parameters.progress_impulses_nmb !== undefined) {
            parameters.progress_impulses_nmb = parseInt(parameters.progress_impulses_nmb);
        }

        if (parameters.progress_digits_nmb !== undefined) {
            parameters.progress_digits_nmb = parseInt(parameters.progress_digits_nmb);
        }

        if (!parameters.sign) {
            parameters.sign = "off"
        }

        if (!parameters.decimal !== undefined) {
            parameters.decimal = "off"
        }

        return parameters;
    }


    function digit_to_input($form, digit, operation, nmb) {
        if (nmb === undefined) nmb = 0;

        switch (parseInt(nmb)) {
            case 0:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits-input").val(), ',');
                break;
            case 1:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits_1-input").val(), ',');
                break;
            case 2:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits_2-input").val(), ',');
                break;
        }
        switch (operation) {
            case "toggle":
                toggle_el_to_array(digit, checked_digits_array);
                break;
            case "include":
                include_el_to_array(digit, checked_digits_array);
                break;
            case "exclude":
                exclude_el_from_array(digit, checked_digits_array);
                break;
        }
        switch (parseInt(nmb)) {
            case 0:
                $form.find(".checked_digits-input").val(checked_digits_array);
                break;
            case 1:
                $form.find(".checked_digits_1-input").val(checked_digits_array);
                break;
            case 2:
                $form.find(".checked_digits_2-input").val(checked_digits_array);
                break;
        }

    }

    function show_checked_digits($form, module) {
        $checked_digits = $form.find(".checked_digits-input");
        switch (module) {
            case "simple":
                for (var i = 1; i <= 4; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 5; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("5,6,7,8,9");
                break;
            case "brother":
                for (var i = 5; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 1; i <= 4; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("1,2,3,4");
                break;
            case "friend":
                for (var i = 1; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("1,2,3,4,5,6,7,8,9");
                break;
            case "combo":
                for (var i = 1; i <= 5; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 6; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("6,7,8,9");
                break;
            case "random":
                $form.find(".checked_digits").addClass("hidden active");
                $form.find(".check_all_digits-input").addClass("hidden");
                $checked_digits.val("0,1,2,3,4,5,6,7,8,9");
                break;
        }
    }

    $.fn.serializeObject2 = function() {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        var $radio = $('input[type=radio],input[type=checkbox]', this);
        $.each($radio, function() {
            if (!o.hasOwnProperty(this.name)) {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            }
        });
        return o;
    };
    $.fn.serializeObject = function() {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function get_number_float_rounded_by_decimal(n, decimal) {
        powered_number = power10(decimal);
        n = parseFloat(n);
        number = Math.round(n * powered_number) / powered_number;
        if (number % powered_number === 0) number = parseInt(number);
        return Math.round(n * powered_number) / powered_number;
    }
    </script>
    <script>
    function is_global_parameters(screen_pk) {
        return (screen_pk === "global" || screen_pk === "modal_global_settings" || screen_pk === "navbar")

    }

    function set_setting_bars(new_screen_state, screen_pk) {
        parameters = new_screen_state.parameters;
        console.log(parameters)

        if (is_global_parameters(screen_pk)) {
            $search_area = $(document);
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].parameters = parameters
            }
        } else {
            $search_area = $("#" + screen_pk.toString());
            screen_id = parseInt(screen_pk);
            GLOBAL_STATE[screen_id].parameters = parameters;
            $search_area.find(".screen_title").html(GLOBAL_STATE[screen_id].screen_title);
        }

        for (key in parameters) {
            $search_area.find("input[name=" + key + "]").val(parameters[key]);
            $search_area.find("." + key + "_display").html(parameters[key]);
            if (key === "examples_nmb") {
                $(document).find("input[name=" + key + "]").val(parameters[key]);
                $(document).find("." + key + "_display").html(parameters[key]);
                $(document).find("." + key).html(parameters[key]);
            } else if (key === "digits_nmb") {
                edit_parameter({ "screen_pk": screen_pk, "value_type": "digits_nmb", value: parameters[key] })
            }
        }

    }

    function convert_abakus_to_number(screen_id) {

        var $screen = $("#" + screen_id.toString());
        var screen_state = GLOBAL_STATE[screen_id];
        $flash_card = $screen.find(".block[data-type='flash_card']");

        for (var i = 0; i < screen_state.parameters.digits_nmb; i++) {
            $col_beads = $flash_card.find(".bead[data-col='" + i.toString() + "']");
            var digit = 0;
            $col_beads.each(function() {
                if ($(this).data("row") && $(this).hasClass("bead-active")) {
                    if (parseInt($(this).data("row")) <= 3) {
                        digit += 5;
                    } else if (parseInt($(this).data("row")) >= 5) {
                        digit += 1;
                    }
                }
            });
            $flash_card.find(".bead-number[data-col='" + i.toString() + "']").html(digit)
        }
    }


    function zero_abakus() {
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            create_and_append_flash_card(i);
        }
        if (GLOBAL_STATE.show_digits) {
            $(".bead-number").removeClass("invisible")
        } else {
            $(".bead-number").addClass("invisible")
        }
    }

    function show_digits(mode) {
        if (mode === "show") {
            GLOBAL_STATE.show_digits = true;
            $(".bead-number").removeClass("invisible")
        } else if (mode === "hide") {
            GLOBAL_STATE.show_digits = false;
            $(".bead-number").addClass("invisible")
        } else if (mode === undefined) {
            if (GLOBAL_STATE.show_digits) {
                GLOBAL_STATE.show_digits = false;
                $(".bead-number").addClass("invisible")
            } else {
                GLOBAL_STATE.show_digits = true;
                $(".bead-number").removeClass("invisible")
            }
        }
    }

    function change_mode(mode) {
        if (mode === "abakus") {
            GLOBAL_STATE.mode = "abakus";
            create_screens(1);
            zero_abakus();
            show_digits("show");
            $("#btn_change_mode").removeClass("btn-outline-secondary").addClass("btn-secondary");
            $("#btn_zero_abakus").removeClass("d-none");
            $("#btn_show_digits").removeClass("d-none");
        } else if (mode === "flash_card") {
            GLOBAL_STATE.mode = "flash_card";
            $("#btn_change_mode").addClass("btn-outline-secondary").removeClass("btn-secondary");
            $("#btn_zero_abakus").addClass("d-none");
            $("#btn_show_digits").addClass("d-none");
            show_digits("hide");
        } else if (mode === undefined) {
            if (GLOBAL_STATE.mode === "abakus") {
                GLOBAL_STATE.mode = "flash_card";
                $("#btn_change_mode").addClass("btn-outline-secondary").removeClass("btn-secondary");
                $("#btn_zero_abakus").addClass("d-none");
                $("#btn_show_digits").addClass("d-none");
                show_digits("hide");

            } else {
                GLOBAL_STATE.mode = "abakus";
                create_screens(1);
                zero_abakus();
                show_digits("show");
                $("#btn_change_mode").removeClass("btn-outline-secondary").addClass("btn-secondary");
                $("#btn_zero_abakus").removeClass("d-none");
                $("#btn_show_digits").removeClass("d-none");
            }
        }

    }

    function change_bead_color(mode) {
        var active_bead_class_list = ["bead-active-red", "bead-active-orange", "bead-active-blue", "bead-active-brown", "bead-active-nefrit", "bead-active-classic"];
        if (mode === "random") {
            active_bead_class = active_bead_class_list[randomInteger(active_bead_class_list.length)];
            GLOBAL_STATE.active_bead_class = active_bead_class;
            if (active_bead_class === "bead-active-classic") {
                GLOBAL_STATE.inactive_bead_class = "bead-inactive-classic";
                GLOBAL_STATE.empty_bead_class = "bead-empty-classic";
                GLOBAL_STATE.line_bead_class = "bead-line-classic";
            } else {
                GLOBAL_STATE.inactive_bead_class = "bead-inactive-default";
                GLOBAL_STATE.empty_bead_class = "bead-empty-default";
                GLOBAL_STATE.line_bead_class = "bead-line-default"
            }

        } else if (mode !== undefined) {
            GLOBAL_STATE.active_bead_class = mode;
            if (GLOBAL_STATE.active_bead_class === "bead-active-classic") {
                GLOBAL_STATE.inactive_bead_class = "bead-inactive-classic";
                GLOBAL_STATE.empty_bead_class = "bead-empty-classic";
                GLOBAL_STATE.line_bead_class = "bead-line-classic";
            } else {
                GLOBAL_STATE.inactive_bead_class = "bead-inactive-default";
                GLOBAL_STATE.empty_bead_class = "bead-empty-default";
                GLOBAL_STATE.line_bead_class = "bead-line-default"
            }
        } else {
            var actual_active_bead_class = GLOBAL_STATE.active_bead_class;
            var n = active_bead_class_list.indexOf(actual_active_bead_class);
            var next_n = (n + 1);
            if (next_n >= active_bead_class_list.length) {
                next_n = 0
            }
            GLOBAL_STATE.active_bead_class = active_bead_class_list[next_n];
            if (GLOBAL_STATE.active_bead_class) {
                GLOBAL_STATE.inactive_bead_class = "bead-inactive-classic";
                GLOBAL_STATE.empty_bead_class = "bead-empty-classic";
                GLOBAL_STATE.line_bead_class = "bead-line-classic";
            } else {
                GLOBAL_STATE.inactive_bead_class = "bead-inactive";
                GLOBAL_STATE.empty_bead_class = "bead-empty-default";
                GLOBAL_STATE.line_bead_class = "bead-line-default"
            }

        }

        for (var el in active_bead_class_list) {
            $(".bead-active").each(function() {
                if (!$(this).hasClass("not-change-color")) {
                    $(this).removeClass(active_bead_class_list[el])
                }
            })
        }
        $(".bead-active").each(function() {
            if (!$(this).hasClass("not-change-color")) {
                $(this).addClass(GLOBAL_STATE.active_bead_class);
            }
        })


        $(".bead-inactive").removeClass("bead-inactive-classic bead-inactive-default");
        if (GLOBAL_STATE.active_bead_class === "bead-active-classic") {
            $(".screen").addClass("bg_white");
            $(".bead-inactive").addClass("bead-inactive-classic")
        } else {
            $(".screen").removeClass("bg_white");
            $(".bead-inactive").addClass("bead-inactive-default")
        }

        $(".bead-line").removeClass("bead-line-classic bead-line-default");
        if (GLOBAL_STATE.active_bead_class === "bead-active-classic") {
            $(".bead-line").addClass("bead-line-classic")
        } else {
            $(".bead-line").addClass("bead-line-default")
        }


        $(".bead-empty").removeClass("bead-empty-classic bead-empty-default");
        if (GLOBAL_STATE.active_bead_class === "bead-active-classic") {
            $(".bead-empty").addClass("bead-empty-classic")
        } else {
            $(".bead-empty").addClass("bead-empty-default")
        }

    }

    function sound_answer(type, to_play) {
        if (to_play === "play") {
            switch (type) {
                case "error":
                    t = false_answer_sounds[randomInteger(false_answer_sounds.length)];
                    exclude_el_from_array(t, false_answer_sounds);
                    if (false_answer_sounds.length === 0) {
                        false_answer_sounds = false_answer_sounds_default.slice()
                    }

                    music = 'incorrect_' + t + '.mp3';
                    current_audio.src = $("#url_incorrect").val() + "/" + music;
                    break;
                case "success":
                    t = true_answer_sounds[randomInteger(true_answer_sounds.length)];
                    exclude_el_from_array(t, true_answer_sounds);
                    if (true_answer_sounds.length === 0) {
                        true_answer_sounds = true_answer_sounds_default.slice()
                    }
                    //t = random_between(1, 38);
                    music = 'correct_' + t + '.mp3';
                    current_audio.src = $("#url_correct").val() + "/" + music;
                    break;
                case "present":
                    t = random_between(1, 58);
                    music = 'present_' + t + '.mp3';
                    current_audio.src = $("#url_present").val() + "/" + music;
                    break;
            }
            current_audio.play()
        } else {
            current_audio.pause();
            // current_audio.currentTime = 0.0;
        }
    }


    function change_bg() {
        random_number = random_between(1, 80);
        var image_fon = "bg_" + random_number + ".jpg";
        image_url = '/testos/static/img/backgrounds/' + image_fon;
        $('#main_screen').css('background-image', 'url(' + image_url + ')');
    }

    function edit_parameter(args) { //{screen_pk, value_type, value}
        screen_pk = args.screen_pk;
        var is_global_parameter = args.screen_pk === "modal_global_settings" || args.screen_pk === "navbar" || args.screen_pk === "global";
        if (is_global_parameter) {
            $search_area = $(document);
            $screen = $("#" + args.screen_pk.toString())
        } else {
            screen_id = parseInt(args.screen_pk);
            $screen = $("#" + screen_id.toString());
            $search_area = $screen;
        }
        $global_input = $search_area.find("input[name='" + args.value_type + "']");
        $input = $screen.find("input[name='" + args.value_type + "']");
        $display = $search_area.find("." + args.value_type + "_display");

        if (args.value !== undefined) {
            $global_input.val(args.value);
            $display.html(args.value);
            if (is_global_parameter) {
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    GLOBAL_STATE[i].parameters[args.value_type] = args.value;
                }
            } else {
                screen_id = parseInt(args.screen_pk);
                GLOBAL_STATE[screen_id].parameters[args.value_type] = args.value;
            }

            if (args.value_type === "digits_nmb") {
                if (is_global_parameter) {
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        create_and_append_flash_card(i)
                    }
                } else {
                    create_and_append_flash_card(screen_id)
                }
            } else if (args.value_type === "screens_nmb") {
                create_screens(args.value)
            } else if (args.value_type === "impulses_nmb") {










            }
        } else {
            switch (args.operation) {
                case "input_increase":
                    var decimal = parseInt($input.data("decimal"));
                    var step = get_number_float_rounded_by_decimal($input.attr("step"), decimal);
                    var min = get_number_float_rounded_by_decimal($input.attr("min"), decimal);
                    var max = get_number_float_rounded_by_decimal($input.attr("max"), decimal);
                    var val = get_number_float_rounded_by_decimal($input.val(), decimal);
                    var input_val = val;
                    if (val + step <= max) {
                        input_val = get_number_float_rounded_by_decimal(val + step, decimal);
                    }
                    $global_input.val(input_val);
                    $display.html(input_val);
                    if (args.value_type === "screens_nmb") {
                        create_screens(input_val)
                    }
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                        }
                    } else {
                        screen_id = parseInt(args.screen_pk);
                        GLOBAL_STATE[screen_id].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                    }
                    if (args.value_type === "digits_nmb") {
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                create_and_append_flash_card(i)
                            }
                        } else {
                            screen_id = parseInt(args.screen_pk);
                            create_and_append_flash_card(screen_id)
                        }
                    }
                    break;
                case "input_decrease":
                    var decimal = parseInt($input.data("decimal"));
                    var step = get_number_float_rounded_by_decimal($input.attr("step"), decimal);
                    var min = get_number_float_rounded_by_decimal($input.attr("min"), decimal);
                    var max = get_number_float_rounded_by_decimal($input.attr("max"), decimal);
                    var val = get_number_float_rounded_by_decimal($input.val(), decimal);
                    var input_val = val;
                    if (val - step >= min) {
                        input_val = get_number_float_rounded_by_decimal(val - step, decimal);

                    }
                    $global_input.val(input_val);
                    $display.html(input_val);
                    if (args.value_type === "screens_nmb") {
                        create_screens(input_val)
                    }
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                        }

                    } else {
                        screen_id = parseInt(args.screen_pk);
                        GLOBAL_STATE[screen_id].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                    }
                    if (args.value_type === "digits_nmb") {
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                create_and_append_flash_card(i)
                            }
                        } else {
                            screen_id = parseInt(args.screen_pk);
                            create_and_append_flash_card(screen_id)
                        }
                    }
                    break;
                case "input_number":
                    var $this = args.$this;
                    var decimal = parseInt($input.data("decimal"));
                    var step = get_number_float_rounded_by_decimal($this.attr("step"), decimal);
                    var min = get_number_float_rounded_by_decimal($this.attr("min"), decimal);
                    var max = get_number_float_rounded_by_decimal($this.attr("max"), decimal);
                    var val = get_number_float_rounded_by_decimal($this.val(), decimal);
                    var input_val = val;
                    if (input_val < min) {
                        input_val = min
                    }
                    if (input_val > max) {
                        input_val = max
                    }
                    if (args.value_type === "screens_nmb") {
                        create_screens(input_val)
                    }


                    $global_input.val(input_val);
                    $display.html(input_val);


                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                        }

                    } else {
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                    }
                    if (args.value_type === "digits_nmb") {
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                create_and_append_flash_card(i)
                            }
                        } else {
                            screen_id = parseInt(args.screen_pk);
                            create_and_append_flash_card(screen_id)
                        }
                    }
                    break;
                case "btn_checked_digits":
                    $form = $screen.find("form");
                    setTimeout(function() {
                        var data = get_parameters_parsed($form.serializeObject());
                        checked_digits = data.checked_digits;
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.checked_digits = checked_digits
                            }
                        } else {
                            screen_id = parseInt(screen_pk);
                            GLOBAL_STATE[screen_id].parameters.checked_digits = checked_digits;
                        }
                        $search_area.find("input[name='checked_digits']").prop("checked", false);
                        $search_area.find(".btn_checked_digits").removeClass("active");

                        for (var digit in checked_digits) {
                            $search_area.find("input[name='checked_digits'][value='" + checked_digits[digit] + "']").prop("checked", true);
                            $search_area.find("input[name='checked_digits'][value='" + checked_digits[digit] + "']").parent().addClass("active");
                        }
                    }, 100);

                    break;
                case "btn_check_all_digits":
                    $inputs_checked_digits = $search_area.find("input[name='checked_digits']");
                    $input_check_all_digits = $screen.find("input[name='check_all_digits']");
                    if (!$input_check_all_digits.prop("checked")) {
                        $inputs_checked_digits.prop("checked", true);
                        $inputs_checked_digits.parent().addClass("active");
                    } else {
                        $inputs_checked_digits.prop("checked", false);
                        $inputs_checked_digits.parent().removeClass("active");
                    }
                    $form = $screen.find("form");
                    var data = get_parameters_parsed($form.serializeObject());

                    checked_digits = data.checked_digits;
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.checked_digits = checked_digits
                        }
                    } else {
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters.checked_digits = checked_digits;
                    }
                    break;
            }

        }


    }

    function show_main_btn_group(mode) {
        $main_btn_group = $(".main_btn_group");
        $main_btn_group.find(".btn").addClass("d-none");

        if (mode === "result") {
            $main_btn_group.find("#btn_global_show_example").removeClass("d-none");
            $main_btn_group.find("#btn_global_show_result").removeClass("d-none");
            if (!is_task_mode()) {
                $main_btn_group.find("#btn_global_restart").removeClass("d-none")
            }
        } else {
            global_status = get_global_status();
            is_there_previous = true;
            is_answers_entered = true;
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                if (GLOBAL_STATE[i].example.length === 0) {
                    is_there_previous = false;
                }
                if (GLOBAL_STATE[i].is_answer_entered === false) {
                    is_answers_entered = false;
                }
            }
            switch (global_status) {
                case "stopped":
                    if (is_there_previous) {
                        $main_btn_group.find("#btn_global_next").removeClass("d-none");
                        if (!is_task_mode()) {
                            $main_btn_group.find("#btn_global_restart").removeClass("d-none")
                        }
                    } else {
                        $main_btn_group.find("#btn_global_start").removeClass("d-none");
                    }
                    if (is_answers_entered) {
                        $main_btn_group.find("#btn_global_show_example").removeClass("d-none");
                    }
                    break;
                case "countdown":
                case "process":
                    $main_btn_group.find("#btn_global_pause").removeClass("d-none");
                    break;
                case "answer_input":
                    if (!is_task_mode()) {
                        $main_btn_group.find("#btn_global_restart").removeClass("d-none")
                    }
                    $main_btn_group.find("#btn_global_check_answer").removeClass("d-none");
                    break;
                case "none":
                    $main_btn_group.find("#btn_global_stop").removeClass("d-none");
                    break;
                case "paused":
                    if (!is_task_mode()) {
                        $main_btn_group.find("#btn_global_restart").removeClass("d-none")
                    }
                    $main_btn_group.find("#btn_global_continue").removeClass("d-none");
                    break;
                case "result":
                    if (!is_task_mode()) {
                        $main_btn_group.find("#btn_global_restart").removeClass("d-none")
                    }
                    $main_btn_group.find("#btn_global_continue").removeClass("d-none");
                    break;
            }
        }

    }

    function show_main_buttons(screen_pk, buttons) {
        if (screen_pk === "modal_global_settings" || screen_pk === "global" || screen_pk === "navbar") {
            $search_area = $(document)
        } else {
            screen_id = parseInt(screen_pk);
            $search_area = $("#" + screen_id)
        }

        $btn_group_main = $search_area.find(".btn_group_main");
        $btn_group_main.find(".btn").addClass("d-none");
        if (is_task_mode()) {
            exclude_el_from_array("btn_restart", buttons)
        }
        for (var el in buttons) {
            $btn_group_main.find("." + buttons[el]).removeClass("d-none");
        }
    }


    function global_refresh() {

        if (confirm("Вы уверены? Обнуляться все баллы и вы начнете с самого начала")) {
            if (is_task_mode()) {
                $.ajax({
                    type: "get",
                    url: $("#task_parameters_url").val(),
                    success: function(data) {
                        set_setting_bars(data, 1, true);
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters = get_parameters_parsed(data.parameters);
                        }
                    }
                });
                date_var = new Date();
                start_time = date_var.getTime();
                $(".timer_bar").css("width", 0);
                $(".examples_done").html(0);
                $(".correct_nmb").html(0);
                $(".done_percent").html(0);
                $(".correct_percent").html(0);
                $(".progress_bar").css("width", 0);
                $(".correctness_bar").css("width", 0);
            }
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].points = 0;
                GLOBAL_STATE[i].diff_points = 0;
                GLOBAL_STATE[i].done = 0;
                GLOBAL_STATE[i].correct = 0;
                GLOBAL_STATE[i].correct_percent = 0;
                GLOBAL_STATE[i].done_percent = 0;
                GLOBAL_STATE[i].progress_key = 0;
                GLOBAL_STATE[i].progress_variant = "speed";
                GLOBAL_STATE[i].progress_digits_nmb_key = 0;
                GLOBAL_STATE[i].is_answer_entered = false;
                GLOBAL_STATE[i].student_answer = "";
                GLOBAL_STATE[i].example_text = "";
                GLOBAL_STATE[i].example = [];
                GLOBAL_STATE[i].answer = undefined;
                GLOBAL_STATE[i].parameters = get_parameters();
            }
            global_stop();
            $(".points").val(0);
            $(".points").html(0);
            $(".player_points").html(0);
        }
    }

    function show_blocks(screen_pk, blocks) {
        if (screen_pk === "modal_global_settings" || screen_pk === "global" || screen_pk === "navbar") {
            $search_area = $(document)
        } else {
            screen_id = parseInt(screen_pk);
            $search_area = $("#" + screen_id)
        }

        $search_area.find(".block").addClass("d-none");
        for (var el in blocks) {
            $search_area.find(".block[data-type='" + blocks[el] + "']").removeClass("d-none");
        }
    }

    function show_blocks_by_status(screen_id) {
        var $screen = $("#" + screen_id.toString());
        var screen_state = GLOBAL_STATE[screen_id];
        switch (screen_state.status) {
            case "main":
                show_blocks(screen_id, ["main", "mini-control"]);
                break;
            case "example_stopped":
                show_blocks(screen_id, ["problem", "problem_inner", "flash_card", "answer_input", "mini-control"]);
                $screen.find(".block[data-type='flash_card']").removeClass("invisible");
                $screen.find(".block[data-type='mini-control']").removeClass("invisible");
                $screen.find(".block[data-type='answer_input']").removeClass("invisible");
                break;
            case "example_started":
                show_blocks(screen_id, ["problem", "problem_inner", "flash_card", "mini-control"]);
                break;
            case "check_answer":
                show_blocks(screen_id, ["problem", "problem_inner", "flash_card", "answer_input", "answer_inputs", "mini-control"]);
                if (screen_state.parameters.impulses_nmb > 1) {
                    create_and_append_answer_inputs(screen_id)
                }
                $("#1").find("input[name='answer_input'][data-number='1']").focus();
                break;
        }
    }
    </script>
    <script>
    var GLOBAL_STATE = {
        "status": "stopped",
        "voice": true,
        "mode": "example",
        "show_digits": false,
        "timer": undefined,
        "interval": 1,
        "active_bead_class": "bead-active-red",
        "inactive_bead_class": "bead-inactive-default",
        "empty_bead_class": "bead-empty-default",
        "line_bead_class": "bead-line-default",
    };
    var date_var = new Date();
    var start_time, end_time;


    function get_number_abakused(number) {
        var number_str = number.toString();
        var number_arr = [];
        for (var el in number_str) {
            number_arr.push(parseInt(number_str[el]))
        }
        number_abakused = [];
        for (var el in number_str) {
            var digit = parseInt(number_str[el]);
            var digit_abakused = get_digit_abakused(digit);
            number_abakused.push(digit_abakused)
        }
        return number_abakused;
    }

    function get_digit_abakused(digit) {
        switch (digit) {
            case 0:
                return {
                    "digit": digit,
                    "array": [3, 2, 0, -1, 2, -1, 0, 0, 0, 0, 2]
                };
                break;
            case 1:
                return {
                    "digit": digit,
                    "array": [3, 2, 0, -1, 2, 1, -1, 0, 0, 0, 2]
                };
                break;
            case 2:
                return {
                    "digit": digit,
                    "array": [3, 2, 0, -1, 2, 1, 1, -1, 0, 0, 2]
                };
                break;
            case 3:
                return {
                    "digit": digit,
                    "array": [3, 2, 0, -1, 2, 1, 1, 1, -1, 0, 2]
                };
                break;
            case 4:
                return {
                    "digit": digit,
                    "array": [3, 2, 0, -1, 2, 1, 1, 1, 1, -1, 2]
                };
                break;
            case 5:
                return {
                    "digit": digit,
                    "array": [3, 2, -1, 1, 2, -1, 0, 0, 0, 0, 2]
                };
                break;
            case 6:
                return {
                    "digit": digit,
                    "array": [3, 2, -1, 1, 2, 1, -1, 0, 0, 0, 2]
                };
                break;
            case 7:
                return {
                    "digit": digit,
                    "array": [3, 2, -1, 1, 2, 1, 1, -1, 0, 0, 2]
                };
                return [3, 2, -1, 1, 2, 1, 1, -1, 0, 0, 2];
                break;
            case 8:
                return {
                    "digit": digit,
                    "array": [3, 2, -1, 1, 2, 1, 1, 1, -1, 0, 2]
                };
                break;
            case 9:
                return {
                    "digit": digit,
                    "array": [3, 2, -1, 1, 2, 1, 1, 1, 1, -1, 2]
                };
                break;
        }
    }

    function get_bead_class(key) {
        switch (key) {
            case 0:
                return "bead-inactive " + GLOBAL_STATE.inactive_bead_class;
                break;
            case 1:
                return "bead-active " + GLOBAL_STATE.active_bead_class;
                break;
            case -1:
                return "bead-empty " + GLOBAL_STATE.empty_bead_class;
                break;
            case 2:
                return "bead-line " + GLOBAL_STATE.line_bead_class;
                break;
            case 3:
                return "bead-number";
                break;
            case undefined:
                return "invisible";
                break;
        }
    }


    function create_flash_card(args) {
        var digits_nmb = GLOBAL_STATE[args.screen_id].parameters.digits_nmb;
        var zero_abakused = get_digit_abakused(0);
        var $$flash_card = "";
        var row_screens_nmb = args.row_screens_nmb;


        var bead_width = (90 / (row_screens_nmb * digits_nmb));
        if (bead_width > 8) {
            bead_width = 8;
        }


        if (GLOBAL_STATE.screens_nmb >= 4) {
            bead_width = (90 / (row_screens_nmb * digits_nmb));
            if (bead_width > 4) {
                bead_width = 4;
            }
        }

        if (device.mobile() || device.tablet()) {
            if (device.landscape()) {
                bead_width = (90 / (row_screens_nmb * digits_nmb));
                if (bead_width > 8) {
                    bead_width = 8
                }
            } else {
                bead_width = (90 / (row_screens_nmb * digits_nmb));
                if (bead_width > 20) {
                    bead_width = 20
                }
            }
        }
        window_screen_width = document.body.clientWidth;
        window_screen_height = window.innerHeight;
        if (window_screen_height === 0) {
            window_screen_height = screen.height;
        }
        if (bead_width * window_screen_width / 100 * 7 > 0.7 * window_screen_height) {
            bead_height = parseInt(window_screen_height) / 100 * 10;
            bead_width = 1.1 * bead_height * 100 / parseInt(window_screen_width);
        }
        if (GLOBAL_STATE.screens_nmb >= 4) {
            if (bead_width * window_screen_width / 100 * 7 > 0.35 * window_screen_height) {
                bead_height = parseInt(window_screen_height) / 100 * 10;
                bead_width = 1.1 * bead_height * 50 / parseInt(window_screen_width);
            }
        }

        var bead_width_vw = bead_width.toString() + "vw";
        var bead_height_vw = bead_width * 0.4.toString() + "vw";
        var bead_number_height_vw = bead_width * 0.6.toString() + "vw";
        var bead_number_fontsize_vw = bead_width * 0.5.toString() + "vw";
        var bead_line_height_vw = bead_width * 0.1.toString() + "vw";
        array = zero_abakused.array;
        if (GLOBAL_STATE.show_digits) {
            bead_number_class = ""
        } else {
            bead_number_class = "invisible"
        }
        for (var el in array) {
            var bead_class = get_bead_class(parseInt(array[el]));

            var $$el = "";
            for (var i = 0; i < digits_nmb; i++) {
                if (bead_class.indexOf("bead-line") !== -1) {
                    $$el += '<div   class="bead ' + bead_class + '" style="width: ' + bead_width_vw + '; height: ' + bead_line_height_vw + ' "></div>'
                } else if (bead_class === "bead-number") {
                    $$el += '<div class="bead bead-number ' + bead_number_class + '" data-col="' + i.toString() + '" style="width: ' + bead_width_vw + '; height: ' + bead_number_height_vw + '; font-size: ' + bead_number_fontsize_vw + ';">' + zero_abakused.digit + '</div>'
                } else {
                    $$el += '<div data-row="' + el + '" data-col="' + i.toString() + '" class="bead  ' + bead_class + '" style="width: ' + bead_width_vw + '; height: ' + bead_height_vw + '"></div>'
                }
            }
            var $$btn_group = '<div class="col-12 row justify-content-center p-0 m-0 ">' + $$el + '</div>';
            $$flash_card += $$btn_group;
        }
        return '<div class="block col-12 row justify-content-center p-0 m-0" data-type="flash_card"> ' + $$flash_card + '</div>';
    }

    function create_mini_control_bar(screen_title) {

        return ' ';

    }

    function create_answer_input(args) {
        $$answer_input = '<div class="row justify-content-center col-12 m-0 p-0 partial_answer_input_block">\
        <div class="input-group mb-3" style="width:' + args.answer_input_width + '">\
        <div class="input-group-prepend">\
        <span class="btn btn-success pr-3 pl-3" style="font-size:' + args.answer_input_font_size + '">' + args.answer_input_number + '</span>\
        </div>\
        <input type="number"  inputmode="numeric" class="form-control partial_answer_input text-center" name="answer_input" data-number="' + args.answer_input_number + '" placeholder="Ответ" style="font-size:' + args.answer_input_font_size + '">\
        <div class="input-group-append">\
        <span class="btn btn-primary pr-3 pl-3 btn_partial_answer_input_status" style="font-size:' + args.answer_input_font_size + '">?</span>\
        </div>\
        </div>\
        </div>';
        return $$answer_input
    }

    function create_answer_input_column(args) {
        var start_number = args.start_number;
        var finish_number = args.finish_number;
        $$answer_input_column = "";
        for (var i = start_number; i <= finish_number; i++) {
            args.answer_input_number = i;

            $$answer_input = create_answer_input(args);
            $$answer_input_column += $$answer_input;
        }
        $$answer_input_column = '<div class="m-0 p-0 ' + args.column_class + '">' + $$answer_input_column + '</div>';
        return $$answer_input_column;
    }

    function create_and_append_answer_inputs(screen_id) {

        $screen = $("#" + screen_id.toString());
        var impulses_nmb = GLOBAL_STATE[screen_id].parameters.impulses_nmb;
        if (GLOBAL_STATE.screens_nmb >= 4) {
            answer_input_font_size = "2vh";
        } else {
            answer_input_font_size = "5vh";
        }
        $$answer_inputs = "";
        if (impulses_nmb > 1) {
            if (impulses_nmb > 5) {
                switch (impulses_nmb) {
                    case 6:
                        $$answer_input_columns = "";
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 1,
                            finish_number: 3,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 4,
                            finish_number: 6,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        break;
                    case 7:
                        $$answer_input_columns = "";
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 1,
                            finish_number: 4,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 5,
                            finish_number: 7,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        break;
                    case 8:
                        $$answer_input_columns = "";
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 1,
                            finish_number: 4,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 5,
                            finish_number: 8,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        break;
                    case 9:
                        $$answer_input_columns = "";
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 1,
                            finish_number: 5,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 6,
                            finish_number: 9,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        break;
                    case 10:
                        $$answer_input_columns = "";
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 1,
                            finish_number: 5,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        args = {
                            answer_input_font_size: answer_input_font_size,
                            start_number: 6,
                            finish_number: 10,
                            answer_input_width: "90%",
                            column_class: "col-md-6"
                        };
                        $$answer_input_columns += create_answer_input_column(args);
                        break;
                }
                $$answer_inputs = '<div class="row align-items-center col-12 m-0 p-0">' + $$answer_input_columns + '</div>';
                $screen.find(".problem_hero").addClass("d-none")
            } else {
                $$answer_input_columns = "";
                args = {
                    answer_input_font_size: answer_input_font_size,
                    start_number: 1,
                    finish_number: impulses_nmb,
                    answer_input_width: "90%",
                    column_class: "col-12"
                };
                $$answer_input_columns += create_answer_input_column(args);
                $$answer_inputs = '<div class="row align-items-center">' + $$answer_input_columns + '</div>';
                if (GLOBAL_STATE.screens_nmb === 1) {
                    $screen.find(".problem_hero").removeClass("d-none")
                }

            }

            $screen.find(".block[data-type='answer_inputs']").html($$answer_inputs);
            $screen.find(".block[data-type='answer_inputs']").removeClass("d-none");
            $screen.find(".block[data-type='answer_input']").find("input").addClass("invisible");
            $screen.find(".block[data-type='flash_card']").addClass("d-none");
        }




    }

    function create_control_buttons_mini() {
        return '<div class="block row col-12 justify-content-center mt-3 d-none" data-type="control-buttons-mini">\
        <div class="btn btn-warning btn-lg btn-nrm-lg mr-5"><i class="fa fa-wrench"></i>  Настройки</div>\
        <div class="btn btn-success btn-lg btn-nrm-lg"><i class="fa fa-play"></i>  Старт</div>\
        </div>'
    }


    function create_and_append_flash_card(screen_id) {
        $screen = $("#" + screen_id.toString());
        var screens_nmb = GLOBAL_STATE.screens_nmb;
        if (screens_nmb <= 3) {
            row_screens_nmb = screens_nmb
        } else {
            if (screens_nmb % 2 === 0) {
                row_screens_nmb = parseInt(screens_nmb * 0.5)
            } else {
                if (screen_id <= Math.floor(screens_nmb * 0.5) + 1) {
                    row_screens_nmb = Math.floor(screens_nmb * 0.5) + 1;
                } else {
                    row_screens_nmb = Math.floor(screens_nmb * 0.5)
                }
            }
        }

        var args = {
            screen_id: screen_id,
            row_screens_nmb: row_screens_nmb
        };
        $$flash_card = create_flash_card(args);
        $$answer_input_block = create_answer_input_block(args);
        $$flash_card_with_answer_input_block = $$flash_card + $$answer_input_block;
        $screen.find(".block[data-type='problem_inner']").html($$flash_card_with_answer_input_block);

    }

    function create_screen(args) {
        var parameters = get_parameters();
        if (!GLOBAL_STATE[args.screen_id]) {
            GLOBAL_STATE[args.screen_id] = {
                "screen_title": $("#trans_player").val() + " " + args.screen_id,
                "num_summand": 0,
                "screen_id": args.screen_id,
                "num_color": args.screen_id,
                "points": 0,
                "diff_points": 0,
                "correct": 0,
                "done": 0,
                "all_examples_done": 0,
                "all_examples_nmb": parameters.examples_nmb,
                "status": "example_stopped",
                "timer": 0,
                "correct_percent": 0,
                "done_percent": 0,
                "progress_key": 0,
                "progress_variant": undefined,
                "progress_digits_nmb_key": 0,
                "srudent_answer": "",
                "correct_answer": 0,
                "example_text": "",
                "entered_answer": "",
                "parameters": parameters
            };
        }

        $$mini_control_bar = create_mini_control_bar(GLOBAL_STATE[args.screen_id].screen_title);
        $$flash_card = create_flash_card(args);
        $$answer_input_block = create_answer_input_block(args);
        if (device.mobile() || device.tablet() || GLOBAL_STATE.screens_nmb >= 3) {
            $$left_hero_block = "";
            $$right_hero_block = "";

        } else {
            $$left_hero_block = '<div class="col d-none d-lg-block left_hero left_hero_0  mr-5" style="height: ' + args.image_height + '; "></div>';
            $$right_hero_block = '<div class="col d-none d-lg-block right_hero right_hero_0 ml-5 " style="height: ' + args.image_height + '; "></div>';

        }

        $$flash_card_with_answer_input_block = '<div class="block card-body col-12 row m-0 p-0 justify-content-center align-items-center" data-type="problem">' + $$left_hero_block + '\
        <div class="col p-0 m-0 block" data-type="problem_inner">' + $$flash_card + $$answer_input_block + '</div>' + $$right_hero_block + '\
        </div>';
        $$settings_block = create_settings_block(args);
        $$main_block = create_main_block(args);
        $$screen = '<div class="screen bg_color_' + args.screen_id + ' m-0 p-0  align-items-center container-fluid text-center  ' + args.screen_width_class + '" id="' + args.screen_id + '" style="border: 1px dotted grey; height:' + args.screen_height + ';">' +
            $$mini_control_bar +
            $$flash_card_with_answer_input_block +
            $$settings_block +
            $$main_block +
            '</div>';
        return $$screen

    }

    function create_main_block(args) {
        if (device.mobile() || device.tablet() || GLOBAL_STATE.screens_nmb >= 4) {
            $$left_hero_block = "";
            $$right_hero_block = "";

        } else {
            $$left_hero_block = '<div class="col left_hero left_hero_0 " style="height: ' + args.image_height + '; "></div>';
            $$right_hero_block = '<div class="col right_hero right_hero_0  " style="height: ' + args.image_height + '; "></div>';

        }
        $$main_block = '<div data-type="main" class="block card-body col row align-items-center justify-content-center col-12 d-none" >' + $$left_hero_block + '\
        <div class="col btn-group-vertical btn_group_main">\
        <a href="#" class="btn_start btn btn-lg btn-nrm btn-success mb-3" ><i class="fa fa-play"> </i>  Старт</a>\
        <a href="#" class="btn_continue d-none btn btn-lg btn-nrm btn-success mb-3" ><i class="fa fa-play"> </i>  Продолжить</a>\
        <a href="#" class="btn_next d-none btn btn-lg btn-nrm btn-success mb-3" ><i class="fa fa-forward"> </i>  Следующий</a>\
        <a href="#" class="btn_stop d-none btn btn-lg btn-nrm btn-danger mb-3" ><i class="fa fa-stop"> </i>  Стоп</a>\
        <a href="#" class="btn_restart d-none btn btn-lg btn-nrm btn-secondary mb-3" ><i class="fa fa-refresh"> </i>  Заново</a>\
        <a href="#" class="btn_show_example show_block hidden btn btn-lg btn-nrm btn-purple mb-3" data-block_type="problem"><i class="fa fa-eye"> </i>  Задание</a>\
        <a href="#" class="btn_show_settings show_block btn btn-lg btn-nrm btn-warning " data-block_type="settings" ><i class="fa fa-wrench"> </i>  Настроить</a>\
        </div>' + $$right_hero_block + '\
        </div>';
        return $$main_block
    }

    function create_answer_input_block(args) {

        var digits_nmb = GLOBAL_STATE[args.screen_id].parameters.digits_nmb;
        var row_screens_nmb = args.row_screens_nmb;
        var bead_width = (90 / (row_screens_nmb * digits_nmb));
        if (bead_width > 8) {
            bead_width = 8;
        }
        window_screen_width = document.body.clientWidth;
        window_screen_height = window.innerHeight;
        if (window_screen_height === 0) {
            window_screen_height = screen.height;
        }
        if (bead_width * window_screen_width / 100 * 7 > 0.7 * window_screen_height) {
            bead_height = parseInt(window_screen_height) / 100 * 10;
            bead_width = 1.1 * bead_height * 100 / parseInt(window_screen_width);
        }
        if (GLOBAL_STATE.screens_nmb >= 4) {
            if (bead_width * window_screen_width / 100 * 7 > 0.35 * window_screen_height) {
                bead_height = parseInt(window_screen_height) / 100 * 10;
                bead_width = 1.1 * bead_height * 50 / parseInt(window_screen_width);
            }
        }

        var answer_input_font_size = "5vh";
        var answer_input_margin_class = "mt-5";
        if (GLOBAL_STATE.screens_nmb >= 4) {
            bead_width = (90 / (row_screens_nmb * digits_nmb));
            if (bead_width > 4) {
                bead_width = 4;
            }
            answer_input_font_size = "2.5vh";
            answer_input_margin_class = "mt-3"
        }

        var answer_input_width = bead_width * digits_nmb;

        if (answer_input_width < 30) {
            answer_input_width = 30
        }
        if (device.mobile() || device.tablet()) {
            bead_width = (90 / (row_screens_nmb * digits_nmb));
            if (bead_width > 22.5) {
                bead_width = 22.5
            }
            answer_input_width = bead_width * digits_nmb;
            if (answer_input_width < 90) {
                answer_input_width = 90
            }
        }



        var answer_input_width_vw = answer_input_width.toString() + "vw";

        $$answer_input_block = '<div class="block col-12 row justify-content-center  p-0 m-0 d-none" data-type="answer_inputs"></div>\
        <div class="block col-12 row justify-content-center  p-0 m-0" data-type="answer_input">\
        <div class="progress timer_block invisible" style="width: 80%; height: 7px; padding: 0; border: none">\
        <div class="timer_bar progress-bar progress-bar-striped bg-danger progress-bar-animated color-black"\
        style="width: 100%; ">\
        <span style="position: absolute; left: 30%; font-weight: 100;" ></span>\
        </div>\
        </div>\
        <div class="input-group mb-3 ' + answer_input_margin_class + '" style="width:' + answer_input_width_vw + '">\
        <div class="input-group-prepend">\
        </div>\
        <div class="wrapp">\
        <input type="number"  inputmode="numeric" name="answer_input" data-number="1" class="form-control answer_input text-center" placeholder="Ответ" style="font-size: 36px">\
        <div class="input-group-append">\
        <span class="btn btn-primary btn_start pr-3 pl-3" style="font-size:40px">ОК</span>\
        </div>\
        </div>\
        </div>\
        </div>\
		<form class="new__form form-inline my-2 my-lg-0">\
            <button type="button" tabindex="-1" class="new__btn btn btn-danger my-2 my-sm-0" id="btn_global_refresh" onclick="global_refresh()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content="Обнулить/заново" data-original-title="" title="">Начать заново</button>\
            <div class="new__group main_btn_group form-inline">\
                <button type="button" tabindex="-1" class="new__btn  btn btn-success my-2 my-sm-0" id="btn_global_start" onclick="global_start()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Старт" data-original-title="" title="">Старт</button>\
            </div>\
            <button type="button" id="btn_global_stop" tabindex="-1" onclick="global_stop()" class="new__btn btn btn-danger my-2 my-sm-0" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content=" Стоп" data-original-title="" title="">Стоп</button>\
        </form>';
        return $$answer_input_block;
    }

    function create_settings_block(args) {
        if (device.mobile() || device.tablet() || GLOBAL_STATE.screens_nmb >= 4) {
            $$left_hero_block = "";
            $$right_hero_block = "";

        } else {
            $$right_hero_block = '<div class="col right_hero right_hero_0 settings_hero " style="height: ' + args.image_height + '; "></div>';
            $$left_hero_block = '<div class="col left_hero left_hero_0 settings_hero " style="height: ' + args.image_height + '; "></div>';
        }
        $$settings_block = '<div class="block row col-12 d-none card-body  align-items-center" data-type="settings">' + $$left_hero_block + '\
        <div class="row justify-content-center col  p-0 m-0">\
        <form>\
        <div class="col-12 card-body text-center p-0">\
        <h4 class="neucha"><a class="btn btn-info color-white mr-3 show_block" data-block_type="problem"><i class="fa fa-arrow-left"></i></a>Настройки<a class="btn btn_start btn-success color-white ml-3"><i class="fa fa-play"></i></a></h4>\
        <div class="btn-group btn-group-toggle" data-toggle="buttons">\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="1"> 1</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="2"> 2</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="3"> 3</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="4"> 4</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="5"> 5</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="6"> 6</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="7"> 7</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="8"> 8</label>\
        <label class="btn_checked_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="checked_digits" checked="checked" value="9"> 9</label>\
        <label class="btn_check_all_digits btn btn-outline-secondary btn-nrm active"><input type="checkbox" name="check_all_digits" checked="checked"><i class="fa fa-check"></i></label>\
        </div>\
        </div>\
        <div class="card-body text-center p-2">\
            <div class="btn-group btn-group-toggle" data-toggle="buttons">\
            <label class="btn btn-outline-secondary active">\
            <input type="radio" name="sign" autocomplete="off" checked="" value="positive"> Положительные\
            </label>\
            <label class="btn btn-outline-secondary">\
            <input type="radio" name="sign"  autocomplete="off" value="negative"> Отрицательные\
            </label>\
            </div>\
        </div>\
        <div class="col-12 card-body text-center p-0">\
        <div class="btn-group2">\
        <div class="btn-group inc-dec-control">\
        <label class="btn btn-nrm btn-success pr-0 change_value_to_default" data-value_type="digits_nmb" data-value="1">Цифр: </label>\
        <label class="btn btn-nrm btn-success input_decrease">  < </label>\
        <label class="btn btn-nrm btn-success p-0">\
        <input type="number" name="digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="1" min="1" max="10" step="1"  data-decimal="0">\
        </label>\
        <label class="btn btn-nrm btn-success input_increase"> > </label>\
        </div>\
        <div class="btn-group inc-dec-control">\
        <label class="btn btn-nrm btn-success pr-0 change_value_to_default" data-value_type="progress_digits_nmb" data-value="0">Про: </label>\
        <label class="btn btn-nrm btn-success input_decrease">  < </label>\
        <label class="btn btn-nrm btn-success p-0">\
        <input type="number" name="progress_digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="0" min="0" max="10" step="1"  data-decimal="0">\
        </label>\
        <label class="btn btn-nrm btn-success input_increase"> > </label>\
        </div>\
        </div>\
        </div>\
        <div class="col-12 card-body text-center p-0 ">\
        <div class="btn-group2">\
        <div class="btn-group inc-dec-control">\
        <label class="btn btn-nrm btn-info pr-0 change_value_to_default" data-value_type="impulses_nmb" data-value="1">Импульсов: </label>\
        <label class="btn btn-nrm btn-info input_decrease">  < </label>\
        <label class="btn btn-nrm btn-info p-0">\
        <input type="number" name="impulses_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="1" min="1" max="10" step="1"  data-decimal="0">\
        </label>\
        <label class="btn btn-nrm btn-info input_increase"> > </label>\
        </div>\
        <div class="btn-group inc-dec-control">\
        <label class="btn btn-nrm btn-info pr-0 change_value_to_default" data-value_type="progress_impulses_nmb" data-value="0">Про: </label>\
        <label class="btn btn-nrm btn-info input_decrease">  < </label>\
        <label class="btn btn-nrm btn-info p-0">\
        <input type="number" name="progress_impulses_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="0" min="0" max="10" step="1"  data-decimal="0">\
        </label>\
        <label class="btn btn-nrm btn-info input_increase"> > </label>\
        </div>\
        </div>\
        </div>\
        <div class="col-12 card-body text-center p-0">\
        <div class="btn-group2">\
        <div class="btn-group inc-dec-control">\
        <label class="btn btn-nrm btn-danger pr-0 change_value_to_default" data-value_type="interval" data-value="1">Паузы: </label>\
        <label class="btn btn-nrm btn-danger input_decrease">  < </label>\
        <label class="btn btn-nrm btn-danger p-0">\
        <input type="number" name="interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="1"  min="0.1" max="10" step="0.1" data-decimal="1">\
        </label>\
        <label class="btn btn-nrm btn-danger input_increase"> > </label>\
        </div>\
        <div class="btn-group inc-dec-control">\
        <label class="btn btn-nrm btn-danger pr-0  change_value_to_default" data-value_type="progress_interval" data-value="0">Про:</label>\
        <label class="btn btn-nrm btn-danger input_decrease">  < </label>\
        <label class="btn btn-nrm btn-danger p-0">\
        <input type="number" name="progress_interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="0"  min="0" max="10" step="1" data-decimal="0">\
        </label>\
        <label class="btn btn-nrm btn-danger input_increase"> > </label>\
        </div>\
        </div>\
        </div>\
        </form>\
        </div>' + $$right_hero_block + '\
        </div>';
        return $$settings_block;
    }

    function create_screens_row(args) {
        var start_number = args.start_number;
        var finish_number = args.finish_number;
        var screen_width_class = args.screen_width_class;
        $$screens_row = "";
        for (var i = start_number; i <= finish_number; i++) {
            args.screen_id = i;
            $$screen = create_screen(args);
            $$screens_row += $$screen;
        }
        return '<div class="row screen_row col-12 justify-content-center p-0 m-0" data-row_position="' + args.row_position + '" data-row_screens_nmb="' + args.row_screens_nmb + '">' + $$screens_row + '</div>'
    }

    function create_screens(screens_nmb) {
        $(".screens_nmb_display").html(screens_nmb);
        $("#main_screen").html("");
        GLOBAL_STATE.screens_nmb = screens_nmb;
        switch (screens_nmb) {
            case 1:
                args = {
                    start_number: 1,
                    finish_number: 1,
                    screen_width_class: "col-12",
                    screen_height: "90vh",
                    image_height: "80vh",
                    row_position: "up",
                    row_screens_nmb: 1,
                };

                if (device.mobile() || device.tablet()) {
                    args = {
                        start_number: 1,
                        finish_number: 1,
                        screen_width_class: "col-12",
                        screen_height: "75vh",
                        image_height: "70vh",
                        row_position: "up",
                        row_screens_nmb: 1,
                    };
                }

                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 2:
                args = {
                    start_number: 1,
                    finish_number: 2,
                    screen_width_class: "col-6",
                    screen_height: "90vh",
                    image_height: "80vh",
                    row_position: "up",
                    row_screens_nmb: 2,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 3:
                args = {
                    start_number: 1,
                    finish_number: 3,
                    screen_width_class: "col-4",
                    screen_height: "90vh",
                    image_height: "80vh",
                    row_position: "up",
                    row_screens_nmb: 3,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 4:
                args = {
                    start_number: 1,
                    finish_number: 2,
                    screen_width_class: "col-6",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 2,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 3,
                    finish_number: 4,
                    screen_width_class: "col-6",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "down",
                    row_screens_nmb: 2,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 5:
                args = {
                    start_number: 1,
                    finish_number: 3,
                    screen_width_class: "col-4",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 3,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 4,
                    finish_number: 5,
                    screen_width_class: "col-6",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 2,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 6:
                args = {
                    start_number: 1,
                    finish_number: 3,
                    screen_width_class: "col-4",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 3,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 4,
                    finish_number: 6,
                    screen_width_class: "col-4",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 3,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 7:
                args = {
                    start_number: 1,
                    finish_number: 4,
                    screen_width_class: "col-3",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 4,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 5,
                    finish_number: 7,
                    screen_width_class: "col-4",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 3,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 8:
                args = {
                    start_number: 1,
                    finish_number: 4,
                    screen_width_class: "col-3",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 4,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 5,
                    finish_number: 8,
                    screen_width_class: "col-3",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 4,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 9:
                args = {
                    start_number: 1,
                    finish_number: 5,
                    screen_width_class: "col",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 5,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 6,
                    finish_number: 9,
                    screen_width_class: "col-3",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 4,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
            case 10:
                args = {
                    start_number: 1,
                    finish_number: 5,
                    screen_width_class: "col",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 5,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                args = {
                    start_number: 6,
                    finish_number: 10,
                    screen_width_class: "col",
                    screen_height: "45vh",
                    image_height: "40vh",
                    row_position: "up",
                    row_screens_nmb: 5,
                };
                $$screens_row = create_screens_row(args);
                $("#main_screen").append($$screens_row);
                break;
        }

        if (screens_nmb > 1) {
            $(".settings_hero").addClass("d-none");
            $(".problem_hero").addClass("d-none");
        } else {
            $(".settings_hero").removeClass("d-none");
            $(".problem_hero").removeClass("d-none");
        }
        if (screens_nmb >= 4 || device.mobile() || device.tablet()) {
            $(".btn-nrm").addClass("btn-sm");
            $(".mini-control").removeClass("h-lg").addClass("h-sm");
            $(".btn-nrm-lg").addClass("btn-sm").removeClass("btn-lg");
            $(".input-nrm").addClass("pt-0 pb-0");
        } else {
            $(".btn-nrm").removeClass("btn-sm");
            $(".mini-control").addClass("h-lg").removeClass("h-sm");
            $(".btn-nrm-lg").removeClass("btn-sm").addClass("btn-lg");
            $(".input-nrm").removeClass("pt-1 pb-1");
        }

        if (device.mobile() || device.tablet()) {

            $(".btn-nrm-2").addClass("btn-sm");
            $(".input-nrm-2").addClass("pt-0 pb-0");
        } else {
            $(".btn-nrm-2").removeClass("btn-sm");
            $(".input-nrm-2").removeClass("pt-1 pb-1");
        }
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            set_setting_bars(GLOBAL_STATE[i], i);
        }

    }

    function show_answers_block() {
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            create_and_append_answer_inputs(i)
        }
    }
    </script>
    <script>
    $(document).ready(function() {
        if (is_task_mode()) {
            $(".btn_checked_digits").addClass("disabled")
        }

        $(".change_bead_color").on("click", function() {
            var bead_class = $(this).data("bead_class");
            change_bead_color(bead_class);
            $("#modal_change_bead_color").modal("hide")
        });

        if (device.tablet()) {
            $(".tablet-hidden").addClass("d-none")
        }

        if (is_task_mode()) {
            $(".task-hidden").addClass("d-none")
        }

        if (device.mobile()) {
            $(".mobile-hidden").addClass("d-none")
        }

        if (device.mobile() || device.tablet()) {

        }
        $(document)
            .on('click.bs.dropdown', '.noclose', function(e) {
                e.stopPropagation()
            })
            .on("click", ".btn_start", function() {
                var screen_id = parseInt($(this).closest(".screen").attr("id"));
                start_example(screen_id)
            })
            .on("click", ".show_block", function() {
                var block_type = $(this).data("block_type");
                $screen = $(this).closest(".screen");
                screen_pk = $screen.attr("id");
                blocks = [block_type];
                if (block_type === "main" || block_type === "settings") {
                    blocks.push("mini-control")
                }
                if (block_type === "problem") {
                    blocks.push("mini-control");
                    blocks.push("problem_inner");
                    blocks.push("answer_input");
                    blocks.push("flash_card");
                }
                show_blocks(screen_pk, blocks)
            })
            .on("change", ".screen_title", function() {
                var screen_id = parseInt($(this).closest(".screen").attr("id"));
                screen_title = $(this).val();
                GLOBAL_STATE[screen_id].screen_title = screen_title;
            })
            .on("click", "#modal_settings_confirm", function() {
                $form = $("#modal_global_settings").find("form");
                var parameters = get_parameters_parsed($form.serializeObject());
                var screen_state = {
                    parameters: parameters
                };
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    set_setting_bars(screen_state, i)
                }
                $("#modal_global_settings").modal("hide")
            })
    })
    </script>
    <script>
    $(document).ready(function() {


        $(document)
            .on("click", ".change_value_to_default", function() {
                var value_type = $(this).data("value_type");
                var value = $(this).data("value");
                var screen_pk = $(this).closest(".screen").attr("id");
                edit_parameter({ 'screen_pk': screen_pk, 'value_type': value_type, 'value': value })
            })
            .on("click", ".input_increase", function() {
                $input = $(this).closest(".inc-dec-control").find("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "input_increase",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)

            })
            .on("click", ".input_decrease", function() {
                $input = $(this).closest(".inc-dec-control").find("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "input_decrease",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("change", ".input_number", function() {
                $input = $(this);
                var args = {
                    "$this": $(this),
                    "value_type": $input.attr("name"),
                    "operation": "input_number",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("click", ".btn_checked_digits", function() {
                $input = $(this).closest("input");

                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "btn_checked_digits",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("click", ".btn_check_all_digits", function() {
                $input = $(this).closest("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "btn_check_all_digits",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("click", ".bead", function() {

                if (GLOBAL_STATE.mode === "abakus") {


                    var row = $(this).data("row");
                    var col = $(this).data("col");
                    var $flash_card = $(this).closest(".block[data-type='flash_card']");

                    if (row >= 5) {
                        if ($(this).hasClass("bead-inactive")) {
                            $(this).removeClass("bead-inactive").addClass("bead-empty").addClass(GLOBAL_STATE.empty_bead_class);
                            for (var i = row - 1; i >= 5; i--) {
                                $previous_bead = $flash_card.find(".bead[data-col='" + col + "'][data-row='" + i.toString() + "']");
                                $previous_bead.removeClass("bead-empty bead-empty-classic bead-empty-default bead-inactive bead-inactive-default bead-inactive-classic").addClass("bead-active").addClass(GLOBAL_STATE.active_bead_class);
                            }

                        } else if ($(this).hasClass("bead-active")) {
                            $(this).removeClass("bead-active").removeClass(GLOBAL_STATE.active_bead_class).addClass("bead-empty").addClass(GLOBAL_STATE.empty_bead_class);
                            for (var i = row + 1; i <= 9; i++) {
                                $previous_bead = $flash_card.find(".bead[data-col='" + col + "'][data-row='" + i.toString() + "']");
                                $previous_bead.removeClass("bead-empty bead-empty-classic bead-empty-default bead-active").removeClass(GLOBAL_STATE.active_bead_class).addClass("bead-inactive").addClass(GLOBAL_STATE.inactive_bead_class);
                            }
                        }
                    } else if (row <= 3) {
                        if ($(this).hasClass("bead-inactive")) {
                            $(this).removeClass("bead-inactive bead-inactive-default bead-inactive-classic").addClass("bead-empty").addClass(GLOBAL_STATE.empty_bead_class);
                            $previous_bead = $flash_card.find(".bead[data-col='" + col + "'][data-row='" + (row + 1).toString() + "']");
                            $previous_bead.removeClass("bead-empty bead-empty-classic bead-empty-default").addClass("bead-active").addClass(GLOBAL_STATE.active_bead_class);
                        } else if ($(this).hasClass("bead-active")) {
                            $(this).removeClass("bead-active").removeClass(GLOBAL_STATE.active_bead_class).addClass("bead-empty").addClass(GLOBAL_STATE.empty_bead_class);
                            $previous_bead = $flash_card.find(".bead[data-col='" + col + "'][data-row='" + (row - 1).toString() + "']");
                            $previous_bead.removeClass("bead-empty bead-empty-classic bead-empty-default bead-active").removeClass(GLOBAL_STATE.active_bead_class).addClass("bead-inactive").addClass(GLOBAL_STATE.inactive_bead_class);
                        }
                    }
                    var screen_id = parseInt($(this).closest(".screen").attr(("id")));
                    convert_abakus_to_number(screen_id);
                }



            })
    })
    </script>
    <script>
    function clearAll() {
        for (var i = setTimeout(function() {}, 0); i > 0; i--) {
            window.clearInterval(i);
            window.clearTimeout(i);
            if (window.cancelAnimationFrame) window.cancelAnimationFrame(i);
        }
    }

    function is_task_mode() {

        return ($("#main_screen").data("type") === "task")
    }

    function show_number_abakused(args) {
        var $screen = $("#" + args.screen_id.toString());
        var screen_id = args.screen_id;
        var number = args.number;
        var number_abakused = get_number_abakused(number);
        if (GLOBAL_STATE[screen_id].parameters.digits_nmb < number.toString().length) {
            GLOBAL_STATE[screen_id].parameters.digits_nmb = number.toString().length;
            create_and_append_flash_card(screen_id);
        }
        $screen.find(".bead").removeClass("bead-active bead-inactive bead-inactive-default bead-inactive-classic bead-empty bead-empty-classic bead-empty-default");
        for (var digit_array in number_abakused) {
            for (var abakus_digit in number_abakused[digit_array].array) {
                $screen.find(".bead[data-row='" + abakus_digit + "'][data-col='" + digit_array + "']").addClass(get_bead_class(number_abakused[digit_array].array[abakus_digit]))
                $screen.find(".bead-number[data-col='" + digit_array + "']").html(number_abakused[digit_array].digit)
            }
        }
    }

    function get_random_number_by_digits_nmb(digits_nmb, checked_digits) {
        number = "";
        if (!checked_digits || checked_digits.length === 0) {
            checked_digits = [1, 2, 3, 4, 5, 6, 7, 8, 9]
        }
        for (var i = 0; i < digits_nmb; i++) {
            digit = checked_digits[randomInteger(checked_digits.length)];
            number += digit.toString()
        }
        number = parseInt(number);
        return number;
    }


    function global_start() {

        if (is_task_mode() && (!GLOBAL_STATE[1].parameters || GLOBAL_STATE[1].parameters.examples_nmb < 1 || !GLOBAL_STATE[1].parameters.examples_nmb)) {
            location.reload()
        }
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            if (GLOBAL_STATE[i].status !== 'example_started') {
                clearInterval(GLOBAL_STATE[i].timer);

                start_example(i)
            }

        }
    }

    function global_stop() {
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            clearInterval(GLOBAL_STATE[i].timer);
            GLOBAL_STATE[i].status = "example_stopped";
            show_blocks_by_status(i);
        }
    }

    function generate_example(parameters) {
        var digits_nmb = parameters.digits_nmb;
        var impulses_nmb = parseInt(parameters.impulses_nmb);
        if (impulses_nmb > 10) {
            impulses_nmb = 10
        }
        var example_answer = [];
        for (var i = 1; i <= impulses_nmb; i++) {
            var random_number = get_random_number_by_digits_nmb(parameters.digits_nmb, parameters.checked_digits);
            example_answer.push({
                "number": i,
                "example": random_number,
                "answer": random_number,
            })
        }
        return example_answer
    }


    function change_btn() {

    }

    function do_progress(screen_state, direction) {


        if (screen_state.progress_variant === undefined) {

            if (screen_state.parameters.progress_interval > 0) {
                screen_state.progress_variant = 'interval'
            } else if (screen_state.parameters.progress_impulses_nmb > 0) {
                screen_state.progress_variant = 'impulses_nmb'
            }
        } else {
            if (screen_state.parameters.progress_interval > 0 && screen_state.parameters.progress_impulses_nmb === 0) {
                screen_state.progress_variant = 'interval'
            } else if (screen_state.parameters.progress_impulses_nmb > 0 && screen_state.parameters.progress_interval === 0) {
                screen_state.progress_variant = 'impulses_nmb'
            }
        }


        if (direction === 'up') {
            if (screen_state.parameters.scenario !== undefined) {
                if (['max_impulses_junior', 'max_impulses_school', 'junior', 'school'].indexOf(screen_state.parameters.scenario) !== -1) {
                    max_digits_nmb = 8;
                    if (['max_impulses_junior', 'junior'].indexOf(screen_state.parameters.scenario) !== -1) {
                        max_digits_nmb = 2
                    }
                    if (screen_state.parameters.interval <= 0.1) {
                        if (GLOBAL_STATE.check === undefined) {
                            GLOBAL_STATE.check = 1;
                        } else if (GLOBAL_STATE.check >= 3) {
                            GLOBAL_STATE.check = 1;
                            max_impulses_nmb = 6;
                            switch (screen_state.parameters.digits_nmb) {
                                case 1:
                                    max_impulses_nmb = 6;
                                    break;
                                case 2:
                                    max_impulses_nmb = 4;
                                    break;
                                case 3:
                                    max_impulses_nmb = 3;
                                    break;
                                case 5:
                                case 6:
                                case 7:
                                case 8:
                                case 9:
                                case 4:
                                    max_impulses_nmb = 1;
                                    break;
                            }

                            if (['max_impulses_junior', 'max_impulses_school'].indexOf(screen_state.parameters.scenario) !== -1) {
                                max_impulses_nmb = 10;
                            }

                            if (screen_state.parameters.impulses_nmb < max_impulses_nmb) {
                                screen_state.parameters.impulses_nmb++;
                                impulses_nmb = screen_state.parameters.impulses_nmb;


                                alert_message("Сейчас будет " + impulses_nmb.toString() + " импульса");
                                edit_parameter({
                                    screen_pk: screen_state.screen_id,
                                    value_type: 'impulses_nmb',
                                    value: screen_state.parameters.impulses_nmb,
                                });
                                screen_state.parameters.interval = 1;
                                edit_parameter({
                                    screen_pk: screen_state.screen_id,
                                    value_type: 'interval',
                                    value: screen_state.parameters.interval,
                                });
                            } else {
                                if (screen_state.parameters.digits_nmb < max_digits_nmb) {
                                    screen_state.parameters.digits_nmb++;
                                }
                                screen_state.parameters.interval = 1;
                                edit_parameter({
                                    screen_pk: screen_state.screen_id,
                                    value_type: 'interval',
                                    value: screen_state.parameters.interval,
                                });
                                screen_state.parameters.impulses_nmb = 1;
                                edit_parameter({
                                    screen_pk: screen_state.screen_id,
                                    value_type: 'impulses_nmb',
                                    value: screen_state.parameters.impulses_nmb,
                                });
                                digits_nmb = screen_state.parameters.digits_nmb;
                                alert_message("Сейчас будет " + digits_nmb.toString() + " цифры");
                                edit_parameter({
                                    screen_pk: screen_state.screen_id,
                                    value_type: 'digits_nmb',
                                    value: screen_state.parameters.digits_nmb,
                                });
                            }


                        } else {
                            GLOBAL_STATE.check++
                        }

                    }
                }
            }

            if (screen_state.parameters.progress_digits_nmb > 0) {
                screen_state.progress_digits_nmb_key++;
                if (screen_state.progress_digits_nmb_key >= screen_state.parameters.progress_digits_nmb) {
                    screen_state.progress_digits_nmb_key = 0;
                    screen_state.parameters.digits_nmb++;
                    edit_parameter({ 'screen_pk': screen_id, 'value_type': 'impulses_nmb', 'value': 1 });
                    $screen = $("#" + screen_state.screen_id.toString());
                    $screen.find("input[name='digits_nmb']").val(screen_state.parameters.digits_nmb)
                }
            }
            if (screen_state.parameters.progress_impulses_nmb > 0 && screen_state.progress_variant === "impulses_nmb") {
                screen_state.progress_key++;
                if (screen_state.progress_key >= screen_state.parameters.progress_impulses_nmb) {
                    screen_state.progress_key = 0;
                    impulses_nmb = screen_state.parameters.impulses_nmb + 1;
                    if (impulses_nmb > 10) {
                        impulses_nmb = 10
                    }

                    edit_parameter({ 'screen_pk': screen_id, 'value_type': 'impulses_nmb', 'value': impulses_nmb });

                    if (screen_state.parameters.progress_interval > 0) {
                        screen_state.progress_variant = "interval"
                    }
                }
            } else if (screen_state.parameters.progress_interval > 0 && screen_state.progress_variant === "interval") {
                screen_state.progress_key++;
                if (screen_state.progress_key >= screen_state.parameters.progress_interval) {
                    screen_state.progress_key = 0;
                    if (screen_state.parameters.interval >= 0.2) {
                        var interval = screen_state.parameters.interval -= 0.1;
                        interval = get_number_float_rounded(interval);
                        edit_parameter({ 'screen_pk': screen_id, 'value_type': 'interval', 'value': interval });
                    }
                    if (screen_state.parameters.progress_impulses_nmb > 0) {
                        screen_state.progress_variant = "impulses_nmb"
                    }
                }
            }
        } else if (direction === 'down') {
            if (screen_state.parameters.progress_digits_nmb > 0) {
                screen_state.progress_digits_nmb_key--;
                if (screen_state.progress_digits_nmb_key <= -screen_state.parameters.progress_digits_nmb) {
                    screen_state.progress_digits_nmb_key = 0;
                    if (screen_state.parameters.digits_nmb >= 2) {
                        screen_state.parameters.digits_nmb--;
                    }
                    $screen = $("#" + screen_state.screen_id.toString());
                    $screen.find("input[name='digits_nmb']").val(screen_state.parameters.digits_nmb)
                }
            }

            if (screen_state.parameters.progress_impulses_nmb > 0 && screen_state.progress_variant === "impulses_nmb") {
                screen_state.progress_key--;
                if (screen_state.progress_key <= -screen_state.parameters.progress_impulses_nmb) {
                    screen_state.progress_key = 0;
                    if (screen_state.parameters.summands_nmb >= 3) {

                        impulses_nmb = screen_state.parameters.impulses_nmb - 1;
                        if (impulses_nmb === 0) {
                            impulses_nmb = 1
                        }
                        edit_parameter({ 'screen_pk': screen_id, 'value_type': 'impulses_nmb', 'value': impulses_nmb })
                    }
                    if (screen_state.parameters.progress_interval > 0) {
                        screen_state.progress_variant = "interval"
                    }
                }
            } else if (screen_state.parameters.progress_interval > 0 && screen_state.progress_variant === "interval") {
                screen_state.progress_key--;
                if (screen_state.progress_key <= -screen_state.parameters.progress_interval) {
                    screen_state.progress_key = 0;
                    interval = screen_state.parameters.interval += 0.1;
                    interval = get_number_float_rounded(interval);
                    edit_parameter({ 'screen_pk': screen_id, 'value_type': 'interval', 'value': interval });
                    if (screen_state.parameters.progress_impulses_nmb > 0) {
                        screen_state.progress_variant = "impulses_nmb"
                    }
                }
            }
        }
    }


    function alert_message(message) {
        $("#alert_message").html(message);
        $("#modal_alert").modal();
    }

    function is_olymp_task() {
        var result = false;

        return result
    }

    function stop_enter_timer(screen_id) {
        clearInterval(GLOBAL_STATE.enter_timer);
        stop_sound();
        $(".timer_bar").css("width", "100%");
        $(".timer_block").addClass("invisible");
    }

    function start_enter_timer(screen_id) {
        if (is_olymp_task()) {
            sound_click("tik-tak");
            var screen_state = GLOBAL_STATE[screen_id];
            //screen_state.parameters.scenario = 'junior';
            if (screen_state.parameters.scenario !== undefined) {
                if (screen_state.parameters.scenario === 'junior' || screen_state.parameters.scenario === 'junior_2') {
                    initial_interval = 15
                } else {
                    initial_interval = 10
                }
                initial_interval = 20;
                var digits_nmb = screen_state.parameters.digits_nmb;
                var impulses_nmb = screen_state.parameters.impulses_nmb;
                interval = (initial_interval + digits_nmb * (impulses_nmb + 1));
                check = 0;
                width = 100;
                GLOBAL_STATE.enter_timer = setInterval(function() {
                    check += 0.2;
                    if (check > interval) {
                        clearInterval(GLOBAL_STATE.enter_timer);
                        $(".timer_bar").css("width", "100%");
                        $(".timer_block").addClass("invisible");
                        check_answer(screen_id);
                    };
                    width = (interval - check) / interval * 100;
                    $(".timer_block").removeClass("invisible");
                    $(".timer_bar").css("width", width.toString() + "%")
                }, 200)
            }
        }

    }
    num = 0;

    function send_result(force, no_answer) {
        if (force === undefined) {
            force = false
        }
        if (no_answer === undefined) {
            no_answer = false
        }
        if (is_task_mode()) {
            all_done = 0;
            all_correct = 0;
            all_examples_nmb = 0;
            all_points = 0;
            all_diff_points = 0;
            all_examples_done = 0;
            all_all_examples_nmb = 0;
            all_student_answer = "";
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                all_done += GLOBAL_STATE[i].done;
                all_examples_done += GLOBAL_STATE[i].all_examples_done;
                all_points += GLOBAL_STATE[i].points;
                all_diff_points += GLOBAL_STATE[i].diff_points;
                all_correct += GLOBAL_STATE[i].correct;
                all_examples_nmb += GLOBAL_STATE[i].parameters.examples_nmb;
                all_all_examples_nmb += GLOBAL_STATE[i].all_examples_nmb;
                all_student_answer += GLOBAL_STATE[i].example_text;
            }
            if (all_examples_done === 0) {
                all_correct_percent = 0
            } else {
                all_correct_percent = parseInt(all_correct / all_examples_done * 100);
            }


            all_done_percent = parseInt(all_examples_done / all_all_examples_nmb * 100);
            $(".examples_done").html(all_examples_done);
            $(".examples_nmb_display").html(all_all_examples_nmb);
            $(".examples_nmb").html(all_all_examples_nmb);
            $(".correct_nmb").html(all_correct);
            $(".correctness_bar").css("width", all_correct_percent + "%");
            $(".correct_percent").html(all_correct_percent);
            $(".progress_bar").css("width", all_done_percent + "%");
            $(".done_percent").html(all_done_percent);
            $(".done_nmb").html(all_done);
            $(".points").html(all_points);
            $("#points").val(all_points);
            $("#diff_points").val(all_diff_points);
            $("#student_answer").val(all_student_answer);
            $("#correct_percent").val(all_correct_percent);
            screen_state = GLOBAL_STATE[1];
            if (screen_state.done >= screen_state.parameters.examples_nmb) {

                if (!end_time) {
                    var d = new Date;
                    end_time = d.getTime();
                }
                duration = end_time - start_time;
                if (isNaN(duration) || isNaN(parseInt(duration))) duration = 5555;
                $("#duration").val(duration);
                seconds = duration / 1000;
                hours = parseInt(seconds / 3600);
                minutes = parseInt(seconds % 60 / 60);
                seconds = parseInt(seconds % 3600);

                if (hours === 0 && minutes === 0) {
                    duration_text = seconds + " секунд"
                } else if (hours === 0 && minutes > 0) {
                    duration_text = minutes + " минут " + seconds + " секунд"
                } else if (hours > 0) {
                    duration_text = hours + " часов " + minutes + " минут " + seconds + " секунд"
                }

                $(".duration").html(duration_text);

                done_date = new Date();
                day = parseInt(done_date.getDate());
                if (day < 10)
                    day = "0" + day.toString();
                month = parseInt(done_date.getMonth()) + 1;
                if (month < 10)
                    month = "0" + month.toString();
                year = done_date.getFullYear();
                done_date_informat = day + "." + month + "." + year;
                $("#done_date").val(done_date_informat);
                $result_form = $("#result_form");

                var data = {
                    correct_percent: all_correct_percent,
                    real_correct_percent: all_correct_percent,
                    real_done_nmb: all_done,
                    done_date: done_date_informat,
                    duration: duration,
                    done_nmb: all_done,
                    points: all_points,
                    save_progress: false,
                    diff_points: all_diff_points,
                    status: 1,

                    student_answer: all_student_answer.substring(0, 14900),
                    parameters: screen_state.parameters,
                };


                if (screen_state.parameters.scenario !== undefined || is_olymp_task()) {
                    data.save_progress = true;
                    data['digits_nmb'] = screen_state.parameters['digits_nmb'];
                    data['impulses_nmb'] = screen_state.parameters['impulses_nmb'];
                    data['interval'] = screen_state.parameters['interval'];
                }

                if (no_answer) {
                    data.student_answer = ''
                }

                function getCookie(name) {
                    var matches = document.cookie.match(new RegExp(
                        "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
                    ));
                    return matches ? decodeURIComponent(matches[1]) : undefined;
                }


                data['csrfmiddlewaretoken'] = $('input[name="csrfmiddlewaretoken"]').val();
                $.ajax({
                    url: $result_form.data('action'),
                    type: 'post',
                    dataType: 'json',
                    data: data,
                    traditional: true,
                    success: function(data) {
                        if (data.res === true) {
                            $("#btn_next_tasks").removeClass("d-none");
                            $("#btn_save_results").addClass("d-none");

                            if (data.is_olymp) {
                                $(".points").parent().addClass("d-none");
                                $(".month_points").parent().addClass("d-none");
                                $(".cs_points").parent().addClass("d-none");
                                $(".summary_points").html(data.diff_points);
                                show_main_btn_group("result");
                                sound_answer("present", "play");
                                $("#modal_result").modal()
                            } else {
                                $(".points").parent().removeClass("d-none");
                                $(".month_points").parent().removeClass("d-none");
                                $(".cs_points").parent().removeClass("d-none");
                                $(".month_points").html(data.month_points);
                                $(".cs_points").html(data.cs_points);
                                if (parseInt(data.plus_bonus) !== 0) {
                                    $(".plus_bonus_points_block").removeClass("d-none");
                                    $(".plus_bonus_points").html(data.plus_bonus);
                                }
                                if (parseInt(data.minus_bonus) !== 0) {
                                    $(".minus_bonus_points_block").removeClass("d-none");
                                    $(".minus_bonus_points").html(data.minus_bonus);
                                }
                                $(".summary_points").html(data.summary_points);
                                show_main_btn_group("result");
                                sound_answer("present", "play");
                                $("#modal_result").modal()
                            }


                        } else {
                            msg = "";
                            for (var el in data) {
                                msg += el + " : " + data[el]
                            }
                            $("#btn_next_tasks").addClass("d-none");
                            $("#btn_save_results").removeClass("d-none");

                            if (num === undefined) {
                                num = 0
                            }
                            num++;
                            if (num >= 3) {
                                send_result(force = true, no_answer = true)
                            } else {
                                if (confirm("Результаты не сохранились - Отправить результаты повторно?")) {
                                    send_result(force = true, no_answer = true)
                                }
                            }
                        }
                    },
                    error: function() {
                        $("#btn_next_tasks").addClass("d-none");
                        $("#btn_save_results").removeClass("d-none");

                        if (num === undefined) {
                            num = 0
                        }
                        num++;
                        if (num >= 3) {
                            send_result(force = true, no_answer = true)
                        } else {
                            if (confirm("Результаты не сохранились - Отправить результаты повторно?")) {
                                send_result(force = true, no_answer = true)
                            }
                        }

                    }
                });

            }


        }
    }

    function check_answer(screen_id) {
        stop_enter_timer(screen_id);
        var screen_state = GLOBAL_STATE[screen_id];
        var $screen = $("#" + screen_id.toString());
        $answer_input = $screen.find("input[name='answer_input']");
        $answer_input.attr("type", "text");
        $answer_input.prop("readonly", true);

        screen_state.example_text += (screen_state.done + 1).toString() + ") ";
        if (screen_state.parameters.impulses_nmb === 1) {
            screen_state.all_examples_done++;
            var student_answer = parseInt($answer_input.val());
            if (true) {

                if (!is_olymp_task() && screen_state.parameters.show_results === 'on') {
                    $screen.find(".block[data-type='flash_card']").removeClass("invisible");
                    $screen.find(".bead-number").removeClass("invisible");
                }

                screen_state.status = "example_stopped";
                if (parseInt(student_answer) == parseInt(screen_state.example[0].answer)) {
                    diff_points = parseInt(Math.pow(screen_state.parameters.digits_nmb, 2) / screen_state.parameters.interval);
                    if (diff_points < 1) {
                        diff_points = 1
                    }
                    screen_state.correct++;
                    example_points = 2;
                    screen_state.points += example_points;
                    screen_state.diff_points += diff_points;

                    if (is_olymp_task() || screen_state.parameters.show_results === 'off') {
                        $answer_input.addClass("bg_color_answer_accepted");
                        var example_text = student_answer.toString() + " = " + screen_state.example[0].answer.toString();
                        var example_text_to_show = "Ответ принят";
                        $answer_input.val(example_text_to_show);

                        screen_state.example_text += example_text + "✔" + " [ импульсов: " + screen_state.parameters.impulses_nmb.toString() + ", интервал: " + screen_state.parameters.interval.toString() + " c., баллов за сложность: " + diff_points.toString() + " ]\n";
                        if (screen_id === 1) {
                            sound_click("success")
                        }
                    } else {
                        $screen.find(".player_points").html(screen_state.points);
                        $answer_input.addClass("bg_color_true");
                        var example_text = student_answer.toString() + " = " + screen_state.example[0].answer.toString();
                        $answer_input.val(example_text);
                        screen_state.example_text += example_text + "✔ (i: " + screen_state.parameters.interval.toString() + ", b: " + diff_points + ") \n";
                        if (screen_id === 1) {
                            sound_click("success")
                        }
                    }
                    do_progress(screen_state, 'up')
                } else {
                    if (is_olymp_task() || screen_state.parameters.show_results === 'off') {
                        example_text = student_answer.toString() + " ≠ " + screen_state.example[0].answer.toString();
                        example_text_to_show = "Ответ принят";
                        $answer_input.val(example_text_to_show);
                        screen_state.example_text += example_text + "✘ \n";
                        $answer_input.addClass("bg_color_answer_accepted");
                        if (screen_id === 1) {
                            sound_click("success")
                        }
                    } else {
                        var example_text = student_answer.toString() + " ≠ " + screen_state.example[0].answer.toString();
                        $answer_input.val(example_text);
                        screen_state.example_text += example_text + "✘ \n";
                        $answer_input.addClass("bg_color_false");

                        if (screen_id === 1) {
                            sound_click("error")
                        }
                    }
                    do_progress(screen_state, 'down')
                }
            } else {
                $answer_input.addClass("bg_color_false");
            }
        } else {
            var example = screen_state.example;
            var true_answers_nmb = 0;
            screen_state.all_examples_nmb--;
            screen_state.this_diff_points = 0;

            for (var el in example) {
                screen_state.all_examples_done++;
                screen_state.all_examples_nmb++;

                $partial_answer_input = $screen.find(".partial_answer_input[data-number='" + example[el].number + "']");
                $btn_partial_answer_input_status = $partial_answer_input.closest(".partial_answer_input_block").find(".btn_partial_answer_input_status");
                $btn_partial_answer_input_status.removeClass("btn-success btn-danger btn-secondary");
                partial_answer_input = parseInt($partial_answer_input.val());

                if (true) {
                    if (parseInt(partial_answer_input) === parseInt(example[el].answer)) {
                        diff_points = parseInt(Math.pow(screen_state.parameters.digits_nmb, 2) / screen_state.parameters.interval);
                        if (diff_points < 1) {
                            diff_points = 1
                        }
                        screen_state.correct++;
                        example_points = 2;
                        screen_state.points += example_points;
                        screen_state.diff_points += diff_points;
                        screen_state.this_diff_points += diff_points;
                        true_answers_nmb++;
                        var example_text = partial_answer_input.toString() + " = " + example[el].answer.toString();
                        example_text_to_show = "Принято";
                        if (is_olymp_task() || screen_state.parameters.show_results === 'off') {
                            $partial_answer_input.val(example_text_to_show);
                            screen_state.example_text += example_text + "✔, ";
                            $partial_answer_input.addClass("bg_color_answer_accepted");
                        } else {
                            $partial_answer_input.val(example_text);
                            screen_state.example_text += example_text + "✔, ";
                            $partial_answer_input.addClass("bg_color_true");
                            $btn_partial_answer_input_status.addClass("btn-success");
                            $btn_partial_answer_input_status.html("✔");
                        }


                    } else {
                        var example_text = partial_answer_input.toString() + " ≠ " + example[el].answer.toString();
                        example_text_to_show = "Принято";
                        if (is_olymp_task() || screen_state.parameters.show_results === 'off') {
                            $partial_answer_input.val(example_text_to_show);
                            screen_state.example_text += example_text + "✘, ";
                            $partial_answer_input.addClass("bg_color_answer_accepted");
                        } else {
                            $partial_answer_input.val(example_text);
                            screen_state.example_text += example_text + "✘, ";
                            $partial_answer_input.addClass("bg_color_false");
                            $btn_partial_answer_input_status.addClass("btn-danger");
                            $btn_partial_answer_input_status.html("✘");
                        }


                    }
                }
            }
            screen_state.example_text += "[ импульсов: " + screen_state.parameters.impulses_nmb.toString() + ", интервал: " + screen_state.parameters.interval.toString() + " c., баллов за сложность: " + screen_state.this_diff_points.toString() + " ]\n";

            if (is_olymp_task() || screen_state.parameters.show_results === 'off') {

            } else {
                $screen.find(".player_points").html(screen_state.points);
            }

            screen_state.status = "example_stopped";
            if (screen_id === 1) {
                if (true_answers_nmb >= Math.ceil(screen_state.parameters.impulses_nmb * 0.5)) {
                    sound_click("success");
                    do_progress(screen_state, 'up')
                } else {
                    if (is_olymp_task() || screen_state.parameters.show_results === 'off' || screen_state.parameters.voice_results === 'off') {
                        sound_click("success");
                    } else {
                        sound_click("error");
                    }
                    do_progress(screen_state, 'down')
                }
            }
        }
        screen_state.done++;


        send_result()


    }

    function start_example(screen_id) {
        change_mode("flash_card");
        $screen = $('.screen');
        $answer_input = $screen.find("input[name='answer_input']");
        $answer_input.prop("readonly", false);
        var $screen = $("#" + screen_id.toString());
        var screen_state = GLOBAL_STATE[screen_id];

        var parameters = screen_state.parameters;
        if (parameters.impulses_nmb >= 6) {
            $screen.find('.left_hero').removeClass('d-lg-block');
            $screen.find('.right_hero').removeClass('d-lg-block');
        } else {
            $screen.find('.left_hero').addClass('d-lg-block');
            $screen.find('.right_hero').addClass('d-lg-block');
        }

        $screen.removeClass("bg_color_true bg_color_false bg_color_answer_accepted");

        if (is_task_mode() && screen_state.done >= screen_state.parameters.examples_nmb) {
            $("#modal_result").modal()
        } else {
            switch (screen_state.status) {
                case "example_stopped":
                    stop_enter_timer(screen_id);
                    screen_state.status = "example_started";
                    $answer_input = $screen.find(".answer_input");
                    $answer_input.attr("type", "number");
                    $screen.find(".block[data-type='answer_input']").find("input").removeClass("invisible");
                    screen_state.status = "example_started";
                    show_blocks_by_status(screen_id);
                    create_and_append_flash_card(screen_id);
                    var $flash_card = $screen.find(".block[data-type='flash_card']");
                    var $answer_input_input_block = $screen.find(".block[data-type='answer_input']");
                    var $$mini_control_block = $screen.find(".block[data-type='mini-control']");
                    $answer_input_input_block.addClass("invisible");
                    $$mini_control_block.addClass("invisible");

                    $flash_card.addClass("invisible");
                    screen_state.num_summand = 0;
                    var example_answer = generate_example(parameters);
                    screen_state.example = example_answer;
                    setTimeout(function() {
                        var example = example_answer[screen_state.num_summand].example;
                        var args = {
                            screen_id: screen_id,
                            number: example
                        };
                        screen_state.num_summand++;
                        if (screen_state.num_summand >= parameters.impulses_nmb) {
                            clearInterval(screen_state.timer);
                            screen_state.status = "check_answer";
                            show_blocks_by_status(screen_id);
                        }
                        show_number_abakused(args);
                        if (screen_id === 1) {
                            sound_click("click");
                        }

                        $flash_card.removeClass("invisible");
                        setTimeout(function() {
                            $flash_card.addClass("invisible");
                            if (screen_state.num_summand >= parameters.impulses_nmb) {
                                $answer_input_input_block.removeClass("invisible");
                                $$mini_control_block.removeClass("invisible");
                                screen_state.status = "check_answer";
                                show_blocks_by_status(screen_id);
                                start_enter_timer(screen_id)
                            }
                        }, parameters.interval * 1000);

                        if (screen_state.num_summand < parameters.impulses_nmb) {
                            screen_state.timer = setInterval(function() {
                                var example = example_answer[screen_state.num_summand].example;
                                var args = {
                                    screen_id: screen_id,
                                    number: example
                                };
                                screen_state.num_summand++;

                                show_number_abakused(args);
                                if (screen_id === 1) {
                                    sound_click("click");
                                }
                                $flash_card.removeClass("invisible");
                                setTimeout(function() {
                                    $flash_card.addClass("invisible")
                                }, parameters.interval * 1000);

                                if (screen_state.num_summand >= parameters.impulses_nmb) {
                                    clearInterval(screen_state.timer);
                                    setTimeout(function() {
                                        $flash_card.addClass("invisible");
                                        $answer_input_input_block.removeClass("invisible");
                                        $$mini_control_block.removeClass("invisible");
                                        screen_state.status = "check_answer";
                                        show_blocks_by_status(screen_id);
                                        start_enter_timer(screen_id)

                                    }, parameters.interval * 1000 + 700)

                                }
                            }, parameters.interval * 1000 + 700);
                        }
                    }, 700);
                    break;
                case "example_started":
                    break;
                case "check_answer":
                    check_answer(screen_id);
                    break;

            }
        }


    }
    </script>
    <script>
    document.onkeyup = function(e) {
        e = e || window.event;
        if (e.keyCode === 13) {
            $modals = $(".modal");
            all_modals_closed = true;
            $modals.each(function() {
                if ($(this).hasClass("show")) {
                    all_modals_closed = false;
                    $(this).modal("hide")
                }
            });

            if (all_modals_closed) {
                global_start()
            }






        }
    };
    $(document).ready(function() {
        create_screens(1);

        $(".btn_start").on("click", function() {
            var screen_id = parseInt($(this).closest(".screen").attr("id"));
            start_example(screen_id)
        })


        date_var = new Date();
        start_time = date_var.getTime();
        args = {
            screen_id: 1,
            number: 7447,
        };
        show_number_abakused(args);
    });


    window.onload = function(ev) {
        if (!is_task_mode()) {
            $('#modal_global_settings').modal();
        }
        $.ajax({
            type: "get",
            traditional: true,
            url: $("#is_auth_check").val(),
            success: function(data) {
                if (data.res === true) {
                    $("#main_screen").removeClass("d-none");
                    $("#navbar").removeClass("d-none");
                }
            }
        });
    };
    </script>
</body>

</html>