<html lang="en" class=" desktop portrait">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="yandex-verification" content="b0b2abeb71178a3b">
    <meta name="google-site-verification" content="Oq6HwhQkLG9zKCfUXwetAn2-EIee9lmoTA6vk2LRT6U">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="static/css/bootstrap4.css">
    <link rel="stylesheet" href="static/css/bootstrap4_additional2.css">
    <link rel="stylesheet" href="static/AdminLTE/bower_components/font-awesome/css/font-awesome.min.css">
    <script src="static/AdminLTE/jquery.min.js"></script>
    <script src="static/js/popper.min.js"></script>
    <script src="static/js/bootsrap4.min.js"></script>
    <script src="static/js/device.min.js"></script>
    <script src="static/js/sketchy_bootstrap4.js"></script>
    <script src="static/main.js"></script>

    <style>
        .number-inherit {
            width: 100px;
            height: 100px;
            background-color: red;
            -webkit-animation-name: example; /* Safari 4.0 - 8.0 */
            -webkit-animation-duration: 0.05s; /* Safari 4.0 - 8.0 */
            animation-name: example;
            animation-duration: 0.05s;
        }

        /* Safari 4.0 - 8.0 */
        @-webkit-keyframes example {
            from {
                color: green;
            }
            to {
                color: inherit !important;
            }
        }

        /* Standard syntax */
        @keyframes example {
            from {
                color: green;
            }
            to {
                color: inherit !important;
            }
        }

        input, h1, h2, h3, h4, div {
            font-family: "Neucha", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .bg-light-success {
            background-color: #1d8120;
            color: white;
        }

        .bg-light-danger {
            background-color: #9b2728;
            color: white;
        }

        .bg-light-info {
            background-color: #03819c;
            color: white;
        }

        .bg-light-secondary {
            background-color: #3d3a3e;
            color: white;
        }

        .btn-warning, .btn-outline-warning {
            color: black;
        }


        .screen-info {
            background-color: rgba(160, 209, 218, 0.9) !important;
        }

        .screen-error {
            background-color: rgba(255, 175, 135, 0.9) !important;
        }

        .btn-keyboard-tablet-landscape > .btn-keyboard {
            height: 9vh;
            width: 9vh;
            font-size: 6vh;
        }

        .btn-keyboard-tablet-portrait > .btn-keyboard {
            height: 6vh;
            width: 6vh;
            font-size: 3vh;
        }

        .btn-keyboard {
            height: 6vh;
            width: 6vh;
            font-size: 3vh;
        }

        .btn-keyboard-group-lg > .btn-keyboard {
            height: 9vh;
            width: 9vh;
            font-size: 6vh;
			cursor: pointer;
        }

        .btn-keyboard-group-md > .btn-keyboard {
            height: 8vh;
            width: 8vh;
            font-size: 4vh;
        }

        .btn-keyboard-group-sm > .btn-keyboard {
            height: 6vh;
            width: 6vh;
            font-size: 3vh;
        }

        .btn-keyboard-group-xs > .btn-keyboard {
            height: 9vh;
            width: 9vh;
            font-size: 5vh;
        }

        .neucha {
            font-family: "Neucha", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .segoe {
            font-family: "Segoe UI", -apple-system, system-ui, BlinkMacSystemFont, Roboto, "Helvetica Neue", Arial, sans-serif !important;
            font-weight: 400 !important;
        }
        .roboto {
            font-family: "Roboto", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .jokerman {
            font-family: "Jokerman", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .showcard {
            font-family: "Showcard Gothic", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .playbill {
            font-family: "Playbill", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .dfpop1 {
            font-family: "DFPOP1-W9", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }

        .btn-warning {
            color: black;
        }

        .btn-outline-warning {
            color: black;
        }

        .btn-outline-warning.active {
            color: black !important;
        }

        .btn-outline-warning.disabled {
            color: black !important;
        }

        .btn-outline-info.active:hover {
            background-color: #138496 !important;
        }

        .btn-outline-info:hover {
            background-color: #16b9ce !important;
        }

        .btn-outline-success.active:hover {
            background-color: #218838 !important;
        }

        .btn-outline-danger.active:hover {
            background-color: #c82333 !important;
        }

        .btn-outline-warning.active:hover {
            background-color: #e0a800 !important;
        }

        .margin-bottom-0 {
            margin-bottom: 0;
        }

        .btn-purple {
            background-color: #8722ae;
            color: white;
        }

        .border-purple {
            border-color: #8722ae;
        }

        .btn-purple:hover {
            background-color: #6c2191;
            color: white;
			cursor: pointer;
        }

        .btn-outline-purple:hover {
            background-color: #eacdfb;
            color: white;
        }

        .margin-bottom-5 {
            margin-bottom: 2.5vh !important;
        }

        .btn-outline-secondary2:hover {
            background-color: #878787;
        }

        .margin-left-right-10 {
            margin-left: 10px;
            margin-right: 10px
        }

        .margin-left-right-20 {
            margin-left: 20px;
            margin-right: 20px
        }

        .margin-left-right-30 {
            margin-left: 30px;
            margin-right: 30px
        }

        .true_answer_image_1 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_1.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_2 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_2.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_3 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_3.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_4 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_4.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_5 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_5.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_6 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_6.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_7 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_7.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_8 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_8.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_9 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_9.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_10 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_10.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_11 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_11.png) center center no-repeat;
            background-size: contain
        }

        .true_answer_image_12 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_12.png) center center no-repeat;
            background-size: contain
        }
        .true_answer_image_13 {
            background: url(static/img_game/heroes_2018/true_hero/true_hero_13.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_1 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_1.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_2 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_2.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_3 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_3.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_4 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_4.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_5 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_5.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_6 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_6.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_7 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_7.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_8 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_8.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_9 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_9.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_10 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_10.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_11 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_11.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_12 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_12.png) center center no-repeat;
            background-size: contain
        }

        .false_answer_image_13 {
            background: url(static/img_game/heroes_2018/false_hero/false_hero_13.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_0 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_1 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_2 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_3 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_4 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_5 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_6 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_7 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_8 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_9 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .left_hero_10 {
            background: url(img/left2.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_0 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_1 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_2 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_3 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_4 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_5 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_6 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_7 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_8 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_9 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .right_hero_10 {
            background: url(img/right.png) center center no-repeat;
            background-size: contain
        }

        .bg_color_1, .bg_color_4, .bg_color_7, .bg_color_10 {
            background-color: rgba(255, 255, 204, 0.9);
        }

        .bg_color_2, .bg_color_5, .bg_color_8 {
            background-color: rgba(255, 243, 205, 0.9);
        }

        .bg_color_3, .bg_color_6, .bg_color_9 {
            background-color: rgba(255, 222, 181, 0.9);
        }

        .color-black {
            color: black !important;
        }

        .tooltip {
            z-index: 500;
            opacity: 1 !important;
            top: 35px;
        }

        .card-slider {
            padding: 0
        }

        .tooltip-inner {
            border: 1px solid #333333;
        }

        .bg-success {
            color: white !important;
        }

        .bg-info {
            color: white !important;
        }

        .bg-warning {
            color: black !important;
        }

        .slider-handle {
            top: -5px;
            width: 0;
            height: 0;
        }

        .change-value {
            width: 100%;
        }

        .btn-nrm {
            margin-bottom: 3px
        }

        .padding-left-right-0 {
            padding-right: 0 !important;
            padding-left: 0 !important;
        }

        .slider-horizontal {
            width: 100% !important;
        }

        #RGB {
            height: 20px;
            background: rgb(128, 128, 128);
        }

        #interval_slider .slider-track-high {
            background: #fc3648;
        }

        #interval_slider .slider-handle {
            background: #dc3545;
        }

        #RC .slider-selection {
            background: #fc3648;
        }

        #RC .slider-handle {
            background: #dc3545;
        }

        #GC .slider-selection {
            background: #2bc64e;
        }

        #GC .slider-handle {
            background: #28a745;
        }

        #BC .slider-selection {
            background: #17bfd5;
        }

        #BC .slider-handle {
            border-bottom-color: #17a2b8;
        }

        #BC .slider-handle {
            background: #17a2b8;
        }

        #GrC .slider-selection {
            background: #666;
        }

        #GrC .slider-handle {
            background: #444;
        }

        #R, #G, #B {
            width: 300px;
        }

        .margin-bottom-0 {
            margin-bottom: 0;
        }

        .popover {
            z-index: 2000;
        }
    </style>

    <link rel="stylesheet" href="css/main.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700,800,900" rel="stylesheet">

    <title>Счет на скорость</title>
</head>

<body class="">
    <nav class="navbar navbar-expand-lg border-info navbar-light screen" style="height: 10vh; background-color: #e2f7df" id="navbar">
        <a class="navbar-brand" tabindex="-1" href="&#10;        &#10;            /games/&#10;        "></a>

        <span class="hidden" id="csrf_check">
            <input type="hidden" name="csrfmiddlewaretoken" value="NmyUbcup0TAEeVQLoVqV1rnVr59HppRBoDKlgXyZH4pNwPD1G9w2qItgiLnVunfK">
            <input type="hidden" id="check_url" value="/csrf_check">
        </span>
        <input type="hidden" id="is_auth_check" value="/is_auth_check">
        <input type="hidden" id="module_names" value="/games/api/module_names/">
        <input type="hidden" id="name_methodic" value="abakus">
        <input type="hidden" id="voice_methodic" value="classic">

        <button type="button" class="hamburger" >
            <img src="img/header--item4.png" alt="">
        </button>

        <nav class="nav">
            <ul class="navbar-nav mr-auto ">

                <li class="nav-item dropdown">
                    <a tabindex="-1" class="dropdown-toggle btn btn-outline-secondary" data-toggle="dropdown" href="#" id="themes">Players <span class="players_nmb">1</span></a>
                    <div class="dropdown-menu border-secondary text-center btn-outline-secondary2" aria-labelledby="themes">
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="1">1</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="6">6</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="8">8</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Знаков <span class="digits_nmb_display">1</span> </a>
                    <div class="dropdown-menu border-success text-center btn-outline-success">
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="1">1</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="6">6</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="8">8</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">D <span class="actions_nmb_display">5</span>
                    </a>
                    <div class="dropdown-menu border-info text-center btn-outline-info">
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="10">10</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="15">15</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="17">17</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="20">20</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="25">25</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="30">30</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="40">40</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="50">50</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Скорость: <span class="interval_display">1</span> </a>
                    <div class="dropdown-menu border-danger text-center btn-outline-danger">
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.1">0.1 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.3">0.3 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.5">0.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.7">0.7 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="1">1 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="1.3">1.3 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="1.7">1.7 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="2">2 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="2.2">2.2 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="2.5">2.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="3">3 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="3.2">3.2 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="3.5">3.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="4">4 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="4.5">4.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="5">5 сек </a>
                    </div>
                </li>

                <li class="nav-pause nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-info" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" onclick="$('#modal_global_settings').modal()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-original-title="" title="">Опции</a>
                </li>
            </ul>
        </nav>

        <div class="collapse navbar-collapse" id="navbarColor03">
            <ul class="navbar-nav mr-auto ">

                <li class="nav-item dropdown ">
                    <a tabindex="-1" class="dropdown-toggle btn btn-outline-secondary" data-toggle="dropdown" href="#" id="themes">Players <span class="players_nmb">1</span></a>
                    <div class="dropdown-menu border-secondary text-center btn-outline-secondary2" aria-labelledby="themes">
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="1">1</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="6">6</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_screens_nmb" href="#" data-value="8">8</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Знаков <span class="digits_nmb_display">1</span> </a>
                    <div class="dropdown-menu border-success text-center btn-outline-success">
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="1">1</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="6">6</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_digits_nmb" href="#" data-value="8">8</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">D <span class="actions_nmb_display">5</span>
                    </a>
                    <div class="dropdown-menu border-info text-center btn-outline-info">
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="2">2</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="3">3</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="4">4</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="5">5</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="7">7</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="10">10</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="15">15</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="17">17</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="20">20</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="25">25</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="30">30</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="40">40</a>
                        <a class="dropdown-item navbar_actions_nmb" href="#" data-value="50">50</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Скорость: <span class="interval_display">1</span> </a>
                    <div class="dropdown-menu border-danger text-center btn-outline-danger">
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.1">0.1 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.3">0.3 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.5">0.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="0.7">0.7 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="1">1 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="1.3">1.3 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="1.7">1.7 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="2">2 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="2.2">2.2 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="2.5">2.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="3">3 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="3.2">3.2 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="3.5">3.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="4">4 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="4.5">4.5 сек </a>
                        <a class="dropdown-item navbar_interval" href="#" data-value="5">5 сек </a>
                    </div>
                </li>

                <li class="nav-pause nav-item dropdown">
                    <a tabindex="-1" href="#" class="btn btn-outline-info" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" onclick="$('#modal_global_settings').modal()" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-original-title="" title="">Опции</a>
                </li>

            </ul>
        </div>
    </nav>
    <script>
        $(document).ready(function () {

                $(".btn_voice").on("click", function () {
                    if (GLOBAL_STATE.voice) {
                        GLOBAL_STATE.voice = false;
                        $(this).closest('a').find('.fa').addClass('d-none');
                        GLOBAL_STATE.show_numbers = true;
                        $('.btn_show_numbers').closest('a').find('.fa').removeClass('d-none');
                    } else {
                        GLOBAL_STATE.voice = true;
                        $(this).closest('a').find('.fa').removeClass('d-none')
                    }
                });
                $(".btn_competition_mode").on("click", function () {
                    if (GLOBAL_STATE.competition_mode) {
                        GLOBAL_STATE.competition_mode = false;
                        $(this).closest('a').find('.fa').addClass('d-none');
                        $('.left_hero').removeClass('invisible');
                        $('.right_hero').removeClass('invisible');
                        $('.player_points').removeClass('d-none');
                    } else {
                        GLOBAL_STATE.competition_mode = true;
                        $(this).closest('a').find('.fa').removeClass('d-none');
                        $('.player_name').val('Олимп');
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].player_name = 'Олимп';
                        }
                        GLOBAL_STATE.voice_comment = false;
                        $('.btn_voice_comment').closest('a').find('.fa').addClass('d-none');

                        GLOBAL_STATE.show_true_false = false;
                        $('.btn_show_true_false').closest('a').find('.fa').addClass('d-none');
                        $('.left_hero').addClass('invisible');
                        $('.right_hero').addClass('invisible');
                        $('.player_points').addClass('d-none');
                        GLOBAL_STATE.show_example_number = true;
                        $('.btn_show_example_number').closest('a').find('.fa').removeClass('d-none')
                    }
                });
                $(".btn_show_numbers").on("click", function () {
                    if (GLOBAL_STATE.show_numbers) {
                        GLOBAL_STATE.show_numbers = false;
                        $(this).closest('a').find('.fa').addClass('d-none');
                        GLOBAL_STATE.voice = true;
                        $('.btn_voice').closest('a').find('.fa').removeClass('d-none');
                    } else {
                        GLOBAL_STATE.show_numbers = true;
                        $(this).closest('a').find('.fa').removeClass('d-none')
                    }
                });
                $(".btn_double_sign_mode").on("click", function () {
                    if (GLOBAL_STATE.double_sign_mode) {
                        GLOBAL_STATE.double_sign_mode = false;
                        $(this).closest('a').find('.fa').addClass('d-none');
                        GLOBAL_STATE.voice = true;
                        create_screens(1);
                    } else {
                        GLOBAL_STATE.double_sign_mode = true;
                        create_screens(2);
                        GLOBAL_STATE[2] = GLOBAL_STATE[1];
                        $(this).closest('a').find('.fa').removeClass('d-none')
                    }
                });
                $(".btn_img_mode").on("click", function () {
                    if (imgMode) {
                        imgMode = false;
                        isAutoScenario = false;
                        $(this).closest('a').find('.fa').addClass('d-none');
                    } else {
                        $(this).closest('a').find('.fa').removeClass('d-none');
                        startIMGMode()
                    }

                });

                $(".btn_scenario_mode").on("click", function () {
                    var mode = $(this).data('scenario');
                    if ($(this).data('scenario') === 'img') {
                        if (imgMode) {
                            imgMode = false;
                            isAutoScenario = false;
                            $(this).closest('a').find('.fa').addClass('d-none');
                        } else {
                            $(this).closest('a').find('.fa').removeClass('d-none');
                            startIMGMode()
                        }
                    } else {
                        startScenarioMode(mode)
                    }


                });
                $(".btn_voice_comment").on("click", function () {
                    if (GLOBAL_STATE.voice_comment) {
                        GLOBAL_STATE.voice_comment = false;
                        $(this).closest('a').find('.fa').addClass('d-none')
                    } else {
                        GLOBAL_STATE.voice_comment = true;
                        $(this).closest('a').find('.fa').removeClass('d-none')
                    }

                });
                $(".btn_show_true_false").on("click", function () {
                    if (GLOBAL_STATE.show_true_false) {
                        GLOBAL_STATE.show_true_false = false;
                        $(this).closest('a').find('.fa').addClass('d-none')
                    } else {
                        GLOBAL_STATE.show_true_false = true;
                        $(this).closest('a').find('.fa').removeClass('d-none')
                    }
                });
                $(".btn_show_example_number").on("click", function () {
                    if (GLOBAL_STATE.show_example_number) {
                        GLOBAL_STATE.show_example_number = false;
                        $(this).closest('a').find('.fa').addClass('d-none')
                    } else {
                        GLOBAL_STATE.show_example_number = true;
                        $(this).closest('a').find('.fa').removeClass('d-none')
                    }
                });
                if (device.mobile() || device.tablet()) {
                    GLOBAL_STATE.voice = false
                }
            })
        </script>

    <!-- modal comment-->
    <div class="modal screen" id="modal_global_settings" style="z-index: 2000; display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document" style="max-width: 600px;">
            <div class="bg_8 modal-content" style=" position: absolute; height: 100%; width: 100%; z-index: 99"></div>
            <div class="modal-content border-primary" style=" z-index: 100">
                <div class="modal-header border-info ">
                    <h5 class="modal-title neucha"> <img src="img/option.png" alt="">Опции</h5>
                    <script>
                        $(document).ready(function () {
                             $('#btn_example_number').on('click', function () {
                                 example_number = $('#example_number').val();
                                 example_num = example_number;
                                 console.log('GLOBAL_STATE[1].num_example ', GLOBAL_STATE[1].num_example)
                             })
                         })
                     </script>
<!--                     <a href="/teachers/settings_page/" class="btn btn-nrm-2 btn-success"> Изменить методику озвучки </a>
 -->                    <button type="button" class="btn btn-nrm-2 btn-danger btn--close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <form action="" id="form_settings">
                    <input type="hidden" class="examples_nmb-input" name="examples_nmb" value="0">
                    <div class="modal-body border-warning">
                        <div class="container-fluid">
                            <div class="row homework hidden">
                                <div class="col-6 ">
                                    <div class="card-body text-center">
                                        <h5 class="neucha">Прогресс выполнения </h5>
                                        <div id="progress_text">
                                            <span class="examples_done">0</span> из <span class="examples_nmb">0</span>
                                            (<span class="done_percent">0</span>%)
                                        </div>
                                        <div class="progress">
                                            <div class="progress_bar progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="card-body text-center">
                                        <h5 class="neucha">Правильность выполнения </h5>
                                        <div id="correctness_text">
                                            <span class="correct_nmb">0</span> из <span class="examples_done">0</span>
                                            (<span class="correct_percent">0</span>%)
                                        </div>
                                        <div class="progress">
                                            <div class="correctness_bar progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body text-center row justify-content-center"  style="display:none;">
                                <label class="h4 neucha" for="topic">Тип тренировки</label><br/><br/>
                                <select name="" id="topic" class="form-control text-center">
                                    <option value="0">Выберите</option>
                                    <option value="simple_mirror">Прямой счет</option>
                                    <option value="simple_brother">Младшие товарищи</option>
                                    <option value="friend_less_100">Старшие товарищи</option>
                                    <option value="combo_less_100">Микс формулы</option>
                                    <option value="random">Все формулы</option>
                                </select>
                            </div>
                            <div class="card-body text-center row justify-content-center">
                                <blockquote class="card-blockquote col-md-8 align-self-center">
                                    <label for="modules" class="h4 neucha">Цифры в формулах
                                        <div class="btn-group mt-2">
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-nrm-2 btn-info dropdown-toggle modules_display select__border" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width:210px">Прямой счет</button>
                                                <div class="dropdown-menu dropdown-menu-middle">
                                                    <input type="hidden" name="modules" value="simple">
                                                    <a class="dropdown-item modules module_simple_title bg-info" href="#" data-value="simple">Прямой счет</a>
                                                    <a class="dropdown-item modules module_brother_title" href="#" data-value="brother" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Младшие товарищи</a>
                                                    <a class="dropdown-item modules module_friend_title" href="#" data-value="friend" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Старшие товарищи</a>
                                                    <a class="dropdown-item modules module_combo_title" href="#" data-value="combo" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Микс формулы</a>
                                                    <a class="dropdown-item modules module_random_title" href="#" data-value="random" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true"  data-original-title="" title="">Все формулы</a>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-nrm-2 btn-outline-info active check_all select__btn"><input type="hidden" value="1"> ОК </button>
                                        </div>
                                    </label>
                                </blockquote>
                                <div class="col-12 ">
                                    <div class="btn-group btn-group-toggle btn--modal2" data-toggle="buttons" style="margin-bottom:3px">
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active"><input name="checked_digits" value="1" type="checkbox" checked=""> 1 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active"><input name="checked_digits" value="2" type="checkbox" checked=""> 2 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active"><input name="checked_digits" value="3" type="checkbox" checked=""> 3 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active"><input name="checked_digits" value="4" type="checkbox" checked=""> 4 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active "><input name="checked_digits" value="5" type="checkbox" checked=""> 5 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active "><input name="checked_digits" value="6" type="checkbox" checked=""> 6 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active "><input name="checked_digits" value="7" type="checkbox" checked=""> 7 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active "><input name="checked_digits" value="8" type="checkbox" checked=""> 8 </label>
                                        <label class="btn btn-nrm-2 btn-outline-info checked_digits active "><input name="checked_digits" value="9" type="checkbox" checked=""> 9 </label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body text-center" style="display:none;">
                                <h4 class="neucha">Операции</h4>
                                <div class="btn-group  ">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-nrm-2 btn-success dropdown-toggle operation_display" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Слож-е/Выч-е</button>
                                        <input type="hidden" name="operation" value="plus_minus">
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item operation" data-value="plus" href="#">Сложение</a>
                                            <a class="dropdown-item operation" data-value="minus" href="#">Вычитание</a>
                                            <a class="dropdown-item operation bg-success" data-value="plus_minus" href="#">Сложение/Вычитание</a>
                                            <div class="dropdown-divider just_operation disabled"></div>
                                            <a class="dropdown-item operation just_operation disabled" data-value="just_plus" href="#">Только сложение</a>
                                            <a class="dropdown-item operation just_operation disabled" data-value="just_minus" href="#">Только вычитание</a>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-nrm-2 btn-outline-success operation_alternation" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="">
                                        <input type="hidden" name="operation_alternation" value="off">+/-
                                    </button>

                                </div>
                            </div>
                            <div class="card-body text-center" style="display:none;">
                                <h4 class="neucha">Дополнительные настройки</h4>
                                <div class="btn-group  ">
                                    <div class="btn-group dropup" role="group">
                                        <button type="button" class="btn btn-nrm-2 btn-outline-warning dropdown-toggle btn_dropdown_50 mode_50_display disabled active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">✓ 50+</button>
                                        <input type="hidden" name="mode_50" value="on">
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item mode_50 text-danger" data-value="off" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="">Выключить 50+</a>
                                            <a class="dropdown-item mode_50 bg-warning" data-value="on" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Включить 50+</a>
                                            <a class="dropdown-item mode_50" href="#" data-value="training" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Тренировка 50+</a>
                                        </div>
                                    </div>
                                    <div class="btn-group dropup" role="group">
                                        <button type="button" class="btn btn-nrm-2 btn-outline-warning dropdown-toggle btn_dropdown_100 mode_100_display disabled active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">✓ 100+</button>
                                        <input type="hidden" name="mode_100" value="on">
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item mode_100 text-danger" data-value="off" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="">Выключить 100+</a>
                                            <a class="dropdown-item mode_100 bg-warning" data-value="on" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Включить 100+</a>
                                            <a class="dropdown-item mode_100" href="#" data-value="training" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Тренировка 100+</a>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-nrm-2 btn-outline-warning all_discharge disabled active" data-container="body" data-toggle="popover" data-trigger="hover" data-html="true" data-placement="right" title=""> <input type="hidden" name="all_discharge" value="on">Все </button>
                                    <button type="button" class="btn btn-nrm-2 btn-outline-warning discharge_mode btn_discharge_mode_mirror" data-value="mirror" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title=""> <input type="hidden" name="discharge_mode" value="all">Зер </button>
                                    <div class="btn-group dropup noclose" role="group">
                                        <button type="button" class="btn btn-sm btn-warning dropdown-toggle btn_dropdown_additional" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="additional_display"> Раз </span></button>
                                        <div class="dropdown-menu min-width-5rem">
                                            <a class="dropdown-item bg-warning discharge_mode" data-value="all" href="#" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Все разряды</a>
                                            <a class="dropdown-item discharge_mode" href="#" data-value="1" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="" >1-й разряд</a>
                                            <a class="dropdown-item discharge_mode" href="#" data-value="2" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">2-й разряд</a>
                                            <a class="dropdown-item discharge_mode" href="#" data-value="3" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="" >3-й разряд</a>
                                            <a class="dropdown-item discharge_mode" href="#" data-value="4" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">4-й разряд</a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <p class="modal__line">
                                <span>Голос</span>
                                <a class="dropdown-item btn_voice click--button" href="#">ОК</a> 
                            </p>
                            <p class="modal__line">
                                <span>Правила знаков</span>
                                <a class="dropdown-item btn_double_sign_mode click--button" href="#">ОК</a>
                            </p>
                            
                            <div class="card-body text-center">
                                <h3 class="neucha">Автомат</h3>
                                <h6 class="neucha">Автоматические изменения в случае правильного решения примера</h6>
                                
                                <div class="btn-group inc-dec-control" style="display:none;">
                                
                                    <label class="btn btn-nrm-2 btn-success input_decrease"> - </label>
                                    <label class="btn btn-nrm-2 btn-success p-0">
                                        <input type="number" name="digits_nmb" class="form-control input-nrm-2 text-center border-success bg-light-success input_number" value="1" min="1" max="12" step="1" data-decimal="0">
                                    </label>
                                    <label class="btn btn-nrm-2 btn-success input_increase"> + </label>
                                </div>

                                <div class="wigth--flex">
                                    <div class="btn-group-2 wigth--five">
                                        <label class="btn btn-nrm-2 btn-success pr-0 change_value_to_default modal__label" data-value_type="progress_digits_nmb" data-value="0" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Знаков: </label>
                                        <div class="btn-group inc-dec-control">
                                            <label class="btn btn-nrm-2 btn-success input_decrease"> - </label>
                                            <label class="btn btn-nrm-2 btn-success p-0">
                                                <input type="number" name="progress_digits_nmb" class="form-control input-nrm-2 text-center border-success bg-light-success input_number" value="0" min="0" max="20" step="1" data-decimal="0">
                                            </label>
                                            <label class="btn btn-nrm-2 btn-success input_increase"> + </label>
                                        </div>
                                    </div>
                                    <div class="btn-group-2 wigth--five">
                                        <div class="btn-group inc-dec-control"  style="display:none;">
                                            <label class="btn btn-nrm-2 btn-danger input_decrease"> - </label>
                                            <label class="btn btn-nrm-2 btn-danger p-0">
                                                <input type="number" name="interval" class="form-control input-nrm-2 text-center border-danger bg-light-danger input_number" value="1" min="0.1" max="10" step="0.1" data-decimal="1">
                                            </label>
                                            <label class="btn btn-danger btn-nrm-2 input_increase"> + </label>
                                        </div>
                                        <label class="btn btn-nrm-2 btn-danger pr-0  change_value_to_default modal__label" data-value_type="progress_interval" data-value="0" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="" >Паузы: </label>
                                        <div class="btn-group inc-dec-control">
                                            <label class="btn btn-nrm-2 btn-danger input_decrease"> - </label>
                                            <label class="btn btn-nrm-2 btn-danger p-0">
                                                <input type="number" name="progress_interval" class="form-control input-nrm-2 text-center border-danger bg-light-danger input_number" value="0" min="0" max="5" step="1" data-decimal="0">
                                            </label>
                                            <label class="btn btn-nrm-2 btn-danger input_increase"> + </label>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="card-body text-center"  style="display:none;">
                                <h4 class="neucha">Количество действий</h4>
                                <div class="btn-group inc-dec-control">
                                  
                                    <label class="btn btn-nrm-2 btn-info input_decrease"> - </label>
                                    <label class="btn btn-nrm-2 btn-info p-0">
                                        <input type="number" name="actions_nmb" class="form-control input-nrm-2 text-center border-info bg-light-info input_number" value="5" min="1" max="300" step="1" data-decimal="0">
                                    </label>
                                    <label class="btn btn-nrm-2 btn-info input_increase"> + </label>
                                </div>
                                <div class="btn-group inc-dec-control">
                                    <label class="btn btn-nrm-2 btn-info pr-0 change_value_to_default" data-value_type="progress_actions_nmb" data-value="0" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="">Автомат: </label>
                                    <label class="btn btn-nrm-2 btn-info input_decrease"> - </label>
                                    <label class="btn btn-nrm-2 btn-info p-0">
                                        <input type="number" name="progress_actions_nmb" class="form-control input-nrm-2 text-center border-info bg-light-info input_number" value="0" min="0" max="10" step="1" data-decimal="0">
                                    </label>
                                    <label class="btn btn-nrm-2 btn-info input_increase"> + </label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-info">
                            <button type="button" class="btn btn-nrm-2 btn-success modal__button" data-dismiss="modal" id="save_settings">ОК</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="modal_enter">
        <input type="hidden" id="enter_type">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Ввод данных</h4>
                </div>
                <form action="">
                    <div class="modal-body">
                        <div class="form-horizontal">
                            <label for="enter" id="label_enter"></label>
                            <input type="number" id="enter" class="form-control text-center" autofocus="">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-nrm-2 btn-uppercase-none btn-primary" id="btn_confirm">Сохранить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="modal_result">
        <div class="modal-dialog modal-lg border-danger" role="document">
            <div class="modal-content border-warning">
                <div class="modal-header border-warning">
                    <h5 class="modal-title neucha">Твои результаты</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <form action="" data-action="" method="get" class="form-horizontal" id="result_form">
                    <input type="hidden" id="correct_percent" name="correct_percent" value="0">
                    <input type="hidden" id="points" name="points" value="0">
                    <input type="hidden" id="diff_points" name="diff_points" value="0">
                    <input type="hidden" id="status" name="status" value="1">
                    <input type="hidden" id="duration" name="duration" value="">
                    <input type="hidden" id="done_date" name="done_date" value="">
                    <div class="modal-body">
                        <div class="row homework">
                            <div class="col-md-6">
                                <div class="card-body text-center">
                                    <h5 class="neucha">Правильность выполнения </h5>
                                    <div id="correctness_text">
                                        <span class="correct_nmb">0</span> из <span class="examples_done">0</span>
                                        (<span class="correct_percent">0</span>%)
                                    </div>
                                    <div class="progress">
                                        <div class="correctness_bar progress-bar progress-bar-striped bg-info" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card-body text-center">
                                    <h5 class="neucha">Прогресс выполнения </h5>
                                    <div id="progress_text">
                                        <span class="examples_done">0</span> из <span class="examples_nmb">0</span>
                                        (<span class="done_percent">0</span>%)
                                    </div>
                                    <div class="progress">
                                        <div class="progress_bar progress-bar progress-bar-striped bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h4 class="neucha"> Поздравляем!!! Ты завершил задание</h4>
                        <h4 class="neucha d-none"> Ты набрал: <span class="points"></span> баллов</h4>
                        <h4 class="neucha text-success d-none plus_bonus_points_block"> Бонусные баллы за 100% правильность: <span class="plus_bonus_points"></span> баллов</h4>
                        <h4 class="neucha text-danger d-none minus_bonus_points_block"> Штрафные баллы за выполнение не в срок: <span class="minus_bonus_points"></span> баллов</h4>
                        <h4 class="neucha"> Итого за данное задание: <span class="summary_points"></span> баллов</h4>
                        <h4 class="neucha"> Итого выполнено: <span class="done_nmb"></span> примеров</h4>
                        <br>
                        <h4 class="neucha d-none"> За этот месяц ты на набрал: <span class="month_points"></span> баллов</h4>
                        <h4 class="neucha d-none"> Всего баллов за данный курс: <span class="cs_points"></span> баллов</h4>
                        <h4 class="neucha"> Время выполнения: <span class="duration"></span></h4>
                        <textarea readonly="" id="student_answer" cols="30" rows="10" class="form-control text-center border-info"></textarea>
                    </div>
                    <div class="modal-footer border-warning">
                        <button type="button" id="btn_save_results" class="btn btn-nrm-2 btn-uppercase-none btn-primary" onclick="send_result(true, true)">Отправить результаты</button>
                        <button type="submit" id="btn_next_tasks" class="btn btn-nrm-2 btn-uppercase-none btn-primary d-none">Перейти к новым заданиям</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="modal_alert">
        <div class="modal-dialog modal-lg border-danger" role="document">
            <div class="bg_8 modal-content" style="position: absolute; height: 100%; width: 100%;"></div>
            <div class="modal-content  border-warning" style="background-color: rgba(255,255,204,0.8);">
                <div class="modal-header border-warning">
                    <h5 class="modal-title neucha">ВНИМАНИЕ!!!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body pb-0 row justify-content-center align-items-center" style="height: 60vh">
                    <h1 class="text-center" id="alert_message"></h1>
                    <input type="text" class="text-center neucha" style="background-color: inherit; border: none; font-size: 100px; max-width: 60vw">
                </div>
                <div class="modal-footer border-warning">
                    <button type="button" class="btn btn-nrm-2 btn-success" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="modal_alert2">
        <div class="modal-dialog modal-lg border-danger" role="document">
            <div class="bg_8 modal-content" style="position: absolute; height: 100%; width: 100%;"></div>
            <div class="modal-content  border-warning" style="background-color: rgba(255,255,204,0.8);">
                <div class="modal-header border-warning">
                    <h5 class="modal-title neucha">ВНИМАНИЕ!!!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body pb-0 row justify-content-center align-items-center" style="height: 60vh">
                    <input type="text" id="alert_text2" class="text-center segoe" style="background-color: inherit; border: none; font-size: 100px; max-width: 60vw">
                </div>
                <div class="modal-footer border-warning">
                    <button type="button" class="btn btn-nrm-2 btn-danger show_res" data-dismiss="modal">Посмотреть ответы</button>
                    <button type="button" class="btn btn-nrm-2 btn-success" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="trans_first_multiplier" value="Первый множитель">
    <input type="hidden" id="trans_second_multiplier" value="Второй множитель">
    <input type="hidden" id="trans_dividend" value="Делимое">
    <input type="hidden" id="trans_divider" value="Делитель">
    <input type="hidden" id="trans_player" value="Игрок">
    <input type="hidden" id="trans_multiply" value="Умножение">
    <input type="hidden" id="trans_divide" value="Деление">
    <input type="hidden" id="is_ready" value="1">
    <input type="hidden" id="url_incorrect" value="static/games_audio/new/kungfu_panda/incorrect">
    <input type="hidden" id="url_correct" value="static/games_audio/new/kungfu_panda/correct">
    <input type="hidden" id="url_present" value="static/audio/audio_for_menar_games/present">
    <input type="hidden" id="url_sounds" value="static/games_audio/new/sounds">
    <input type="hidden" id="url_voice" value="static/games_audio/voice/russian/female_2">
    <input type="hidden" id="url_voice_new" value="static/games_audio/voice/russian/female_3">
    <input type="hidden" id="url_voice_none_sign" value="static/games_audio/voice/russian/none_sign/female">
    <input type="hidden" id="trans_simple" value="Прямой счет">
    <input type="hidden" id="trans_brother" value="Младшие товарищи">
    <input type="hidden" id="trans_friend" value="Старшие товарищи">
    <input type="hidden" id="trans_friend_brother" value="Старшие товарищи">
    <input type="hidden" id="trans_combo" value="Микс формулы">
    <input type="hidden" id="trans_random" value="Все формулы">
    <input type="hidden" id="trans_player" value="Игрок">
    <input type="hidden" id="trans_simple_short" value="Прямой счет">
    <input type="hidden" id="trans_brother_short" value="Младшие товарищи">
    <input type="hidden" id="trans_friend_brother_short" value="Старшие товарищи">
    <input type="hidden" id="trans_friend_short" value="Старшие товарищи">
    <input type="hidden" id="trans_combo_short" value="Микс формулы">
    <input type="hidden" id="trans_random_short" value="Все формулы">
    <input type="hidden" id="trans_plus" value="Сложение">
    <input type="hidden" id="trans_just_plus" value="Только сложение">
    <input type="hidden" id="trans_minus" value="Вычитание">
    <input type="hidden" id="trans_just_minus" value="Только вычитание">
    <input type="hidden" id="trans_plus_minus" value="Слож-е/Выч-е">
    <input type="hidden" id="trans_plus_minus_short" value="Слож/Выч">
    <input type="hidden" id="trans_decimal_off" value="Дробь">
    <input type="hidden" id="trans_decimal_1_digit" value="Дробь 1">
    <input type="hidden" id="trans_decimal_2_digit" value="Дробь 2">
    <input type="hidden" id="trans_sign_off" value="Знак">
    <input type="hidden" id="trans_sign_on" value="✓ Знак">
    <input type="hidden" id="trans_sign_training" value="Т Знак">
    <input type="hidden" id="trans_progress_off" value="Прогресс">
    <input type="hidden" id="trans_progress_on" value="Про:">
    <input type="hidden" id="trans_progress_action_1" value="Д1">
    <input type="hidden" id="trans_progress_action_2" value="Д2">
    <input type="hidden" id="trans_progress_action_3" value="Д3">
    <input type="hidden" id="trans_progress_action_4" value="Д4">
    <input type="hidden" id="trans_progress_speed_1" value="С1">
    <input type="hidden" id="trans_progress_speed_2" value="С2">
    <input type="hidden" id="trans_countdown_1" value="1">
    <input type="hidden" id="trans_countdown_2" value="2">
    <input type="hidden" id="trans_countdown_3" value="3">
    <input type="hidden" id="trans_false_answer" value="Ничего страшного! В другой раз получиться!">
    <script>
        $(document).ready(function () {
                GLOBAL_STATE.voice = true;

                $.ajax({
                    type: 'get',
                    url: $("#module_names").val(),
                    traditional: true,
                    success: function (data) {
                        switch ($("#modal_global_settings").find("input[name='modules']").val()) {
                            case "simple":
                            $(".modules_display").html(data.simple);
                            break;
                            case "brother":
                            $(".modules_display").html(data.brother);
                            break;
                            case "brother,simple":
                            $(".modules_display").html(data.brother);
                            break;
                            case "friend":
                            $(".modules_display").html(data.friend);
                            break;
                            case "friend,brother":
                            $(".modules_display").html(data.friend_brother);
                            break;
                            case "combo":
                            $(".modules_display").html(data.combo);
                            break;
                            case "random":
                            $(".modules_display").html(data.random);
                            break;
                        }

                        $$options = "";
                        switch (data.name_methodic) {
                            case "iama":
                            $$options = '<option value="0">Выберите</option>\
                            <option value="simple_mirror">1 - Зеркальные числа (Прямой счет)</option>\
                            <option value="brother_mirror">1.1 - Зеркальные числа (Младшие товарищи)</option>\
                            <option value="simple_brother">2 - Младшие товарищи, а на старшем разряде - прямой счет</option>\
                            <option value="friend_less_100">3 - Старшие товарищи - оставаться внутри 100 (без переходов)</option>\
                            <option value="combo_less_100">4 - Микс формулы - оставаться внутри 100 (без переходов)</option>\
                            <option value="train_mode_50">5 - Тренировка переходов через 50</option>\
                            <option value="train_mode_100">6 - Тренировка переходов через 100</option>\
                            <option value="train_sign">7 - Тренировка отрицательных чисел</option>\
                            <option value="random">8 - Все темы</option>';

                            break;
                            case "abakus":
                            $$options = '<option value="0">Выберите</option>\
                            <option value="simple_mirror">1 - Зеркальные числа (Прямой счет)</option>\
                            <option value="brother_mirror">1.1 - Зеркальные числа (Младшие товарищи)</option>\
                            <option value="simple_brother">2 - Младшие товарищи, а на старшем разряде - Прямой счет</option>\
                            <option value="friend_less_100">3 - Старшие товарищи - оставаться внутри 100 (без переходов)</option>\
                            <option value="combo_less_100">4 - Комьинированный счет - оставаться внутри 100 (без переходов)</option>\
                            <option value="train_mode_50">5 - Тренировка переходов через 50</option>\
                            <option value="train_mode_100">6 - Тренировка переходов через 100</option>\
                            <option value="train_sign">7 - Тренировка отрицательных чисел</option>\
                            <option value="random">8 - Все темы</option>';


                            break;
                            case "amakids":
                            $$options = '<option value="0">Выберите</option>\
                            <option value="simple_mirror">1 - Зеркальные числа (Просто)</option>\
                            <option value="brother_mirror">1.1 - Зеркальные числа (Братья)</option>\
                            <option value="simple_brother">2 - Братья, а на старшем разряде - просто</option>\
                            <option value="friend_less_100">3 - Друзья - оставаться внутри 100 (без переходов)</option>\
                            <option value="combo_less_100">4 - Друзья и братья - оставаться внутри 100 (без переходов)</option>\
                            <option value="train_mode_50">5 - Тренировка переходов через 50</option>\
                            <option value="train_mode_100">6 - Тренировка переходов через 100</option>\
                            <option value="train_sign">7 - Тренировка отрицательных чисел</option>\
                            <option value="random">8 - Все темы</option>';


                            break;
                            case "default":
                            $$options = '<option value="0">Выберите</option>\
                            <option value="simple_mirror">1 - Зеркальные числа (Прямой счет)</option>\
                            <option value="brother_mirror">1.1 - Зеркальные числа (Формулы 5-ки)</option>\
                            <option value="simple_brother">2 - Формулы 5-ки, а на старшем разряде - Прямой счет</option>\
                            <option value="friend_less_100">3 - Формулы 10-ки - оставаться внутри 100 (без переходов)</option>\
                            <option value="combo_less_100">4 - Микс формулы (5-ки и 10-ки) - оставаться внутри 100 (без переходов)</option>\
                            <option value="train_mode_50">5 - Тренировка переходов через 50</option>\
                            <option value="train_mode_100">6 - Тренировка переходов через 100</option>\
                            <option value="train_sign">7 - Тренировка отрицательных чисел</option>\
                            <option value="random">8 - Все темы</option>';


                            break;
                        }

                        $("#topic").html($$options);

                        $(".module_simple_title").html(data.simple);
                        $(".module_brother_title").html(data.brother);
                        $(".module_friend_title").html(data.friend);
                        $(".module_friend_brother_title").html(data.friend_brother);
                        $(".module_combo_title").html(data.combo);
                        $(".module_random_title").html(data.random);
                        $("#name_methodic").val(data.name_methodic);
                        $("#voice_methodic").val(data.voice_methodic);


                        $("#trans_simple").val(data.simple);
                        $("#trans_brother").val(data.brother);
                        $("#trans_friend").val(data.friend);
                        $("#trans_friend_brother").val(data.friend);
                        $("#trans_combo").val(data.combo);
                        $("#trans_random").val(data.random);

                        $("#trans_simple_short").val(data.simple);
                        $("#trans_brother_short").val(data.brother);
                        $("#trans_friend_brother_short").val(data.friend);
                        $("#trans_friend_short").val(data.friend);
                        $("#trans_combo_short").val(data.combo);
                        $("#trans_random_short").val(data.random);
                    }

                })


})
</script>
    <div class="modal" id="modal_browser_alert2">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">ВНИМАНИЕ!!!!</h4>
                </div>
                <div class="modal-body">
                    <h4>Уважаемый пользователь! </h4>
                    <h5> Для корректной работы портала необходимо установить и работать на одном из следующих браузеров: </h5>
                    <br><br>
                    <p>
                        <a class="btn btn-lg btn-success" href="https://browser.yandex.ru/"><i class="fa fa-yahoo" aria-hidden="true"></i> Yandex Browser</a>
                        <a class="btn btn-lg btn-primary  pull-right" href="https://www.google.ru/chrome/browser/desktop/index.html"><i class="fa fa-google" aria-hidden="true"></i> Google Chrome</a>
                    </p>
                    <p>
                        <a class="btn btn-lg btn-primary" href="http://www.opera.com/ru"><i class="fa fa-opera" aria-hidden="true"></i> Opera Browser</a>
                        <a class="btn btn-lg btn-primary pull-right" href="https://www.mozilla.org/ru/firefox/"><i class="fa fa-firefox" aria-hidden="true"></i> Mozilla Browser</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        function getInternetExplorerVersion() {
        var rv = -1;
        if (navigator.appName == 'Microsoft Internet Explorer') {
            var ua = navigator.userAgent;
            var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null)
                rv = parseFloat(RegExp.$1);
        }
        else if (navigator.appName == 'Netscape') {
            var ua = navigator.userAgent;
            var re = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null)
                rv = parseFloat(RegExp.$1);
        }
        return rv;
    }
    $(document).ready(function () {

        if (getInternetExplorerVersion() !== -1) {
            window.location = '/browser_error/'
        }
    })
</script>
    <div id="main_screen" class="container-fluid card border-warning" style="background-position: center center; background-repeat: no-repeat; background-size: cover;" data-type="class">
        <div class="row">
            <div class="screen container-fluid card text-center padding-left-right-0 padding-top-bottom-0 4bg_1  " id="1" style="border: 1px dotted grey; background-color:inherit"> <input type="hidden" class="block_type" value="main_block">
               <!--  <form class="padding-left-right-0" style="margin:0;">
                    <div class="bg_color bg_color_1" style="height:100vh; width:100%; position:absolute; "></div> <input type="hidden" class="active_block" value="choice_block">
                    <div class="btn-group block_header">
                        <div class="btn-group change_value" data-value-type="actions_nmb"> <button tabindex="-1" type="button" class="decrease btn-nrm btn btn-lg btn-info">-</button> <button tabindex="-1" type="button" class="btn-nrm btn btn-lg btn-info padding-left-right-0" style="width: 40px"> <span class="actions_nmb_display">5</span> д</button> <button tabindex="-1" type="button" class="increase btn-nrm btn btn-lg btn-info">+</button> </div> <a tabindex="-1" class="btn btn-nrm btn-lg btn-warning player_name_title"><span class="player_name_points6"> <input tabindex="-1" class="player_name text-center" style="max-width: 70px; border: none; background: inherit;" value="Игрок0"> (<span class="player_points">0</span>)</span></a>
                        <div class="btn-group change_value" data-value-type="interval"> <button tabindex="-1" type="button" class="decrease btn-nrm btn btn-lg btn-danger">-</button> <button tabindex="-1" type="button" class="btn-nrm btn btn-lg btn-danger padding-left-right-0" style="width: 40px"><span class="interval_display">1</span> с</button> <button tabindex="-1" type="button" class="increase btn-nrm btn btn-lg btn-danger">+</button> </div>
                    </div>
                    <div class="card-body padding-top-bottom-1vh row justify-content-center align-items-center" style="height: 80vh; padding:0; ">
                        <div class="row justify-content-center col-12">
                            <div data-block_type="main_block" class="block col row align-items-center justify-content-center col-12">
                                <div class="col left_hero left_hero_3" style=" height: 80vh; "></div>
                                <div class="col btn-group-vertical btn_group_main"> 
                                    <a href="#" class="btn_start btn btn-lg btn-nrm btn-success margin-bottom-5">
                                        <img src="img/btn--arrow.png" alt=""> Старт
                                    </a> 
                                    <a href="#" class="btn_continue hidden btn btn-lg btn-nrm btn-success margin-bottom-5">
                                        <img src="img/btn--arrow.png" alt=""> Продолжить
                                    </a> 
                                    <a href="#" class="btn_next hidden btn btn-lg btn-nrm btn-success margin-bottom-5">
                                        <i class="fa fa-forward"> </i> Следующий
                                    </a> 
                                    <a href="#" class="btn_stop hidden btn btn-lg btn-nrm btn-danger margin-bottom-5">
                                        <i class="fa fa-stop"> </i> Стоп
                                    </a> 
                                    <a href="#" class="btn_restart hidden btn btn-lg btn-nrm btn-secondary margin-bottom-5">
                                        <i class="fa fa-refresh"> </i> Заново
                                    </a> 
                                    <a href="#" class="btn_show_example show_block hidden btn btn-lg btn-nrm btn-purple margin-bottom-5" data-block_type="problem_show_block">
                                        <i class="fa fa-eye"> </i> Задание
                                    </a> 
                                    <a href="#" class="btn_show_settings show_block btn btn-lg btn-nrm btn-warning" data-block_type="settings_block">
                                        <i class="fa fa-wrench"> </i> Настроить
                                    </a> 
                                </div>
                                <div class="col right_hero right_hero_4" style=" height: 80vh;"></div>
                            </div> <input data-block_type="countdown_block" type="text" class="block col hidden text-center " readonly="" style="background-color: inherit; border: none; width:100%; height: 80vh; font-size: 16vw" value="">
                            <div data-block_type="problem_block" class="block col hidden row align-items-center justify-content-center"> <input class="text-center col-12 w-100 fonted" type="text" readonly="" tabindex="-1" value="" style="color: black; background-color: inherit; border: none; width:100%; height: 73vh ; font-size: 70vh;">
                                <div class="row justify-content-center"> <button tabindex="-1" type="button" class="btn_pause show_block btn btn-lg btn-nrm btn-success " data-block_type="main_block"><i class="fa fa-pause"></i> Пауза</button> </div>
                            </div>
                            <div data-block_type="answer_input_block" class="block col hidden row align-items-center justify-content-center">
                                <div class="d-none d-lg-block col left_hero_1" style="height: 80vh;"></div>
                                <div class="col row justify-content-center align-items-center">
                                    <p class="col-sm-10 d-none d-md-block">Твой ответ</p>
                                    <div class="progress timer_block " style="width: 80%; height: 2vh; padding: 0; border: none; margin-bottom: 2px">
                                        <div class="timer_bar progress-bar progress-bar-striped bg-danger progress-bar-animated color-black" style="width: 100%; "> <span style="position: absolute; left: 30%; font-weight: 100;"></span> </div>
                                    </div> <input type="text" class="form-control text-center border-info col-sm-10 answer_input" style=" height: 20vh ; font-size: 8vw">
                                    <div class="keyboard row justify-content-center">
                                        <div class="col-sm-12">
                                            <div class="col-sm-12 btn-keyboard-group-lg"> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="1">1</button> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="2">2</button> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="3">3</button> </div>
                                            <div class="col-sm-12 btn-keyboard-group-lg"> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="4">4</button> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="5">5</button> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="6">6</button> </div>
                                            <div class="col-sm-12 btn-keyboard-group-lg"> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="7">7</button> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="8">8</button> <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="9">9</button> </div>
                                            <div class="col-sm-12 btn-keyboard-group-lg"> <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="clear"><i class="fa fa-times"></i></button> <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="0">0</button> <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="backspace"> <i class="fa fa-long-arrow-left"></i> </button> </div>
                                            <div class="col-sm-12 btn-keyboard-group-lg"> <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="minus"><i class="fa fa-minus"></i></button> <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value=".">.</button> <button tabindex="-1" type="button" class="btn btn-lg btn-success btn-keyboard btn_start"><i class="fa fa-play"></i> </button> </div>
                                        </div>
                                        <div class="row col-sm-12 justify-content-center"> <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"><i class="fa fa-bars"></i> Меню</button> <button tabindex="-1" type="button" class="btn  btn-nrm btn-lg btn-info btn_check_answer"><i class="fa fa-question"></i> Отправить</button> </div>
                                    </div>
                                </div>
                            </div>
                            <div data-block_type="answer_comment_block" class="block col hidden row align-items-center justify-content-center ">
                                <div class="row col-12 align-items-center justify-content-center" style="width:90%;  height: 73vh; font-size:4vw"> <span class="col-12 answer_check_text  text-center"> </span>
                                    <div class="col-12  true_answer_image true_answer_image_1" style=" width: 100%; height: 50vh;"></div>
                                    <div class="col-12 hidden false_answer_image false_answer_image_1 " style=" width: 100%; height: 50vh;"></div> <span class="answer_comment_text text-center col-12"> </span>
                                </div>
                                <div class="row"> <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"><i class="fa fa-bars"></i> Меню</button> <button tabindex="-1" type="button" class="btn_show_example show_block btn btn-lg btn-nrm btn-purple" data-block_type="problem_show_block"><i class="fa fa-eye"></i> Задание</button> <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_show_result hidden"><i class="fa fa-thumbs-up"></i> Результат</button> <button tabindex="-1" type="button" class="btn btn-lg d-none btn-warning text-dark btn-nrm btn-success hidden btn_reexample"><i class="fa fa-refresh"></i></button> <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_next"><i class="fa fa-forward"></i> Следующий</button> </div>
                            </div>
                            <div data-block_type="problem_show_block" class="block col hidden row align-items-center justify-content-center"> <textarea type="text" class="form-control text-center border-info problem_show" readonly="" style="resize: none; width:100%; height: 73vh; font-size: 7vw"></textarea>
                                <div class="row justify-content-center"> <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"><i class="fa fa-bars"></i> Меню</button> <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_show_result hidden"><i class="fa fa-thumbs-up"></i> Результат</button> <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_next"><i class="fa fa-forward"></i> Следующий</button> </div>
                            </div>
                            <div data-block_type="settings_block" class="block col row justify-content-center hidden col">
                                <div class="left_hero col left_hero_3" style=" height: 80vh; "></div>
                                <div class="row col justify-content-center align-self-center padding-left-right-0">
                                    <div class="col padding-left-right-0">
                                        <div class="row justify-content-center">
                                            <blockquote class="card-blockquote col-12 align-self-center" style="margin-bottom:3px">
                                                <div class="btn-group" role="group"> <button type="button" class="btn-nrm btn btn-lg btn-purple show_block" data-block_type="main_block"><i class="fa fa-bars"></i></button>
                                                    <div class="btn-group" role="group"> <button type="button" class="btn btn-nrm btn-info dropdown-toggle modules_display" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width:190px">Прямой счет</button>
                                                        <div class="dropdown-menu"> <input type="hidden" name="modules" value="simple"> <a class="dropdown-item modules module_simple_title bg-info" href="#" data-value="simple">Прямой счет</a> <a class="dropdown-item modules module_brother_title" href="#" data-value="brother" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Формулы 5-ки" data-content="+1 = +5 - 4       -1 = -5 + 4  <br> +2 = +5 - 3       -2 = -5 + 3<br> +3 = +5 - 2       -3 = -5 + 2 <br> +4 = +5 - 1       -4 = -5 + 1">Младшие товарищи</a> <a class="dropdown-item modules module_friend_title" href="#" data-value="friend,brother" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Формулы 10-ки" data-content="+1 = +10 - 9       -1 = -10 + 9  <br>  +2 = +10 - 8       -2 = -10 + 8 <br> +3 = +10 - 7       -3 = -10 + 7 <br> +4 = +10 - 6       -4 = -10 + 6<br> +5 = +10 - 5       -5 = -10 + 5<br> +6 = +10 - 4       -6 = -10 + 4<br> +7 = +10 - 3       -7 = -10 + 3<br> +8 = +10 - 2       -8 = -10 + 2<br> +9 = +10 - 1       -9 = -10 + 1">Старшие товарищи</a> <a class="dropdown-item modules module_combo_title" href="#" data-value="combo" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Формулы комбинированного счета 10-ки и 5-ки" data-content=" <p> +6 = +11 - 5       -6 = -11 + 5  <br> +6 = +10 - 5 + 1     -6 = -10 + 5 - 1</p> <p> +7 = +12 - 5       -7 = -12 + 5<br> +7 = +10 - 5 + 2      -7 = -10 + 5 - 2</p> <p> +8 = +13 - 5       -8 = -13 + 5 <br> +8 = +10 - 5 + 3     -8 = -10 + 5 -3 </p> <p> +9 = +14 - 5       -9 = -14 + 5 <br> +9 = +10 - 5 + 4     -9 = -10 + 5 - 4">Микс формулы</a> <a class="dropdown-item modules module_random_title" href="#" data-value="random" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" data-content="Генерируются случайные числа. <br>  В настройках ниже можно включить генерацию и отрицательных чисел: Кнопка ЗНАК">Все формулы</a> </div> <a href="#" class="btn_start btn btn-lg btn-nrm btn-success"><i class="fa fa-play"> </i></a>
                                                    </div>
                                                </div>
                                            </blockquote>
                                            <div class="btn-group btn-group-lg btn-group-juestified col-12 row align-items-center justify-content-center" data-toggle="buttons" style="margin-bottom:3px"> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="1" type="checkbox" checked=""> 1 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="2" type="checkbox" checked=""> 2 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="3" type="checkbox" checked=""> 3 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="4" type="checkbox" checked=""> 4 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="5" type="checkbox" checked=""> 5 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="6" type="checkbox" checked=""> 6 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="7" type="checkbox" checked=""> 7 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="8" type="checkbox" checked=""> 8 </label> <label class="btn btn-nrm btn-outline-info checked_digits active"><input name="checked_digits" value="9" type="checkbox" checked=""> 9 </label> <label class="btn btn-nrm btn-lg btn-outline-info active check_all"><input type="hidden" value="1"> <i class="fa fa-check"></i></label> </div>
                                            <div class="col-10 padding-left-right-0">
                                                <div class="btn-group btn-group-juestified btn-group-lg ">
                                                    <div class="btn-group" role="group"> <button type="button" class="btn btn-nrm btn-success dropdown-toggle operation_display" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Слож-е/Выч-е</button> <input type="hidden" name="operation" value="plus_minus">
                                                        <div class="dropdown-menu"> <a class="dropdown-item operation" data-value="plus" href="#">Сложение</a> <a class="dropdown-item operation" data-value="minus" href="#">Вычитание</a> <a class="dropdown-item operation bg-success" data-value="plus_minus" href="#">Сложение/Вычитание</a> </div>
                                                    </div>
                                                    <div class="btn-group" role="group"> <button type="button" class="decimal_display btn btn-nrm btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Дробь</button> <input type="hidden" name="decimal" value="off">
                                                        <div class="dropdown-menu dropdown-menu-right"> <a class="dropdown-item decimal text-danger bg-success" data-value="off" href="#">Выключить</a> <a class="dropdown-item decimal" data-value="1_digit" href="#">1 знак после запятой</a> <a class="dropdown-item decimal" data-value="2_digit" href="#">2 знака после запятой</a> </div>
                                                    </div>
                                                    <div class="btn-group " role="group"> <button type="button" class="btn btn-nrm btn-success sign_display btn_dropdown_sign disabled dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Знак</button> <input type="hidden" name="sign" value="off">
                                                        <div class="dropdown-menu dropdown-menu-right"> <a class="dropdown-item sign text-danger bg-success" data-value="off" href="#">Исключить отрицательные числа</a> <a class="dropdown-item sign" data-value="on" href="#">Включить отрицательные числа</a> <a class="dropdown-item sign" data-value="training" href="#">Тренировка отрицательных чисел</a> </div>
                                                    </div> <input type="hidden" name="is_alternation" value="off"> <button type="button" class="btn btn-nrm btn-success is_alternation" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Режим чередования" data-content="При генерации примеров чередоваться слагаемые с количеством цифр меньше на 1 (например 34 + 3 + 98 + 2)">1/2 </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="btn-group2">
                                            <div class="btn-group inc-dec-control"> <label class="btn btn-nrm btn-success change_value_to_default" data-value_type="digits_nmb" data-value="1">Цифр: </label> <label class="btn btn-nrm btn-success input_decrease"> - </label> <label class="btn btn-nrm btn-success p-0"> <input type="number" name="digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="1" min="1" max="12" step="1" data-decimal="0"> </label> <label class="btn btn-nrm btn-success input_increase"> + </label> </div>
                                            <div class="btn-group inc-dec-control"> <label class="btn btn-nrm btn-success pr-0  change_value_to_default" data-value_type="progress_digits_nmb" data-value="0">Прогресс: </label> <label class="btn btn-nrm btn-success input_decrease"> - </label> <label class="btn btn-nrm btn-success p-0"> <input type="number" name="progress_digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="0" min="0" max="5" step="1" data-decimal="0"> </label> <label class="btn btn-nrm btn-success input_increase"> + </label> </div>
                                        </div>
                                        <div class="btn-group2">
                                            <div class="btn-group inc-dec-control"> <label class="btn btn-nrm btn-info change_value_to_default" data-value_type="actions_nmb" data-value="5">Действий: </label> <label class="btn btn-nrm btn-info input_decrease"> - </label> <label class="btn btn-nrm btn-info p-0"> <input type="number" name="actions_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="5" min="1" max="300" step="1" data-decimal="0"> </label> <label class="btn btn-info btn-nrm input_increase"> + </label> </div>
                                            <div class="btn-group inc-dec-control"> <label class="btn btn-nrm btn-info pr-0  change_value_to_default" data-value_type="progress_actions_nmb" data-value="0">Прогресс: </label> <label class="btn btn-nrm btn-info input_decrease"> - </label> <label class="btn btn-nrm btn-info p-0"> <input type="number" name="progress_actions_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="0" min="0" max="5" step="1" data-decimal="0"> </label> <label class="btn btn-nrm btn-info input_increase"> + </label> </div>
                                        </div>
                                        <div class="btn-group2">
                                            <div class="btn-group inc-dec-control"> <label class="btn btn-nrm btn-danger change_value_to_default" data-value_type="interval" data-value="1">Интервал: </label> <label class="btn btn-nrm btn-danger input_decrease"> - </label> <label class="btn btn-nrm btn-danger p-0"> <input type="number" name="interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="1" min="0.1" max="10" step="0.1" data-decimal="1"> </label> <label class="btn btn-danger btn-nrm input_increase"> + </label> </div>
                                            <div class="btn-group inc-dec-control"> <label class="btn btn-nrm btn-danger pr-0 change_value_to_default" data-value_type="progress_interval" data-value="0">Про: </label> <label class="btn btn-nrm btn-danger input_decrease"> - </label> <label class="btn btn-nrm btn-danger p-0"> <input type="number" name="progress_interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="0" min="0" max="5" step="1" data-decimal="0"> </label> <label class="btn btn-nrm  btn-danger input_increase"> + </label> </div>
                                        </div>
                                        <div class="btn-group  ">
                                            <div class="btn-group dropup" role="group"> <button type="button" class="btn btn-nrm btn-outline-warning dropdown-toggle btn_dropdown_50 mode_50_display disabled active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">✓ 50+</button> <input type="hidden" name="mode_50" value="on">
                                                <div class="dropdown-menu"> <a class="dropdown-item mode_50 text-danger" data-value="off" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Режим выключенного перехода через 50" data-content="При генерации примеров будут ИСКЛЮЧЕНЫ переходы через 50 (типа 49+4)">Выключить 50+</a> <a class="dropdown-item mode_50 bg-warning" data-value="on" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим включенного перехода через 50" data-content="При генерации примеров БУДУТ примеры на переходы через 50 (типа 49+4)">Включить 50+</a> <a class="dropdown-item mode_50" href="#" data-value="training" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим тренировки перехода через 50" data-content="Генерация примеров на переходы через 50 (типа 49+4)">Тренировка 50+</a> </div>
                                            </div>
                                            <div class="btn-group dropup" role="group"> <button type="button" class="btn btn-nrm btn-outline-warning dropdown-toggle btn_dropdown_100 mode_100_display disabled active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">✓ 100+</button> <input type="hidden" name="mode_100" value="on">
                                                <div class="dropdown-menu dropdown-menu-right"> <a class="dropdown-item mode_100 text-danger" data-value="off" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Режим выключенного перехода через 100" data-content="При генерации примеров будут ИСКЛЮЧЕНЫ переходы через 100 (типа 99+4)">Выключить 100+</a> <a class="dropdown-item mode_100 bg-warning" data-value="on" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим включенного перехода через 100" data-content="При генерации примеров БУДУТ переходы через 100 (типа 99+4)">Включить 100+</a> <a class="dropdown-item mode_100" href="#" data-value="training" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим тренировки перехода через 100" data-content="Генерация примеров на переходы через 100 (типа 99+4)">Тренировка 100+</a> </div>
                                            </div> <button type="button" class="btn btn-nrm btn-outline-warning all_discharge disabled active" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Формулы на все разряды" data-content="При генерации примеров формулы не распространяются на старший разряд"> <input type="hidden" name="all_discharge" value="on">Все </button> <button type="button" class="btn btn-nrm btn-outline-warning discharge_mode btn_discharge_mode_mirror" data-value="mirror" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Зеркальные числа" data-content="При включенном режиме будут генерироваться примеры с одинаковыми цифрами, типа: 444 + 333 - 222"> <input type="hidden" name="discharge_mode" value="all">Зер </button>
                                            <div class="btn-group dropup noclose" role="group"> <button type="button" class="btn btn-sm btn-warning dropdown-toggle btn_dropdown_additional" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="additional_display"> Доп </span></button>
                                                <div class="dropdown-menu min-width-5rem"> <a class="dropdown-item bg-warning discharge_mode" data-value="all" href="#" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Распространение формул" data-content="При ВКЛЮЧЕННОМ режиме ВСЕ формулы брата, друга, комбо на разряды распространяются на все разряды, <br> <br> при ВЫКЛЮЧЕННОМ режиме формулы НЕ распространяются на старший разряд">Все разряды</a> <a class="dropdown-item discharge_mode" href="#" data-value="1" data-container="body">1-й разряд</a> <a class="dropdown-item discharge_mode" href="#" data-value="2" data-container="body">2-й разряд</a> <a class="dropdown-item discharge_mode" href="#" data-value="3" data-container="body">3-й разряд</a> <a class="dropdown-item discharge_mode" href="#" data-value="4" data-container="body">4-й разряд</a> </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="right_hero col right_hero_4" style=" height: 80vh; "></div>
                            </div>
                        </div>
                    </div>
                </form> -->
            </div>
        </div>
    </div>
    <script src="static/games_static/js/howler.js"></script>
    <script>
    var GLOBAL_STATE = {
        "status": "stopped",
        "voice": true,
        "voice_comment": true,
        "show_numbers": true,
        "show_true_false": true,
        "show_example_number": false,
        "competition_mode": false,
        "modes": ["default"],
        "timer": undefined,
        "additional_timer": undefined,
        "counter": 3,
        "interval": 1,
        "all_points_100": 0,
        'double_sign_mode': false
    };


    function getInternetExplorerVersion() {
        var rv = -1;
        if (navigator.appName == 'Microsoft Internet Explorer') {
            var ua = navigator.userAgent;
            var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null)
                rv = parseFloat(RegExp.$1);
        } else if (navigator.appName == 'Netscape') {
            var ua = navigator.userAgent;
            var re = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null)
                rv = parseFloat(RegExp.$1);
        }
        return rv;
    }

    function ajax_get_parameters() {
        $.ajax({
            type: "get",
            url: $("#task_parameters_url").val(),
            success: function(data) {
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    GLOBAL_STATE[i].parameters = get_parameters_parsed(data.parameters);
                }
                set_setting_bars(GLOBAL_STATE[1], 1, true);
                $('#main_screen').removeClass('d-none');
            }
        })
    }

    $(document).ready(function() {
        if (is_task_mode()) {
            $('#main_screen').addClass('d-none');
            ajax_get_parameters()
        }

    });

    function get_parameters() {
        parameters = $("#modal_global_settings").find("form").serializeObject();
        return get_parameters_parsed(parameters)
    }

    function change_bg() {
        random_number = random_between(1, 80);
        var image_fon = "bg_" + random_number + ".jpg";
        image_url = 'static/img/backgrounds/' + image_fon;
        $('#main_screen').css('background-image', 'url(' + image_url + ')');
    }


    function playSound(sound, i, newVoice) {
        var soundHowl;
        switch (sound) {
            case 'tik-tak':
                break;
            case 'countdown':
                if (i === 0) {
                    sound_click(sound);
                } else {
                    soundHowl = new Howl({
                        src: [`static/games_audio/new/sounds/${sound}.mp3`],
                    });
                    soundHowl.play();
                }

                break;
            case 'click':
            case 'error':
            case 'success':
                soundHowl = new Howl({
                    src: [`static/games_audio/new/sounds/${sound}.mp3`],
                });
                soundHowl.play();
                break;
            case 'successMusic':
            case 'errorMusic':
            case 'presentMusic':
                break;
            default:
                filename = sound.replace("+", "plus_").replace("-", "minus_");
                number = parseInt(sound);
                absNumber = Math.abs(number);

                voiceUrl = 'static/games_audio/new/numbers/ru2/';
                if (newVoice) {

                    sound_interval = 270;

                    if (number > 0) {
                        sound_interval = 220;
                    }

                    if (absNumber >= 100 && absNumber < 1000) {

                        if (number > 0) {
                            sound_interval = 550;
                        }

                        if (absNumber % 100 === 0) {
                            soundHowl = new Howl({
                                src: [`${voiceUrl}${sound}.mp3`],
                            });
                            soundHowl.play();
                        } else {
                            if (sound.indexOf('+') !== -1) {
                                decades = absNumber % 100;
                                hundreds = absNumber - decades;
                                soundHowl = new Howl({
                                    src: [`${voiceUrl}+${hundreds}_.mp3`],
                                });
                                soundHowl.play();
                                decadesDuration = parseInt(soundHowl.duration() * 1000);
                                setTimeout(function() {
                                    soundHowl = new Howl({
                                        src: [`${voiceUrl}${decades}.mp3`],
                                    });
                                    soundHowl.play();
                                }, decadesDuration - 20)


                            } else if (sound.indexOf('-') !== -1) {

                                decades = absNumber % 100;
                                hundreds = absNumber - decades;
                                soundHowl = new Howl({
                                    src: [`${voiceUrl}-${hundreds}_.mp3`],
                                });
                                soundHowl.play();
                                decadesDuration = parseInt(soundHowl.duration() * 1000);

                                setTimeout(function() {
                                    soundHowl = new Howl({
                                        src: [`${voiceUrl}${decades}.mp3`],
                                    });
                                    soundHowl.play();
                                }, decadesDuration - 20)

                            } else {

                                decades = absNumber % 100;
                                hundreds = absNumber - decades;
                                soundHowl = new Howl({
                                    src: [`${voiceUrl}${hundreds}_.mp3`],
                                });
                                soundHowl.play();
                                decadesDuration = parseInt(soundHowl.duration() * 1000);
                                setTimeout(function() {
                                    soundHowl = new Howl({
                                        src: [`${voiceUrl}${decades}.mp3`],
                                    });
                                    soundHowl.play();
                                }, decadesDuration - 20)

                            }
                        }

                    } else {
                        if (absNumber <= 10) {
                            soundHowl = new Howl({
                                src: [`${voiceUrl}${sound}.mp3`],
                            });
                            soundHowl.play();
                        } else {
                            if (sound.indexOf('+') !== -1) {
                                soundHowl = new Howl({
                                    src: [`${voiceUrl}plus.mp3`],
                                });
                                soundHowl.play();
                                setTimeout(function() {
                                    filename = sound.replace("+", "").replace("-", "");
                                    soundHowl = new Howl({
                                        src: [`${voiceUrl}${filename}.mp3`],
                                    });
                                    soundHowl.play();
                                }, sound_interval)
                            } else if (sound.indexOf('-') !== -1) {
                                soundHowl = new Howl({
                                    src: [`${voiceUrl}minus.mp3`],
                                });
                                soundHowl.play();
                                setTimeout(function() {
                                    filename = sound.replace("+", "").replace("-", "");
                                    soundHowl = new Howl({
                                        src: [`${voiceUrl}${filename}.mp3`],
                                    });
                                    soundHowl.play();
                                }, sound_interval)
                            } else {
                                filename = sound.replace("+", "").replace("-", "");
                                soundHowl = new Howl({
                                    src: [`${voiceUrl}${filename}.mp3`],
                                });
                                soundHowl.play();
                            }
                        }
                    }
                } else {
                    soundHowl = new Howl({
                        src: [`static/games_audio/new/numbers/ru3/${filename}.mp3`],
                    });
                    soundHowl.play();
                }
                break;
        }


    }

    function soundNumber(example, numSummand) {
        const maxIntervalToVoiceNumber1 = 0.6;
        const maxIntervalToVoiceNumber2 = 1;
        const maxIntervalToVoiceNumber3 = 1.4;
        var voiceMethodic = $("#voice_methodic").val();
        summand = example[numSummand];

        var newVoice = false;
        for (var el of example) {
            if (Math.abs(el) > 100) {
                newVoice = true;
                break;
            }
        }
        var isDecimal = false;
        if (Math.round(summand) !== summand) {
            isDecimal = true;
        }


        var soundEnabled = GLOBAL_STATE.voice &&
            GLOBAL_STATE.screens_nmb === 1 &&
            !exist_in_array("disorder", GLOBAL_STATE.modes) &&
            GLOBAL_STATE[1].parameters.digits_nmb <= 3 &&
            !isDecimal;


        if ((GLOBAL_STATE[1].parameters.digits_nmb === 1 && GLOBAL_STATE[1].parameters.interval < maxIntervalToVoiceNumber1) ||
            (GLOBAL_STATE[1].parameters.digits_nmb === 2 && GLOBAL_STATE[1].parameters.interval < maxIntervalToVoiceNumber2) ||
            (GLOBAL_STATE[1].parameters.digits_nmb === 3 && GLOBAL_STATE[1].parameters.interval < maxIntervalToVoiceNumber3)
        ) {
            soundEnabled = false
        }


        if (!soundEnabled) {
            playSound('click')
        } else {
            if (voiceMethodic === 'iama') {
                if (numSummand === 0) {
                    playSound(summand.toString(), 0, newVoice)
                } else if (numSummand === 1) {
                    if (summand > 0) {
                        playSound(`+${summand}`, 0, newVoice)
                    } else {
                        playSound(`${summand}`, 0, newVoice)
                    }
                } else {
                    if (example[numSummand - 1] * summand > 0) {
                        playSound(Math.abs(summand).toString(), 0, newVoice)
                    } else {
                        if (summand > 0) {
                            playSound(`+${summand}`, 0, newVoice)
                        } else {
                            playSound(`${summand}`, 0, newVoice)
                        }
                    }
                }
            } else {
                if (summand > 0) {
                    playSound(`+${summand}`, 0, newVoice)
                } else {
                    playSound(`${summand}`, 0, newVoice)
                }
            }
        }
    }
    </script>
    <script>
    /**
     * Created by User on 07.09.2017.
     */

    $.fn.serializeObject = function() {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function to_boolean(t) {
        if (t === "true" || t === "on" || t === true || t === 1)
            return true;
        else if (t === "false" || t === false || t === 0 || t === undefined || t === null)
            return false;
        else
            return undefined
    }

    function randomInteger(n) {
        var t = Math.floor(Math.random() * (n - 0.0001));
        if (t < 0) t = 0;
        return t;
    }

    function random_between(n, m) {
        var t = n + randomInteger(m - n);
        return t;
    }

    function power10(n) {
        var d = 1;
        for (var i = 1; i <= n; i++) {
            d *= 10;
        }
        return d;
    }

    // mutliply 2 arrays

    function multiply_arrays(arr1, arr2, is_int) {
        if (is_int === undefined) is_int = false;
        var multi = [],
            obj1 = {},
            obj2 = {};

        for (var i = 0; i < arr1.length; i++)
            obj1[arr1[i]] = !0;

        for (i = 0; i < arr2.length; i++)
            obj2[arr2[i]] = !0;

        if (is_int)
            for (var el in obj1) obj2[el] && multi.push(parseInt(el));
        else
            for (var el in obj1) obj2[el] && multi.push(el);
        return multi;
    }

    function sum_of_arrays(arr1, arr2, is_int) {
        if (is_int === undefined) is_int = false;
        var sum = [],
            obj1 = {},
            obj2 = {};

        for (var i = 0; i < arr1.length; i++)
            obj1[arr1[i]] = !0;

        for (i = 0; i < arr2.length; i++)
            obj2[arr2[i]] = !0;

        for (var el in obj1)
            obj2[el] = !0;

        if (is_int)
            for (el in obj2)
                sum.push(parseInt(el))
        else
            for (el in obj2)
                sum.push(el)

        return sum;
    }


    // included element a in array arr
    function include_el_to_array(a, arr) {
        if (arr.indexOf(a) === -1)
            arr.push(a);
        return arr
    }

    function get_array_with_el_included(a, arr) {
        var new_arr = arr.slice();
        if (new_arr.indexOf(a) === -1)
            new_arr.push(a);
        return new_arr
    }

    // exists element in array arr
    function exist_in_array(a, arr) {
        var index = arr.indexOf(a);
        return (index !== -1)
    }

    // exclude element a from array arr
    function exclude_el_from_array(a, arr) {
        var index = arr.indexOf(a);
        if (index !== -1)
            arr.splice(index, 1);
        return arr;
    }

    // get new array with excluded element
    function get_array_with_el_excluded(a, arr) {
        var new_arr = arr.slice();
        var index = new_arr.indexOf(a);
        if (index !== -1)
            new_arr.splice(index, 1);
        return new_arr;
    }

    function toggle_el_to_array(a, arr) {
        var index = arr.indexOf(a);
        if (index !== -1)
            arr.splice(index, 1);
        else
            arr.push(a);
        return arr;
    }

    function get_array_with_el_toggled(a, arr) {
        var new_arr = arr.slice();
        var index = new_arr.indexOf(a);
        if (index !== -1)
            new_arr.splice(index, 1);
        else
            new_arr.push(a);
        return new_arr;
    }

    // included element a in array arr if element not exists else exclude element a from array arr

    function get_array_of_digits_from_str(str, splitter) {
        if (typeof str === "string") {
            var str_array = str.split(splitter);
            if (str_array.length === 0 || str_array[0] === "")
                return [];
            var digits_array = [];
            for (var i in str_array) {
                digits_array.push(parseInt(str_array[i]))
            }
            return digits_array;
        } else if (typeof str === "object") {
            array = [];
            for (e in str) {
                array.push(parseInt(str[e]))
            }
            return array
        } else {
            return str
        }
    }


    //rounds till 1 digit after dot: 1.3333 => 1.3
    function get_number_float_rounded(n) {
        n = parseFloat(n);
        number = Math.round(n * 10) / 10;
        if (number % 10 === 0) number = parseInt(number);
        return Math.round(n * 10) / 10;
    }

    function get_number_float_rounded2(n) {
        n = parseFloat(n);
        number = Math.round(n * 100) / 100;
        if (number % 100 === 0) number = parseInt(number);
        return Math.round(n * 100) / 100;
    }

    function get_number_float_rounded_for_sound(n) {
        n = parseFloat(n);
        number = Math.round(n * 10) / 10;
        return number.toFixed(1);
    }

    function get_number_float_rounded_for_sound2(n) {
        n = parseFloat(n);
        number = Math.round(n * 100) / 100;
        return number.toFixed(2);
    }

    //gets reversed digits array from number 1234 => [4,3,2,1]
    function get_digits_array_from_nmb(number, digits_nmb) {
        var str_number = number.toString();
        if (digits_nmb === undefined)
            digits_nmb = 0;
        if (digits_nmb > 0) {
            if (str_number.length < digits_nmb) {
                for (var i = 1; i <= digits_nmb - str_number.length; i++)
                    str_number = "0" + str_number;
            }
        }
        return get_array_of_digits_from_str(str_number.split("").reverse().join(","), ",");
    }

    function getRefundMode(refund_mode) {
        console.log('refund_mode 1  ', refund_mode)
        if (refund_mode !== undefined) {
            if (typeof refund_mode === 'string') {
                refund_mode = refund_mode.replace(/'/g, '');
                refund_mode = refund_mode.replace(/\s/g, '');
                refund_mode = refund_mode.replace(/"/g, '');
                refund_mode = refund_mode.replace('[', '');
                refund_mode = refund_mode.replace(']', '');

                console.log('refund_mode 2 ', refund_mode)
                const arr = refund_mode.split(',');

                console.log('arr 2 ', arr)

                const refundModeArray = [];
                for (var el of arr) {
                    refundModeArray.push(el)
                }
                return refundModeArray
            } else {
                return refund_mode.slice()
            }
        } else {
            return ['off']
        }

    }

    function get_parameters_parsed(parameters) {


        if (parameters.accept_just_true_answers === undefined) {
            parameters.accept_just_true_answers = 'off'
        }

        if (parameters.show_results === undefined) {
            parameters.show_results = 'on'
        }

        if (parameters.voice_results === undefined) {
            parameters.voice_results = 'on'
        }

        if (parameters.voice_numbers === undefined) {
            parameters.voice_numbers = 'on'
        }

        if (parameters.show_numbers === undefined) {
            parameters.show_numbers = 'on'
        }

        if (parameters.save_progress === undefined) {
            parameters.save_progress = 'off'
        }


        if (parameters.timer !== undefined) {
            parameters.timer = get_number_float_rounded(parameters.timer);
        }

        if (parameters.timer_select !== undefined) {
            if (parameters.timer_select !== "task_timer" && parameters.timer_select !== "action_timer") {
                parameters.timer_select = "off";
            }
        }
        if (parameters.timer_select === undefined) {
            parameters.timer_select = "off"
        }


        if (parameters.decimal_1) {
            parameters.decimal_1 = parseInt(parameters.decimal_1);
        } else {
            parameters.decimal_1 = 0
        }

        if (parameters.modulo === undefined) {
            parameters.modulo = 'off'
        }
        if (parameters.base === undefined) {
            parameters.base = '100'
        }

        parameters.refund_mode = getRefundMode(parameters.refund_mode)

        // if (parameters.refund_mode === undefined) {
        //   parameters.refund_mode = ['off']
        //} else if (typeof parameters.refund_mode === 'string') {
        //     parameters.refund_mode = [parameters.refund_mode]
        // }
        if (parameters.base_direction === undefined) {
            parameters.base_direction = 'less'
        }

        if (parameters.multiply_mode === undefined) {
            parameters.multiply_mode = 'ordinary_mode'
        }

        if (parameters.rounding) {
            parameters.rounding = parseInt(parameters.rounding);
        } else {
            parameters.rounding = 2
        }

        if (parameters.decimal_2) {
            parameters.decimal_2 = parseInt(parameters.decimal_2);
        } else {
            parameters.decimal_2 = 0
        }


        if (parameters.impulses_nmb)
            parameters.impulses_nmb = parseInt(parameters.impulses_nmb);


        if (parameters.columns_nmb)
            parameters.columns_nmb = parseInt(parameters.columns_nmb);

        if (parameters.tables_nmb)
            parameters.tables_nmb = parseInt(parameters.tables_nmb);

        if (parameters.interval)
            parameters.interval = get_number_float_rounded(parameters.interval);

        if (parameters.checked_digits) {
            if (typeof parameters.checked_digits === "string") {
                parameters.checked_digits = parameters.checked_digits.replace('[', '');
                parameters.checked_digits = parameters.checked_digits.replace(']', '');
            }
            parameters.checked_digits = get_array_of_digits_from_str(parameters.checked_digits, ",")
        } else
            parameters.checked_digits = [];

        if (parameters.checked_digits_1) {
            if (typeof parameters.checked_digits_1 === "string") {
                parameters.checked_digits_1 = parameters.checked_digits_1.replace('[', '');
                parameters.checked_digits_1 = parameters.checked_digits_1.replace(']', '');
            }

            parameters.checked_digits_1 = get_array_of_digits_from_str(parameters.checked_digits_1, ",");
        } else
            parameters.checked_digits_1 = [];

        if (parameters.checked_digits_11) {
            if (typeof parameters.checked_digits_11 === "string") {
                parameters.checked_digits_11 = parameters.checked_digits_11.replace('[', '');
                parameters.checked_digits_11 = parameters.checked_digits_11.replace(']', '');
            }

            parameters.checked_digits_11 = get_array_of_digits_from_str(parameters.checked_digits_11, ",");
        } else
            parameters.checked_digits_11 = parameters.checked_digits_1;


        if (parameters.checked_digits_2) {
            if (typeof parameters.checked_digits_2 === "string") {
                parameters.checked_digits_2 = parameters.checked_digits_2.replace('[', '');
                parameters.checked_digits_2 = parameters.checked_digits_2.replace(']', '');
            }

            parameters.checked_digits_2 = get_array_of_digits_from_str(parameters.checked_digits_2, ",");
        } else
            parameters.checked_digits_2 = [];

        if (parameters.checked_digits_21) {
            if (typeof parameters.checked_digits_21 === "string") {
                parameters.checked_digits_21 = parameters.checked_digits_21.replace('[', '');
                parameters.checked_digits_21 = parameters.checked_digits_21.replace(']', '');
            }

            parameters.checked_digits_21 = get_array_of_digits_from_str(parameters.checked_digits_21, ",");
        } else
            parameters.checked_digits_21 = parameters.checked_digits_2;

        if (parameters.digits_nmb)
            parameters.digits_nmb = parseInt(parameters.digits_nmb);

        if (parameters.screens_nmb)
            parameters.screens_nmb = parseInt(parameters.screens_nmb);

        if (parameters.digits_nmb_1)
            parameters.digits_nmb_1 = parseInt(parameters.digits_nmb_1);

        if (parameters.digits_nmb_2)
            parameters.digits_nmb_2 = parseInt(parameters.digits_nmb_2);

        if (parameters.examples_nmb)
            parameters.examples_nmb = parseInt(parameters.examples_nmb);

        if (parameters.summands_nmb)
            parameters.summands_nmb = parseInt(parameters.summands_nmb);

        if (parameters.actions_nmb)
            parameters.actions_nmb = parseInt(parameters.actions_nmb);

        if (parameters.progress_actions_nmb)
            parameters.progress_actions_nmb = parseInt(parameters.progress_actions_nmb);

        if (parameters.progress_interval)
            parameters.progress_interval = parseInt(parameters.progress_interval);

        if (parameters.progress_digits_nmb)
            parameters.progress_digits_nmb = parseInt(parameters.progress_digits_nmb);

        if (parameters.progress_impulses_nmb !== undefined) {
            parameters.progress_impulses_nmb = parseInt(parameters.progress_impulses_nmb);
        }

        if (parameters.is_alternation) {
            if (parameters.is_alternation === "true") {
                parameters.is_alternation = "on"
            } else if (parameters.is_alternation === "false") {
                parameters.is_alternation = "off"
            }
        }
        if (parameters.is_brother_global) {
            if (parameters.is_brother_global === "true") {
                parameters.mode_50 = "on"
            } else if (parameters.is_brother_global === "false") {
                parameters.mode_50 = "off"
            }
        }

        if (parameters.is_friend_global) {
            if (parameters.is_friend_global === "true") {
                parameters.mode_100 = "on"
            } else if (parameters.is_friend_global === "false") {
                parameters.mode_100 = "off"
            }
        }


        if (!parameters.all_discharge) {
            parameters.all_discharge = "on"
        }


        if (parameters.is_progress && parameters.is_progress === "true") {
            parameters.progress_speed = 2;
            parameters.progress_action = 2
        }

        if (parameters.progress_speed) {
            parameters.progress_speed = parseInt(parameters.progress_speed);
        }

        if (parameters.progress_action) {
            parameters.progress_action = parseInt(parameters.progress_action);
        }

        if (!parameters.sign) {
            parameters.sign = "off"
        }

        if (!parameters.decimal) {
            parameters.decimal = "off"
        }

        return parameters;
    }


    function digit_to_input($form, digit, operation, nmb) {
        if (nmb === undefined) nmb = 0;

        switch (parseInt(nmb)) {
            case 0:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits-input").val(), ',');
                break;
            case 1:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits_1-input").val(), ',');
                break;
            case 2:
                checked_digits_array = get_array_of_digits_from_str($form.find(".checked_digits_2-input").val(), ',');
                break;
        }
        switch (operation) {
            case "toggle":
                toggle_el_to_array(digit, checked_digits_array);
                break;
            case "include":
                include_el_to_array(digit, checked_digits_array);
                break;
            case "exclude":
                exclude_el_from_array(digit, checked_digits_array);
                break;
        }
        switch (parseInt(nmb)) {
            case 0:
                $form.find(".checked_digits-input").val(checked_digits_array);
                break;
            case 1:
                $form.find(".checked_digits_1-input").val(checked_digits_array);
                break;
            case 2:
                $form.find(".checked_digits_2-input").val(checked_digits_array);
                break;
        }

    }

    function show_checked_digits($form, module) {
        $checked_digits = $form.find(".checked_digits-input");
        switch (module) {
            case "simple":
                for (var i = 1; i <= 4; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 5; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("5,6,7,8,9");
                break;
            case "brother":
                for (var i = 5; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 1; i <= 4; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("1,2,3,4");
                break;
            case "friend":
                for (var i = 1; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("1,2,3,4,5,6,7,8,9");
                break;
            case "combo":
                for (var i = 1; i <= 5; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").addClass("hidden")
                }
                for (var i = 6; i <= 9; i++) {
                    $form.find(".checked_digits:contains(" + i + ")").removeClass("hidden").addClass("active")
                }
                $checked_digits.val("6,7,8,9");
                break;
            case "random":
                $form.find(".checked_digits").addClass("hidden active");
                $form.find(".check_all_digits-input").addClass("hidden");
                $checked_digits.val("0,1,2,3,4,5,6,7,8,9");
                break;
        }
    }
    </script>
    <script>
    var module_parameters = {
        "simple": {
            "title": $("#trans_simple").val(),
            "title_short": $("#trans_simple_short").val(),
            "digits_to_show": [1, 2, 3, 4, 5, 6, 7, 8, 9],
            "elements_to_disable": ["btn_dropdown_sign", "btn_dropdown_50", "btn_dropdown_100", "all_discharge", "just_operation"],
            "elements_to_activate": ["btn_discharge_mode_mirror"]
        },
        "brother": {
            "title": $("#trans_brother").val(),
            "title_short": $("#trans_brother_short").val(),
            "digits_to_show": [1, 2, 3, 4],
            "elements_to_disable": ["btn_dropdown_sign", "btn_dropdown_50", "btn_dropdown_100", "just_operation"],
            "elements_to_activate": ["all_discharge", "btn_discharge_mode_mirror"]
        },
        "brother,simple": {
            "title": $("#trans_brother").val(),
            "title_short": $("#trans_brother_short").val(),
            "digits_to_show": [1, 2, 3, 4],
            "elements_to_disable": ["btn_dropdown_sign", "btn_dropdown_50", "btn_dropdown_100", "just_operation"],
            "elements_to_activate": ["all_discharge", "btn_discharge_mode_mirror"]
        },
        "friend": {
            "title": $("#trans_friend").val(),
            "title_short": $("#trans_friend_short").val(),
            "digits_to_show": [1, 2, 3, 4, 5, 6, 7, 8, 9],
            "elements_to_disable": ["btn_discharge_mode_mirror"],
            "elements_to_activate": ["all_discharge", "btn_dropdown_50", "btn_dropdown_100", "btn_dropdown_sign", "just_operation"]
        },
        "friend,brother": {
            "title": $("#trans_friend").val(),
            "title_short": $("#trans_friend_short").val(),
            "digits_to_show": [1, 2, 3, 4, 5, 6, 7, 8, 9],
            "elements_to_disable": ["btn_discharge_mode_mirror"],
            "elements_to_activate": ["all_discharge", "btn_dropdown_50", "btn_dropdown_100", "btn_dropdown_sign", "just_operation"]
        },
        "friend,brother_fr": {
            "title": $("#trans_friend").val(),
            "title_short": $("#trans_friend_short").val(),
            "digits_to_show": [1, 2, 3, 4, 5, 6, 7, 8, 9],
            "elements_to_disable": ["btn_discharge_mode_mirror"],
            "elements_to_activate": ["all_discharge", "btn_dropdown_50", "btn_dropdown_100", "btn_dropdown_sign", "just_operation"]
        },
        "friend,brother,simple_fr": {
            "title": $("#trans_friend").val(),
            "title_short": $("#trans_friend_short").val(),
            "digits_to_show": [1, 2, 3, 4, 5, 6, 7, 8, 9],
            "elements_to_disable": ["btn_discharge_mode_mirror"],
            "elements_to_activate": ["all_discharge", "btn_dropdown_50", "btn_dropdown_100", "btn_dropdown_sign", "just_operation"]
        },
        "combo": {
            "title": $("#trans_combo").val(),
            "title_short": $("#trans_combo_short").val(),
            "digits_to_show": [6, 7, 8, 9],
            "elements_to_disable": ["btn_discharge_mode_mirror"],
            "elements_to_activate": ["all_discharge", "btn_dropdown_50", "btn_dropdown_100", "btn_dropdown_sign", "just_operation"]
        },
        "random": {
            "title": $("#trans_random").val(),
            "title_short": $("#trans_random_short").val(),
            "digits_to_show": [1, 2, 3, 4, 5, 6, 7, 8, 9],
            "elements_to_disable": ["btn_discharge_mode_mirror"],
            "elements_to_activate": ["btn_dropdown_sign", "all_discharge", "btn_dropdown_50", "btn_dropdown_100", "just_operation"]
        }
    };

    var operation_titles = {
        "just_plus": $("#trans_just_plus").val(),
        "plus": $("#trans_plus").val(),
        "minus": $("#trans_minus").val(),
        "just_minus": $("#trans_just_minus").val(),
        "plus_minus": $("#trans_plus_minus").val()
    };

    var operation_short_titles = {
        "just_plus": $("#trans_just_plus").val(),
        "plus": $("#trans_plus").val(),
        "minus": $("#trans_minus").val(),
        "just_minus": $("#trans_just_minus").val(),
        "plus_minus": $("#trans_plus_minus_short").val()
    };

    var decimal_titles = {
        "off": $("#trans_decimal_off").val(),
        "1_digit": $("#trans_decimal_1_digit").val(),
        "2_digit": $("#trans_decimal_2_digit").val()
    };
    var sign_titles = {
        "off": $("#trans_sign_off").val(),
        "on": $("#trans_sign_on").val(),
        "training": $("#trans_sign_training").val()
    };
    var progress_titles = {
        "off": $("#trans_progress_off").val(),
        "on": $("#trans_progress_on").val()
    };
    var progress_action_titles = {
        0: "",
        1: $("#trans_progress_action_1").val(),
        2: $("#trans_progress_action_2").val(),
        3: $("#trans_progress_action_3").val()
    };
    var progress_speed_titles = {
        0: "",
        1: $("#trans_progress_speed_1").val(),
        2: $("#trans_progress_speed_2").val()
    };
    var mode_50_titles = {
        "off": "50+",
        "on": "✓ 50+",
        "training": "T 50+"
    };
    var mode_100_titles = {
        "off": "100+",
        "on": "✓ 100+",
        "training": "T 100+"
    };


    var true_answer_sounds = [];
    var true_answer_sounds_default = [];

    var false_answer_sounds = [];
    var false_answer_sounds_default = [];


    for (var i = 1; i <= 40; i++) {
        true_answer_sounds.push(i)
    }
    for (var i = 1; i <= 52; i++) {
        false_answer_sounds.push(i)
    }
    true_answer_sounds_default = true_answer_sounds.slice();
    false_answer_sounds_default = false_answer_sounds.slice();

    function get_number_float_rounded_by_decimal(n, decimal) {
        powered_number = power10(decimal);
        n = parseFloat(n);
        number = Math.round(n * powered_number) / powered_number;
        if (number % powered_number === 0) number = parseInt(number);
        return Math.round(n * powered_number) / powered_number;
    }





    function sound_answer(type, to_play) {
        if (to_play === "play") {
            switch (type) {
                case "error":
                    t = false_answer_sounds[randomInteger(false_answer_sounds.length)];
                    exclude_el_from_array(t, false_answer_sounds);
                    if (false_answer_sounds.length === 0) {
                        false_answer_sounds = false_answer_sounds_default.slice()
                    }

                    music = 'incorrect_' + t + '.mp3';
                    current_audio.src = $("#url_incorrect").val() + "/" + music;
                    break;
                case "success":
                    t = true_answer_sounds[randomInteger(true_answer_sounds.length)];
                    exclude_el_from_array(t, true_answer_sounds);
                    if (true_answer_sounds.length === 0) {
                        true_answer_sounds = true_answer_sounds_default.slice()
                    }
                    //t = random_between(1, 38);
                    music = 'correct_' + t + '.mp3';
                    current_audio.src = $("#url_correct").val() + "/" + music;
                    break;
                case "present":
                    t = random_between(1, 58);
                    music = 'present_' + t + '.mp3';
                    current_audio.src = $("#url_present").val() + "/" + music;
                    break;
            }
            current_audio.play()
        } else {
            current_audio.pause();
            // current_audio.currentTime = 0.0;
        }
    }

    function stop_sound() {
        current_audio.pause();
        current_audio2.pause()
    }

    function sound_click(sound_type) {
        if (sound_type === 'tik-tak') return;
        if (device.mobile() || device.tablet() || sound_type === 'tik-tak') {
            current_audio.src = $("#url_sounds").val() + "/" + sound_type + ".mp3";
            current_audio.play()
        } else {
            if (true_key) {
                true_key = false;
                current_audio.src = $("#url_sounds").val() + "/" + sound_type + ".mp3";
                current_audio.play()
            } else {
                true_key = true;
                current_audio2.src = $("#url_sounds").val() + "/" + sound_type + ".mp3";
                current_audio2.play()
            }
        }
    }

    function sound_number(n) {
        if (n !== parseInt(n) || GLOBAL_STATE[1].parameters.digits_nmb > 2 || device.mobile() || device.tablet()) {
            sound_click("click")
        } else {
            if (n > 0) {
                number_mp3 = "plus_" + n + ".mp3"
            } else {
                n = -n;
                number_mp3 = "minus_" + n + ".mp3"
            }
            if (device.ios()) {
                if (GLOBAL_STATE.interval >= 1.3 && GLOBAL_STATE.screens_nmb === 1 && GLOBAL_STATE.voice && !exist_in_array("disorder", GLOBAL_STATE.modes)) {
                    current_audio.src = $("#url_voice").val() + "/" + number_mp3;
                    current_audio.play();
                } else {
                    sound_click("click")
                }
            } else {
                if (GLOBAL_STATE.interval >= 0.7 && GLOBAL_STATE.screens_nmb === 1 && GLOBAL_STATE.voice && !exist_in_array("disorder", GLOBAL_STATE.modes)) {
                    if (true_key) {
                        true_key = false;
                        current_audio.src = $("#url_voice").val() + "/" + number_mp3;
                        current_audio.play();
                    } else {
                        true_key = true;
                        current_audio2.src = $("#url_voice").val() + "/" + number_mp3;
                        current_audio2.play();
                    }
                } else {
                    sound_click("click")
                }
            }
        }


    }

    function show_block(block_type, screen_pk) {
        if (screen_pk === "navbar" || screen_pk === "global") {
            $search_area = $(document)
        } else {
            $screen = $("#" + screen_pk);
            $search_area = $screen
        }
        $search_area.find("block_type").val(block_type);
        if (block_type === "answer_comment_block_true") {
            $search_area.find(".block").addClass("hidden");
            $answer_comment_block = $search_area.find(".block[data-block_type='answer_comment_block']");
            $answer_comment_block.removeClass("hidden");
            $answer_comment_block.find(".true_answer_image").removeClass("hidden");
            $answer_comment_block.find(".false_answer_image").addClass("hidden")
        } else if (block_type === "answer_comment_block_false") {
            $search_area.find(".block").addClass("hidden");
            $answer_comment_block = $search_area.find(".block[data-block_type='answer_comment_block']");
            $answer_comment_block.removeClass("hidden");
            $answer_comment_block.find(".true_answer_image").addClass("hidden");
            $answer_comment_block.find(".false_answer_image").removeClass("hidden")
        } else if (block_type === "answer_input_block") {
            if (GLOBAL_STATE.competition_mode) {
                $search_area.find(".block").addClass("hidden");
                $answer_comment_block = $search_area.find(".block[data-block_type='answer_comment_block']");
                $answer_comment_text = $search_area.find(".answer_comment_text");
                $screen_bg_color = $screen.find(".bg_color");
                $screen_bg_color.removeClass("screen-success screen-error screen-info");
                $answer_comment_block.removeClass("hidden");
                $answer_comment_block.find(".true_answer_image").addClass("hidden");
                $answer_comment_block.find(".false_answer_image").addClass("hidden");

                $screen_bg_color.addClass("screen-info");
                $answer_comment_text.html("Впишите ответ");
            } else {
                $search_area.find(".block").addClass("hidden");
                $search_area.find(".block[data-block_type='" + block_type + "']").removeClass("hidden");
                if (!device.mobile() && !device.tablet()) {
                    $search_area.find(".block[data-block_type='" + block_type + "']").find("input").focus()
                }
            }



        } else if (block_type === "settings_block") {
            if (device.mobile() || device.tablet() && GLOBAL_STATE.screens_nmb === 1) {
                $("#modal_global_settings").modal()
            } else {
                $search_area.find(".block").addClass("hidden");
                $search_area.find(".block[data-block_type='" + block_type + "']").removeClass("hidden");
            }
        } else {
            $search_area.find(".block").addClass("hidden");
            $search_area.find(".block[data-block_type='" + block_type + "']").removeClass("hidden");
        }

    }

    function create_keyboards() {
        if (GLOBAL_STATE.screens_nmb === 1 && !device.mobile()) {
            switch (GLOBAL_STATE.screens_nmb) {
                case 1:
                    btn_keyboard_group_class = "btn-keyboard-group-lg";
                    hero_class = "col";
                    answer_input_fontsize = "8vw";
                    answer_input_height = "20vh";
                    break;
                case 2:
                    btn_keyboard_group_class = "btn-keyboard-group-lg";
                    hero_class = "col-5";
                    answer_input_fontsize = "5vw";
                    answer_input_height = "18vh";
                    break;
                case 3:
                    btn_keyboard_group_class = "btn-keyboard-group-md";
                    hero_class = "col-4";
                    answer_input_fontsize = "4vw";
                    answer_input_height = "15vh";
                    break;
            }
            btn_keyboard_group_class = "btn-keyboard-group-lg";
            keyboard_block_class = "col-md-6 col-lg-4";
            if (device.mobile()) {
                btn_keyboard_group_class = "btn-keyboard-group-xs";
                answer_input_height = "10vh";
                answer_input_fontsize = "5vh"
            } else if (device.tablet()) {
                if (device.landscape()) {
                    btn_keyboard_group_class = " btn-keyboard-tablet-landscape";
                } else {
                    btn_keyboard_group_class = " btn-keyboard-tablet-portrait";
                }

                keyboard_block_class = "col-md-6 col-lg-6";
            }



            hero_class = "col";
            answer_input_fontsize = "8vw";
            answer_input_height = "20vh";
            $$answer_input_block_with_keyboard =
                '<div class="' + keyboard_block_class + '" >\
            <div class="row justify-content-center align-items-center" style="background: rgba(40, 38, 10, 0.9); border-radius: 100px; padding:15px; border: 2px solid #ffc107">\
            <div class="answer_input_block row  align-items-center justify-content-center" style="height:77vh">\
            <p class="col-sm-10 d-none d-md-block text-center" style=" color:white; font-size:30px">Твой ответ</p>\
            <input type="text" readonly class="form-control text-center border-info col-10 answer_input answer_input_keyboarded" \
            style=" height: 15vh; font-size: 12vh" >\
            <div class="keyboard row justify-content-center">\
            <div class="col-sm-12">\
            <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="1">1</button>\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="2">2</button>\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="3">3</button>\
            </div>\
            <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="4">4</button>\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="5">5</button>\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="6">6</button>\
            </div>\
            <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="7">7</button>\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="8">8</button>\
            <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="9">9</button>\
            </div>\
            <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
            <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="clear"><i class="fa fa-times"></i></button>\
            <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="0">0</button>\
            <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="backspace"> <i class="fa fa-long-arrow-left"></i> </button>\
            </div>\
            <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
            <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="minus"><i class="fa fa-minus"></i></button>\
            <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value=".">.</button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-info btn-keyboard btn_check_answer hidden"><i class="fa fa-question"></i> </button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-success btn-keyboard btn_start"><i class="fa fa-play"></i> </button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-success btn-keyboard btn_next hidden"><i class="fa fa-forward"></i> </button>\
            </div>\
            </div>\
            </div>\
            </div>\
            <div class="answer_comment_block row col-sm-12 align-items-center justify-content-center hidden" style="height:71vh"> \
            <span class=" answer_check_text text-center" style="font-size:40px"></span>\
            <div class="answer_image w-100" style="height: 50vh"></div>\
            <span class=" answer_comment_text text-center" style="font-size:30px; color:white"></span>\
            </div>\
            <div class="row col-sm-12 justify-content-center keyboard_btn_group hidden">\
            <button tabindex="-1" type="button" class="btn btn-lg btn-info btn_check_answer hidden"><i class="fa fa-question"></i> Отправить</button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-success btn_start"><i class="fa fa-play"></i> Старт</button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-success btn_next hidden"><i class="fa fa-forward"></i> Следующий</button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-warning btn_reexample d-none hidden"><i class="fa fa-refresh"></i></button>\
            </div>\
            </div>\
            </div>';
            $("#main_block").append($$answer_input_block_with_keyboard)

        }
    }

    function create_sliders() {
        if (!device.mobile() && !device.tablet()) {
            var $digits_nmb_slider = $('.digits_nmb').slider({
                min: 1,
                max: 8,
                step: 1,
                value: 1,
                id: "GC",
                tooltip: "always",
                formatter: function(value) {
                    $('.digits_nmb').closest("label").find(".tooltip-inner").css("background-color", "#28a745")
                    return 'Цифр: ' + value;
                }
            });
            var $actions_nmb_slider = $('.actions_nmb').slider({
                min: 1,
                max: 50,
                step: 1,
                value: 5,
                tooltip: "always",
                id: "BC",
                formatter: function(value) {
                    $('.actions_nmb').closest("label").find(".tooltip-inner").css("background-color", "#17a2b8");
                    return 'Действий: ' + value;
                }
            });
            var $screens_nmb_slider = $('.screens_nmb').slider({
                min: 1,
                max: 10,
                step: 1,
                value: 1,
                tooltip: "always",
                id: "GrC",
                formatter: function(value) {
                    $('.screens_nmb').closest("label").find(".tooltip-inner").css("background-color", "#555");
                    return 'Игроков: ' + value;
                }
            });
            var $interval_slider = $('.interval').slider({
                max: 10,
                min: 0.1,
                step: 0.1,
                value: 1,
                tooltip: "always",
                id: "interval_slider",
                formatter: function(value) {
                    $('.interval').closest("label").find(".tooltip-inner").css("background-color", "#dc3545");
                    return 'Интервал: ' + value;
                }
            });
        }

    }

    function set_setting_bars(screen_state, screen_pk, global) {
        console.log('set_setting_bars')

        if (global) {
            $search_area = $(document);
            screen_id = 1;
        } else {
            $screen = $("#" + screen_pk);
            $search_area = $screen;
            screen_id = parseInt(screen_pk);
        }
        parameters = screen_state.parameters;

        console.log('parameters ', parameters)
        //set player name

        $search_area.find(".player_name").val(screen_state.player_name);
        if (!is_olymp_task()) {
            $search_area.find(".player_points").html(screen_state.points);
        }

        console.log('parameters.examples_nmb ', parameters.examples_nmb)

        $(document).find(".examples_nmb").html(parameters.examples_nmb);


        // set modules
        $checked_digits = $search_area.find("input[name='checked_digits']");
        value = parameters.modules;
        if (value !== undefined) {
            $search_area.find("input[name=modules]").val(value);
            $search_area.find(".check_all").addClass("active");
            $search_area.find(".check_all").find("input").val(1);
            $search_area.find(".modules_display").html(module_parameters[value].title);
            $search_area.find(".modules").removeClass("bg-info");
            $search_area.find(".modules[data-value='" + value + "']").addClass("bg-info");
            $search_area.find(".modules_display_short").html(module_parameters[value].title_short);


            $checked_digits.prop("checked", false);
            $checked_digits.closest("label").addClass("hidden").removeClass("active");
            $checked_digits.each(function() {
                this_val = parseInt($(this).val());

                if (exist_in_array(this_val, module_parameters[value].digits_to_show)) {
                    $(this).closest("label").removeClass("hidden")
                }
            });
        }



        // set checked_digits
        checked_digits_arr = parameters.checked_digits;
        if (checked_digits_arr !== undefined) {
            $checked_digits.each(function() {
                this_val = parseInt($(this).val());
                if (exist_in_array(this_val, checked_digits_arr)) {
                    $(this).prop("checked", true);
                    $(this).closest("label").addClass("active")
                }
            });
        }



        elements_to_activate = module_parameters[value].elements_to_activate;
        elements_to_disable = module_parameters[value].elements_to_disable;
        for (var el in elements_to_activate) {
            $search_area.find("." + elements_to_activate[el]).removeClass("disabled");
        }
        for (var el in elements_to_disable) {
            $search_area.find("." + elements_to_disable[el]).addClass("disabled");
        }


        // set operation
        operation = parameters.operation;
        value = operation;
        if (value !== undefined) {
            $search_area.find("input[name='operation']").val(value);
            $search_area.find(".operation_display").html(operation_titles[value]);
            $search_area.find(".operation").removeClass("bg-success");
            $search_area.find(".operation[data-value='" + value + "']").addClass("bg-success");
        }


        // set decimal
        value = parameters.decimal;
        if (value !== undefined) {
            $search_area.find("input[name='decimal']").val(value);
            $search_area.find(".decimal_display").html(decimal_titles[value]);
            $search_area.find(".decimal").removeClass("bg-success");
            $search_area.find(".decimal[data-value='" + value + "']").addClass("bg-success");
            if (value !== "off") {
                $search_area.find(".decimal_display").addClass("active")
            } else {
                $search_area.find(".decimal_display").removeClass("active")
            }
        }


        //set sign
        value = parameters.sign;
        if (value !== undefined) {
            $search_area.find("input[name='sign']").val(value);
            $search_area.find(".sign_display").html(sign_titles[value]);
            $search_area.find(".sign").removeClass("bg-success");
            $search_area.find(".sign[data-value='" + value + "']").addClass("bg-success");
            if (value !== "off") {
                $search_area.find(".sign_display").addClass("active")
            } else {
                $search_area.find(".sign_display").removeClass("active")
            }
        }



        //set is_alternation
        value = parameters.is_alternation;
        if (value !== undefined) {
            $search_area.find("input[name='is_alternation']").val(value);
            if (value !== "off") {
                $search_area.find(".is_alternation").addClass("active")
            } else {
                $search_area.find(".is_alternation").removeClass("active")
            }
        }

        //set is_alternation
        value = parameters.is_alternation;
        if (value !== undefined) {
            $search_area.find("input[name='operation_alternation']").val(value);
            if (value !== "off") {
                $search_area.find(".operation_alternation").addClass("active")
            } else {
                $search_area.find(".operation_alternation").removeClass("active")
            }
        }




        // set digits_nmb
        value = parameters.digits_nmb;
        if (value !== undefined) {
            $search_area.find(".digits_nmb_display").html(value);

            $search_area.find(".digits_nmb").val(parseInt(value));

            $search_area.find("input[name='digits_nmb']").val(parseInt(value));
        }

        // set actions_nmb
        value = parameters.actions_nmb;
        if (value !== undefined) {
            $search_area.find(".actions_nmb_display").html(value);

            $search_area.find(".actions_nmb").val(parseInt(value));
            $search_area.find("input[name='actions_nmb']").val(parseInt(value));
        }

        // set progress_actions_nmb
        value = parameters.progress_actions_nmb;
        if (value !== undefined) {
            $search_area.find(".progress_actions_nmb_display").html(value);

            $search_area.find(".progress_actions_nmb").val(parseInt(value));
            $search_area.find("input[name='progress_actions_nmb']").val(parseInt(value));
        }

        // set progress_digits_nmb
        value = parameters.progress_digits_nmb;
        if (value !== undefined) {
            $search_area.find(".progress_digits_nmb_display").html(value);

            $search_area.find(".progress_digits_nmb").val(parseInt(value));
            $search_area.find("input[name='progress_digits_nmb']").val(parseInt(value));
        }

        // set progress_interval
        value = parameters.progress_interval;
        if (value !== undefined) {
            $search_area.find(".progress_interval_display").html(value);

            $search_area.find(".progress_interval").val(parseInt(value));
            $search_area.find("input[name='progress_interval']").val(parseInt(value));
        }

        // set interval
        value = parameters.interval;
        if (value !== undefined) {
            $search_area.find(".interval_display").html(value);

            $search_area.find(".interval").val(get_number_float_rounded(value));
            $search_area.find("input[name='interval']").val(get_number_float_rounded(value));
        }

        // set all_discharge
        value = parameters.all_discharge;
        if (value !== undefined) {
            $search_area.find("input[name='all_discharge']").val(value);
            if (value !== "off") {
                $search_area.find(".all_discharge").addClass("active")
            } else {
                $search_area.find(".all_discharge").removeClass("active")
            }
        }



        // set discharge_mode
        value = parameters.discharge_mode;
        if (value !== undefined) {
            $search_area.find("input[name='discharge_mode']").val(value);
            switch (value) {
                case "mirror":
                    $search_area.find(".discharge_mode[data-value='" + value + "']").addClass("active");
                    break;
                case "all":
                    $search_area.find(".discharge_mode[data-value='" + value + "']").addClass("bg-warning");
                    break;
                default:
                    if (typeof value === "number") {
                        value = parseInt(value);
                        change_parameter($this, "digits_nmb", screen_pk, value);
                        $search_area.find(".discharge_mode[data-value='" + value + "']").addClass("bg-warning");
                    } else {
                        value = get_array_of_digits_from_str(value, ",");
                        for (var el in value) {
                            $search_area.find(".discharge_mode[data-value='" + value[el] + "']").addClass("bg-warning");
                        }
                    }
                    break;
            }
        }

        // set progress_speed
        value = parameters.progress_speed;
        if (value !== undefined) {
            $search_area.find("input[name='progress_speed']").val(value);
            $search_area.find(".progress_speed_display").html(progress_speed_titles[value]);
            $search_area.find(".progress_speed").removeClass("bg-warning");
            $search_area.find(".progress_speed[data-value='" + value.toString() + "']").addClass("bg-warning");

            if (value !== "off") {
                $search_area.find(".btn_dropdown_progress").addClass("active");
                $search_area.find(".progress_display").html(progress_titles["on"]);
            } else {
                if (GLOBAL_STATE[screen_id].parameters.progress_action === 0) {
                    $search_area.find(".btn_dropdown_progress").removeClass("active");
                    $search_area.find(".progress_display").html(progress_titles["off"]);
                }
            }
        }

        // set progress_action
        value = parameters.progress_action;
        if (value !== undefined) {
            $search_area.find("input[name='progress_action']").val(value);
            $search_area.find(".progress_action_display").html(progress_action_titles[value]);
            $search_area.find(".progress_action").removeClass("bg-warning");
            $search_area.find(".progress_action[data-value='" + value + "']").addClass("bg-warning");
            if (value !== "off") {
                $search_area.find(".btn_dropdown_progress").addClass("active");
                $search_area.find(".progress_display").html(progress_titles["on"]);
            } else {
                if (GLOBAL_STATE[screen_id].parameters.progress_speed === 0) {
                    $search_area.find(".btn_dropdown_progress").removeClass("active");
                    $search_area.find(".progress_display").html(progress_titles["off"]);
                }
            }
        }

        // set mode_50
        value = parameters.mode_50;
        if (value !== undefined) {

            $search_area.find("input[name='mode_50']").val(value);
            $search_area.find(".mode_50_display").html(mode_50_titles[value]);
            $search_area.find(".mode_50").removeClass("bg-warning");
            $search_area.find(".mode_50[data-value='" + value + "']").addClass("bg-warning");

            if (value !== "off") {
                $search_area.find(".btn_dropdown_50").addClass("active");
            } else {
                $search_area.find(".btn_dropdown_50").removeClass("active");
            }
        }

        // set mode_100
        value = parameters.mode_100;
        if (value !== undefined) {
            $search_area.find("input[name='mode_100']").val(value);
            $search_area.find(".mode_100_display").html(mode_100_titles[value]);
            $search_area.find(".mode_100").removeClass("bg-warning");
            $search_area.find(".mode_100[data-value='" + value + "']").addClass("bg-warning");

            if (value !== "off") {
                $search_area.find(".btn_dropdown_100").addClass("active");
            } else {
                $search_area.find(".btn_dropdown_100").removeClass("active");
            }
        }
    }

    function global_refresh() {

        if (confirm("Вы уверены? Обнуляться все баллы и вы начнете с самого начала")) {
            if (is_task_mode()) {
                $.ajax({
                    type: "get",
                    url: $("#task_parameters_url").val(),
                    success: function(data) {
                        set_setting_bars(data, 1, true);
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters = get_parameters_parsed(data.parameters);
                        }
                    }
                })
                date_var = new Date();
                start_time = date_var.getTime();

                $(".timer_bar").css("width", 0);
                $(".examples_done").html(0);
                $(".correct_nmb").html(0);
                $(".done_percent").html(0);
                $(".correct_percent").html(0);
                $(".progress_bar").css("width", 0);
                $(".correctness_bar").css("width", 0);
            };

            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].points = 0;
                GLOBAL_STATE[i].diff_points = 0;
                GLOBAL_STATE[i].done = 0;
                GLOBAL_STATE[i].real_done = 0;
                GLOBAL_STATE[i].correct = 0;
                GLOBAL_STATE[i].correct_percent = 0;
                GLOBAL_STATE[i].done_percent = 0;
                GLOBAL_STATE[i].status = "stopped";
                GLOBAL_STATE[i].progress_key = 0;
                GLOBAL_STATE[i].progress_variant = "speed";
                GLOBAL_STATE[i].progress_digits_nmb_key = 0;
                GLOBAL_STATE[i].is_answer_entered = false;
                GLOBAL_STATE[i].student_answer = "";
                GLOBAL_STATE[i].example_text = "";
                GLOBAL_STATE[i].example = [];
                GLOBAL_STATE[i].answer = undefined;
                GLOBAL_STATE[i].parameters = get_parameters();
            };


            $(".points").val(0);
            $(".points").html(0);
            $(".player_points").html(0);
            stop_example("global")
        }


    }

    function create_and_append_flash_card() {

    }

    function edit_parameter(args) { //{screen_pk, value_type, value}
        screen_pk = args.screen_pk;
        var is_global_parameter = args.screen_pk === "modal_global_settings" || args.screen_pk === "navbar" || args.screen_pk === "global";
        if (is_global_parameter) {
            $search_area = $(document);
            $screen = $("#" + args.screen_pk.toString())
        } else {
            screen_id = parseInt(args.screen_pk);
            $screen = $("#" + screen_id.toString());
            $search_area = $screen;
        }
        $global_input = $search_area.find("input[name='" + args.value_type + "']");
        $input = $screen.find("input[name='" + args.value_type + "']");
        $display = $search_area.find("." + args.value_type + "_display");

        if (args.value !== undefined) {
            $global_input.val(args.value);
            $display.html(args.value);
            if (is_global_parameter) {
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    GLOBAL_STATE[i].parameters[args.value_type] = args.value;
                }
            } else {
                screen_id = parseInt(args.screen_pk);
                GLOBAL_STATE[screen_id].parameters[args.value_type] = args.value;
            }

            if (args.value_type === "digits_nmb") {
                if (is_global_parameter) {
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        create_and_append_flash_card(i)
                    }
                } else {
                    create_and_append_flash_card(screen_id)
                }
            } else if (args.value_type === "screens_nmb") {
                create_screens(args.value)
            }
        } else {
            switch (args.operation) {
                case "operation_alternation":
                    if ($screen.find("input[name='operation_alternation']").val() === "on") {
                        value = "off"
                    } else {
                        value = "on"
                    }
                    if (is_global_parameter) {
                        $search_area = $(document);
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.operation_alternation = value;
                        }
                    } else {
                        $search_area = $screen;
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters.operation_alternation = value;
                    }
                    $search_area.find("input[name='operation_alternation']").val(value);
                    if (value !== "off") {
                        $search_area.find(".operation_alternation").addClass("active")
                    } else {
                        $search_area.find(".operation_alternation").removeClass("active")
                    }
                    break;

                case "input_increase":
                    var decimal = parseInt($input.data("decimal"));
                    var step = get_number_float_rounded_by_decimal($input.attr("step"), decimal);
                    var min = get_number_float_rounded_by_decimal($input.attr("min"), decimal);
                    var max = get_number_float_rounded_by_decimal($input.attr("max"), decimal);
                    var val = get_number_float_rounded_by_decimal($input.val(), decimal);
                    var input_val = val;
                    if (val + step <= max) {
                        input_val = get_number_float_rounded_by_decimal(val + step, decimal);
                    }
                    $global_input.val(input_val);
                    $display.html(input_val);
                    if (args.value_type === "screens_nmb") {
                        create_screens(input_val)
                    }
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                        }
                    } else {
                        screen_id = parseInt(args.screen_pk);
                        GLOBAL_STATE[screen_id].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                    }
                    if (args.value_type === "digits_nmb") {
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                create_and_append_flash_card(i)
                            }
                        } else {
                            screen_id = parseInt(args.screen_pk);
                            create_and_append_flash_card(screen_id)
                        }
                    }
                    break;
                case "input_decrease":
                    var decimal = parseInt($input.data("decimal"));
                    var step = get_number_float_rounded_by_decimal($input.attr("step"), decimal);
                    var min = get_number_float_rounded_by_decimal($input.attr("min"), decimal);
                    var max = get_number_float_rounded_by_decimal($input.attr("max"), decimal);
                    var val = get_number_float_rounded_by_decimal($input.val(), decimal);
                    var input_val = val;
                    if (val - step >= min) {
                        input_val = get_number_float_rounded_by_decimal(val - step, decimal);

                    }
                    $global_input.val(input_val);
                    $display.html(input_val);
                    if (args.value_type === "screens_nmb") {
                        create_screens(input_val)
                    }
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                        }

                    } else {
                        screen_id = parseInt(args.screen_pk);
                        GLOBAL_STATE[screen_id].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                    }
                    if (args.value_type === "digits_nmb") {
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                create_and_append_flash_card(i)
                            }
                        } else {
                            screen_id = parseInt(args.screen_pk);
                            create_and_append_flash_card(screen_id)
                        }
                    }
                    break;
                case "input_number":
                    var $this = args.$this;
                    var decimal = parseInt($input.data("decimal"));
                    var step = get_number_float_rounded_by_decimal($this.attr("step"), decimal);
                    var min = get_number_float_rounded_by_decimal($this.attr("min"), decimal);
                    var max = get_number_float_rounded_by_decimal($this.attr("max"), decimal);
                    var val = get_number_float_rounded_by_decimal($this.val(), decimal);
                    var input_val = val;
                    if (input_val < min) {
                        input_val = min
                    }
                    if (input_val > max) {
                        input_val = max
                    }
                    if (args.value_type === "screens_nmb") {
                        create_screens(input_val)
                    }


                    $global_input.val(input_val);
                    $display.html(input_val);


                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                        }

                    } else {
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters[args.value_type] = get_number_float_rounded_by_decimal(input_val, decimal);
                    }
                    if (args.value_type === "digits_nmb") {
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                create_and_append_flash_card(i)
                            }
                        } else {
                            screen_id = parseInt(args.screen_pk);
                            create_and_append_flash_card(screen_id)
                        }
                    }
                    break;
                case "btn_checked_digits":
                    $form = $screen.find("form");
                    setTimeout(function() {
                        var data = get_parameters_parsed($form.serializeObject());
                        checked_digits = data.checked_digits;
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.checked_digits = checked_digits
                            }
                        } else {
                            screen_id = parseInt(screen_pk);
                            GLOBAL_STATE[screen_id].parameters.checked_digits = checked_digits;
                        }
                        $search_area.find("input[name='checked_digits']").prop("checked", false);
                        $search_area.find(".btn_checked_digits").removeClass("active");

                        for (var digit in checked_digits) {
                            $search_area.find("input[name='checked_digits'][value='" + checked_digits[digit] + "']").prop("checked", true);
                            $search_area.find("input[name='checked_digits'][value='" + checked_digits[digit] + "']").parent().addClass("active");
                        }
                    }, 100);

                    break;
                case "btn_check_all_digits":
                    $inputs_checked_digits = $search_area.find("input[name='checked_digits']");
                    $input_check_all_digits = $screen.find("input[name='check_all_digits']");
                    if (!$input_check_all_digits.prop("checked")) {
                        $inputs_checked_digits.prop("checked", true);
                        $inputs_checked_digits.parent().addClass("active");
                    } else {
                        $inputs_checked_digits.prop("checked", false);
                        $inputs_checked_digits.parent().removeClass("active");
                    }
                    $form = $screen.find("form");
                    var data = get_parameters_parsed($form.serializeObject());

                    checked_digits = data.checked_digits;
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.checked_digits = checked_digits
                        }
                    } else {
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters.checked_digits = checked_digits;
                    }
                    break;
            }

        }


    }


    function change_parameter($this, parameter, screen_pk, value) {
        if (screen_pk === undefined) {
            $screen = $this.closest(".screen");
        } else {
            $screen = $("#" + screen_pk);
            $this = $screen.find("." + parameter);
        }

        screen_pk = $screen.attr("id");
        is_global_parameter = screen_pk === "modal_global_settings" || screen_pk === "navbar";

        switch (parameter) {
            case "increase":
                value_type = $this.closest(".change_value").data("value-type");

                no_slider_change = $this.hasClass("no_slider_change");

                if (is_global_parameter) {
                    $search_area = $(document);
                } else {
                    $search_area = $screen
                }

                $global_input = $search_area.find("input[name='" + value_type + "']");
                $input = $screen.find("input[name='" + value_type + "']");

                $display = $search_area.find("." + value_type + "_display");

                input_val = get_number_float_rounded($input.val());
                min_val = get_number_float_rounded($input.attr("min"));
                max_val = get_number_float_rounded($input.attr("max"));
                step = get_number_float_rounded($input.attr("step"));

                if (input_val + step <= max_val) {

                    input_val = get_number_float_rounded(input_val) + get_number_float_rounded(step);
                    if (value_type === "screens_nmb") {
                        create_screens(parseInt(input_val))
                    }
                    input_val = get_number_float_rounded(input_val);
                    if (no_slider_change) {
                        $global_input.val(input_val)
                    } else {

                        $global_input.val(input_val);
                    }
                    $display.html(input_val);
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[value_type] = get_number_float_rounded(input_val);
                        }

                    } else {
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters[value_type] = get_number_float_rounded(input_val);
                    }
                }

                break;
            case "decrease":
                value_type = $this.closest(".change_value").data("value-type");
                no_slider_change = $this.hasClass("no_slider_change");
                if (is_global_parameter) {
                    $search_area = $(document);
                } else {
                    $search_area = $screen
                }

                $global_input = $search_area.find("input[name='" + value_type + "']");
                $input = $screen.find("input[name='" + value_type + "']");

                $display = $search_area.find("." + value_type + "_display");
                $slider = $search_area.find(".change_value[data-value-type='" + value_type + "']").find(".slider");
                input_val = get_number_float_rounded($input.val());
                min_val = get_number_float_rounded($input.attr("min"));
                max_val = get_number_float_rounded($input.attr("max"));
                step = get_number_float_rounded($input.attr("step"));

                if (input_val - step >= min_val) {

                    input_val -= step;
                    if (value_type === "screens_nmb") {
                        create_screens(parseInt(input_val))
                    }
                    input_val = get_number_float_rounded(input_val);
                    if (no_slider_change) {
                        $global_input.val(input_val)
                    } else {

                        $global_input.val(input_val);
                    }
                    $display.html(input_val);
                    if (is_global_parameter) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters[value_type] = get_number_float_rounded(input_val);
                        }
                    } else {
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters[value_type] = get_number_float_rounded(input_val);
                    }
                }
                break;
            case "actions_nmb":
                if (is_global_parameter) {
                    $(".actions_nmb_display").html($this.val());
                    $(".actions_nmb").val(parseInt($this.val()));

                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.actions_nmb = parseInt($this.val())
                    }
                } else {
                    $screen.find(".actions_nmb_display").html($this.val());
                    screen_id = parseInt($screen.attr("id"));
                    GLOBAL_STATE[screen_id].parameters.actions_nmb = parseInt($this.val())
                }
                break;
            case "digits_nmb":
                if (value !== undefined) {
                    digits_nmb = value
                } else {
                    digits_nmb = parseInt($this.val());
                }

                if (is_global_parameter) {
                    $(".digits_nmb_display").html(digits_nmb);

                    $(".digits_nmb").val(digits_nmb);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.digits_nmb = digits_nmb
                    }
                } else {
                    $screen.find(".digits_nmb_display").html(digits_nmb);
                    screen_id = parseInt($screen.attr("id"));
                    GLOBAL_STATE[screen_id].parameters.digits_nmb = digits_nmb;
                }
                break;
            case "interval":
                if (is_global_parameter) {
                    $(".interval_display").html($this.val());


                    $(".interval").val(get_number_float_rounded($this.val()));

                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.interval = get_number_float_rounded($this.val())
                    }
                } else {
                    $screen.find(".interval_display").html($this.val());
                    screen_id = parseInt($screen.attr("id"));
                    GLOBAL_STATE[screen_id].parameters.interval = get_number_float_rounded($this.val())
                }
                break;
            case "operation":

                value = $this.data("value");
                if (!$this.hasClass("disabled")) {
                    is_short_title = $this.hasClass("short_title");
                    if (is_global_parameter) {
                        $search_area = $(document);
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.operation = value;
                        }
                    } else {
                        $search_area = $screen;

                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters.operation = value;
                    }
                    $search_area.find("input[name='operation']").val(value);
                    if (is_short_title) {
                        $search_area.find(".operation_display").html(operation_short_titles[value]);
                    } else {
                        $search_area.find(".operation_display").html(operation_titles[value]);
                    }

                    $search_area.find(".operation").removeClass("bg-success");
                    $search_area.find(".operation[data-value='" + value + "']").addClass("bg-success");
                    if (value === "plus" || value === "minus") {
                        $search_area.find(".sign_display ").removeClass("active").html($("#trans_sign_off").val())
                        $search_area.find("input[name='sign']").val("off");
                        $search_area.find(".sign").removeClass("bg-success");
                        $search_area.find(".sign[data-value='off']").addClass("bg-success");
                        if (is_global_parameter) {
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.sign = "off"
                            }
                        } else {
                            screen_id = parseInt($this.closest(".screen").attr("id"));
                            GLOBAL_STATE[screen_id].parameters.sign = "off"
                        }
                    }
                }

                break;
            case "decimal":

                value = $this.data("value");
                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.decimal = value;
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.decimal = value;
                }
                $search_area.find("input[name='decimal']").val(value);
                $search_area.find(".decimal_display").html(decimal_titles[value]);
                $search_area.find(".decimal").removeClass("bg-success");
                $search_area.find(".decimal[data-value='" + value + "']").addClass("bg-success");
                if (value !== "off") {
                    $search_area.find(".decimal_display").addClass("active")
                } else {
                    $search_area.find(".decimal_display").removeClass("active")
                }
                break;
            case "operation_alternation":
                if ($screen.find("input[name='operation_alternation']").val() === "on") {
                    value = "off"
                } else {
                    value = "on"
                }
                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.operation_alternation = value;
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.operation_alternation = value;
                }
                $search_area.find("input[name='operation_alternation']").val(value);
                if (value !== "off") {
                    $search_area.find(".operation_alternation").addClass("active")
                } else {
                    $search_area.find(".operation_alternation").removeClass("active")
                }
                break;
            case "is_alternation":
                if ($screen.find("input[name='is_alternation']").val() === "on") {
                    value = "off"
                } else {
                    value = "on"
                }
                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.is_alternation = value;
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.is_alternation = value;
                }
                $search_area.find("input[name='is_alternation']").val(value);
                if (value !== "off") {
                    $search_area.find(".is_alternation").addClass("active")
                } else {
                    $search_area.find(".is_alternation").removeClass("active")
                }
                break;
            case "all_discharge":
                if (!$this.hasClass("disabled")) {
                    if ($screen.find("input[name='all_discharge']").val() === "on") {
                        value = "off"
                    } else {
                        value = "on"
                    }
                    if (is_global_parameter) {
                        $search_area = $(document);
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.all_discharge = value;
                        }
                    } else {
                        $search_area = $screen;
                        screen_id = parseInt(screen_pk);
                        GLOBAL_STATE[screen_id].parameters.all_discharge = value;
                    }
                    $search_area.find("input[name='all_discharge']").val(value);
                    if (value !== "off") {
                        $search_area.find(".all_discharge").addClass("active")
                    } else {
                        $search_area.find(".all_discharge").removeClass("active")
                    }
                }

                break;
            case "progress_speed":
                value = parseInt($this.data("value"));
                screen_id = 1;
                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.progress_speed = value;
                        if (value > 0) {
                            GLOBAL_STATE[i].progress_variant = "speed";
                        }
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.progress_speed = value;
                    if (value > 0) {
                        GLOBAL_STATE[screen_id].progress_variant = "speed";
                    }
                }
                $search_area.find("input[name='progress_speed']").val(value);
                $search_area.find(".progress_speed_display").html(progress_speed_titles[value]);
                $search_area.find(".progress_speed").removeClass("bg-warning");
                $search_area.find(".progress_speed[data-value='" + value.toString() + "']").addClass("bg-warning");

                if (value !== 0) {
                    $search_area.find(".btn_dropdown_progress").addClass("active");
                    $search_area.find(".progress_display").html(progress_titles["on"]);
                } else {
                    if (GLOBAL_STATE[screen_id].parameters.progress_action === 0) {
                        $search_area.find(".btn_dropdown_progress").removeClass("active");
                        $search_area.find(".progress_display").html(progress_titles["off"]);
                    }
                }
                break;
            case "progress_action":
                value = parseInt($this.data("value"));
                screen_id = 1;
                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.progress_action = value;
                        if (value > 0) {
                            GLOBAL_STATE[i].progress_variant = "action";
                        }
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.progress_action = value;
                    if (value > 0) {
                        GLOBAL_STATE[screen_id].progress_variant = "action";
                    }
                }
                $search_area.find("input[name='progress_action']").val(value);
                $search_area.find(".progress_action_display").html(progress_action_titles[value]);
                $search_area.find(".progress_action").removeClass("bg-warning");
                $search_area.find(".progress_action[data-value='" + value.toString() + "']").addClass("bg-warning");
                if (value !== 0) {
                    $search_area.find(".btn_dropdown_progress").addClass("active");
                    $search_area.find(".progress_display").html(progress_titles["on"]);
                } else {
                    if (GLOBAL_STATE[screen_id].parameters.progress_speed === 0) {
                        $search_area.find(".btn_dropdown_progress").removeClass("active");
                        $search_area.find(".progress_display").html(progress_titles["off"]);
                    }
                }
                break;
            case "mode_50":
                if (value === undefined) {
                    value = $this.data("value");
                }
                screen_id = 1;
                if (is_global_parameter) {
                    $search_area = $(document);
                    if (value === "training") {
                        change_parameter($this, "sign", screen_pk, "off");
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.mode_100 = "on";
                        }
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.mode_50 = value;
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.mode_50 = value;
                    if (value === "training") {
                        change_parameter($this, "sign", screen_pk, "off");
                        GLOBAL_STATE[screen_id].parameters.mode_100 = "on";
                    }
                }
                $search_area.find("input[name='mode_50']").val(value);
                $search_area.find(".mode_50_display").html(mode_50_titles[value]);
                $search_area.find(".mode_50").removeClass("bg-warning");
                $search_area.find(".mode_50[data-value='" + value + "']").addClass("bg-warning");
                if (value === "training") {
                    $search_area.find(".btn_dropdown_100").addClass("active");
                    $search_area.find("input[name='mode_100']").val("on");
                    $search_area.find(".mode_100_display").html(mode_100_titles["on"]);
                    $search_area.find(".mode_100").removeClass("bg-warning");
                    $search_area.find(".mode_100[data-value='on']").addClass("bg-warning");
                }
                if (value !== "off") {
                    $search_area.find(".btn_dropdown_50").addClass("active");
                } else {
                    $search_area.find(".btn_dropdown_50").removeClass("active");
                }
                break;
            case "mode_100":
                if (value === undefined) {
                    value = $this.data("value");
                }
                screen_id = 1;
                if (is_global_parameter) {
                    $search_area = $(document);
                    if (value === "training") {
                        change_parameter($this, "sign", screen_pk, "off");
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.mode_50 = "on";
                        }
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.mode_100 = value;
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.mode_100 = value;
                    if (value === "training") {
                        change_parameter($this, "sign", screen_pk, "off");
                        GLOBAL_STATE[screen_id].parameters.mode_50 = "on";
                    }
                }
                $search_area.find("input[name='mode_100']").val(value);
                $search_area.find(".mode_100_display").html(mode_100_titles[value]);
                $search_area.find(".mode_100").removeClass("bg-warning");
                $search_area.find(".mode_100[data-value='" + value + "']").addClass("bg-warning");
                if (value === "training") {
                    $search_area.find(".btn_dropdown_50").addClass("active");
                    $search_area.find("input[name='mode_50']").val("on");
                    $search_area.find(".mode_50_display").html(mode_50_titles["on"]);
                    $search_area.find(".mode_50").removeClass("bg-warning");
                    $search_area.find(".mode_50[data-value='on']").addClass("bg-warning");
                }
                if (value !== "off") {
                    $search_area.find(".btn_dropdown_100").addClass("active");
                } else {
                    $search_area.find(".btn_dropdown_100").removeClass("active");
                }
                break;
            case "sign":
                if (value === undefined) {
                    value = $this.data("value");
                }

                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.sign = value;
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.sign = value;
                }
                $search_area.find("input[name='sign']").val(value);
                $search_area.find(".sign_display").html(sign_titles[value]);
                $search_area.find(".sign").removeClass("bg-success");
                $search_area.find(".sign[data-value='" + value + "']").addClass("bg-success");
                if (value !== "off") {
                    $search_area.find(".sign_display").addClass("active")
                } else {
                    $search_area.find(".sign_display").removeClass("active")
                }
                if (value === "training") {
                    change_parameter($this, "mode_50", screen_pk, "on");
                    change_parameter($this, "mode_100", screen_pk, "on");
                    $search_area.find(".operation_display").html($("#trans_plus_minus").val());
                    $search_area.find(".operation").removeClass("bg-success");
                    $search_area.find(".operation[data-value='plus_minus']").addClass("bg-success");
                    $search_area.find("input[name='operation']").val("plus_minus");
                    if ($this.closest(".screen").attr("id") === "modal_global_settings") {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.operation = "plus_minus"
                        }
                    } else {
                        screen_id = parseInt($this.closest(".screen").attr("id"));
                        GLOBAL_STATE[screen_id].parameters.operation = "plus_minus"
                    }
                }
                break;
            case "modules":
                value = $this.data("value");
                is_short_title = $this.hasClass("short_title");
                if (is_global_parameter) {
                    $search_area = $(document);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = value;
                        GLOBAL_STATE[i].parameters.checked_digits = module_parameters[value].digits_to_show.slice();
                    }
                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    GLOBAL_STATE[screen_id].parameters.modules = value;
                    GLOBAL_STATE[screen_id].parameters.checked_digits = module_parameters[value].digits_to_show.slice();
                }
                $modules_display = $search_area.find(".modules_display");
                $search_area.find("input[name=modules]").val(value);
                $search_area.find(".check_all").addClass("active");
                $search_area.find(".check_all").find("input").val(1);
                if (is_short_title) {
                    $search_area.find(".modules_display").html(module_parameters[value].title_short);
                } else {
                    $search_area.find(".modules_display").html(module_parameters[value].title);
                }
                $search_area.find(".modules").removeClass("bg-info");
                $search_area.find(".modules[data-value='" + value + "']").addClass("bg-info");
                $search_area.find(".modules_display_short").html(module_parameters[value].title_short);
                modules = value.split(",");
                module = modules[0];
                $checked_digits = $search_area.find("input[name='checked_digits']");
                $checked_digits.prop("checked", false);
                $checked_digits.closest("label").addClass("hidden active");
                elements_to_activate = module_parameters[value].elements_to_activate;
                elements_to_disable = module_parameters[value].elements_to_disable;
                for (var el in elements_to_activate) {
                    $search_area.find("." + elements_to_activate[el]).removeClass("disabled");
                }
                for (var el in elements_to_disable) {
                    $search_area.find("." + elements_to_disable[el]).addClass("disabled");
                }
                $checked_digits.each(function() {
                    this_val = parseInt($(this).val());
                    if (exist_in_array(this_val, module_parameters[value].digits_to_show)) {
                        $(this).prop("checked", true);
                        $(this).closest("label").removeClass("hidden")
                    }
                });
                break;
            case "checked_digits":
                $input = $this.find("input");
                value = parseInt($input.val());
                is_checked = $input.prop("checked");
                if (is_global_parameter) {
                    $search_area = $("#main_screen");
                    $inputs = $search_area.find("input[name='checked_digits'][value='" + value.toString() + "']");

                    if (is_checked) {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            exclude_el_from_array(value, GLOBAL_STATE[i].parameters.checked_digits);
                        }
                        $inputs.each(function() {
                            $(this).prop("checked", false);
                            $(this).closest("label").removeClass("active")
                        })
                    } else {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            include_el_to_array(value, GLOBAL_STATE[i].parameters.checked_digits);
                        }
                        $inputs.each(function() {
                            $(this).prop("checked", true);
                            $(this).closest("label").addClass("active")
                        })
                    }

                } else {
                    $search_area = $screen;
                    screen_id = parseInt(screen_pk);
                    if (is_checked) {
                        exclude_el_from_array(value, GLOBAL_STATE[screen_id].parameters.checked_digits);
                    } else {
                        include_el_to_array(value, GLOBAL_STATE[screen_id].parameters.checked_digits);
                    }
                }
                break;
            case "check_all":
                $input = $this.find("input");
                value = parseInt($input.val());

                if (is_global_parameter) {
                    if (value === 1) {
                        $input.val(0);
                        $(".check_all").removeClass("active");
                        $(".check_all").find("input").val(0);
                        $("input[name='checked_digits']").prop("checked", false);
                        $(".checked_digits").removeClass("active");
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.checked_digits = [];
                        }
                    } else {
                        $input.val(1);
                        $(".check_all").addClass("active");
                        $(".check_all").find("input").val(1);
                        $("input[name='checked_digits']").prop("checked", true);
                        $(".checked_digits").addClass("active");
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            GLOBAL_STATE[i].parameters.checked_digits = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                        }
                    }
                } else {
                    screen_id = parseInt(screen_pk);
                    if (value === 1) {
                        $input.val(0);
                        //$screen.find(".check_all").removeClass("active");
                        $screen.find("input[name='checked_digits']").prop("checked", false);
                        $screen.find(".checked_digits").removeClass("active");
                        GLOBAL_STATE[screen_id].parameters.checked_digits = [];
                    } else {
                        $input.val(1);
                        //$screen.find(".check_all").addClass("active");
                        $screen.find("input[name='checked_digits']").prop("checked", true);
                        $screen.find(".checked_digits").addClass("active");
                        GLOBAL_STATE[screen_id].parameters.checked_digits = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                    }
                }
                break;
            case "discharge_mode":
                $screen = $this.closest(".screen");
                value = $this.data("value");

                $input_discharge_mode = $screen.find("input[name='discharge_mode']");
                previous_value = $input_discharge_mode.val();
                new_value = previous_value;
                if (is_global_parameter) {
                    $search_area = $(document);
                    if (value === "all" || value === "mirror") {

                        if (value === "mirror" && previous_value === "mirror") {
                            new_value = value;
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.discharge_mode = "all"
                            }
                        } else {
                            new_value = value;
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.discharge_mode = new_value
                            }
                        }


                    } else {
                        if (previous_value === "mirror" || previous_value === "all") {
                            new_value = value;
                            new_value = parseInt(new_value);
                            change_parameter($this, "digits_nmb", screen_pk, new_value);
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.discharge_mode = new_value
                            }
                        } else {
                            previous_value_arr = get_array_of_digits_from_str(previous_value, ",");
                            toggle_el_to_array(parseInt(value), previous_value_arr);
                            new_value = previous_value_arr;
                            new_value.sort();
                            max_value = new_value[new_value.length - 1];
                            max_value = parseInt(max_value);
                            change_parameter($this, "digits_nmb", screen_pk, max_value);
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                GLOBAL_STATE[i].parameters.discharge_mode = new_value;
                            }
                        }
                    }

                } else {
                    screen_id = parseInt(screen_pk);
                    $search_area = $screen;
                    if (value === "all" || value === "mirror") {

                        if (value === "mirror" && previous_value === "mirror") {
                            GLOBAL_STATE[screen_id].parameters.discharge_mode = "all"
                        } else {
                            new_value = value;
                            GLOBAL_STATE[screen_id].parameters.discharge_mode = new_value
                        }

                    } else {
                        if (previous_value === "mirror" || previous_value === "all") {
                            new_value = value;
                            new_value = parseInt(new_value);
                            change_parameter($this, "digits_nmb", screen_pk, new_value);
                            GLOBAL_STATE[screen_id].parameters.discharge_mode = value;
                        } else {
                            previous_value_arr = get_array_of_digits_from_str(previous_value, ",");
                            toggle_el_to_array(parseInt(value), previous_value_arr);
                            new_value = previous_value_arr;
                            new_value.sort();
                            max_value = new_value[new_value.length - 1];
                            max_value = parseInt(max_value);
                            change_parameter($this, "digits_nmb", screen_pk, max_value);
                            GLOBAL_STATE[screen_id].parameters.discharge_mode = new_value;
                        }
                    }
                }


                if (value === "mirror" && previous_value === "mirror") {
                    $search_area.find("input[name='discharge_mode']").val("all");
                    $search_area.find(".discharge_mode").removeClass("bg-warning active");
                } else {
                    $search_area.find("input[name='discharge_mode']").val(new_value);
                    $search_area.find(".discharge_mode").removeClass("bg-warning active");
                }

                switch (new_value) {
                    case "mirror":
                        if (previous_value !== "mirror") {
                            $search_area.find(".discharge_mode[data-value='" + new_value + "']").addClass("active");
                        }

                        break;
                    case "all":
                        $search_area.find(".discharge_mode[data-value='" + new_value + "']").addClass("bg-warning");
                        break;
                    default:
                        if (typeof new_value === "number") {
                            $search_area.find(".discharge_mode[data-value='" + new_value + "']").addClass("bg-warning");
                        } else {
                            new_value = get_array_of_digits_from_str(new_value, ",");
                            for (var el in new_value) {
                                $search_area.find(".discharge_mode[data-value='" + new_value[el] + "']").addClass("bg-warning");
                            }
                        }

                        break;
                }
                break;
        }
    }
    $(document).ready(function() {
        $("#btn_global_refresh").on("click", function() {
            global_refresh()
        });
        if (device.tablet()) {
            $(".tablet-hidden").addClass("d-none")
        }

        if (device.mobile()) {
            $(".mobile-hidden").addClass("d-none")
        }




        $(document)
            .on("click", ".show_block", function() {
                show_block($(this).data("block_type"), $(this).closest(".screen").attr("id"))
            })
            .on("click", ".btn_show_example", function() {
                show_example($(this).closest(".screen").attr("id"))
            })
            .on("click", ".btn_settings", function() {
                $(this).closest(".screen").find(".example_block").toggle();
                $(this).closest(".screen").find(".settings_block").toggle();
            })
            .on("click", ".btn-keyboard", function() {
                if (!$(this).hasClass("btn_start")) {
                    value = $(this).data("value");
                    $answer_input = $(this).closest(".screen").find(".answer_input");
                    if ($answer_input.val() === undefined) {
                        $answer_input = $("#main_screen").find(".answer_input");
                    }
                    input_value = $answer_input.val().toString();
                    if (value === "backspace") {
                        input_value = input_value.slice(0, -1);
                        $answer_input.val(input_value)
                    } else if (value === "clear") {
                        $answer_input.val("")
                    } else if (value === ".") {
                        if (input_value.indexOf(value) === -1) {
                            $answer_input.val(input_value + value)
                        }
                    } else if (value === "minus") {
                        $answer_input.val(-input_value)
                    } else {
                        $answer_input.val(input_value + value)
                    }
                }


            })
            .on("mouseover", ".screen", function() {
                $(this).find(".btn_group_local_settings").removeClass("invisible")
            })
            .on("mouseout", ".screen", function() {
                $(this).find(".btn_group_local_settings").addClass("invisible")
            })
            .on("mouseover", ".player_header", function() {
                if (!device.mobile() && !device.tablet()) {
                    $(this).closest(".screen").find(".short_settings_bar_block").removeClass("hidden")
                }
            })
            .on("mouseout", ".player_header", function() {
                if (!device.mobile() && !device.tablet()) {
                    if ($(this).closest(".screen").find(".full_settings_bar_block").hasClass("hidden")) {
                        $(this).closest(".screen").find(".short_settings_bar_block").addClass("hidden")
                    }
                }
            })
            .on("click", ".show_full_settings_bar_block", function() {
                if (!device.mobile() && !device.tablet()) {
                    $(this).closest(".screen").find(".full_settings_bar_block").toggleClass("hidden");
                }
            })
            .on("click", ".close_full_settings_bar_block", function() {
                if (!device.mobile() && !device.tablet()) {
                    $(this).closest(".screen").find(".full_settings_bar_block").addClass("hidden");
                    $(this).closest(".screen").find(".short_settings_bar_block").addClass("hidden")
                }
            })

            .on("change", ".player_name", function() {
                screen_id = parseInt($(this).closest(".screen").attr("id"));
                GLOBAL_STATE[screen_id].player_name = $(this).val()
            })
            .on("click", "#modal_settings_confirm", function(e) {
                e.preventDefault();
                $("#modal_settings").modal("hide");
                $form = $(this).closest("form");
                parameters = $form.serializeObject();
                global_screen_state = {
                    "parameters": get_parameters_parsed(parameters)
                };

            })
            .on("click", "#save_settings", function(e) {
                e.preventDefault();
                $("#modal_settings").modal("hide");
                $form = $(this).closest("form");
                parameters = $form.serializeObject();
                global_screen_state = {
                    "parameters": get_parameters_parsed(parameters)
                };

            })
            .on("click", ".btn_settings_show", function() {
                $screen = $(this).closest(".screen");
                $screen.find(".active_block").val("settings_block");
                $screen.find(".settings_block").removeClass("hidden");
                $screen.find(".choice_block").addClass("hidden");
                $screen.find(".example_block").addClass("hidden");
            })

            .on("change", ".answer_input_keyboarded", function() {
                value = $(this).val();
                $("#main_block").find(".answer_input").val(value)
            })
            .on("click", ".btn_choice_block_show", function() {
                $screen = $(this).closest(".screen");
                $screen.find(".active_block").val("choice_block");
                $screen.find(".settings_block").addClass("hidden");
                $screen.find(".choice_block").removeClass("hidden");
                $screen.find(".example_block").addClass("hidden");
            })


        $(document).on('click.bs.dropdown', '.noclose', function(e) {
            e.stopPropagation()
        });

        $(".change_font").on("click", function() {
            value = $(this).data("value");
            $("#font").val(value);
            $(".font_display").html($(this).html());
            $("table").removeClass("neucha roboto dfpop1 showcard playbill jokerman segoe");
            $("table").addClass(value);

            $(".fonted").removeClass("neucha roboto dfpop1 showcard playbill jokerman segoe");
            $(".fonted").addClass(value);
        });

        $(".show_all_settings_block").on("click", function() {
            $input = $(this).find("input");
            if ($input.val() === "off") {
                $input.val("on");
                $(".full_settings_bar_block").removeClass("hidden")
            } else {
                $input.val("off");
                $(".full_settings_bar_block").addClass("hidden")
            }

        });

        if (device.mobile()) {
            $("#modal_global_settings").find(".modal-body").addClass("padding-left-right-0");
            $("#modal_global_settings").find(".settings-left").addClass("padding-left-right-0");

        }

    })
    </script>
    <script>
    $(document).ready(function() {
        change_bg();
        if (device.mobile() || device.tablet()) {
            $(".screens_nmb_card").addClass("hidden")
        }
    });


    function create_screen(screen_parameters) {
        num_screen = screen_parameters.screen_id;
        if (!GLOBAL_STATE[num_screen]) {
            GLOBAL_STATE[num_screen] = {
                "player_name": $("#trans_player").val() + num_screen,
                "num_summand": 3,
                "num_color": num_screen,
                "num_example": 0,
                'show_numbers': true,
                'voice_numbers': true,
                'voice_results': true,
                'show_results': true,
                "points": 0,
                "diff_points": 0,
                "correct": 0,
                "done": 0,
                "real_done": 0,
                "timer": 0,
                "additional_timer": 0,
                "status": "stopped",
                "correct_percent": 0,
                "done_percent": 0,
                "progress_key": 0,
                "progress_digits_nmb_key": 0,
                "progress_variant": "interval",
                "student_answer": "",
                "is_answer_entered": false,
                "correct_answer": 0,
                "entered_answer": "",
                "example": [],
                "answer": undefined,
                "parameters": get_parameters(),
                "example_text": ""
            };
        } else {
            clearInterval(GLOBAL_STATE[num_screen].timer)
            clearInterval(GLOBAL_STATE.timer)
        }
        screen_state = GLOBAL_STATE[num_screen];
        var left_hero_index = random_between(1, 5);
        var right_hero_index = random_between(1, 5);
        return '<div  class="screen container-fluid card text-center padding-left-right-0 padding-top-bottom-0 4bg_' + screen_parameters.screen_id + ' ' + screen_parameters.screen_class + ' " id="' + screen_parameters.screen_id + '" style="border: 1px dotted grey; background-color:inherit">\
            <input type="hidden" class="block_type" value="main_block"/>\
            <form class="padding-left-right-0" style="margin:0;" >\
            <div class="bg_color bg_color_' + screen_parameters.screen_id + '" style="min-height: 650px; height:100vh; width:100%; position:absolute; "></div>\
            <input type="hidden" class="active_block" value="choice_block">\
            \
            <div class="card-body padding-top-bottom-1vh row justify-content-center align-items-center" style="height: ' + screen_parameters.screen_height + '; padding:0; ">\
            <div class="row justify-content-center col-12">\
            <div data-block_type="main_block" class="block col row align-items-center justify-content-center col-12" >\
            <div class="col left_hero left_hero_' + left_hero_index + '" style=" height: ' + screen_parameters.screen_height + '; "></div>\
            <div class="col btn-group-vertical btn_group_main">\
            <a href="#" class="btn_start btn btn-lg btn-nrm btn-success margin-bottom-5" ><img src="img/btn--arrow.png" alt="" /> Старт</a>\
            <a href="#" class="btn_continue hidden btn btn-lg btn-nrm btn-success margin-bottom-5" ><img src="img/btn--arrow.png" alt="" /> Продолжить</a>\
            <a href="#" class="btn_next hidden btn btn-lg btn-nrm btn-success margin-bottom-5" ><img src="img/btn--arrow.png" alt="" /> </i>  Следующие</a>\
            <a href="#" class="btn_stop hidden btn btn-lg btn-nrm btn-danger margin-bottom-5" ><i class="fa fa-stop"> </i>  Стоп</a>\
            <a href="#" class="btn_restart hidden btn btn-lg btn-nrm btn-secondary margin-bottom-5" ><img src="img/btn--again.png" alt="" />  Заново</a>\
            <a href="#" class="btn_show_example show_block hidden btn btn-lg btn-nrm btn-purple margin-bottom-5" data-block_type="problem_show_block"><i class="fa fa-eye"> </i>  Задание</a>\
            </div>\
            <div class="col right_hero right_hero_' + right_hero_index + '" style=" height: ' + screen_parameters.screen_height + ';"></div>\
            </div>\
            <input data-block_type="countdown_block" type="text" class="block col hidden text-center color" readonly \
            style="background-color: inherit; border: none; width:100%; height: ' + screen_parameters.countdown_block_height + '; font-size: ' + screen_parameters.countdown_block_fontsize + '" value="">\
            <div data-block_type="problem_block" class="block col hidden row align-items-center justify-content-center">\
            <input class="text-center col-12 w-100 fonted"  type="text" readonly tabindex="-1" value="" \
            style="color: black; background-color: inherit; border: none; width:100%; max-height: 300px; height: ' + screen_parameters.problem_block_height + ' ; font-size: ' + screen_parameters.problem_block_fontsize + '; ">\
            <div class="row justify-content-center"> \
            <button tabindex="-1" type="button" class="btn_pause show_block btn btn-lg btn-nrm btn-success " data-block_type="main_block"> Пауза <img src="img/btn--pause.png" alt="" /></button> \
            </div>\
            </div>\
            <div data-block_type="answer_input_block" class="block col hidden row align-items-center justify-content-center" >\
            <p>Твой ответ</p>\
            <input type="number" class="form-control fonted text-center border-info answer_input" \
            style="width:90%; height: ' + screen_parameters.answer_input_block_height + '; font-size: 24px !important;">\
            <div class="row justify-content-center" style="margin-top:10px"> \
            <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"><i class="fa fa-bars"></i> Меню</button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-info btn_check_answer"><i class="fa fa-question"></i> Отправить</button> \
            </div>\
            </div>\
            <div data-block_type="answer_comment_block" class="block col hidden row align-items-center justify-content-center ">\
            <div class="row col-12 align-items-center justify-content-center" style="width:90%;  height: 30vh; font-size:' + screen_parameters.answer_comment_block_fontsize + '"> \
            <span class="col-12 answer_check_text  text-center">  </span>  \
            <div class="col-12 hidden false_answer_image false_answer_image_' + screen_parameters.screen_id + ' " style=" width: 100%; height: ' + screen_parameters.comment_image_height + ';"></div>\
            <span class="answer_comment_text text-center col-12">  </span>  \
            </div>\
            <div class="row"> \
            <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"><i class="fa fa-bars"></i> Меню</button> \
            <button tabindex="-1" type="button" class="btn_show_example d-none show_block btn btn-lg btn-nrm btn-purple" data-block_type="problem_show_block"><i class="fa fa-eye"></i> Задание</button> \
            <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_show_result hidden"><i class="fa fa-thumbs-up"></i> Результат</button> \
            <button tabindex="-1" type="button" class="btn btn-lg d-none btn-warning text-dark btn-nrm btn-success hidden btn_reexample"><i class="fa fa-refresh"></i></button> \
            <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_next"><i class="fa fa-forward"></i> Следующий</button> \
            </div>\
            </div>\
            <div data-block_type="problem_show_block" class="block col hidden row align-items-center justify-content-center">\
            <textarea  type="text" class="form-control text-center border-info problem_show" readonly  \
            style="resize: none; width:100%; height: 30vh; font-size: 5vh;"></textarea>\
            <div class="row justify-content-center">\
            <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"><i class="fa fa-bars"></i> Меню</button>\
            <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_show_result hidden"><i class="fa fa-thumbs-up"></i> Результат</button> \
            <button tabindex="-1" type="button" class="btn btn-lg btn-nrm btn-success btn_next"><i class="fa fa-forward"></i> Следующий</button> \
            </div>\
            </div>\
            <div data-block_type="settings_block" class="block col row justify-content-center hidden ' + screen_parameters.settings_block_class + '" >\
            <div class="left_hero ' + screen_parameters.setting_heroes_class + ' left_hero_' + left_hero_index + '" style=" height: ' + screen_parameters.screen_height + '; "></div>\
            <div class="row col justify-content-center align-self-center padding-left-right-0">\
            <div class="col padding-left-right-0">\
            <div class="row justify-content-center">\
            <blockquote class="card-blockquote col-12 align-self-center" style="margin-bottom:3px">\
            <div class="btn-group" role="group">\
            <button type="button" class="btn-nrm btn btn-lg btn-purple show_block" data-block_type="main_block"><i class="fa fa-bars"></i></button>\
            <div class="btn-group" role="group">\
            <button  type="button" class="btn btn-nrm btn-info dropdown-toggle modules_display" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width:190px">Прямой счет</button>\
            <div class="dropdown-menu">\
            <input type="hidden" name="modules" value="simple"/>\
            <a class="dropdown-item modules module_simple_title bg-info" href="#" data-value="simple">' + $("#trans_simple").val() + '</a>\
            <a class="dropdown-item modules module_brother_title" href="#" data-value="brother"  data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Формулы 5-ки" data-content="+1 = +5 - 4 &emsp; &emsp; &emsp; -1 = -5 + 4  <br> +2 = +5 - 3 &emsp; &emsp; &emsp; -2 = -5 + 3<br> +3 = +5 - 2 &emsp; &emsp; &emsp; -3 = -5 + 2 <br> +4 = +5 - 1 &emsp; &emsp; &emsp; -4 = -5 + 1">' + $("#trans_brother").val() + '</a>\
            <a class="dropdown-item modules module_friend_title" href="#" data-value="friend,brother"  data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Формулы 10-ки" data-content="+1 = +10 - 9 &emsp; &emsp; &emsp; -1 = -10 + 9  <br>  +2 = +10 - 8 &emsp; &emsp; &emsp; -2 = -10 + 8 <br> +3 = +10 - 7 &emsp; &emsp; &emsp; -3 = -10 + 7 <br> +4 = +10 - 6 &emsp; &emsp; &emsp; -4 = -10 + 6<br> +5 = +10 - 5 &emsp; &emsp; &emsp; -5 = -10 + 5<br> +6 = +10 - 4 &emsp; &emsp; &emsp; -6 = -10 + 4<br> +7 = +10 - 3 &emsp; &emsp; &emsp; -7 = -10 + 3<br> +8 = +10 - 2 &emsp; &emsp; &emsp; -8 = -10 + 2<br> +9 = +10 - 1 &emsp; &emsp; &emsp; -9 = -10 + 1">' + $("#trans_friend").val() + '</a>\
            <a class="dropdown-item modules module_combo_title" href="#" data-value="combo" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Формулы комбинированного счета 10-ки и 5-ки" data-content=" <p> +6 = +11 - 5 &emsp; &emsp; &emsp; -6 = -11 + 5  <br> +6 = +10 - 5 + 1 &emsp; &emsp; -6 = -10 + 5 - 1</p> <p> +7 = +12 - 5 &emsp; &emsp; &emsp; -7 = -12 + 5<br> +7 = +10 - 5 + 2  &emsp; &emsp; -7 = -10 + 5 - 2</p> <p> +8 = +13 - 5 &emsp; &emsp; &emsp; -8 = -13 + 5 <br> +8 = +10 - 5 + 3 &emsp; &emsp; -8 = -10 + 5 -3 </p> <p> +9 = +14 - 5 &emsp; &emsp; &emsp; -9 = -14 + 5 <br> +9 = +10 - 5 + 4 &emsp; &emsp; -9 = -10 + 5 - 4">' + $("#trans_combo").val() + '</a>\
            <a class="dropdown-item modules module_random_title" href="#" data-value="random" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" data-content="Генерируются случайные числа. <br>  В настройках ниже можно включить генерацию и отрицательных чисел: Кнопка ЗНАК">' + $("#trans_random").val() + '</a>\
            </div>\
            <a href="#" class="btn_start btn btn-lg btn-nrm btn-success" ><i class="fa fa-play"> </i></a>\
            </div>\
            </div>\
            </blockquote>\
            <div class="btn-group ' + screen_parameters.btn_group_class + ' btn-group-juestified col-12 row align-items-center justify-content-center" data-toggle="buttons" style="margin-bottom:3px">\
            <label class="btn btn-nrm btn-outline-info checked_digits active hidden"><input  name="checked_digits" value="1" type="checkbox" checked> 1 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active hidden"><input  name="checked_digits" value="2" type="checkbox" checked> 2 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active hidden"><input   name="checked_digits" value="3" type="checkbox" checked> 3 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active hidden"><input  name="checked_digits" value="4" type="checkbox" checked> 4 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active "><input   name="checked_digits" value="5" type="checkbox" checked> 5 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active "><input   name="checked_digits" value="6" type="checkbox" checked> 6 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active "><input   name="checked_digits" value="7" type="checkbox" checked> 7 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active "><input   name="checked_digits" value="8" type="checkbox" checked> 8 </label>\
            <label class="btn btn-nrm btn-outline-info checked_digits active "><input   name="checked_digits" value="9" type="checkbox" checked> 9 </label>\
            <label class="btn btn-nrm btn-lg btn-outline-info active check_all"><input type="hidden" value="1"> <i class="fa fa-check"></i></label>\
            </div>\
            <div class="col-10 padding-left-right-0">\
            <div class="btn-group btn-group-juestified ' + screen_parameters.btn_group_class + ' ">\
            <div class="btn-group" role="group">\
            <button  type="button" class="btn btn-nrm btn-success dropdown-toggle operation_display" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Слож-е/Выч-е</button>\
            <input type="hidden" name="operation" value="plus_minus">\
            <div class="dropdown-menu">\
            <a class="dropdown-item operation" data-value="plus" href="#">Сложение</a>\
            <a class="dropdown-item operation" data-value="minus" href="#">Вычитание</a>\
            <a class="dropdown-item operation bg-success" data-value="plus_minus" href="#">Сложение/Вычитание</a>\
            </div>\
            </div>\
            <div class="btn-group" role="group">\
            <button  type="button" class="decimal_display btn btn-nrm btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Дробь</button>\
            <input type="hidden" name="decimal" value="off">\
            <div class="dropdown-menu dropdown-menu-right">\
            <a class="dropdown-item decimal text-danger  bg-success" data-value="off" href="#">Выключить</a>\
            <a class="dropdown-item decimal" data-value="1_digit" href="#">1 знак после запятой</a>\
            <a class="dropdown-item decimal" data-value="2_digit" href="#">2 знака после запятой</a>\
            </div>\
            </div>\
            <div class="btn-group " role="group">\
            <button  type="button" class="btn btn-nrm btn-success sign_display btn_dropdown_sign disabled dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Знак</button>\
            <input type="hidden" name="sign" value="off">\
            <div class="dropdown-menu dropdown-menu-right">\
            <a class="dropdown-item sign text-danger bg-success" data-value="off" href="#">Исключить отрицательные числа</a>\
            <a class="dropdown-item sign" data-value="on" href="#">Включить отрицательные числа</a>\
            <a class="dropdown-item sign" data-value="training" href="#">Тренировка отрицательных чисел</a>\
            </div>\
            </div>\
            <input type="hidden" name="is_alternation" value="off">\
            <button type="button" class="btn btn-nrm btn-success is_alternation" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Режим чередования" data-content="При генерации примеров чередоваться слагаемые с количеством цифр меньше на 1 (например 34 + 3 + 98 + 2)">1/2 </button>\
            </div>\
            </div>\
            </div>\
            <div class="btn-group2">\
            <div class="btn-group inc-dec-control">\
            <label class="btn btn-nrm btn-success change_value_to_default" data-value_type="digits_nmb" data-value="1">Цифр: </label>\
            <label class="btn btn-nrm btn-success input_decrease"> < </label>\
            <label class="btn btn-nrm btn-success p-0">\
            <input type="number" name="digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="1" min="1" max="12" step="1"  data-decimal="0">\
            </label>\
            <label class="btn btn-nrm btn-success input_increase"> > </label>\
            </div>\
            <div class="btn-group inc-dec-control">\
            <label class="btn btn-nrm btn-success pr-0  change_value_to_default" data-value_type="progress_digits_nmb" data-value="0">Прогресс: </label>\
            <label class="btn btn-nrm btn-success input_decrease"> < </label>\
            <label class="btn btn-nrm btn-success p-0">\
            <input type="number" name="progress_digits_nmb" class="form-control input-nrm text-center border-success bg-light-success input_number" value="0" min="0" max="5" step="1"  data-decimal="0">\
            </label>\
            <label class="btn btn-nrm btn-success input_increase"> > </label>\
            </div>\
            </div>\
            <div class="btn-group2">\
            <div class="btn-group inc-dec-control">\
            <label class="btn btn-nrm btn-info change_value_to_default" data-value_type="actions_nmb" data-value="5">Действий: </label>\
            <label class="btn btn-nrm btn-info input_decrease"> < </label>\
            <label class="btn btn-nrm btn-info p-0">\
            <input type="number" name="actions_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="5" min="1" max="300" step="1"  data-decimal="0">\
            </label>\
            <label class="btn btn-info btn-nrm input_increase"> > </label>\
            </div>\
            <div class="btn-group inc-dec-control">\
            <label class="btn btn-nrm btn-info pr-0  change_value_to_default" data-value_type="progress_actions_nmb" data-value="0">Прогресс: </label>\
            <label class="btn btn-nrm btn-info input_decrease"> < </label>\
            <label class="btn btn-nrm btn-info p-0">\
            <input type="number" name="progress_actions_nmb" class="form-control input-nrm text-center border-info bg-light-info input_number" value="0" min="0" max="5" step="1"  data-decimal="0">\
            </label>\
            <label class="btn btn-nrm btn-info input_increase"> > </label>\
            </div>\
            </div>\
            <div class="btn-group2">\
            <div class="btn-group inc-dec-control">\
            <label class="btn btn-nrm btn-danger change_value_to_default" data-value_type="interval" data-value="1">Интервал: </label>\
            <label class="btn btn-nrm btn-danger input_decrease"> < </label>\
            <label class="btn btn-nrm btn-danger p-0">\
            <input type="number" name="interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="1" min="0.1" max="10" step="0.1"  data-decimal="1">\
            </label>\
            <label class="btn btn-danger btn-nrm input_increase"> > </label>\
            </div>\
            <div class="btn-group inc-dec-control">\
            <label class="btn btn-nrm btn-danger pr-0 change_value_to_default" data-value_type="progress_interval" data-value="0">Про: </label>\
            <label class="btn btn-nrm btn-danger input_decrease"> < </label>\
            <label class="btn btn-nrm btn-danger p-0">\
            <input type="number" name="progress_interval" class="form-control input-nrm text-center border-danger bg-light-danger input_number" value="0" min="0" max="5" step="1"  data-decimal="0">\
            </label>\
            <label class="btn btn-nrm  btn-danger input_increase"> > </label>\
            </div>\
            </div>\
            <div class="btn-group  " >\
            <div class="btn-group dropup" role="group">\
            <button  type="button" class="btn btn-nrm btn-outline-warning dropdown-toggle btn_dropdown_50 mode_50_display disabled active"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">✓ 50+</button>\
            <input type="hidden" name="mode_50" value="on">\
            <div class="dropdown-menu">\
            <a class="dropdown-item mode_50 text-danger" data-value="off" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Режим выключенного перехода через 50" data-content="При генерации примеров будут ИСКЛЮЧЕНЫ переходы через 50 (типа 49+4)">Выключить 50+</a>\
            <a class="dropdown-item mode_50 bg-warning" data-value="on" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим включенного перехода через 50" data-content="При генерации примеров БУДУТ примеры на переходы через 50 (типа 49+4)">Включить 50+</a>\
            <a class="dropdown-item mode_50" href="#" data-value="training" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим тренировки перехода через 50" data-content="Генерация примеров на переходы через 50 (типа 49+4)">Тренировка 50+</a>\
            </div>\
            </div>\
            <div class="btn-group dropup" role="group">\
            <button  type="button" class="btn btn-nrm btn-outline-warning dropdown-toggle btn_dropdown_100 mode_100_display disabled active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">✓ 100+</button>\
            <input type="hidden" name="mode_100" value="on">\
            <div class="dropdown-menu dropdown-menu-right">\
            <a class="dropdown-item mode_100 text-danger" data-value="off" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Режим выключенного перехода через 100" data-content="При генерации примеров будут ИСКЛЮЧЕНЫ переходы через 100 (типа 99+4)">Выключить 100+</a>\
            <a class="dropdown-item mode_100 bg-warning" data-value="on" href="#" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим включенного перехода через 100" data-content="При генерации примеров БУДУТ переходы через 100 (типа 99+4)">Включить 100+</a>\
            <a class="dropdown-item mode_100" href="#" data-value="training" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Режим тренировки перехода через 100" data-content="Генерация примеров на переходы через 100 (типа 99+4)">Тренировка 100+</a>\
            </div>\
            </div>\
            <button type="button" class="btn btn-nrm btn-outline-warning all_discharge disabled active" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Формулы на все разряды" data-content="При генерации примеров формулы не распространяются на старший разряд">  <input type="hidden" name="all_discharge" value="on">Все </button>\
            <button type="button" class="btn btn-nrm btn-outline-warning discharge_mode btn_discharge_mode_mirror"   data-value="mirror" data-container="body" data-toggle="popover" data-trigger="hover" data-placement="right" title="Зеркальные числа" data-content="При включенном режиме будут генерироваться примеры с одинаковыми цифрами, типа: 444 + 333 - 222"> <input type="hidden" name="discharge_mode" value="all">Зер </button>\
            <div class="btn-group dropup noclose" role="group">\
            <button  type="button" class="btn btn-sm btn-warning dropdown-toggle btn_dropdown_additional" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="additional_display"> Доп </span></button>\
            <div class="dropdown-menu min-width-5rem">\
            <a class="dropdown-item bg-warning discharge_mode" data-value="all" href="#" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" title="Распространение формул" data-content="При ВКЛЮЧЕННОМ режиме ВСЕ формулы брата, друга, комбо на разряды распространяются на все разряды, <br> <br> при ВЫКЛЮЧЕННОМ режиме формулы НЕ распространяются на старший разряд">Все разряды</a>\
            <a class="dropdown-item discharge_mode" href="#" data-value="1" data-container="body">1-й разряд</a>\
            <a class="dropdown-item discharge_mode" href="#" data-value="2" data-container="body">2-й разряд</a>\
            <a class="dropdown-item discharge_mode" href="#" data-value="3" data-container="body">3-й разряд</a>\
            <a class="dropdown-item discharge_mode" href="#" data-value="4" data-container="body">4-й разряд</a>\
            </div>\
            </div>\
            </div>\
            </div>\
            </div>\
            <div class="right_hero ' + screen_parameters.setting_heroes_class + ' right_hero_' + right_hero_index + '" style=" height: ' + screen_parameters.screen_height + '; "></div>\
            </div>\
            </div>\
            </div>\
            </form>\
            </div>'
    }

    function create_screen_row(screen_parameters) {
        $screen_row = "";
        for (var i = screen_parameters.screen_id_start; i <= screen_parameters.screen_id_end; i++) {
            screen_parameters["screen_id"] = i;
            $screen = create_screen(screen_parameters);
            $screen_row += $screen;
        }
        $screen_row = '<div class="row">' + $screen_row + '</div>';
        return $screen_row;
    }

    function create_keyboards(screens_nmb) {
        if (screens_nmb <= 3) {
            switch (screens_nmb) {
                case 1:
                    btn_keyboard_group_class = "btn-keyboard-group-lg";
                    hero_class = "col";
                    answer_input_fontsize = "8vw";
                    answer_input_height = "20vh";
                    break;
                case 2:
                    btn_keyboard_group_class = "btn-keyboard-group-lg";
                    hero_class = "col-5  d-none";
                    answer_input_fontsize = "5vw";
                    answer_input_height = "18vh";
                    break;
                case 3:
                    btn_keyboard_group_class = "btn-keyboard-group-md";
                    hero_class = "col-4 d-none";
                    answer_input_fontsize = "4vw";
                    answer_input_height = "15vh";
                    break;
            }

            if (device.mobile()) {
                btn_keyboard_group_class = "btn-keyboard-group-xs";
                answer_input_height = "10vh";
                answer_input_fontsize = "5vh"
            } else if (device.tablet()) {
                if (device.landscape()) {
                    btn_keyboard_group_class = " btn-keyboard-tablet-landscape";
                } else {
                    btn_keyboard_group_class = " btn-keyboard-tablet-portrait";
                }

                keyboard_block_class = "col-md-6 col-lg-6";
            }


            for (var i = 1; i <= screens_nmb; i++) {

                var left_hero_index = random_between(1, 5);
                $$answer_input_block_with_keyboard =
                    '\
                    <div class="calculation__wrap keyboard row justify-content-center">\
                        <p class="d-none d-md-block calculation__title">Твой ответ</p>\
                        <div class="calculation__wrap-input ">\
                            <input type="text" class="calculation__input form-control text-center border-info answer_input">\
                        </div>\
                    </div>\
                    <div class="keyboard row justify-content-center calculation__wrap-btn">\
                    <div class="col-sm-12">\
                    <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="1">1</button>\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="2">2</button>\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="3">3</button>\
                    </div>\
                    <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="4">4</button>\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="5">5</button>\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="6">6</button>\
                    </div>\
                    <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="7">7</button>\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="8">8</button>\
                    <button tabindex="-1" type="button" class="btn  btn-secondary btn-keyboard" data-value="9">9</button>\
                    </div>\
                    <div class="col-sm-12 ' + btn_keyboard_group_class + '">\
                    <button tabindex="-1" type="button" class="btn btn-lg btn-success btn-keyboard btn_start btn--calculation">OK</button>\
                    <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard" data-value="0">0</button>\
                    <button tabindex="-1" type="button" class="btn btn-secondary btn-keyboard btn--calculation" data-value="minus"><i class="fa fa-minus"></i></button>\
                    </div>\
                    </div>\
                    <div class="row col-sm-12 justify-content-center">\
                    <button tabindex="-1" type="button" class="show_block btn btn-lg btn-nrm btn-purple" data-block_type="main_block"> Меню</button>\
                    <button tabindex="-1" type="button" class="btn  btn-nrm btn-lg btn-info btn_check_answer">Результат</button>\
                    </div>\
                    ';


                $("#" + i).find(".block[data-block_type='answer_input_block']").html($$answer_input_block_with_keyboard)
            }
        }

    }

    function create_screens(screens_nmb) {
        if (screens_nmb > 1 && exist_in_array("disorder", GLOBAL_STATE.modes)) {
            change_mode("disorder")
        }
        GLOBAL_STATE["screens_nmb"] = screens_nmb;
        clearInterval(GLOBAL_STATE.timer);
        $(".screens_nmb").html(screens_nmb);
        $(".players_nmb").html(screens_nmb);
        $main_screen = $("#main_screen");
        $main_screen.html("");
        switch (screens_nmb) {
            case 1:
                screen_parameters = {
                    screen_class: "",
                    screen_height: "80vh",

                    countdown_block_height: "80vh",
                    countdown_block_fontsize: "10vw",

                    problem_block_height: "73vh",
                    problem_block_fontsize: "10vh",

                    answer_input_block_height: "50vh",
                    answer_input_block_fontsize: "10vh",

                    answer_comment_block_height: "73vh",
                    answer_comment_block_fontsize: "4vw",

                    comment_image_height: "50vh",

                    problem_show_block_height: "65vh",
                    problem_show_block_fontsize: "4vw",

                    settings_block_class: "col",
                    setting_heroes_class: "col",

                    btn_group_class: "btn-group-lg",
                    input_class: "input-lg",
                    screen_id_start: 1,
                    screen_id_end: 1,
                    slider_class: "col-8"
                };

                if (device.mobile()) {

                    screen_parameters = {
                        screen_class: "",
                        screen_height: "66.5vh",

                        countdown_block_height: "66.5vh",
                        countdown_block_fontsize: "10vw",

                        problem_block_height: "60vh",
                        problem_block_fontsize: "10vh",

                        answer_input_block_height: "50vh",
                        answer_input_block_fontsize: "10vh",

                        answer_comment_block_height: "60vh",
                        answer_comment_block_fontsize: "4vw",

                        comment_image_height: "50vh",

                        problem_show_block_height: "60vh",
                        problem_show_block_fontsize: "7vw",

                        settings_block_class: "pr-0 pl-0",
                        setting_heroes_class: "",

                        btn_group_class: "",
                        input_class: "input-lg",
                        screen_id_start: 1,
                        screen_id_end: 1,
                        slider_class: "col-8"
                    };
                }
                if (device.tablet()) {
                    screen_parameters = {
                        screen_class: "",
                        screen_height: "80vh",

                        countdown_block_height: "80vh",
                        countdown_block_fontsize: "16vw",

                        problem_block_height: "73vh",
                        problem_block_fontsize: "20vh",

                        answer_input_block_height: "50vh",
                        answer_input_block_fontsize: "20vh",

                        answer_comment_block_height: "73vh",
                        answer_comment_block_fontsize: "4vw",

                        comment_image_height: "50vh",

                        problem_show_block_height: "73vh",
                        problem_show_block_fontsize: "7vw",

                        settings_block_class: "col",
                        setting_heroes_class: "col",

                        btn_group_class: "btn-group-lg",
                        input_class: "input-lg",
                        screen_id_start: 1,
                        screen_id_end: 1,
                        slider_class: "col-8"
                    };
                }

                $screen_row = create_screen_row(screen_parameters);
                $main_screen.append($screen_row);
                break;
            case 2:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "80vh",

                    countdown_block_height: "80vh",
                    countdown_block_fontsize: "8vw",

                    problem_block_height: "73vh",
                    problem_block_fontsize: "20vw",

                    answer_input_block_height: "50vh",
                    answer_input_block_fontsize: "20vw",

                    answer_comment_block_height: "73vh",
                    answer_comment_block_fontsize: "3vw",

                    comment_image_height: "40vh",

                    problem_show_block_height: "73vh",
                    problem_show_block_fontsize: "5vw",

                    settings_block_class: "col",
                    setting_heroes_class: "col-3",

                    btn_group_class: "btn-group-lg",
                    input_class: "input-lg",
                    screen_id_start: 1,
                    screen_id_end: 2,
                    slider_class: "col-8",
                };
                $screen_row = create_screen_row(screen_parameters);
                $main_screen.append($screen_row);
                break;
            case 3:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "80vh",

                    countdown_block_height: "80vh",
                    countdown_block_fontsize: "6vw",

                    problem_block_height: "73vh",
                    problem_block_fontsize: "15vw",

                    answer_input_block_height: "50vh",
                    answer_input_block_fontsize: "15vw",

                    comment_image_height: "40vh",

                    answer_comment_block_height: "73vh",
                    answer_comment_block_fontsize: "2.5vw",

                    problem_show_block_height: "73vh",
                    problem_show_block_fontsize: "4vw",

                    settings_block_class: "col",
                    setting_heroes_class: "col-2",

                    btn_group_class: "btn-group-lg",
                    input_class: "input-lg",
                    screen_id_start: 1,
                    screen_id_end: 3,
                    slider_class: "col-8",
                };
                $screen_row = create_screen_row(screen_parameters);
                $main_screen.append($screen_row);
                break;
            case 4:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "10vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "15vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "4vw",


                    settings_block_class: "col",
                    setting_heroes_class: "col-3",

                    btn_group_class: "",
                    input_class: "input-md",
                    screen_id_start: 1,
                    screen_id_end: 2,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters.screen_id_start = 3;
                screen_parameters.screen_id_end = 4;
                $screen_row_2 = create_screen_row(screen_parameters);
                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
            case 5:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "8vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "13vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.5vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "3vw",

                    settings_block_class: "col",
                    setting_heroes_class: "col-2",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 1,
                    screen_id_end: 3,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "8vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "15vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "3vw",


                    settings_block_class: "col",
                    setting_heroes_class: "col-3",

                    btn_group_class: "",
                    input_class: "input-md",
                    screen_id_start: 4,
                    screen_id_end: 5,
                    slider_class: "col-8",
                };
                $screen_row_2 = create_screen_row(screen_parameters);
                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
            case 6:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "34vh",
                    countdown_block_fontsize: "8vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "13vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.5vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "3vw",


                    settings_block_class: "col",
                    setting_heroes_class: "col-2",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 1,
                    screen_id_end: 3,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters.screen_id_start = 4;
                screen_parameters.screen_id_end = 6;
                $screen_row_2 = create_screen_row(screen_parameters);
                $screen_row_2 = create_screen_row(screen_parameters);
                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
            case 7:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "5vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "10vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "3vw",


                    settings_block_class: "col",
                    setting_heroes_class: "col-1",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 1,
                    screen_id_end: 4,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "5vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "10vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.5vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "3vw",


                    settings_block_class: "col",
                    setting_heroes_class: "col-2",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 5,
                    screen_id_end: 7,
                    slider_class: "col-8",
                };
                $screen_row_2 = create_screen_row(screen_parameters);

                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
            case 8:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "5vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "10vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "12vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "3vw",

                    settings_block_class: "col",
                    setting_heroes_class: "col-1",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 1,
                    screen_id_end: 4,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters.screen_id_start = 5;
                screen_parameters.screen_id_end = 8;
                $screen_row_2 = create_screen_row(screen_parameters);
                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
            case 9:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "4vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "8vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "10vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "2.5vw",

                    settings_block_class: "padding-left-right-0",
                    setting_heroes_class: "hidden",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 1,
                    screen_id_end: 5,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "4vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "8vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "10vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "2.5vw",


                    settings_block_class: "padding-left-right-0",
                    setting_heroes_class: "hidden",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 6,
                    screen_id_end: 9,
                    slider_class: "col-8",
                };
                $screen_row_2 = create_screen_row(screen_parameters);

                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
            case 10:
                screen_parameters = {
                    screen_class: "col",
                    screen_height: "38.8vh",

                    countdown_block_height: "38.8vh",
                    countdown_block_fontsize: "4vw",

                    problem_block_height: "34vh",
                    problem_block_fontsize: "8vw",

                    answer_input_block_height: "15vh",
                    answer_input_block_fontsize: "10vh",

                    answer_comment_block_height: "34vh",
                    answer_comment_block_fontsize: "1.2vw",

                    comment_image_height: "22vh",

                    problem_show_block_height: "34vh",
                    problem_show_block_fontsize: "2.5vw",


                    settings_block_class: "padding-left-right-0",
                    setting_heroes_class: "hidden",

                    btn_group_class: "btn-group-sm",
                    input_class: "input-sm",
                    screen_id_start: 1,
                    screen_id_end: 5,
                    slider_class: "col-8",
                };
                $screen_row_1 = create_screen_row(screen_parameters);
                screen_parameters.screen_id_start = 6;
                screen_parameters.screen_id_end = 10;
                $screen_row_2 = create_screen_row(screen_parameters);
                $screen_rows = $screen_row_1 + $screen_row_2;
                $main_screen.append($screen_rows);
                break;
        }
        if (parseInt(screens_nmb) === 1) {
            $(".btn-group-local_control")
                .removeClass("should-be-shown invisible btn-group-local_control")
                .addClass("btn-group-local_control2");
            $(".player_name_points").addClass("invisible")
        } else {
            $(".btn-group-local_control2").addClass("btn-group-local_control should-be-shown invisible");
            $(".player_name_points").removeClass("invisible");
        }



        $(document).ready(function() {
            for (var i = 1; i <= screens_nmb; i++) {
                if (GLOBAL_STATE[i]) {
                    set_setting_bars(GLOBAL_STATE[i], i);
                } else {
                    screen_state = {
                        "parameters": get_parameters(),
                        "progress_key": 0,
                        "progress_digits_nmb_key": 0,
                    };
                    set_setting_bars(screen_state, i)
                }
                stop_example(i);
            }
            create_keyboards(screens_nmb);
            if (exist_in_array("disorder", GLOBAL_STATE.modes)) {
                create_screens_for_disorder_mode();
            }
            if (parseInt(screens_nmb) >= 3 || device.mobile()) {
                $(".btn-nrm").removeClass("btn-lg").addClass("btn-sm");
                $(".input-nrm").addClass("input-sm")
            }
            if (device.mobile()) {
                $(".btn-nrm").removeClass("btn-lg").addClass("btn-sm");
                $(".input-nrm").addClass("input-sm")
            }
            if (!is_olymp_task() || !is_task_mode()) {
                $(".btn_show_example").removeClass("d-none")
            }
            GLOBAL_STATE.status = "stopped";
        })


    }

    function create_screens_for_disorder_mode() {
        problem_block = '<div data-block_type="problem_block" class="block hidden col row align-items-center justify-content-center">\
            <input class="text-center col-12 w-100"  type="text" readonly tabindex="-1" value="" \
            style="color: black; background-color: inherit; border: none; width:100%; height: ' + screen_parameters.problem_block_height + ' ; font-size: ' + screen_parameters.problem_block_fontsize + ';">\
            <div class="row justify-content-center"> \
            <button tabindex="-1" type="button" class="btn_pause show_block btn btn-lg btn-nrm btn-success " data-block_type="main_block"><i class="fa fa-pause"></i> Пауза</button> \
            </div>\
            </div>';
        $$disorder_rows = "";
        var k = 0;
        for (var j = 1; j <= 2; j++) {
            $$disorder_inputs = "";
            for (var i = 1; i <= 5; i++) {
                k++;
                $$disorder_input = '<input class="col-2 text-center disorder_screen" data-screen_number="' + k.toString() + '" type="text" readonly tabindex="-1" style="background-color: inherit; border: none; height:34vh; font-size: 10vw;"/>'
                $$disorder_inputs += $$disorder_input;
            }
            $$disorder_row = '<div class="row">' + $$disorder_inputs + '</div>';
            $$disorder_rows += $$disorder_row;
        }
        $$disorder_block = $$disorder_rows;
        $(document).find(".block[data-block_type='problem_block']").html($$disorder_block)

    }
    </script>
    <script>
    function change_mode(mode_type) {
        $all_modes = $(".mode");
        $default_mode = $(".mode[data-mode_type='default']");
        $default_mode.find(".activity").html("");
        $default_mode.find("input").val("off");
        $this = $("#navbar").find(".mode[data-mode_type='" + mode_type + "']");
        value = $this.find("input").val();
        $$check_symbol = "<i class='fa fa-check'></i>";
        switch (mode_type) {
            case "default":
                $all_modes.find(".activity").html("");
                $all_modes.find("input").val("off");
                $this.find("input").val("on");
                $this.find(".activity").html($$check_symbol);
                GLOBAL_STATE.modes = ["default"];
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    GLOBAL_STATE[i].parameters.sign = "off";
                    GLOBAL_STATE[i].parameters.decimal = "off";
                    GLOBAL_STATE[i].parameters.mode_50 = "on";
                    GLOBAL_STATE[i].parameters.mode_100 = "on";
                }
                create_screens(GLOBAL_STATE.screens_nmb);
                set_setting_bars(GLOBAL_STATE[1], 1, "global");
                break;
            case "disorder":
                if (value === "off") {
                    $(".mode[data-mode_type='3_screens']").find(".activity").html("");
                    $(".mode[data-mode_type='3_screens']").find("input").val("off");

                    $(".mode[data-mode_type='2_screens']").find(".activity").html("");
                    $(".mode[data-mode_type='2_screens']").find("input").val("off");

                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("2_screens", GLOBAL_STATE.modes);
                        exclude_el_from_array("3_screens", GLOBAL_STATE.modes);
                        include_el_to_array("disorder", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["disorder"];
                    }
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("disorder", GLOBAL_STATE.modes);
                    }
                }
                create_screens(1);
                break;
            case "negative":
                if (value === "off") {
                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        include_el_to_array("negative", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["negative"];
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "random";
                        GLOBAL_STATE[i].parameters.sign = "training";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")

                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("negative", GLOBAL_STATE.modes);
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "random";
                        GLOBAL_STATE[i].parameters.sign = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                }

                break;
            case "2_screens":
                if (value === "off") {
                    $(".mode[data-mode_type='3_screens']").find(".activity").html("");
                    $(".mode[data-mode_type='3_screens']").find("input").val("off");
                    $(".mode[data-mode_type='disorder']").find(".activity").html("");
                    $(".mode[data-mode_type='disorder']").find("input").val("off");
                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("3_screens", GLOBAL_STATE.modes);
                        exclude_el_from_array("disorder", GLOBAL_STATE.modes);
                        include_el_to_array("2_screens", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["2_screens"];
                    }
                    create_screens(2);
                    GLOBAL_STATE[2].parameters = GLOBAL_STATE[1].parameters;
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("2_screens", GLOBAL_STATE.modes);
                    }
                    create_screens(1);
                }
                break;
            case "3_screens":
                if (value === "off") {
                    $(".mode[data-mode_type='2_screens']").find(".activity").html("");
                    $(".mode[data-mode_type='2_screens']").find("input").val("off");
                    $(".mode[data-mode_type='disorder']").find(".activity").html("");
                    $(".mode[data-mode_type='disorder']").find("input").val("off");

                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("2_screens", GLOBAL_STATE.modes);
                        exclude_el_from_array("disorder", GLOBAL_STATE.modes);
                        include_el_to_array("3_screens", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["3_screens"];
                    }
                    create_screens(3);
                    GLOBAL_STATE[2].parameters = GLOBAL_STATE[1].parameters;
                    GLOBAL_STATE[3].parameters = GLOBAL_STATE[1].parameters;
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("3_screens", GLOBAL_STATE.modes);
                    }
                    create_screens(1);
                }
                break;
            case "decimal_1":
                if (value === "off") {
                    $(".mode[data-mode_type='decimal_2']").find(".activity").html("");
                    $(".mode[data-mode_type='decimal_2']").find("input").val("off");

                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("decimal_2", GLOBAL_STATE.modes);
                        include_el_to_array("decimal_1", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["decimal_1"];
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.digits_nmb = 3;
                        GLOBAL_STATE[i].parameters.decimal = "1_digit";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("decimal_1", GLOBAL_STATE.modes);
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.decimal = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                }
                break;
            case "decimal_2":
                if (value === "off") {
                    $(".mode[data-mode_type='decimal_1']").find(".activity").html("");
                    $(".mode[data-mode_type='decimal_1']").find("input").val("off");

                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("decimal_1", GLOBAL_STATE.modes);
                        include_el_to_array("decimal_2", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["decimal_2"];
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.digits_nmb = 3;
                        GLOBAL_STATE[i].parameters.decimal = "2_digit";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("decimal_2", GLOBAL_STATE.modes);
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.decimal = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                }
                break;
            case "mode_50":
                if (value === "off") {
                    $(".mode[data-mode_type='mode_100']").find(".activity").html("");
                    $(".mode[data-mode_type='mode_100']").find("input").val("off");

                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("mode_100", GLOBAL_STATE.modes);
                        include_el_to_array("mode_50", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["mode_50"];
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "combo";
                        GLOBAL_STATE[i].parameters.operation = "plus_minus";
                        GLOBAL_STATE[i].parameters.mode_100 = "off";
                        GLOBAL_STATE[i].parameters.mode_50 = "training";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("mode_50", GLOBAL_STATE.modes);
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.mode_50 = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                }
                break;
            case "mode_100":
                if (value === "off") {
                    $(".mode[data-mode_type='mode_50']").find(".activity").html("");
                    $(".mode[data-mode_type='mode_50']").find("input").val("off");

                    $this.find("input").val("on");
                    $this.find(".activity").html($$check_symbol);
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("default", GLOBAL_STATE.modes);
                        exclude_el_from_array("mode_50", GLOBAL_STATE.modes);
                        include_el_to_array("mode_100", GLOBAL_STATE.modes)
                    } else {
                        GLOBAL_STATE.modes = ["mode_100"];
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "combo";
                        GLOBAL_STATE[i].parameters.operation = "plus_minus";
                        GLOBAL_STATE[i].parameters.mode_50 = "off";
                        GLOBAL_STATE[i].parameters.mode_100 = "training";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                } else {
                    $this.find("input").val("off");
                    $this.find(".activity").html("");
                    if (GLOBAL_STATE.modes) {
                        exclude_el_from_array("mode_100", GLOBAL_STATE.modes);
                    }
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.mode_100 = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global")
                }
                break;
        }
    }

    $(document).ready(function() {

        $(document).on("change", "#topic", function() {

            switch ($(this).val()) {
                case "simple_mirror":
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.discharge_mode = "mirror";
                        GLOBAL_STATE[i].parameters.modules = "simple";
                        GLOBAL_STATE[i].parameters.sign = "off";
                        GLOBAL_STATE[i].parameters.decimal = "off";
                        GLOBAL_STATE[i].parameters.digits_nmb = 2;
                        GLOBAL_STATE[i].parameters.actions_nmb = 5;
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global");
                    break;
                case "brother_mirror":
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "brother";
                        GLOBAL_STATE[i].parameters.digits_nmb = 2;
                        GLOBAL_STATE[i].parameters.sign = "off";
                        GLOBAL_STATE[i].parameters.decimal = "off";
                        GLOBAL_STATE[i].parameters.actions_nmb = 5;
                        GLOBAL_STATE[i].parameters.discharge_mode = "mirror";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global");
                    break;
                case "simple_brother":
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "brother";
                        GLOBAL_STATE[i].parameters.digits_nmb = 2;
                        GLOBAL_STATE[i].parameters.sign = "off";
                        GLOBAL_STATE[i].parameters.decimal = "off";
                        GLOBAL_STATE[i].parameters.actions_nmb = 5;
                        GLOBAL_STATE[i].parameters.all_discharge = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global");
                    break;
                case "friend_less_100":
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "friend,brother_fr";
                        GLOBAL_STATE[i].parameters.digits_nmb = 2;
                        GLOBAL_STATE[i].parameters.mode_50 = "off";
                        GLOBAL_STATE[i].parameters.sign = "off";
                        GLOBAL_STATE[i].parameters.decimal = "off";
                        GLOBAL_STATE[i].parameters.actions_nmb = 5;
                        GLOBAL_STATE[i].parameters.all_discharge = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global");
                    break;
                case "combo_less_100":
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "combo";
                        GLOBAL_STATE[i].parameters.digits_nmb = 2;
                        GLOBAL_STATE[i].parameters.mode_50 = "off";
                        GLOBAL_STATE[i].parameters.sign = "off";
                        GLOBAL_STATE[i].parameters.decimal = "off";
                        GLOBAL_STATE[i].parameters.actions_nmb = 5;
                        GLOBAL_STATE[i].parameters.all_discharge = "off";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global");
                    break;
                case "train_mode_50":
                    change_mode("mode_50");
                    break;
                case "train_mode_100":
                    change_mode("mode_100");
                    break;
                case "train_sign":
                    change_mode("negative");
                    break;
                case "random":
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].parameters.modules = "random";
                        GLOBAL_STATE[i].parameters.digits_nmb = 2;
                        GLOBAL_STATE[i].parameters.mode_50 = "on";
                        GLOBAL_STATE[i].parameters.mode_100 = "on";
                        GLOBAL_STATE[i].parameters.actions_nmb = 5;
                        GLOBAL_STATE[i].parameters.sign = "off";
                        GLOBAL_STATE[i].parameters.decimal = "off";
                        GLOBAL_STATE[i].parameters.all_discharge = "on";
                    }
                    set_setting_bars(GLOBAL_STATE[1], 1, "global");
                    break;
            }
        });


        $(document)
            .on("click", ".increase", function() { change_parameter($(this), "increase") })
            .on("click", ".decrease", function() { change_parameter($(this), "decrease") })
            .on("change", ".actions_nmb", function() { change_parameter($(this), "actions_nmb") })
            .on("change", ".digits_nmb", function() { change_parameter($(this), "digits_nmb") })
            .on("change", ".interval", function() { change_parameter($(this), "interval") })
            .on("click", ".operation", function() { change_parameter($(this), "operation") })
            .on("click", ".decimal", function() { change_parameter($(this), "decimal") })
            .on("click", ".sign", function() { change_parameter($(this), "sign") })
            .on("click", ".is_alternation", function() { change_parameter($(this), "is_alternation") })
            .on("click", ".operation_alternation", function() { change_parameter($(this), "operation_alternation") })
            .on("click", ".all_discharge", function() { change_parameter($(this), "all_discharge") })
            .on("click", ".discharge_mode", function() { change_parameter($(this), "discharge_mode") })
            .on("click", ".progress_speed", function() { change_parameter($(this), "progress_speed") })
            .on("click", ".progress_action", function() { change_parameter($(this), "progress_action") })
            .on("click", ".mode_50", function() { change_parameter($(this), "mode_50") })
            .on("click", ".mode_100", function() { change_parameter($(this), "mode_100") })
            .on("click", ".modules", function() { change_parameter($(this), "modules") })
            .on("click", ".checked_digits", function() { change_parameter($(this), "checked_digits") })
            .on("click", ".check_all", function() { change_parameter($(this), "check_all") });


        $(".navbar_interval").on("click", function() {
            value = get_number_float_rounded($(this).data("value"));
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].parameters.interval = value;
            }
            $(".interval_display").html(value.toString());
            $("input[name='interval']").val(value.toString());
            $(".interval").val(value)
        });

        $(".navbar_digits_nmb").on("click", function() {
            value = parseInt($(this).data("value"));
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].parameters.digits_nmb = value;
            }
            $(".digits_nmb_display").html(value.toString());
            $("input[name='digits_nmb']").val(value.toString());
            $(".digits_nmb").val(value)
        });

        $(".navbar_actions_nmb").on("click", function() {
            value = parseInt($(this).data("value"));
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].parameters.actions_nmb = value;
            }
            $(".actions_nmb_display").html(value.toString());
            $("input[name='actions_nmb']").val(value.toString());
            $(".actions_nmb").val(value)
        });

        $(".navbar_screens_nmb").on("click", function() {
            value = parseInt($(this).data("value"));
            $(".screens_nmb_display").html(value.toString());

            $(".screens_nmb").val(value);
            $("input[name='screens_nmb']").val(value.toString());
            create_screens(value);
        });

        $(".screens_nmb").on("click", function() {
            value = parseInt($(this).val());
            $(".screens_nmb_display").html(value);
            create_screens(value);
        });



        $(".mode").on("click", function() {
            mode_type = $(this).data("mode_type");
            change_mode(mode_type)
        });


        $("#save_settings").on("click", function() {
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                GLOBAL_STATE[i].parameters = get_parameters();
                set_setting_bars(GLOBAL_STATE[i], i);
            };

        });
    });

    $(document).ready(function() {
        $(document)
            .on("click", ".input_increase", function() {
                $input = $(this).closest(".inc-dec-control").find("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "input_increase",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)

            })
            .on("click", ".input_decrease", function() {
                $input = $(this).closest(".inc-dec-control").find("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "input_decrease",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("change", ".input_number", function() {
                $input = $(this);
                var args = {
                    "$this": $(this),
                    "value_type": $input.attr("name"),
                    "operation": "input_number",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("click", ".btn_checked_digits", function() {
                $input = $(this).closest("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "btn_checked_digits",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("click", ".btn_check_all_digits", function() {
                $input = $(this).closest("input");
                var args = {
                    "value_type": $input.attr("name"),
                    "operation": "btn_check_all_digits",
                    "screen_pk": $(this).closest(".screen").attr("id")
                };
                edit_parameter(args)
            })
            .on("click", ".change_value_to_default", function() {
                var value_type = $(this).data("value_type");
                var value = $(this).data("value");
                var screen_pk = $(this).closest(".screen").attr("id");
                edit_parameter({ 'screen_pk': screen_pk, 'value_type': value_type, 'value': value })
            })
    })
    </script>
    <script>
    isAutoScenario = false;
    answerEnterInterval = 4;
    newExampleStartInterval = 1;
    imgMode = false;

    last_example_was_true = true;
    stop_button_entered = false;
    var correct_answer_text = [
        'Правильный ответ!',
        'Правильный ответ!',
    ];

    var index_1 = 0;
    var index_2 = 1;

    function changeToScenarioMode(scenario) {
        isAutoScenario = true;
        selectedScenario = scenario;
        changeParametersByScanerionParameters(scenario[0])
    }

    function changeFontToSegoe() {
        value = 'segoe';
        $("#font").val(value);
        $("table").removeClass("neucha roboto dfpop1 showcard playbill jokerman segoe");
        $("table").addClass(value);

        $(".fonted").removeClass("neucha roboto dfpop1 showcard playbill jokerman segoe");
        $(".fonted").addClass(value);
    }

    function startScenarioMode(mode) {

        scenario = junior_scenario;
        global_refresh();
        clearAll()
        switch (mode) {
            case 'junior':
                scenario = junior_scenario;
                break;
            case 'middle':
                scenario = middle_scenario;
                break;
            case 'abakus':
                scenario = abakus_scenario;
                break;
            case 'upper':
                scenario = upper_scenario;
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    GLOBAL_STATE[i].parameters.modules = 'random';
                    GLOBAL_STATE[i].parameters.operation_alternation = 'on';
                    GLOBAL_STATE[i].parameters.checked_digits = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                }
                break;
        }
        isAutoScenario = true;
        example_num = 1;

        GLOBAL_STATE.double_sign_mode = false;
        create_screens(1);
        changeFontToSegoe();
        changeToScenarioMode(scenario);
        changeToCompetitionMode();
        GLOBAL_STATE.voice = false;
        scenarioParameters = scenario[0];
        if (scenarioParameters.digits_nmb === 1) {
            answerEnterInterval = 3
        } else if (scenarioParameters.digits_nmb === 2) {
            answerEnterInterval = 4
        } else if (scenarioParameters.digits_nmb === 3) {
            answerEnterInterval = 5
        } else if (scenarioParameters.digits_nmb === 4) {
            answerEnterInterval = 6
        } else {
            answerEnterInterval = 7
        }
    }

    function changeToCompetitionMode() {
        GLOBAL_STATE.competition_mode = true;
        $('.player_name').val('Олимп');
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            GLOBAL_STATE[i].player_name = 'Олимп';
        }
        GLOBAL_STATE.voice_comment = false;
        $('.btn_voice_comment').closest('a').find('.fa').addClass('d-none');

        GLOBAL_STATE.show_true_false = false;
        $('.btn_show_true_false').closest('a').find('.fa').addClass('d-none');
        $('.left_hero').addClass('invisible');
        $('.right_hero').addClass('invisible');
        $('.player_points').addClass('d-none');
        GLOBAL_STATE.show_example_number = true;
        $('.btn_show_example_number').closest('a').find('.fa').removeClass('d-none');
    }

    function startIMGMode() {

        global_refresh();
        clearAll();
        imgMode = true;
        isAutoScenario = true;
        example_num = 1;
        GLOBAL_STATE.double_sign_mode = true;
        create_screens(2);
        GLOBAL_STATE[1].parameters.checked_digits = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        GLOBAL_STATE[2] = GLOBAL_STATE[1];

        changeFontToSegoe();
        changeToScenarioMode(img_scenario);

        changeToCompetitionMode();

        scenarioParameters = img_scenario[0];
        if (scenarioParameters.digits_nmb === 1) {
            answerEnterInterval = 3
        } else if (scenarioParameters.digits_nmb === 2) {
            answerEnterInterval = 4
        } else if (scenarioParameters.digits_nmb === 3) {
            answerEnterInterval = 5
        } else if (scenarioParameters.digits_nmb === 4) {
            answerEnterInterval = 6
        } else {
            answerEnterInterval = 7
        }

    }

    function restartScenarioMode(scenario) {
        index_1 = 0;
        index_2 = 1;
        changeParametersByScanerionParameters(scenario[0])
    }

    var img_scenario = [{
            digits_nmb: 1,
            actions_nmb: 5,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 15,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 20,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 25,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 2,
            actions_nmb: 5,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 7,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 15,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 20,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 25,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 3,
            actions_nmb: 2,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 3,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 4,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 5,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 7,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 4,
            actions_nmb: 2,
            interval: 2,
            examples_nmb: 1
        },
        {
            digits_nmb: 4,
            actions_nmb: 3,
            interval: 2,
            examples_nmb: 1
        },
        {
            digits_nmb: 4,
            actions_nmb: 4,
            interval: 2,
            examples_nmb: 1
        },
        {
            digits_nmb: 4,
            actions_nmb: 5,
            interval: 2,
            examples_nmb: 1
        },
        {
            digits_nmb: 4,
            actions_nmb: 7,
            interval: 2,
            examples_nmb: 1
        },
    ];

    var abakus_scenario = [{
            digits_nmb: 1,
            actions_nmb: 4,
            interval: 2,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 4,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 6,
            interval: 2,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 4,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 4,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1,
            actions_nmb: 6,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 4,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 4,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 6,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 6,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 2,
            actions_nmb: 4,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 2,
            actions_nmb: 4,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 2,
            actions_nmb: 6,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 2,
            actions_nmb: 6,
            interval: 1,
            examples_nmb: 1
        },

        {
            digits_nmb: 2,
            actions_nmb: 8,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 2,
            actions_nmb: 8,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 4,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 4,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 6,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 6,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 8,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 8,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 4,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 4,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 6,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 6,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 8,
            interval: 1.5,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 8,
            interval: 1,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 8,
            interval: 0.9,
            examples_nmb: 1
        },
        {
            digits_nmb: 3,
            actions_nmb: 8,
            interval: 0.8,
            examples_nmb: 1
        },

    ];

    var selectedScenario = img_scenario;

    var junior_scenario = [{
            digits_nmb: 1,
            actions_nmb: 7,
            interval: 1.5,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 10,
            interval: 1.2,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 12,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 15,
            interval: 0.7,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 20,
            interval: 0.5,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 5,
            interval: 1.8,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 7,
            interval: 1.5,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 10,
            interval: 1.3,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 12,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 15,
            interval: 0.8,
            examples_nmb: 2
        },
    ];


    var middle_scenario = [{
            digits_nmb: 1,
            actions_nmb: 7,
            interval: 1.3,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 15,
            interval: 0.8,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 20,
            interval: 0.5,
            examples_nmb: 2
        },
        {
            digits_nmb: 1,
            actions_nmb: 25,
            interval: 0.3,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 6,
            interval: 1.4,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 15,
            interval: 0.7,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 15,
            interval: 0.8,
            examples_nmb: 2
        },
    ];

    var upper_scenario = [{
            digits_nmb: 1.5,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 1.5,
            actions_nmb: 15,
            interval: 0.5,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 15,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 20,
            interval: 0.8,
            examples_nmb: 2
        },
        {
            digits_nmb: 2,
            actions_nmb: 25,
            interval: 0.6,
            examples_nmb: 2
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 6,
            interval: 1.5,
            examples_nmb: 2
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 8,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 2.5,
            actions_nmb: 10,
            interval: 0.8,
            examples_nmb: 2
        },
        {
            digits_nmb: 3,
            actions_nmb: 10,
            interval: 1,
            examples_nmb: 2
        },
        {
            digits_nmb: 3,
            actions_nmb: 15,
            interval: 0.8,
            examples_nmb: 2
        },
    ];













    function startAutoScenario(interval, scenario, message) {
        if (isAutoScenario) {
            setTimeout(function() {
                startScenario(scenario)
            }, 1000 * interval);
        }
    }

    function changeParametersByScanerionParameters(scenarioParameters) {
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            GLOBAL_STATE[i].parameters.actions_nmb = scenarioParameters.actions_nmb;
            GLOBAL_STATE[i].parameters.interval = scenarioParameters.interval;
            if (scenarioParameters.digits_nmb.toString().indexOf('.') !== -1) {
                GLOBAL_STATE[i].parameters.digits_nmb = Math.round(scenarioParameters.digits_nmb);
                GLOBAL_STATE[i].parameters.is_alternation = 'on'
            } else {
                GLOBAL_STATE[i].parameters.is_alternation = 'off';
                GLOBAL_STATE[i].parameters.digits_nmb = scenarioParameters.digits_nmb;
            }


            set_setting_bars(GLOBAL_STATE[i], i)
        }
    }

    function startScenario(scenario) {
        allExamples = 0;


        var scenarioParameters = scenario[index_1];

        if (!scenarioParameters) {
            $('#modal_alert2').modal();
            $('#alert_text2').val('Конец');
            setTimeout(function() {
                $('#alert_text2').val('mindskills.ru');
                sound_click('success')
            }, 2000);
            return
        }

        changeParametersByScanerionParameters(scenarioParameters);
        if (scenarioParameters.digits_nmb === 1) {
            answerEnterInterval = 3
        } else if (scenarioParameters.digits_nmb === 2) {
            answerEnterInterval = 4
        } else if (scenarioParameters.digits_nmb === 3) {
            answerEnterInterval = 5
        } else if (scenarioParameters.digits_nmb === 3) {
            answerEnterInterval = 6
        } else {
            answerEnterInterval = 7
        }
        console.log('answerEnterInterval ', answerEnterInterval)
        console.log('scenarioParameters.digits_nmb ', scenarioParameters.digits_nmb)

        if (GLOBAL_STATE[1].status === 'answer_input') {
            if (index_2 >= scenarioParameters.examples_nmb) {
                index_1++;
                index_2 = 1;
            } else {
                index_2++;
            }

        }

        global_start();

    }

    var false_answer_text = ['Ничего страшного! В другой раз получиться!'];

    //var colors = ["#000000", "#ff4c25", "#8100ff", "#ff8106", "#08ca82", "#460dff", "#ff0c81", "#3bb400", "#0bc3eb"];
    var colors = [
        "#000000",
        "#3d46ad",
        "#0f731f",
        "#5b096e",
        "#831931",
        "#0b6583"
    ];

    var colors = [
        "#000000",
        "#3d46ad",
        "#000000",
        "#3d46ad",
        "#000000",
        "#3d46ad"
    ];
    color = "#363f7d";

    var olymp_mode = false;

    function is_olymp_mode() {
        return olymp_mode
    }

    var current_audio = new Audio();
    var current_audio2 = new Audio();
    var current_audio3 = new Audio();
    var true_key = true;
    var date_var = new Date();
    var start_time, end_time;
    var disorder_screens = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

    var true_image_classes = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];
    var false_image_classes = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];


    function clearAll() {
        for (var i = setTimeout(function() {}, 0); i > 0; i--) {
            window.clearInterval(i);
            window.clearTimeout(i);
            if (window.cancelAnimationFrame) window.cancelAnimationFrame(i);
        }
    }

    function get_number_list(start, finish) {
        numbers = [];
        for (var i = start; i <= finish; i++) {
            numbers.push(i)
        }
        return numbers
    }

    window.onload = function(ev) {


        if (!is_task_mode()) {
            $('#modal_global_settings').modal();
        }
        $.ajax({
            type: "get",
            traditional: true,
            url: $("#is_auth_check").val(),
            success: function(data) {
                if (data.res === true) {
                    script = document.createElement('script');
                    script.src = "static/games_static/js/meg_22.min.js";
                    document.body.appendChild(script);
                }
            }
        });
    };


    var firstDownload = false;

    document.onkeypress = function(e) {
        firstSoundsDownload()
    };
    document.querySelector('.modal').addEventListener('click', function() {
        firstSoundsDownload()
    });


    function firstSoundsDownload() {
        if (!firstDownload) {
            loadSoundNumbers(get_number_list(1, 100));
            firstDownload = true
        }
    }


    function alert_message(message) {
        $("#alert_message").html(message);
        $("#modal_alert").modal();
    }


    function is_olymp_task() {
        var result = false;

        if (is_olymp_mode()) {
            result = true;
        }
        return result
    }

    function stop_enter_timer(screen_id) {
        clearInterval(GLOBAL_STATE.enter_timer);
        stop_sound();
        $(".timer_bar").css("width", "100%");
        $(".timer_block").addClass("d-none");
    }

    function start_enter_timer(screen_id) {
        if (is_olymp_task()) {
            playSound("tik-tak");
            var screen_state = GLOBAL_STATE[screen_id];
            //screen_state.parameters.scenario = 'abakus_1';
            if (screen_state.parameters.scenario !== undefined || is_olymp_task()) {
                initial_interval = 7;
                var digits_nmb = screen_state.parameters.digits_nmb;
                interval = (initial_interval + digits_nmb);
                check = 0;
                width = 100;
                GLOBAL_STATE.enter_timer = setInterval(function() {
                    check += 0.2;
                    if (check > interval) {
                        clearInterval(GLOBAL_STATE.enter_timer);
                        $(".timer_bar").css("width", "100%");
                        $(".timer_block").addClass("d-none");
                        check_answer(screen_id);
                    }
                    width = (interval - check) / interval * 100;
                    $(".timer_block").removeClass("d-none");
                    $(".timer_bar").css("width", width.toString() + "%")
                }, 200)
            }
        }

    }


    var countdown_array = [];

    function is_all_screens_sychronized() {
        is_sychro = true;
        if (GLOBAL_STATE.screens_nmb === 1) {
            return true
        } else {
            for (var i = 2; i <= GLOBAL_STATE.screens_nmb; i++) {
                if (GLOBAL_STATE[i].parameters.interval !== GLOBAL_STATE[1].parameters.interval) {
                    return false
                }
            }
        }
        return true
    }

    var example_num = 1;

    function global_countdown() {

        if (device.mobile() || device.tablet()) {
            global_countdown_interval = 900;
        } else {
            global_countdown_interval = 700;
        }
        $search_area = $(document);
        $countdown_blocks = $search_area.find(".block[data-block_type='countdown_block']");
        show_block("countdown_block", "navbar");
        words = [{
                title: $("#trans_countdown_1").val(),
                font_color: "#9247c3"
            },
            {
                title: $("#trans_countdown_2").val(),
                font_color: "#9247c3"
            },
            {
                title: $("#trans_countdown_3").val(),
                font_color: "#9247c3"
            }
        ];
        for (var j = 1; j <= GLOBAL_STATE.screens_nmb; j++) {
            GLOBAL_STATE[j].status = "countdown";
        }

        var i = 0;


        GLOBAL_STATE.timer = setInterval(function() {
            if (i < 3) {
                $countdown_blocks.css("color", words[i].font_color);
                $countdown_blocks.val(words[i].title);
                playSound("countdown", i);
                i++;

            } else {
                clearInterval(GLOBAL_STATE.timer);
                $countdown_blocks.val("");
            }
        }, global_countdown_interval);

        show_main_btn_group();
    }

    function countdown(screen_id) {

        $screen = $("#" + screen_id.toString());
        $countdown_block = $screen.find(".block[data-block_type='countdown_block']");
        countdown_array[screen_id] = $countdown_block;
        show_block("countdown_block", screen_id);
        words = [{
                title: $("#trans_countdown_1").val(),
                font_color: "#ff4d2d"
            },
            {
                title: $("#trans_countdown_2").val(),
                font_color: "#4a9aff"
            },
            {
                title: $("#trans_countdown_3").val(),
                font_color: "#14bd02"
            }
        ];
        var i = 0;
        GLOBAL_STATE[screen_id].status = "countdown";
        GLOBAL_STATE[screen_id].timer = setInterval(function() {
            if (i < 3) {
                countdown_array[screen_id].css("color", words[i].font_color);
                countdown_array[screen_id].val(words[i].title);
                i++;
            } else {
                clearInterval(GLOBAL_STATE[screen_id].timer);
                countdown_array[screen_id].val("");
            }
        }, 700);
        show_main_btn_group();
    }

    function show_main_buttons(screen_pk, buttons) {
        if (screen_pk === "modal_global_settings") {
            $search_area = $(document)
        } else {
            $search_area = $("#" + screen_id)
        }

        $btn_group_main = $search_area.find(".btn_group_main");
        $btn_group_main.find(".btn").addClass("hidden");
        if (is_task_mode()) {
            exclude_el_from_array("btn_restart", buttons);
        }
        if (is_olymp_task()) {
            exclude_el_from_array("btn_show_example", buttons);
        }
        for (var el in buttons) {
            $btn_group_main.find("." + buttons[el]).removeClass("hidden");
        }
    }

    var loadedNumberSounds = [];
    var soundNumberAreLoaded = true;


    function loadSoundNumbers(numbers) {

        console.log('loading ')
        var newVoice = false;
        for (var el of numbers) {
            if (Math.abs(el) > 100) {
                newVoice = true;
                break;
            }
        }

        var loadedNumbersNmb = 0;
        voiceUrl = 'static/games_audio/new/numbers/ru2/';
        oldVoiceUrl = 'static/games_audio/voice/russian/female_3/';
        var soundHowl;
        for (var number of numbers) {
            number = Math.abs(number);

            if (Math.round(number) === number) {

                if (number < 100) {
                    if (!newVoice) {

                        if (loadedNumberSounds.indexOf(number) === -1 || true) {
                            loadedNumberSounds.push(number);

                            soundHowl = new Howl({
                                src: [`${oldVoiceUrl}${number}.mp3`],
                                onload: function() {

                                }

                            });
                            soundHowl = new Howl({
                                src: [`${oldVoiceUrl}plus_${number}.mp3`],
                                onload: function() {

                                }
                            });
                            soundHowl = new Howl({
                                src: [`${oldVoiceUrl}minus_${number}.mp3`],
                                onload: function() {

                                }
                            });
                        } else {
                            loadedNumbersNmb += 3;
                        }

                    } else {
                        if (loadedNumberSounds.indexOf(number) === -1 || true) {
                            loadedNumberSounds.push(number);
                            soundHowl = new Howl({
                                src: [`${voiceUrl}${number}.mp3`],
                                onload: function() {

                                }
                            });
                        } else {
                            loadedNumbersNmb += 3;
                        }
                    }
                } else if (number >= 100 && number < 1000) {
                    decades = number % 100;
                    hundreds = number - decades;
                    if (decades === 0) {

                        soundHowl = new Howl({
                            src: [`${voiceUrl}+${hundreds}.mp3`],
                            onload: function() {

                            }
                        });

                        soundHowl = new Howl({
                            src: [`${voiceUrl}-${hundreds}.mp3`],
                            onload: function() {

                            }
                        });
                        soundHowl = new Howl({
                            src: [`${voiceUrl}${hundreds}.mp3`],
                            onload: function() {

                            }
                        });

                    } else {


                        soundHowl = new Howl({
                            src: [`${voiceUrl}${decades}.mp3`],
                            onload: function() {
                                console.log(`new ${number} loaded`)
                            }

                        });

                        soundHowl = new Howl({
                            src: [`${voiceUrl}${hundreds}_.mp3`],
                            onload: function() {
                                console.log(`new ${number} loaded`)
                            }
                        });

                        soundHowl = new Howl({
                            src: [`${voiceUrl}+${hundreds}_.mp3`],
                            onload: function() {
                                console.log(`new ${number} loaded`)
                            }
                        });

                        soundHowl = new Howl({
                            src: [`${voiceUrl}-${hundreds}_.mp3`],
                            onload: function() {
                                console.log(`new ${number} loaded`)
                            }
                        });

                    }

                }

            } else {
                soundNumberAreLoaded = true
            }
        }

        if (loadedNumbersNmb >= numbers.length * 3) {
            soundNumberAreLoaded = true
        }
    }

    function canHideNumbers() {
        if (GLOBAL_STATE[1].parameters.digits_nmb === 1 && GLOBAL_STATE[1].parameters.interval < 0.6) {
            return false
        } else if (GLOBAL_STATE[1].parameters.digits_nmb === 2 && GLOBAL_STATE[1].parameters.interval < 1) {
            return false
        } else if (GLOBAL_STATE[1].parameters.digits_nmb === 3 && GLOBAL_STATE[1].parameters.interval < 1.4) {
            return false
        }
        return true
    }

    function startVoicingNumbers() {
        GLOBAL_STATE.additional_timer = setTimeout(function() {
            show_block("problem_block", "global");
            if (GLOBAL_STATE.interval > 0.1) {
                soundNumber(GLOBAL_STATE[1].example, num_summand)
            }
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                $screen = $("#" + i.toString());
                $problem_plock = $screen.find(".block[data-block_type='problem_block']");
                $problem_block_input = $problem_plock.find("input");
                num_summand = parseInt(num_summand);
                summand = GLOBAL_STATE[i].example[parseInt(num_summand)];

                if (GLOBAL_STATE.double_sign_mode) {
                    GLOBAL_STATE[2] = GLOBAL_STATE[1]
                }

                if (summand !== undefined) {
                    GLOBAL_STATE[i].status = "process";

                    if (exist_in_array("disorder", GLOBAL_STATE.modes)) {
                        if (disorder_screens.length === 0) {
                            disorder_screens = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
                        }
                        random_disorder_screen_number = disorder_screens[randomInteger(disorder_screens.length)];
                        exclude_el_from_array(random_disorder_screen_number, disorder_screens);
                        $$random_disorder_screen = $problem_plock.find(".disorder_screen[data-screen_number='" + random_disorder_screen_number + "']");
                        $$random_disorder_screen.css("color", colors[(parseInt(num_summand) + parseInt(i)) % 6]);
                        if ($("#name_methodic").val() === "amakids") {
                            if (summand > 0) {
                                summand = "+" + summand.toString()
                            }
                        }
                        $$random_disorder_screen.val(summand)
                    } else {

                        if (GLOBAL_STATE.double_sign_mode) {
                            $problem_block_input.css("color", colors[(parseInt(num_summand)) % 6]);
                        } else {
                            $problem_block_input.css("color", colors[(parseInt(num_summand) + parseInt(i)) % 6]);
                        }


                        if (GLOBAL_STATE.double_sign_mode) {
                            if (i === 1 && summand > 0) {
                                summand = "+" + summand.toString()
                            }

                        } else {
                            if ($("#name_methodic").val() === "amakids") {
                                if (summand > 0) {

                                    summand = "+" + summand.toString()
                                }
                            }
                        }

                        $problem_block_input.val(summand);

                    }

                } else {
                    GLOBAL_STATE[i].status = "answer_input";


                    show_block("answer_input_block", i);
                    start_enter_timer(i);
                    show_main_buttons(i, ["btn_next", "btn_restart", "btn_show_settings"]);
                }

            }
            show_main_btn_group();
            num_summand = parseInt(num_summand);
            num_summand++;




            $problem_block_input = $(document).find(".block[data-block_type='problem_block']").find("input");
            add_css_animation($problem_block_input, screen_state.parameters.interval, screen_state.parameters.actions_nmb);
            GLOBAL_STATE.timer = setInterval(function() {
                if (parseInt(num_summand) >= parseInt(max_example_length)) {
                    clearInterval(GLOBAL_STATE.timer);
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].status = "answer_input";

                        show_block("answer_input_block", i);
                        start_enter_timer(i);
                        show_main_buttons(i, ["btn_next", "btn_restart", "btn_show_settings"]);

                        startAutoScenario(answerEnterInterval, selectedScenario, 'answer_input')


                    }
                    show_main_btn_group();
                } else {
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        $screen = $("#" + i.toString());
                        $problem_block_input = $screen.find(".block[data-block_type='problem_block']").find("input");
                        summand = GLOBAL_STATE[i].example[parseInt(num_summand)];
                        if (summand !== undefined) {
                            GLOBAL_STATE[i].status = "process";
                            if (exist_in_array("disorder", GLOBAL_STATE.modes)) {
                                $$random_disorder_screen = $problem_plock.find(".disorder_screen");
                                $$random_disorder_screen.val("");
                                if (disorder_screens.length === 0) {
                                    disorder_screens = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
                                }
                                random_disorder_screen_number = disorder_screens[randomInteger(disorder_screens.length)];
                                exclude_el_from_array(random_disorder_screen_number, disorder_screens);
                                $$random_disorder_screen = $problem_plock.find(".disorder_screen[data-screen_number='" + random_disorder_screen_number + "']");
                                $$random_disorder_screen.css("color", colors[(parseInt(num_summand) + i) % 6]);
                                if ($("#name_methodic").val() === "amakids") {
                                    if (summand > 0) {
                                        summand = "+" + summand.toString()
                                    }
                                }


                                $$random_disorder_screen.val(summand)
                            } else {

                                if (GLOBAL_STATE.double_sign_mode) {
                                    $problem_block_input.css("color", colors[(parseInt(num_summand)) % 6]);
                                } else {
                                    $problem_block_input.css("color", colors[(parseInt(num_summand) + parseInt(i)) % 6]);
                                }
                                if (GLOBAL_STATE.double_sign_mode) {


                                    if (i === 1 && summand > 0) {
                                        console.log('i === 1')

                                        summand = "+" + summand.toString()
                                    }

                                } else {
                                    if ($("#name_methodic").val() === "amakids") {
                                        if (summand > 0) {

                                            summand = "+" + summand.toString()
                                        }
                                    }
                                }
                                $problem_block_input.val(summand)
                            }
                        } else {
                            GLOBAL_STATE[i].status = "answer_input";
                            start_enter_timer(i);


                            show_block("answer_input_block", i);
                            show_main_buttons(i, ["btn_next", "btn_restart", "btn_show_settings"]);
                        }
                    }
                    show_main_btn_group();






                    soundNumber(GLOBAL_STATE[1].example, parseInt(num_summand));
                    num_summand = parseInt(num_summand);
                    num_summand++;
                }
            }, GLOBAL_STATE.interval * 1000)
        }, global_countdown_interval)
    }

    function global_start_inner(mode) {

        if (is_olymp_task()) {
            $('.btn_pause').addClass('d-none');
            $('#btn_global_stop').addClass('d-none');
        }
        if (is_task_mode() && (!GLOBAL_STATE[1].parameters ||
                GLOBAL_STATE[1].parameters.examples_nmb < 1 ||
                !GLOBAL_STATE[1].parameters.examples_nmb)) {
            location.reload()
        }

        if (GLOBAL_STATE.screens_nmb === 1) {
            $screen = $('.screen');
            $problem_block_input = $screen.find(".block[data-block_type='problem_block']").find("input");

            if (canHideNumbers()) {
                if (is_task_mode()) {
                    if (!GLOBAL_STATE.show_numbers || GLOBAL_STATE[1].parameters.show_numbers === 'off') {
                        $problem_block_input.addClass('invisible');
                    } else {
                        $problem_block_input.removeClass('invisible');
                    }
                } else {
                    if (!GLOBAL_STATE.show_numbers) {
                        $problem_block_input.addClass('invisible');
                    } else {
                        $problem_block_input.removeClass('invisible');
                    }
                }
            } else {
                $problem_block_input.removeClass('invisible');
            }
        }

        $(".disorder_screen").val("");
        global_status = get_global_status();
        if (mode === "restart") {
            global_status = "stopped"
        }
        if (is_all_examples_done()) {
            $("#modal_result").modal()
        } else {
            switch (global_status) {
                case "paused":
                case "stopped":
                    example_num++;
                    $screen_bg_color = $(".bg_color");
                    $screen_bg_color.removeClass("screen-success screen-error screen-info");
                    $player_name_title = $(".player_name_title");
                    $player_name_title.removeClass("btn-success btn-danger").addClass("btn-warning");
                    if (mode === undefined) {
                        mode = "start"
                    }

                    if (is_task_mode() && !last_example_was_true && GLOBAL_STATE[1].parameters.accept_just_true_answers === 'on' && mode !== 'restart') {
                        mode = 'restart';
                        if (stop_button_entered) {

                        } else {
                            GLOBAL_STATE[1].done--;
                            show_result(false);
                        }


                    }
                    stop_button_entered = false;

                    global_countdown();
                    if (is_all_screens_sychronized()) {
                        GLOBAL_STATE.interval = GLOBAL_STATE[1].parameters.interval;
                        GLOBAL_STATE.actions_nmb = GLOBAL_STATE[1].parameters.actions_nmb;

                        if (mode === "start") {
                            num_summand = 0;
                            max_example_length = 0;
                            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                                change_problem_input_font(i);
                                GLOBAL_STATE[i].is_answer_entered = false;
                                screen_state = GLOBAL_STATE[i];
                                screen_state.num_example++;
                                if (parameters.operation_alternation === 'on' && (exist_in_array("friend", parameters.modules) || exist_in_array("combo", parameters.modules) || exist_in_array("random", parameters.modules))) {
                                    if (screen_state.num_example % 2 === 0) {
                                        parameters.operation = 'just_plus'
                                    } else {
                                        parameters.operation = 'plus_minus'
                                    }
                                }
                                GLOBAL_STATE[i].parameters.num_example = screen_state.num_example;
                                example_answer = generate_example(GLOBAL_STATE[i].parameters);


                                GLOBAL_STATE[i].example = example_answer.example;
                                if (GLOBAL_STATE[i].example.length > max_example_length) {
                                    max_example_length = GLOBAL_STATE[i].example.length;
                                }
                                GLOBAL_STATE[i].answer = example_answer.answer;
                                loadSoundNumbers(GLOBAL_STATE[i].example)

                            }
                        } else if (mode === "continue") {

                        } else if (mode === 'restart') {
                            console.log('restart restart');
                            console.log('example_answer ', GLOBAL_STATE[1].example)
                            num_summand = 0;
                        } else {
                            num_summand = 0;
                        }

                        if (device.mobile() || device.tablet()) {
                            global_countdown_interval = 4000;
                        } else {
                            global_countdown_interval = 3500;
                        }


                        //var checkInterval = setInterval(function () {
                        //  console.log('nooo!!!');
                        // if (soundNumberAreLoaded) {
                        //    startVoicingNumbers();
                        //    clearInterval(checkInterval)
                        // }
                        //}, 10);


                        startVoicingNumbers();


                    } else {
                        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                            start_example(i, "global")
                        }
                    }
                    show_main_btn_group();
                    break;
                case "countdown":
                    stop_example("global");
                    break;
                case "process":

                    pause_example("global");

                    break;
                case "answer_input":
                    global_check_answer();
                    break;
            }
        }
    }

    function global_start(mode) {


        if (GLOBAL_STATE.show_example_number && GLOBAL_STATE[1].status === 'stopped') {
            show_example_num();
            setTimeout(function() {
                global_start_inner(mode)
            }, 3000)
        } else {

            if (['stopped', 'answer_input'].indexOf(get_global_status()) !== -1) {
                clearAll()
            }

            global_start_inner(mode)
        }
    }


    function add_css_animation($element, interval, repeats_nmb) {








    }

    function start_example(screen_id, mode) {
        change_problem_input_font(screen_id);
        if (mode === undefined) {
            mode = "start";
        }

        var $screen = $("#" + screen_id.toString());
        $screen_bg_color = $screen.find(".bg_color");
        $screen_bg_color.removeClass("screen-success screen-error screen-info");
        var $player_name_title = $screen.find(".player_name_title");
        $player_name_title.removeClass("btn-success btn-danger").addClass("btn-warning");
        var $problem_block_input = $screen.find(".block[data-block_type='problem_block']").find("input");
        var screen_state = GLOBAL_STATE[screen_id];

        screen_state.is_answer_entered = false;
        if (mode === "restart") {


            var example = screen_state.example;
            var answer = screen_state.answer;
            screen_state.num_summand = 0;
            first_number = 0;
            $problem_block_input.val("");
            countdown(screen_id);
            countdown_interval = 3500;
        } else if (mode === "start") {
            screen_state.num_example++;
            if (parameters.operation_alternation === 'on' && (exist_in_array("friend", parameters.modules) || exist_in_array("combo", parameters.modules) || exist_in_array("random", parameters.modules))) {
                if (screen_state.num_example % 2 === 0) {
                    parameters.operation = 'just_plus'
                } else {
                    parameters.operation = 'plus_minus'
                }
            }
            screen_state.num_example++;
            if (parameters.operation_alternation === 'on' && (exist_in_array("friend", parameters.modules) || exist_in_array("combo", parameters.modules) || exist_in_array("random", parameters.modules))) {
                if (screen_state.num_example % 2 === 0) {
                    parameters.operation = 'just_plus'
                } else {
                    parameters.operation = 'plus_minus'
                }
            }
            screen_state.parameters.num_example = screen_state.num_example;
            example_answer = generate_example(screen_state.parameters);
            screen_state.example = example_answer.example;
            screen_state.answer = example_answer.answer;
            var example = screen_state.example;
            var answer = screen_state.answer;
            screen_state.num_summand = 0;
            countdown(screen_id);
            countdown_interval = 3500;
        } else if (mode === "continue") {
            GLOBAL_STATE[screen_id].num_summand = parseInt(GLOBAL_STATE[screen_id].num_summand);
            GLOBAL_STATE[screen_id].num_summand++;
            var example = screen_state.example;
            var answer = screen_state.answer;
            countdown(screen_id);
            countdown_interval = 3500;
        } else if (mode === "global") {
            screen_state.num_example++;
            if (parameters.operation_alternation === 'on' && (exist_in_array("friend", parameters.modules) || exist_in_array("combo", parameters.modules) || exist_in_array("random", parameters.modules))) {
                if (screen_state.num_example % 2 === 0) {
                    parameters.operation = 'just_plus'
                } else {
                    parameters.operation = 'plus_minus'
                }
            }
            screen_state.parameters.num_example = screen_state.num_example;
            example_answer = generate_example(screen_state.parameters);
            screen_state.example = example_answer.example;
            screen_state.answer = example_answer.answer;
            var example = screen_state.example;
            var answer = screen_state.answer;
            GLOBAL_STATE[screen_id].num_summand = 0;
            countdown_interval = 3500;
        }


        screen_state.additional_timer = setTimeout(function() {
            show_block("problem_block", screen_id);
            GLOBAL_STATE[screen_id].status = "process";
            show_main_btn_group();


            if (GLOBAL_STATE.double_sign_mode) {
                $problem_block_input.css("color", colors[(parseInt(screen_state.num_summand)) % 6]);
            } else {
                $problem_block_input.css("color", colors[(parseInt(screen_state.num_summand) + parseInt(i)) % 6]);
            }

            if ($("#name_methodic").val() === "amakids") {
                summand = example[parseInt(GLOBAL_STATE[screen_id].num_summand)];
                if (summand > 0) {
                    summand = "+" + summand.toString()
                }
                $problem_block_input.val(summand);
            } else {
                $problem_block_input.val(example[parseInt(screen_state.num_summand)]);
            }












            GLOBAL_STATE[parseInt(screen_id)].timer = setInterval(function() {
                GLOBAL_STATE[parseInt(screen_id)].num_summand = parseInt(GLOBAL_STATE[parseInt(screen_id)].num_summand);
                GLOBAL_STATE[parseInt(screen_id)].num_summand++;
                if (example[parseInt(GLOBAL_STATE[parseInt(screen_id)].num_summand)] === undefined) {
                    clearInterval(screen_state.timer);
                    GLOBAL_STATE[screen_id].status = "answer_input";
                    show_main_btn_group();
                    show_block("answer_input_block", screen_id);
                    show_main_buttons(screen_id, ["btn_next", "btn_restart", "btn_show_settings"]);
                    start_enter_timer(screen_id);


                } else {







                    if (GLOBAL_STATE.double_sign_mode) {
                        $problem_block_input.css("color", colors[(parseInt(screen_state.num_summand)) % 6]);
                    } else {
                        $problem_block_input.css("color", colors[(parseInt(screen_state.num_summand) + parseInt(i)) % 6]);
                    }

                    if ($("#name_methodic").val() === "amakids") {
                        summand = example[parseInt(screen_state.num_summand)];
                        if (summand > 0) {
                            summand = "+" + summand.toString()
                        }
                        $problem_block_input.val(summand);
                    } else {
                        $problem_block_input.val(example[parseInt(screen_state.num_summand)]);
                    }
                }
            }, screen_state.parameters.interval * 1000)
        }, countdown_interval)
    }

    function stop_example(screen_pk) {

        if (!is_olymp_task()) {
            stop_button_entered = true;
            if (screen_pk === "global") {
                search_area = $(document);
                for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                    GLOBAL_STATE[i].status = "stopped";
                    clearInterval(GLOBAL_STATE[i].timer);
                    clearTimeout(GLOBAL_STATE[i].additional_timer);
                    if (GLOBAL_STATE[i].example.length > 0) {
                        show_main_buttons(i, ["btn_next", "btn_restart", "btn_show_settings"]);
                    } else {
                        show_main_buttons(i, ["btn_start", "btn_show_settings"]);
                    }
                }
                show_block("main_block", "global");
                clearInterval(GLOBAL_STATE.timer);
                clearTimeout(GLOBAL_STATE.additional_timer);
            } else {
                $search_area = $("#" + screen_pk);
                screen_id = parseInt(screen_pk);
                GLOBAL_STATE[screen_id].status = "stopped";

                clearInterval(GLOBAL_STATE[screen_id].timer);
                clearTimeout(GLOBAL_STATE[screen_id].additional_timer);
                if (GLOBAL_STATE[screen_id].example.length > 0) {
                    show_main_buttons(screen_id, ["btn_next", "btn_restart", "btn_show_settings"]);
                } else {
                    show_main_buttons(screen_id, ["btn_start", "btn_show_settings"]);
                }
            }
            show_main_btn_group();
        }


    }

    function get_example_text(screen_state) {
        var example = screen_state.example;
        example_text = "";
        for (var el in example) {
            if (parseInt(el) !== 0 && example[el] > 0) {
                example_text += "+" + example[el];
            } else if (parseInt(el) !== 0 && example[el] < 0) {
                example_text += "-" + Math.abs(example[el]);
            } else {
                example_text += example[el];
            }
        }
        return example_text;
    }

    function show_example(screen_pk) {
        show_block("problem_show_block", screen_pk);
        if (screen_pk === "global") {
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                $screen = $("#" + i.toString());
                screen_state = GLOBAL_STATE[i];
                $screen.find(".problem_show").val(screen_state.example_text)
            }
        } else {
            $screen = $("#" + screen_pk);
            screen_id = parseInt(screen_pk);
            screen_state = GLOBAL_STATE[screen_id];
            $screen.find(".problem_show").val(screen_state.example_text)
        }
    }

    function do_progress(screen_state, direction) {
        if (direction === "up") {

            //screen_state.parameters.scenario = "abakus_1";
            scenario = screen_state.parameters.scenario;
            if (screen_state.parameters.scenario !== undefined) {
                if (scenario === "abakus_1" || scenario === "abakus_2" || scenario === "abakus_3" || scenario === "abakus_4") {
                    var default_interval = 2.5;
                    var min_interval = 1.5;
                    switch (screen_state.parameters.scenario) {
                        case "abakus_1":
                            default_interval = 2.5;
                            min_interval = 1;
                            break;
                        case "abakus_2":
                            default_interval = 3;
                            min_interval = 1;
                            break;
                        case "abakus_3":
                            default_interval = 3;
                            min_interval = 1.5;
                            break;
                        case "abakus_4":
                            default_interval = 3.5;
                            min_interval = 2;
                            break;
                    }
                    if (screen_state.parameters.interval <= min_interval) {
                        if (GLOBAL_STATE.check === undefined) {
                            GLOBAL_STATE.check = 1;
                        } else if (GLOBAL_STATE.check >= 3) {
                            screen_state.parameters.interval = default_interval;
                            screen_state.parameters.actions_nmb = 10;
                            if (screen_state.parameters.digits_nmb === 1) {
                                screen_state.parameters.is_alternation = "off";
                            }
                            if (screen_state.parameters.is_alternation === "on") {
                                screen_state.parameters.is_alternation = "off";
                            } else {
                                screen_state.parameters.is_alternation = "on";
                                screen_state.parameters.digits_nmb++
                            }
                            digits_nmb = screen_state.parameters.digits_nmb;
                            message = "Сейчас будут " + digits_nmb.toString() + " значные числа";
                            if (screen_state.parameters.is_alternation) {
                                message += " с чередованием"
                            }
                            alert_message(message)
                        } else {
                            GLOBAL_STATE.check++
                        }
                    }

                }
            }

            if (screen_state.parameters.progress_actions_nmb > 0 && screen_state.parameters.progress_interval === 0) {
                screen_state.progress_variant = "action"
            }
            if (screen_state.progress_variant === undefined) {

                if (screen_state.parameters.progress_interval > 0) {
                    screen_state.progress_variant = 'interval'
                } else if (screen_state.parameters.progress_impulses_nmb > 0) {
                    screen_state.progress_variant = 'action'
                }
            } else {
                if (screen_state.parameters.progress_interval > 0 && screen_state.parameters.progress_actions_nmb === 0) {
                    screen_state.progress_variant = 'interval'
                } else if (screen_state.parameters.progress_actions_nmb > 0 && screen_state.parameters.progress_interval === 0) {
                    screen_state.progress_variant = 'action'
                }
            }


            if (screen_state.parameters.progress_actions_nmb > 0 && screen_state.progress_variant === "action") {
                screen_state.progress_key++;
                if (screen_state.progress_key >= screen_state.parameters.progress_actions_nmb) {
                    screen_state.progress_key = 0;
                    screen_state.parameters.actions_nmb++;
                    if (screen_state.parameters.progress_interval > 0) {
                        screen_state.progress_variant = "interval"
                    }
                }
            } else if (screen_state.parameters.progress_interval > 0 && screen_state.progress_variant === "interval") {
                screen_state.progress_key++;
                if (screen_state.progress_key >= screen_state.parameters.progress_interval) {
                    screen_state.progress_key = 0;
                    if (screen_state.parameters.interval >= 0.2) {
                        screen_state.parameters.interval -= 0.1;
                    }
                    screen_state.parameters.interval = get_number_float_rounded(screen_state.parameters.interval);
                    if (screen_state.parameters.progress_actions_nmb > 0) {
                        screen_state.progress_variant = "action"
                    }
                }
            }

            if (screen_state.parameters.progress_digits_nmb > 0 && screen_state.parameters.progress_actions_nmb === 0) {
                screen_state.parameters.progress_actions_nmb = 3
            }


            if (screen_state.parameters.progress_digits_nmb > 0 && screen_state.parameters.actions_nmb >= screen_state.parameters.progress_digits_nmb) {
                screen_state.progress_digits_nmb_key++;
                if (screen_state.progress_digits_nmb_key >= 3) {
                    screen_state.progress_digits_nmb_key = 0;
                    screen_state.parameters.digits_nmb++;
                    screen_state.parameters.actions_nmb = 3;
                    screen_state.parameters.initial_interval = screen_state.parameters.interval;
                    screen_state.parameters.interval = 3;
                }
            }
        } else if (direction === "down") {
            if (screen_state.parameters.progress_actions_nmb > 0 && screen_state.parameters.progress_interval === 0) {
                screen_state.progress_variant = "action"
            }
            if (screen_state.parameters.progress_actions_nmb > 0 && screen_state.progress_variant === "action") {
                screen_state.progress_key--;
                if (screen_state.progress_key <= -screen_state.parameters.progress_actions_nmb) {
                    screen_state.progress_key = 0;
                    if (screen_state.parameters.actions_nmb >= 3) {
                        screen_state.parameters.actions_nmb--;
                    }
                    if (screen_state.parameters.progress_interval > 0) {
                        screen_state.progress_variant = "interval"
                    }
                }
            } else if (screen_state.parameters.progress_interval > 0 && screen_state.progress_variant === "interval") {
                screen_state.progress_key--;
                if (screen_state.progress_key <= -screen_state.parameters.progress_interval) {
                    screen_state.progress_key = 0;
                    screen_state.parameters.interval += 0.1;
                    screen_state.parameters.interval = get_number_float_rounded(screen_state.parameters.interval);
                    if (screen_state.parameters.progress_actions_nmb > 0) {
                        screen_state.progress_variant = "action"
                    }
                }
            }

            if (screen_state.parameters.progress_digits_nmb > 0 && screen_state.parameters.progress_digits_nmb <= 3) {
                screen_state.progress_digits_nmb_key--;
                if (screen_state.progress_digits_nmb_key <= -3) {
                    screen_state.progress_digits_nmb_key = 0;
                    if (screen_state.parameters.digits_nmb > 1) {
                        screen_state.parameters.digits_nmb--;
                        screen_state.parameters.actions_nmb = screen_state.parameters.progress_digits_nmb;
                        screen_state.parameters.interval = screen_state.parameters.initial_interval;
                    }

                }
            }
        }
    }

    function check_answer(screen_pk) {
        stop_enter_timer(screen_pk);

        screen_id = parseInt(screen_pk);
        screen_state = GLOBAL_STATE[screen_id];
        screen_state.is_answer_entered = true;
        screen_state.status = "stopped";
        show_main_btn_group();
        show_main_buttons(screen_pk, ["btn_next", "btn_restart", "btn_show_settings"]);
        $screen = $("#" + screen_pk.toString());
        $screen_bg_color = $screen.find(".bg_color");
        $screen_bg_color.removeClass("screen-success screen-error screen-info");
        $answer_input = $screen.find(".answer_input");
        $answer_check_text = $screen.find(".answer_check_text");
        $answer_check_text.removeClass('hidden');


        if (!is_olymp_task()) {
            $('#btn_global_show_example').removeClass('hidden');
            $('.btn_show_example').removeClass('hidden');
        }


        $player_name_title = $screen.find(".player_name_title");
        $true_answer_image = $screen.find(".true_answer_image");
        $false_answer_image = $screen.find(".false_answer_image");
        $true_answer_image.addClass("hidden");
        $false_answer_image.addClass("hidden");
        $player_name_title.removeClass("btn-success btn-danger btn-warning");
        $player_points = $screen.find(".player_points");
        $answer_comment_text = $screen.find(".answer_comment_text");
        $answer_comment_block = $screen.find(".block[data-block_type='answer_comment_block']");
        player_answer = get_number_float_rounded2($answer_input.val());
        $answer_input.val("");
        screen_state.done++;
        screen_state.real_done++;
        $('.btn_reexample').addClass('hidden');

        if (is_task_mode() && screen_state.done >= screen_state.parameters.examples_nmb) {
            $screen.find(".btn_next").addClass("hidden");
            if (!is_olymp_task() && screen_state.parameters.show_results === 'on') {
                $screen.find(".btn_show_result").removeClass("hidden");
            }

        }
        if (get_number_float_rounded2(screen_state.answer) === player_answer) {
            last_example_was_true = true;
            if (is_olymp_task() || screen_state.parameters.show_results === 'off') {
                $screen_bg_color.addClass("screen-info");
            } else {
                $screen_bg_color.addClass("screen-success");
            }

            checked_answer = true;

            digits_nmb_full = screen_state.parameters.digits_nmb;
            if (screen_state.parameters.is_alternation === "on" && screen_state.parameters.digits_nmb >= 2) {
                digits_nmb_full = screen_state.parameters.digits_nmb - 0.5;
            }

            diff_points = parseInt(2 * screen_state.example.length * Math.pow(digits_nmb_full, 2) / screen_state.parameters.interval);


            example_points = 10;

            screen_state.points += example_points;
            screen_state.diff_points += diff_points;

            screen_state.correct++;

            if (true_image_classes.length === 0) {
                true_image_classes = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];
            }
            true_image_class_number = true_image_classes[randomInteger(true_image_classes.length)];
            exclude_el_from_array(true_image_class_number, true_image_classes);
            true_image_class = "true_answer_image_" + true_image_class_number.toString();

            answer_text = player_answer + " = " + screen_state.answer;


            if (is_olymp_task() || !GLOBAL_STATE.show_true_false || screen_state.parameters.show_results === 'off') {
                $screen_bg_color.addClass("screen-info");
                $answer_comment_text.html("Ответ принят");
                playSound('success')
            } else {
                $player_points.html(screen_state.points);
                $true_answer_image.removeClass("hidden");
                $true_answer_image.attr("class", "col-12 true_answer_image");
                $true_answer_image.addClass(true_image_class);
                $answer_check_text.html(answer_text);
                $player_name_title.addClass("btn-success");
                $answer_comment_text.html(correct_answer_text[random_between(1, 2)]);
            }


            //$answer_check_text.css("color", "green");


            example_text = screen_state.done + ") " + get_example_text(screen_state) + " = " + player_answer + " ✓ (" + screen_state.answer + ")";
            example_text += " [действий: " + screen_state.parameters.actions_nmb.toString() + ", интервал: " + screen_state.parameters.interval.toString() + "с., баллов за сложность: " + diff_points + "] \n";
            screen_state.example_text = example_text;
            screen_state.student_answer += example_text;

            do_progress(screen_state, "up")

        } else {
            last_example_was_true = false;
            if (parameters.accept_just_true_answers !== 'on') {
                $('.btn_reexample').removeClass('hidden');
            }

            checked_answer = false;
            answer_text = player_answer + " ≠ " + screen_state.answer;

            //$answer_check_text.css("color", "red");

            if (false_image_classes.length === 0) {
                false_image_classes = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            }
            false_image_class_number = false_image_classes[randomInteger(false_image_classes.length)];
            exclude_el_from_array(false_image_class_number, false_image_classes);
            false_image_class = "false_answer_image_" + false_image_class_number.toString();


            if (GLOBAL_STATE.double_sign_mode) {
                if (screen_state.done % 2 === 0) {
                    example_text = parseInt(screen_state.done / 2) + ") " + get_example_text(screen_state) + " ≠ " + player_answer + " ✗ (" + screen_state.answer + ")\n";
                    screen_state.example_text = example_text;
                    screen_state.student_answer += example_text;
                }
            } else {
                example_text = screen_state.done + ") " + get_example_text(screen_state) + " ≠ " + player_answer + " ✗ (" + screen_state.answer + ")\n";
                screen_state.example_text = example_text;
                screen_state.student_answer += example_text;
            }


            if (is_olymp_task() || !GLOBAL_STATE.show_true_false || screen_state.parameters.show_results === 'off') {
                $screen_bg_color.addClass("screen-info");
                $answer_comment_text.html("Ответ принят");
            } else {
                if (screen_state.parameters.accept_just_true_answers === 'off') {

                    $answer_check_text.html(answer_text);

                } else {
                    $answer_check_text.addClass('hidden');
                    $('.btn_show_example').addClass('hidden');
                    $('#btn_global_show_example').addClass('hidden');
                }

                $screen_bg_color.addClass("screen-error");
                $answer_comment_text.html($("#trans_false_answer").val());
                $false_answer_image.removeClass("hidden");
                $false_answer_image.attr("class", "col-12 false_answer_image");
                $false_answer_image.addClass(false_image_class);
                $player_name_title.addClass("btn-danger");
            }

            // progress
            do_progress(screen_state, "down")

        }
        show_block("answer_comment_block", screen_id);
        if (GLOBAL_STATE.screens_nmb === 1) {
            set_setting_bars(screen_state, screen_id, "global")
        } else {
            set_setting_bars(screen_state, screen_id)
        }
        return checked_answer
    }

    function get_global_status() {
        statuses = {
            "stopped": 0,
            "paused": 0,
            "answer_input": 0,
            "process": 0,
            "countdown": 0,
        };
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            statuses[GLOBAL_STATE[i].status]++
        }
        status = "none";
        for (var el in statuses) {
            if (statuses[el] === GLOBAL_STATE.screens_nmb) {
                status = el
            }
        }
        return status
    }

    function show_main_btn_group(mode) {
        $main_btn_group = $(".main_btn_group");
        $main_btn_group.find(".btn").addClass("hidden");

        if (mode === "result") {
            if (!is_olymp_task() &&
                screen_state.parameters.show_results === 'on' &&
                screen_state.parameters.accept_just_true_answers !== 'on') {

                $main_btn_group.find("#btn_global_show_example").removeClass("hidden");
                $main_btn_group.find("#btn_global_show_result").removeClass("hidden");
            }


            if (!is_task_mode()) {
                $main_btn_group.find("#btn_global_restart").removeClass("hidden")
            }
        } else {
            global_status = get_global_status();
            is_there_previous = true;
            is_answers_entered = true;
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                if (GLOBAL_STATE[i].example.length === 0) {
                    is_there_previous = false;
                }
                if (GLOBAL_STATE[i].is_answer_entered === false) {
                    is_answers_entered = false;
                }
            }
            switch (global_status) {
                case "stopped":
                    if (is_there_previous) {
                        $main_btn_group.find("#btn_global_next").removeClass("hidden");
                        if (!is_task_mode()) {
                            $main_btn_group.find("#btn_global_restart").removeClass("hidden")
                        }
                    } else {
                        $main_btn_group.find("#btn_global_start").removeClass("hidden");
                    }
                    if (is_answers_entered && !is_olymp_task() && screen_state.parameters.show_results === 'on' && screen_state.parameters.accept_just_true_answers !== 'on') {
                        $main_btn_group.find("#btn_global_show_example").removeClass("hidden");
                    }
                    break;
                case "countdown":
                case "process":
                    $main_btn_group.find("#btn_global_pause").removeClass("hidden");
                    break;
                case "answer_input":
                    if (!is_task_mode()) {
                        $main_btn_group.find("#btn_global_restart").removeClass("hidden")
                    }
                    $main_btn_group.find("#btn_global_check_answer").removeClass("hidden");
                    break;
                case "none":
                    $main_btn_group.find("#btn_global_stop").removeClass("hidden");
                    break;
                case "paused":
                    if (!is_task_mode()) {
                        $main_btn_group.find("#btn_global_restart").removeClass("hidden")
                    }
                    $main_btn_group.find("#btn_global_continue").removeClass("hidden");
                    break;
                case "result":
                    if (!is_task_mode()) {
                        $main_btn_group.find("#btn_global_restart").removeClass("hidden")
                    }
                    $main_btn_group.find("#btn_global_continue").removeClass("hidden");
                    break;
            }
        }

    }

    function change_problem_input_font(screen_id) {
        $screen = $("#" + screen_id.toString());
        screen_state = GLOBAL_STATE[screen_id];
        digits_nmb = screen_state.parameters.digits_nmb;
        $problem_screen_input = $screen.find(".block[data-block_type='problem_block']").find("input");
        index = 1;
        switch (GLOBAL_STATE.screens_nmb) {
            case 1:
                index = 1.4;
                break;
            case 2:
                index = 1.5;
                break;
            case 3:
                index = 3;
                break;
            case 4:
                index = 3;
                break;
            case 5:
                index = 3;
                break;
            case 6:
                index = 3;
                break;
            case 7:
                index = 4;
                break;
            case 8:
                index = 4;
                break;
            case 9:
                index = 4;
                break;
            case 10:
                index = 4;
                break;
        }
        var k = 1;
        switch (digits_nmb) {
            case 1:
                $("#font").val() === "jokerman" ? k = 3 : k = 2;
                break;
            case 2:
                $("#font").val() === "jokerman" ? k = 3 : k = 2;

                break;
            case 3:
                $("#font").val() === "jokerman" ? k = 3 : k = 2.3;
                break;
            case 4:
                k = 4;
                break;
            case 5:
                k = 5;
                break;
            case 6:
                k = 6;
                break;
            case 7:
                k = 6;
                break;
            case 8:
                k = 6;
                break;
        }
        k++;
        if (exist_in_array("disorder", GLOBAL_STATE.modes)) {
            font_size = get_number_float_rounded(100 / (5 * k)) + "vw";
        } else {
            font_size = get_number_float_rounded(90 / (index * k)) + "vw";
        }
        $problem_screen_input.css("font-size", font_size);
    }

    function is_task_mode() {
        return ($("#main_screen").data("type") === "task")
    }

    function is_all_examples_done() {
        if (is_task_mode()) {
            all_examples_done = true;
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                if (GLOBAL_STATE[i].done < GLOBAL_STATE[i].parameters.examples_nmb) {
                    all_examples_done = false;
                }
            }
            return all_examples_done
        } else {
            return false
        }
    }

    var num = 0;

    function show_result(show_modal) {
        if (show_modal === undefined) {
            show_modal = true
        }
        all_done = 0;
        all_real_done = 0;
        all_correct = 0;
        all_examples_nmb = 0;
        all_points = 0;
        all_diff_points = 0;
        all_student_answer = "";
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            all_done += GLOBAL_STATE[i].done;
            all_real_done += GLOBAL_STATE[i].real_done;
            all_points += GLOBAL_STATE[i].points;
            all_diff_points += GLOBAL_STATE[i].diff_points;
            all_correct += GLOBAL_STATE[i].correct;
            all_examples_nmb += GLOBAL_STATE[i].parameters.examples_nmb;

            if (GLOBAL_STATE.double_sign_mode) {
                if (i % 2 === 0) {
                    all_student_answer += GLOBAL_STATE[i].student_answer;
                }
            } else {
                all_student_answer += GLOBAL_STATE[i].student_answer;
            }
        }

        console.log('GLOBAL_STATE[i].student_answer ', GLOBAL_STATE)
        console.log('GLOBAL_STATE.double_sign_mode ', GLOBAL_STATE.double_sign_mode)

        console.log('all_student_answer ', all_student_answer)

        if (all_done === 0) {
            all_correct_percent = 0
        } else {
            all_correct_percent = parseInt(all_correct / all_done * 100);
        }
        all_done_percent = parseInt(all_done / all_examples_nmb * 100);
        $(".examples_done").html(all_done);
        $(".examples_nmb").html(all_examples_nmb);
        $(".correct_nmb").html(all_correct);
        $(".correctness_bar").css("width", all_correct_percent + "%");
        $(".correct_percent").html(all_correct_percent);
        $(".progress_bar").css("width", all_done_percent + "%");
        $(".done_percent").html(all_done_percent);
        $(".points").html(all_points);
        $("#points").val(all_points);
        $("#diff_points").val(all_diff_points);
        $("#student_answer").val(all_student_answer);
        $("#correct_percent").val(all_correct_percent);
        if (show_modal) {
            $('#modal_result').modal()
        }

    }

    function send_result(force, no_answer) {
        if (force === undefined) {
            force = false
        }
        if (no_answer === undefined) {
            no_answer = false
        }
        if (is_task_mode()) {
            all_done = 0;
            real_all_done = 0;
            all_correct_percent = 0;
            real_all_correct_percent = 0;
            all_correct = 0;
            all_examples_nmb = 0;
            all_points = 0;
            all_diff_points = 0;
            all_student_answer = "";
            for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                all_done += GLOBAL_STATE[i].done;
                real_all_done += GLOBAL_STATE[i].real_done;
                all_points += GLOBAL_STATE[i].points;
                all_diff_points += GLOBAL_STATE[i].diff_points;
                all_correct += GLOBAL_STATE[i].correct;
                all_examples_nmb += GLOBAL_STATE[i].parameters.examples_nmb;
                all_student_answer += GLOBAL_STATE[i].student_answer;
            }
            if (all_done !== 0) {
                all_correct_percent = parseInt(all_correct / all_done * 100);
            }
            if (real_all_done !== 0) {
                real_all_correct_percent = parseInt(all_correct / real_all_done * 100);
            }

            all_done_percent = parseInt(all_done / all_examples_nmb * 100);
            $(".examples_done").html(all_done);
            $(".examples_nmb").html(all_examples_nmb);
            $(".correct_nmb").html(all_correct);
            $(".correctness_bar").css("width", all_correct_percent + "%");
            $(".correct_percent").html(all_correct_percent);
            $(".progress_bar").css("width", all_done_percent + "%");
            $(".done_percent").html(all_done_percent);
            $(".done_nmb").html(all_done);
            $(".points").html(all_points);
            $("#points").val(all_points);
            $("#diff_points").val(all_diff_points);
            $("#student_answer").val(all_student_answer);
            $("#correct_percent").val(all_correct_percent);

            if (is_all_examples_done()) {

                if (!end_time) {
                    var d = new Date;
                    end_time = d.getTime();
                }
                duration = end_time - start_time;
                if (isNaN(duration) || isNaN(parseInt(duration))) duration = 5555;
                $("#duration").val(duration);
                seconds = duration / 1000;
                hours = parseInt(seconds / 3600);
                minutes = parseInt(seconds % 60 / 60);
                seconds = parseInt(seconds % 3600);

                if (hours === 0 && minutes === 0) {
                    duration_text = seconds + " секунд"
                } else if (hours === 0 && minutes > 0) {
                    duration_text = minutes + " минут " + seconds + " секунд"
                } else if (hours > 0) {
                    duration_text = hours + " часов " + minutes + " минут " + seconds + " секунд"
                }

                $(".duration").html(duration_text);

                done_date = new Date();
                day = parseInt(done_date.getDate());
                if (day < 10)
                    day = "0" + day.toString();
                month = parseInt(done_date.getMonth()) + 1;
                if (month < 10)
                    month = "0" + month.toString();
                year = done_date.getFullYear();
                done_date_informat = day + "." + month + "." + year;
                $("#done_date").val(done_date_informat);
                $result_form = $("#result_form");




                all_student_answer_cutted = all_student_answer.substring(0, 14900);
                screen_state = GLOBAL_STATE[1];


                var data = {
                    correct_percent: all_correct_percent,
                    real_correct_percent: real_all_correct_percent,
                    real_done_nmb: real_all_done,
                    done_date: done_date_informat,
                    done_nmb: all_done,
                    duration: duration,
                    points: all_points,
                    save_progress: false,
                    diff_points: all_diff_points,
                    status: 1,
                    student_answer: all_student_answer_cutted,
                    digits_nmb: screen_state.parameters.digits_nmb,
                    is_alternation: screen_state.parameters.is_alternation,
                    actions_nmb: screen_state.parameters.actions_nmb,
                    interval: screen_state.parameters.interval,
                };

                if (no_answer) {
                    data.student_answer = ''
                }

                if (screen_state.parameters.scenario !== undefined || is_olymp_task()) {
                    data.save_progress = true;




                }

                function getCookie(name) {
                    var matches = document.cookie.match(new RegExp(
                        "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
                    ));
                    return matches ? decodeURIComponent(matches[1]) : undefined;
                }

                data['csrfmiddlewaretoken'] = $('input[name="csrfmiddlewaretoken"]').val();
                $.ajax({
                    url: $result_form.data('action'),
                    type: 'post',
                    data: data,
                    dataType: 'json',
                    traditional: true,

                    success: function(data) {
                        if (data.res === true) {
                            $("#btn_next_tasks").removeClass("d-none");
                            $("#btn_save_results").addClass("d-none");

                            if (data.is_olymp) {
                                $(".points").parent().addClass("d-none");
                                $(".month_points").parent().addClass("d-none");
                                $(".cs_points").parent().addClass("d-none");
                                $(".summary_points").html(data.diff_points);
                                $(".summary_points").html(data.points);
                                show_main_btn_group("result");
                                sound_answer("present", "play");
                                $("#modal_result").modal()
                            } else {
                                $(".points").parent().removeClass("d-none");
                                $(".month_points").parent().removeClass("d-none");
                                $(".cs_points").parent().removeClass("d-none");
                                $(".month_points").html(data.month_points);
                                $(".cs_points").html(data.cs_points);
                                if (parseInt(data.plus_bonus) !== 0) {
                                    $(".plus_bonus_points_block").removeClass("d-none");
                                    $(".plus_bonus_points").html(data.plus_bonus);
                                }
                                if (parseInt(data.minus_bonus) !== 0) {
                                    $(".minus_bonus_points_block").removeClass("d-none");
                                    $(".minus_bonus_points").html(data.minus_bonus);
                                }
                                $(".summary_points").html(data.summary_points);
                                show_main_btn_group("result");
                                sound_answer("present", "play");
                                $("#modal_result").modal()
                            }



                        } else {
                            $("#btn_next_tasks").addClass("d-none");
                            $("#btn_save_results").removeClass("d-none");
                            msg = "";
                            for (el in data) {
                                msg += el.toString() + ': ' + data[el]
                            }
                            num++;
                            if (num >= 5) {
                                send_result(force = true, no_answer = true)
                            } else {
                                if (confirm("Результаты не сохранились - Отправить результаты повторно?")) {
                                    send_result(force = true, no_answer = true)
                                }
                            }


                        }
                    },
                    error: function(data) {
                        $("#btn_next_tasks").addClass("d-none");
                        $("#btn_save_results").removeClass("d-none");
                        msg = "";
                        for (el in data) {
                            msg += el.toString() + ': ' + data[el]
                        }
                        if (num === undefined) {
                            num = 0
                        }
                        num++;
                        if (num >= 5) {
                            send_result(force = true, no_answer = true)
                        } else {
                            if (confirm("Результаты не сохранились - Отправить результаты повторно?")) {
                                send_result(force = true, no_answer = true)
                            }
                        }


                    }
                });


            }
        }
    }

    function global_check_answer() {
        true_answer = 0;
        for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
            if (check_answer(i)) {
                true_answer++
            }
        }
        if (is_olymp_task() || !GLOBAL_STATE.show_true_false || screen_state.parameters.show_results === 'off' || screen_state.parameters.voice_results === 'off') {
            playSound("success")
        } else {
            if (true_answer >= Math.ceil(GLOBAL_STATE.screens_nmb * 0.5)) {
                if (GLOBAL_STATE.voice_comment) {
                    sound_answer("success", "play");
                } else {
                    playSound("success")
                }
            } else {
                if (GLOBAL_STATE.voice_comment) {
                    sound_answer("error", "play");
                } else {
                    playSound("error")
                }

            }
        }
        send_result();

        startAutoScenario(newExampleStartInterval, selectedScenario, 'new_example');


    }


    function pause_example(screen_pk) {
        if (!is_olymp_task()) {
            if (is_task_mode()) {
                stop_example(screen_pk)
            } else {
                if (screen_pk === "global" || screen_pk === "modal_global_settings" || screen_pk === "navbar") {
                    for (var i = 1; i <= GLOBAL_STATE.screens_nmb; i++) {
                        GLOBAL_STATE[i].status = "paused";
                        show_main_buttons(i, ["btn_continue", "btn_stop", "btn_restart"]);
                        show_block("main_block", i);
                        clearTimeout(GLOBAL_STATE[i].additional_timer);
                        clearInterval(GLOBAL_STATE[i].timer);
                    }
                    clearTimeout(GLOBAL_STATE.additional_timer);
                    clearInterval(GLOBAL_STATE.timer);
                } else {
                    screen_id = parseInt(screen_pk);
                    show_main_buttons(screen_id, ["btn_continue", "btn_stop", "btn_restart"]);
                    screen_state = GLOBAL_STATE[screen_id];
                    screen_state.status = "paused";
                    clearInterval(screen_state.timer);
                }
                show_main_btn_group();
            }
        }
    }

    $(document).ready(function() {

        if (device.mobile()) {
            $(".btn-nrm").removeClass("btn-nrm").addClass("btn-sm");
            $(".btn-nrm-2").addClass("btn-sm");
            $(".input-nrm").removeClass("input-nrm").addClass("input-sm");
            $(".input-nrm-2").addClass("input-sm")
        }

        if (is_task_mode() || device.mobile() || device.tablet()) {
            $(".screens_nmb_card").addClass("hidden")
        }
    });


    $(document).ready(function() {
        if (getInternetExplorerVersion() !== -1) {
            $("#modal_browser_alert").modal()
        }
        date_var = new Date();
        start_time = date_var.getTime();
        document.onkeyup = function(e) {
            e = e || window.event;
            if (e.keyCode === 13) {
                $modals = $(".modal");
                all_modals_closed = true;
                $modals.each(function() {
                    if ($(this).hasClass("show")) {
                        all_modals_closed = false;
                        $(this).modal("hide")
                    }
                });

                if (all_modals_closed && !$('#main_screen').hasClass('d-none')) {
                    global_start()
                }

            } else if (e.keyCode === 32) {
                stop_example("global")
            } else if (e.keyCode === 17) {
                $("#show_example_num").click()
            }
        };
        create_screens(1);

    });

    $(document)
        .on("click", ".btn_restart", function() {
            if (GLOBAL_STATE.screens_nmb === 1) {
                global_start("restart")
            } else {
                $screen = $(this).closest(".screen");
                screen_id = parseInt($screen.attr("id"));
                start_example(screen_id, "restart")
            }
        })
        .on("click", ".btn_reexample", function() {
            if (GLOBAL_STATE.screens_nmb === 1) {
                screen_state = GLOBAL_STATE[1];

                if (screen_state.done >= 1) {
                    screen_state.done--;
                    show_result(false);

                    console.log('screen_state.parameters.accept_just_true_answers ', screen_state.parameters.accept_just_true_answers)
                    if (screen_state.parameters.accept_just_true_answers === 'on') {
                        global_start("restart")
                    } else {
                        global_start("start")
                    }
                }

            } else {
                $screen = $(this).closest(".screen");
                screen_id = parseInt($screen.attr("id"));
                screen_state = GLOBAL_STATE[screen_id];
                screen_state.done--;
                start_example(screen_id, "start")
            }
        })
        .on("click", ".btn_continue", function() {
            if (GLOBAL_STATE.screens_nmb === 1) {
                global_start("continue")
            } else {
                $screen = $(this).closest(".screen");
                screen_id = parseInt($screen.attr("id"));
                start_example(screen_id, "continue")
            }
        })
        .on("click", ".btn_start", function() {
            if (GLOBAL_STATE.screens_nmb === 1) {
                global_start();
            } else {
                $screen = $(this).closest(".screen");
                screen_id = parseInt($screen.attr("id"));
                start_example(screen_id, "start")
            }
        })
        .on("click", ".btn_next", function() {
            if (GLOBAL_STATE.screens_nmb === 1) {
                global_start()
            } else {
                $screen = $(this).closest(".screen");
                screen_id = parseInt($screen.attr("id"));
                start_example(screen_id)
            }
        })
        .on("click", ".btn_pause", function() {
            screen_id = parseInt($(this).closest(".screen").attr("id"));
            if (GLOBAL_STATE.screens_nmb === 1) {
                pause_example("global")
            } else {
                pause_example(screen_id);
            }
        })
        .on("click", ".btn_stop", function() {
            screen_id = parseInt($(this).closest(".screen").attr("id"));
            stop_example(screen_id);

        })
        .on("click", ".btn_check_answer", function() {
            if (GLOBAL_STATE.screens_nmb === 1) {
                global_check_answer()
            } else {
                screen_id = parseInt($(this).closest(".screen").attr("id"));
                check_answer(screen_id);
            }

        })
        .on("click", "#btn_global_start", function() {
            global_start()
        })
        .on("click", "#btn_global_pause", function() {
            pause_example("global")
        })
        .on("click", "#btn_global_stop", function() {
            stop_example("global")
        })
        .on("click", "#btn_global_next", function() {
            global_start()
        })
        .on("click", "#btn_global_continue", function() {
            global_start("continue")
        })
        .on("click", "#btn_global_restart", function() {
            global_start("restart")
        })
        .on("click", "#btn_global_check_answer", function() {
            global_check_answer()
        })
        .on("click", ".btn_show_result", function() {
            $("#modal_result").modal()
        })
        .on("click", "#btn_global_ashow_result", function() {
            $("#modal_result").modal()
        })
        .on("change", ".player_name", function() {
            screen_id = parseInt($(this).closest(".screen").attr("id"));
            GLOBAL_STATE[screen_id].player_name = $(this).val()
        });

    $("#btn_mission_start").on("click", function() {
        date_var = new Date();
        start_time = date_var.getTime();
    });

    $("#btn_global_show_example").on("click", function() {
        show_example("global")
    });


    if (!device.mobile() && !device.tablet() && !is_task_mode()) {
        $('[data-toggle="popover"]').popover()
    }
    </script>
    <script src="static/games_static/js/meg_22.min.js"></script>
</body>

</html>